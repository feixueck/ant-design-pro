(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[3806],{64335:function(Or,U,E){"use strict";var le=E(67294),C=(0,le.createContext)({});U.Z=C},21349:function(Or,U,E){"use strict";var le=E(84305),C=E(69224),p=E(17781),A=E.n(p),Q=E(67294),Y=E(94184),W=E.n(Y),L=E(64335),N=function(Ye){var Je=(0,Q.useContext)(L.Z),et=Ye.children,Yt=Ye.contentWidth,Gt=Ye.className,tr=Ye.style,zt=(0,Q.useContext)(C.ZP.ConfigContext),Pt=zt.getPrefixCls,xt=Ye.prefixCls||Pt("pro"),yr=Yt||Je.contentWidth,ee="".concat(xt,"-grid-content");return Q.createElement("div",{className:W()(ee,Gt,{wide:yr==="Fixed"}),style:tr},Q.createElement("div",{className:"".concat(xt,"-grid-content-children")},et))};U.Z=N},46343:function(Or,U,E){"use strict";E.d(U,{zj:function(){return Ft},oI:function(){return Vi},ni:function(){return ye},gg:function(){return yn}});var le=E(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function C(ir,de,Te,Ue){function Le(kt){return kt instanceof Te?kt:new Te(function(er){er(kt)})}return new(Te||(Te=Promise))(function(kt,er){function w(je){try{Ee(Ue.next(je))}catch(Qe){er(Qe)}}function Z(je){try{Ee(Ue.throw(je))}catch(Qe){er(Qe)}}function Ee(je){je.done?kt(je.value):Le(je.value).then(w,Z)}Ee((Ue=Ue.apply(ir,de||[])).next())})}function p(ir,de){var Te={label:0,sent:function(){if(kt[0]&1)throw kt[1];return kt[1]},trys:[],ops:[]},Ue,Le,kt,er;return er={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(er[Symbol.iterator]=function(){return this}),er;function w(Ee){return function(je){return Z([Ee,je])}}function Z(Ee){if(Ue)throw new TypeError("Generator is already executing.");for(;Te;)try{if(Ue=1,Le&&(kt=Ee[0]&2?Le.return:Ee[0]?Le.throw||((kt=Le.return)&&kt.call(Le),0):Le.next)&&!(kt=kt.call(Le,Ee[1])).done)return kt;switch(Le=0,kt&&(Ee=[Ee[0]&2,kt.value]),Ee[0]){case 0:case 1:kt=Ee;break;case 4:return Te.label++,{value:Ee[1],done:!1};case 5:Te.label++,Le=Ee[1],Ee=[0];continue;case 7:Ee=Te.ops.pop(),Te.trys.pop();continue;default:if(kt=Te.trys,!(kt=kt.length>0&&kt[kt.length-1])&&(Ee[0]===6||Ee[0]===2)){Te=0;continue}if(Ee[0]===3&&(!kt||Ee[1]>kt[0]&&Ee[1]<kt[3])){Te.label=Ee[1];break}if(Ee[0]===6&&Te.label<kt[1]){Te.label=kt[1],kt=Ee;break}if(kt&&Te.label<kt[2]){Te.label=kt[2],Te.ops.push(Ee);break}kt[2]&&Te.ops.pop(),Te.trys.pop();continue}Ee=de.call(ir,Te)}catch(je){Ee=[6,je],Le=0}finally{Ue=kt=0}if(Ee[0]&5)throw Ee[1];return{value:Ee[0]?Ee[1]:void 0,done:!0}}}function A(ir,de){var Te=typeof Symbol=="function"&&ir[Symbol.iterator];if(!Te)return ir;var Ue=Te.call(ir),Le,kt=[],er;try{for(;(de===void 0||de-- >0)&&!(Le=Ue.next()).done;)kt.push(Le.value)}catch(w){er={error:w}}finally{try{Le&&!Le.done&&(Te=Ue.return)&&Te.call(Ue)}finally{if(er)throw er.error}}return kt}function Q(){for(var ir=[],de=0;de<arguments.length;de++)ir=ir.concat(A(arguments[de]));return ir}function Y(ir){return ir&&ir.__esModule&&Object.prototype.hasOwnProperty.call(ir,"default")?ir.default:ir}function W(ir,de){return de={exports:{}},ir(de,de.exports),de.exports}var L=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Te;function Te(Ue){return Ue&&typeof Ue.length=="number"&&Ue.length>=0&&Ue.length%1==0}ir.exports=de.default});Y(L);var N=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=function(Te){return function(){for(var Ue=[],Le=arguments.length;Le--;)Ue[Le]=arguments[Le];var kt=Ue.pop();return Te.call(this,Ue,kt)}},ir.exports=de.default});Y(N);var Be=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.fallback=Le,de.wrap=kt;var Te=de.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Ue=de.hasNextTick=typeof le=="object"&&typeof le.nextTick=="function";function Le(w){setTimeout(w,0)}function kt(w){return function(Z){for(var Ee=[],je=arguments.length-1;je-- >0;)Ee[je]=arguments[je+1];return w(function(){return Z.apply(void 0,Ee)})}}var er;Te?er=setImmediate:Ue?er=le.nextTick:er=Le,de.default=kt(er)});Y(Be);var Ye=Be.fallback,Je=Be.wrap,et=Be.hasSetImmediate,Yt=Be.hasNextTick,Gt=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=kt;var Te=Le(N),Ue=Le(Be);function Le(Z){return Z&&Z.__esModule?Z:{default:Z}}function kt(Z){return(0,tr.isAsync)(Z)?function(){for(var Ee=[],je=arguments.length;je--;)Ee[je]=arguments[je];var Qe=Ee.pop(),yt=Z.apply(this,Ee);return er(yt,Qe)}:(0,Te.default)(function(Ee,je){var Qe;try{Qe=Z.apply(this,Ee)}catch(yt){return je(yt)}if(Qe&&typeof Qe.then=="function")return er(Qe,je);je(null,Qe)})}function er(Z,Ee){return Z.then(function(je){w(Ee,null,je)},function(je){w(Ee,je&&je.message?je:new Error(je))})}function w(Z,Ee,je){try{Z(Ee,je)}catch(Qe){(0,Ue.default)(function(yt){throw yt},Qe)}}ir.exports=de.default});Y(Gt);var tr=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.isAsyncIterable=de.isAsyncGenerator=de.isAsync=void 0;var Te=Ue(Gt);function Ue(Z){return Z&&Z.__esModule?Z:{default:Z}}function Le(Z){return Z[Symbol.toStringTag]==="AsyncFunction"}function kt(Z){return Z[Symbol.toStringTag]==="AsyncGenerator"}function er(Z){return typeof Z[Symbol.asyncIterator]=="function"}function w(Z){if(typeof Z!="function")throw new Error("expected a function");return Le(Z)?(0,Te.default)(Z):Z}de.default=w,de.isAsync=Le,de.isAsyncGenerator=kt,de.isAsyncIterable=er});Y(tr);var zt=tr.isAsyncIterable,Pt=tr.isAsyncGenerator,xt=tr.isAsync,yr=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Te;function Te(Ue,Le){if(Le===void 0&&(Le=Ue.length),!Le)throw new Error("arity is undefined");function kt(){for(var er=this,w=[],Z=arguments.length;Z--;)w[Z]=arguments[Z];return typeof w[Le-1]=="function"?Ue.apply(this,w):new Promise(function(Ee,je){w[Le-1]=function(Qe){for(var yt=[],St=arguments.length-1;St-- >0;)yt[St]=arguments[St+1];if(Qe)return je(Qe);Ee(yt.length>1?yt:yt[0])},Ue.apply(er,w)})}return Object.defineProperty(kt,"name",{configurable:!0,value:"awaitable("+Ue.name+")"}),kt}ir.exports=de.default});Y(yr);var ee=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=kt(L),Ue=kt(tr),Le=kt(yr);function kt(er){return er&&er.__esModule?er:{default:er}}de.default=(0,Le.default)(function(er,w,Z){var Ee=(0,Te.default)(w)?[]:{};er(w,function(je,Qe,yt){(0,Ue.default)(je)(function(St){for(var jt,Et=[],Qt=arguments.length-1;Qt-- >0;)Et[Qt]=arguments[Qt+1];Et.length<2&&(jt=Et,Et=jt[0]),Ee[Qe]=Et,yt(St)})},function(je){return Z(je,Ee)})},3),ir.exports=de.default});Y(ee);var vr=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Te;function Te(Ue){function Le(){for(var kt=[],er=arguments.length;er--;)kt[er]=arguments[er];if(Ue!==null){var w=Ue;Ue=null,w.apply(this,kt)}}return Object.assign(Le,Ue),Le}ir.exports=de.default});Y(vr);var Ct=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=function(Te){return Te[Symbol.iterator]&&Te[Symbol.iterator]()},ir.exports=de.default});Y(Ct);var Ke=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Z;var Te=Le(L),Ue=Le(Ct);function Le(Ee){return Ee&&Ee.__esModule?Ee:{default:Ee}}function kt(Ee){var je=-1,Qe=Ee.length;return function(){return++je<Qe?{value:Ee[je],key:je}:null}}function er(Ee){var je=-1;return function(){var yt=Ee.next();return yt.done?null:(je++,{value:yt.value,key:je})}}function w(Ee){var je=Ee?Object.keys(Ee):[],Qe=-1,yt=je.length;return function(){var jt=je[++Qe];return Qe<yt?{value:Ee[jt],key:jt}:null}}function Z(Ee){if((0,Te.default)(Ee))return kt(Ee);var je=(0,Ue.default)(Ee);return je?er(je):w(Ee)}ir.exports=de.default});Y(Ke);var Rt=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Te;function Te(Ue){return function(){for(var Le=[],kt=arguments.length;kt--;)Le[kt]=arguments[kt];if(Ue===null)throw new Error("Callback was already called.");var er=Ue;Ue=null,er.apply(this,Le)}}ir.exports=de.default});Y(Rt);var Xe=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0});var Te={};de.default=Te,ir.exports=de.default});Y(Xe);var Ut=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Le;var Te=Ue(Xe);function Ue(kt){return kt&&kt.__esModule?kt:{default:kt}}function Le(kt,er,w,Z){var Ee=!1,je=!1,Qe=!1,yt=0,St=0;function jt(){yt>=er||Qe||Ee||(Qe=!0,kt.next().then(function(ie){var sr=ie.value,Br=ie.done;if(!(je||Ee)){if(Qe=!1,Br){Ee=!0,yt<=0&&Z(null);return}yt++,w(sr,St,Et),St++,jt()}}).catch(Qt))}function Et(ie,sr){if(yt-=1,!je){if(ie)return Qt(ie);if(ie===!1){Ee=!0,je=!0;return}if(sr===Te.default||Ee&&yt<=0)return Ee=!0,Z(null);jt()}}function Qt(ie){je||(Qe=!1,Ee=!0,Z(ie))}jt()}ir.exports=de.default});Y(Ut);var _r=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=w(vr),Ue=w(Ke),Le=w(Rt),kt=w(Ut),er=w(Xe);function w(Z){return Z&&Z.__esModule?Z:{default:Z}}de.default=function(Z){return function(Ee,je,Qe){if(Qe=(0,Te.default)(Qe),Z<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!Ee)return Qe(null);if((0,tr.isAsyncGenerator)(Ee))return(0,kt.default)(Ee,Z,je,Qe);if((0,tr.isAsyncIterable)(Ee))return(0,kt.default)(Ee[Symbol.asyncIterator](),Z,je,Qe);var yt=(0,Ue.default)(Ee),St=!1,jt=!1,Et=0,Qt=!1;function ie(Br,Lr){if(!jt)if(Et-=1,Br)St=!0,Qe(Br);else if(Br===!1)St=!0,jt=!0;else{if(Lr===er.default||St&&Et<=0)return St=!0,Qe(null);Qt||sr()}}function sr(){for(Qt=!0;Et<Z&&!St;){var Br=yt();if(Br===null){St=!0,Et<=0&&Qe(null);return}Et+=1,je(Br.value,Br.key,(0,Le.default)(ie))}Qt=!1}sr()}},ir.exports=de.default});Y(_r);var or=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=kt(_r),Ue=kt(tr),Le=kt(yr);function kt(w){return w&&w.__esModule?w:{default:w}}function er(w,Z,Ee,je){return(0,Te.default)(Z)(w,(0,Ue.default)(Ee),je)}de.default=(0,Le.default)(er,4),ir.exports=de.default});Y(or);var zr=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=Le(or),Ue=Le(yr);function Le(er){return er&&er.__esModule?er:{default:er}}function kt(er,w,Z){return(0,Te.default)(er,1,w,Z)}de.default=(0,Ue.default)(kt,3),ir.exports=de.default});Y(zr);var he=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=kt;var Te=Le(ee),Ue=Le(zr);function Le(er){return er&&er.__esModule?er:{default:er}}function kt(er,w){return(0,Te.default)(Ue.default,er,w)}ir.exports=de.default}),Re=Y(he),ye=function(){function ir(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];this.args=[],this.tasks=[]}return ir.prototype.call=function(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];return this.args=Te,Re(this.tasks)},ir.prototype.tap=function(de,Te){var Ue=this;this.tasks.push(function(Le){Te.apply(void 0,Q(Ue.args)),Le(null,de)})},ir}(),_t=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=Ee(L),Ue=Ee(Xe),Le=Ee(or),kt=Ee(vr),er=Ee(Rt),w=Ee(tr),Z=Ee(yr);function Ee(St){return St&&St.__esModule?St:{default:St}}function je(St,jt,Et){Et=(0,kt.default)(Et);var Qt=0,ie=0,sr=St.length,Br=!1;sr===0&&Et(null);function Lr(rt,gt){rt===!1&&(Br=!0),Br!==!0&&(rt?Et(rt):(++ie===sr||gt===Ue.default)&&Et(null))}for(;Qt<sr;Qt++)jt(St[Qt],Qt,(0,er.default)(Lr))}function Qe(St,jt,Et){return(0,Le.default)(St,Infinity,jt,Et)}function yt(St,jt,Et){var Qt=(0,Te.default)(St)?je:Qe;return Qt(St,(0,w.default)(jt),Et)}de.default=(0,Z.default)(yt,3),ir.exports=de.default});Y(_t);var ft=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=kt;var Te=Le(_t),Ue=Le(ee);function Le(er){return er&&er.__esModule?er:{default:er}}function kt(er,w){return(0,Ue.default)(Te.default,er,w)}ir.exports=de.default}),Nt=Y(ft),Ft=function(){function ir(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];this.tasks=[]}return ir.prototype.promise=function(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];return Nt(this.tasks)},ir.prototype.tapPromise=function(de,Te){var Ue=this;this.tasks.push(function(Le){return C(Ue,void 0,void 0,function(){return p(this,function(kt){switch(kt.label){case 0:return[4,Te()];case 1:return kt.sent(),Le(null,de),[2]}})})})},ir}(),kr=W(function(ir,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=er(vr),Ue=er(Rt),Le=er(tr),kt=er(yr);function er(Z){return Z&&Z.__esModule?Z:{default:Z}}function w(Z,Ee){if(Ee=(0,Te.default)(Ee),!Array.isArray(Z))return Ee(new Error("First argument to waterfall must be an array of functions"));if(!Z.length)return Ee();var je=0;function Qe(St){var jt=(0,Le.default)(Z[je++]);jt.apply(void 0,St.concat([(0,Ue.default)(yt)]))}function yt(St){for(var jt=[],Et=arguments.length-1;Et-- >0;)jt[Et]=arguments[Et+1];if(St!==!1){if(St||je===Z.length)return Ee.apply(void 0,[St].concat(jt));Qe(jt)}}Qe([])}de.default=(0,kt.default)(w),ir.exports=de.default}),cn=Y(kr),yn=function(){function ir(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];this.tasks=[]}return ir.prototype.call=function(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];return cn(this.tasks)},ir.prototype.tap=function(de,Te){this.tasks.length===0?this.tasks.push(function(Ue){var Le=Te();Ue(Le?null:!1,Le)}):this.tasks.push(function(Ue,Le){var kt=Te();Le(kt?null:!1,de)})},ir}(),Vi=function(){function ir(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];this.tasks=[]}return ir.prototype.call=function(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];return Re(this.tasks)},ir.prototype.tap=function(de,Te){this.tasks.push(function(Ue){var Le=Te();Ue(Le,de)})},ir}()},58881:function(Or,U,E){"use strict";E.d(U,{nC:function(){return le.ZP},Hp:function(){return le.Hp},e7:function(){return le.e7},yT:function(){return le.yT},vK:function(){return p.v},BlendType:function(){return Q.h},AttributeType:function(){return Y.GC},ScaleTypes:function(){return Y.vY},StyleScaleType:function(){return Y.ee},MapServiceEvent:function(){return N.I},CoordinateSystem:function(){return Be.l},CoordinateUniform:function(){return Be.k},CameraUniform:function(){return et.l},SceneEventList:function(){return tr.P},PositionType:function(){return Ct.d},gl:function(){return er.gl}});var le=E(12250),C=E(69530),p=E(72302),A=E(76915),Q=E(77252),Y=E(31251),W=E(8628),L=E.n(W);E.o(W,"CameraUniform")&&E.d(U,{CameraUniform:function(){return W.CameraUniform}}),E.o(W,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return W.CityBuildingLayer}}),E.o(W,"CoordinateSystem")&&E.d(U,{CoordinateSystem:function(){return W.CoordinateSystem}}),E.o(W,"CoordinateUniform")&&E.d(U,{CoordinateUniform:function(){return W.CoordinateUniform}}),E.o(W,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return W.HeatmapLayer}}),E.o(W,"ImageLayer")&&E.d(U,{ImageLayer:function(){return W.ImageLayer}}),E.o(W,"LineLayer")&&E.d(U,{LineLayer:function(){return W.LineLayer}}),E.o(W,"MapServiceEvent")&&E.d(U,{MapServiceEvent:function(){return W.MapServiceEvent}}),E.o(W,"Marker")&&E.d(U,{Marker:function(){return W.Marker}}),E.o(W,"PointLayer")&&E.d(U,{PointLayer:function(){return W.PointLayer}}),E.o(W,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return W.PolygonLayer}}),E.o(W,"Popup")&&E.d(U,{Popup:function(){return W.Popup}}),E.o(W,"PositionType")&&E.d(U,{PositionType:function(){return W.PositionType}}),E.o(W,"RasterLayer")&&E.d(U,{RasterLayer:function(){return W.RasterLayer}}),E.o(W,"Scene")&&E.d(U,{Scene:function(){return W.Scene}}),E.o(W,"SceneEventList")&&E.d(U,{SceneEventList:function(){return W.SceneEventList}}),E.o(W,"gl")&&E.d(U,{gl:function(){return W.gl}});var N=E(16606),Be=E(47282),Ye=E(41906),Je=E.n(Ye);E.o(Ye,"CameraUniform")&&E.d(U,{CameraUniform:function(){return Ye.CameraUniform}}),E.o(Ye,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Ye.CityBuildingLayer}}),E.o(Ye,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Ye.HeatmapLayer}}),E.o(Ye,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Ye.ImageLayer}}),E.o(Ye,"LineLayer")&&E.d(U,{LineLayer:function(){return Ye.LineLayer}}),E.o(Ye,"Marker")&&E.d(U,{Marker:function(){return Ye.Marker}}),E.o(Ye,"PointLayer")&&E.d(U,{PointLayer:function(){return Ye.PointLayer}}),E.o(Ye,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Ye.PolygonLayer}}),E.o(Ye,"Popup")&&E.d(U,{Popup:function(){return Ye.Popup}}),E.o(Ye,"PositionType")&&E.d(U,{PositionType:function(){return Ye.PositionType}}),E.o(Ye,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Ye.RasterLayer}}),E.o(Ye,"Scene")&&E.d(U,{Scene:function(){return Ye.Scene}}),E.o(Ye,"SceneEventList")&&E.d(U,{SceneEventList:function(){return Ye.SceneEventList}}),E.o(Ye,"gl")&&E.d(U,{gl:function(){return Ye.gl}});var et=E(4594),Yt=E(1910),Gt=E.n(Yt);E.o(Yt,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Yt.CityBuildingLayer}}),E.o(Yt,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Yt.HeatmapLayer}}),E.o(Yt,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Yt.ImageLayer}}),E.o(Yt,"LineLayer")&&E.d(U,{LineLayer:function(){return Yt.LineLayer}}),E.o(Yt,"Marker")&&E.d(U,{Marker:function(){return Yt.Marker}}),E.o(Yt,"PointLayer")&&E.d(U,{PointLayer:function(){return Yt.PointLayer}}),E.o(Yt,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Yt.PolygonLayer}}),E.o(Yt,"Popup")&&E.d(U,{Popup:function(){return Yt.Popup}}),E.o(Yt,"PositionType")&&E.d(U,{PositionType:function(){return Yt.PositionType}}),E.o(Yt,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Yt.RasterLayer}}),E.o(Yt,"Scene")&&E.d(U,{Scene:function(){return Yt.Scene}}),E.o(Yt,"SceneEventList")&&E.d(U,{SceneEventList:function(){return Yt.SceneEventList}}),E.o(Yt,"gl")&&E.d(U,{gl:function(){return Yt.gl}});var tr=E(19793),zt=E(93102),Pt=E.n(zt);E.o(zt,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return zt.CityBuildingLayer}}),E.o(zt,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return zt.HeatmapLayer}}),E.o(zt,"ImageLayer")&&E.d(U,{ImageLayer:function(){return zt.ImageLayer}}),E.o(zt,"LineLayer")&&E.d(U,{LineLayer:function(){return zt.LineLayer}}),E.o(zt,"Marker")&&E.d(U,{Marker:function(){return zt.Marker}}),E.o(zt,"PointLayer")&&E.d(U,{PointLayer:function(){return zt.PointLayer}}),E.o(zt,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return zt.PolygonLayer}}),E.o(zt,"Popup")&&E.d(U,{Popup:function(){return zt.Popup}}),E.o(zt,"PositionType")&&E.d(U,{PositionType:function(){return zt.PositionType}}),E.o(zt,"RasterLayer")&&E.d(U,{RasterLayer:function(){return zt.RasterLayer}}),E.o(zt,"Scene")&&E.d(U,{Scene:function(){return zt.Scene}}),E.o(zt,"gl")&&E.d(U,{gl:function(){return zt.gl}});var xt=E(64532),yr=E.n(xt);E.o(xt,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return xt.CityBuildingLayer}}),E.o(xt,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return xt.HeatmapLayer}}),E.o(xt,"ImageLayer")&&E.d(U,{ImageLayer:function(){return xt.ImageLayer}}),E.o(xt,"LineLayer")&&E.d(U,{LineLayer:function(){return xt.LineLayer}}),E.o(xt,"Marker")&&E.d(U,{Marker:function(){return xt.Marker}}),E.o(xt,"PointLayer")&&E.d(U,{PointLayer:function(){return xt.PointLayer}}),E.o(xt,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return xt.PolygonLayer}}),E.o(xt,"Popup")&&E.d(U,{Popup:function(){return xt.Popup}}),E.o(xt,"PositionType")&&E.d(U,{PositionType:function(){return xt.PositionType}}),E.o(xt,"RasterLayer")&&E.d(U,{RasterLayer:function(){return xt.RasterLayer}}),E.o(xt,"Scene")&&E.d(U,{Scene:function(){return xt.Scene}}),E.o(xt,"gl")&&E.d(U,{gl:function(){return xt.gl}});var ee=E(2811),vr=E.n(ee);E.o(ee,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return ee.CityBuildingLayer}}),E.o(ee,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return ee.HeatmapLayer}}),E.o(ee,"ImageLayer")&&E.d(U,{ImageLayer:function(){return ee.ImageLayer}}),E.o(ee,"LineLayer")&&E.d(U,{LineLayer:function(){return ee.LineLayer}}),E.o(ee,"Marker")&&E.d(U,{Marker:function(){return ee.Marker}}),E.o(ee,"PointLayer")&&E.d(U,{PointLayer:function(){return ee.PointLayer}}),E.o(ee,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return ee.PolygonLayer}}),E.o(ee,"Popup")&&E.d(U,{Popup:function(){return ee.Popup}}),E.o(ee,"PositionType")&&E.d(U,{PositionType:function(){return ee.PositionType}}),E.o(ee,"RasterLayer")&&E.d(U,{RasterLayer:function(){return ee.RasterLayer}}),E.o(ee,"Scene")&&E.d(U,{Scene:function(){return ee.Scene}}),E.o(ee,"gl")&&E.d(U,{gl:function(){return ee.gl}});var Ct=E(66690),Ke=E(81732),Rt=E.n(Ke);E.o(Ke,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Ke.CityBuildingLayer}}),E.o(Ke,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Ke.HeatmapLayer}}),E.o(Ke,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Ke.ImageLayer}}),E.o(Ke,"LineLayer")&&E.d(U,{LineLayer:function(){return Ke.LineLayer}}),E.o(Ke,"Marker")&&E.d(U,{Marker:function(){return Ke.Marker}}),E.o(Ke,"PointLayer")&&E.d(U,{PointLayer:function(){return Ke.PointLayer}}),E.o(Ke,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Ke.PolygonLayer}}),E.o(Ke,"Popup")&&E.d(U,{Popup:function(){return Ke.Popup}}),E.o(Ke,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Ke.RasterLayer}}),E.o(Ke,"Scene")&&E.d(U,{Scene:function(){return Ke.Scene}}),E.o(Ke,"gl")&&E.d(U,{gl:function(){return Ke.gl}});var Xe=E(84007),Ut=E.n(Xe);E.o(Xe,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Xe.CityBuildingLayer}}),E.o(Xe,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Xe.HeatmapLayer}}),E.o(Xe,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Xe.ImageLayer}}),E.o(Xe,"LineLayer")&&E.d(U,{LineLayer:function(){return Xe.LineLayer}}),E.o(Xe,"Marker")&&E.d(U,{Marker:function(){return Xe.Marker}}),E.o(Xe,"PointLayer")&&E.d(U,{PointLayer:function(){return Xe.PointLayer}}),E.o(Xe,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Xe.PolygonLayer}}),E.o(Xe,"Popup")&&E.d(U,{Popup:function(){return Xe.Popup}}),E.o(Xe,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Xe.RasterLayer}}),E.o(Xe,"Scene")&&E.d(U,{Scene:function(){return Xe.Scene}}),E.o(Xe,"gl")&&E.d(U,{gl:function(){return Xe.gl}});var _r=E(89648),or=E(90919),zr=E.n(or);E.o(or,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return or.CityBuildingLayer}}),E.o(or,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return or.HeatmapLayer}}),E.o(or,"ImageLayer")&&E.d(U,{ImageLayer:function(){return or.ImageLayer}}),E.o(or,"LineLayer")&&E.d(U,{LineLayer:function(){return or.LineLayer}}),E.o(or,"Marker")&&E.d(U,{Marker:function(){return or.Marker}}),E.o(or,"PointLayer")&&E.d(U,{PointLayer:function(){return or.PointLayer}}),E.o(or,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return or.PolygonLayer}}),E.o(or,"Popup")&&E.d(U,{Popup:function(){return or.Popup}}),E.o(or,"RasterLayer")&&E.d(U,{RasterLayer:function(){return or.RasterLayer}}),E.o(or,"Scene")&&E.d(U,{Scene:function(){return or.Scene}}),E.o(or,"gl")&&E.d(U,{gl:function(){return or.gl}});var he=E(75925),Re=E.n(he);E.o(he,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return he.CityBuildingLayer}}),E.o(he,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return he.HeatmapLayer}}),E.o(he,"ImageLayer")&&E.d(U,{ImageLayer:function(){return he.ImageLayer}}),E.o(he,"LineLayer")&&E.d(U,{LineLayer:function(){return he.LineLayer}}),E.o(he,"Marker")&&E.d(U,{Marker:function(){return he.Marker}}),E.o(he,"PointLayer")&&E.d(U,{PointLayer:function(){return he.PointLayer}}),E.o(he,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return he.PolygonLayer}}),E.o(he,"Popup")&&E.d(U,{Popup:function(){return he.Popup}}),E.o(he,"RasterLayer")&&E.d(U,{RasterLayer:function(){return he.RasterLayer}}),E.o(he,"Scene")&&E.d(U,{Scene:function(){return he.Scene}}),E.o(he,"gl")&&E.d(U,{gl:function(){return he.gl}});var ye=E(85040),_t=E.n(ye);E.o(ye,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return ye.CityBuildingLayer}}),E.o(ye,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return ye.HeatmapLayer}}),E.o(ye,"ImageLayer")&&E.d(U,{ImageLayer:function(){return ye.ImageLayer}}),E.o(ye,"LineLayer")&&E.d(U,{LineLayer:function(){return ye.LineLayer}}),E.o(ye,"Marker")&&E.d(U,{Marker:function(){return ye.Marker}}),E.o(ye,"PointLayer")&&E.d(U,{PointLayer:function(){return ye.PointLayer}}),E.o(ye,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return ye.PolygonLayer}}),E.o(ye,"Popup")&&E.d(U,{Popup:function(){return ye.Popup}}),E.o(ye,"RasterLayer")&&E.d(U,{RasterLayer:function(){return ye.RasterLayer}}),E.o(ye,"Scene")&&E.d(U,{Scene:function(){return ye.Scene}}),E.o(ye,"gl")&&E.d(U,{gl:function(){return ye.gl}});var ft=E(8594),Nt=E.n(ft);E.o(ft,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return ft.CityBuildingLayer}}),E.o(ft,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return ft.HeatmapLayer}}),E.o(ft,"ImageLayer")&&E.d(U,{ImageLayer:function(){return ft.ImageLayer}}),E.o(ft,"LineLayer")&&E.d(U,{LineLayer:function(){return ft.LineLayer}}),E.o(ft,"Marker")&&E.d(U,{Marker:function(){return ft.Marker}}),E.o(ft,"PointLayer")&&E.d(U,{PointLayer:function(){return ft.PointLayer}}),E.o(ft,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return ft.PolygonLayer}}),E.o(ft,"Popup")&&E.d(U,{Popup:function(){return ft.Popup}}),E.o(ft,"RasterLayer")&&E.d(U,{RasterLayer:function(){return ft.RasterLayer}}),E.o(ft,"Scene")&&E.d(U,{Scene:function(){return ft.Scene}}),E.o(ft,"gl")&&E.d(U,{gl:function(){return ft.gl}});var Ft=E(67571),kr=E.n(Ft);E.o(Ft,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Ft.CityBuildingLayer}}),E.o(Ft,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Ft.HeatmapLayer}}),E.o(Ft,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Ft.ImageLayer}}),E.o(Ft,"LineLayer")&&E.d(U,{LineLayer:function(){return Ft.LineLayer}}),E.o(Ft,"Marker")&&E.d(U,{Marker:function(){return Ft.Marker}}),E.o(Ft,"PointLayer")&&E.d(U,{PointLayer:function(){return Ft.PointLayer}}),E.o(Ft,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Ft.PolygonLayer}}),E.o(Ft,"Popup")&&E.d(U,{Popup:function(){return Ft.Popup}}),E.o(Ft,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Ft.RasterLayer}}),E.o(Ft,"Scene")&&E.d(U,{Scene:function(){return Ft.Scene}}),E.o(Ft,"gl")&&E.d(U,{gl:function(){return Ft.gl}});var cn=E(66718),yn=E.n(cn);E.o(cn,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return cn.CityBuildingLayer}}),E.o(cn,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return cn.HeatmapLayer}}),E.o(cn,"ImageLayer")&&E.d(U,{ImageLayer:function(){return cn.ImageLayer}}),E.o(cn,"LineLayer")&&E.d(U,{LineLayer:function(){return cn.LineLayer}}),E.o(cn,"Marker")&&E.d(U,{Marker:function(){return cn.Marker}}),E.o(cn,"PointLayer")&&E.d(U,{PointLayer:function(){return cn.PointLayer}}),E.o(cn,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return cn.PolygonLayer}}),E.o(cn,"Popup")&&E.d(U,{Popup:function(){return cn.Popup}}),E.o(cn,"RasterLayer")&&E.d(U,{RasterLayer:function(){return cn.RasterLayer}}),E.o(cn,"Scene")&&E.d(U,{Scene:function(){return cn.Scene}}),E.o(cn,"gl")&&E.d(U,{gl:function(){return cn.gl}});var Vi=E(92364),ir=E(78010),de=E.n(ir);E.o(ir,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return ir.CityBuildingLayer}}),E.o(ir,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return ir.HeatmapLayer}}),E.o(ir,"ImageLayer")&&E.d(U,{ImageLayer:function(){return ir.ImageLayer}}),E.o(ir,"LineLayer")&&E.d(U,{LineLayer:function(){return ir.LineLayer}}),E.o(ir,"Marker")&&E.d(U,{Marker:function(){return ir.Marker}}),E.o(ir,"PointLayer")&&E.d(U,{PointLayer:function(){return ir.PointLayer}}),E.o(ir,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return ir.PolygonLayer}}),E.o(ir,"Popup")&&E.d(U,{Popup:function(){return ir.Popup}}),E.o(ir,"RasterLayer")&&E.d(U,{RasterLayer:function(){return ir.RasterLayer}}),E.o(ir,"Scene")&&E.d(U,{Scene:function(){return ir.Scene}}),E.o(ir,"gl")&&E.d(U,{gl:function(){return ir.gl}});var Te=E(68116),Ue=E.n(Te);E.o(Te,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Te.CityBuildingLayer}}),E.o(Te,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Te.HeatmapLayer}}),E.o(Te,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Te.ImageLayer}}),E.o(Te,"LineLayer")&&E.d(U,{LineLayer:function(){return Te.LineLayer}}),E.o(Te,"Marker")&&E.d(U,{Marker:function(){return Te.Marker}}),E.o(Te,"PointLayer")&&E.d(U,{PointLayer:function(){return Te.PointLayer}}),E.o(Te,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Te.PolygonLayer}}),E.o(Te,"Popup")&&E.d(U,{Popup:function(){return Te.Popup}}),E.o(Te,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Te.RasterLayer}}),E.o(Te,"Scene")&&E.d(U,{Scene:function(){return Te.Scene}}),E.o(Te,"gl")&&E.d(U,{gl:function(){return Te.gl}});var Le=E(23067),kt=E.n(Le);E.o(Le,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Le.CityBuildingLayer}}),E.o(Le,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Le.HeatmapLayer}}),E.o(Le,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Le.ImageLayer}}),E.o(Le,"LineLayer")&&E.d(U,{LineLayer:function(){return Le.LineLayer}}),E.o(Le,"Marker")&&E.d(U,{Marker:function(){return Le.Marker}}),E.o(Le,"PointLayer")&&E.d(U,{PointLayer:function(){return Le.PointLayer}}),E.o(Le,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Le.PolygonLayer}}),E.o(Le,"Popup")&&E.d(U,{Popup:function(){return Le.Popup}}),E.o(Le,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Le.RasterLayer}}),E.o(Le,"Scene")&&E.d(U,{Scene:function(){return Le.Scene}}),E.o(Le,"gl")&&E.d(U,{gl:function(){return Le.gl}});var er=E(7648)},12250:function(Or,U,E){"use strict";E.d(U,{e7:function(){return _i},Hp:function(){return Bn},ZP:function(){return ii},yT:function(){return ni}});var le=E(28660),C=E(26729),p=E.n(C),A=E(86700),Q=E(84879),Y=E(72302),W=E(6610),L=E(5991),N=E(96156),Be=E(6901),Ye=E(49296),Je=E.n(Ye);function et(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function Yt(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?et(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):et(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function Gt(te,q){var R=typeof Symbol!="undefined"&&te[Symbol.iterator]||te["@@iterator"];if(!R){if(Array.isArray(te)||(R=tr(te))||q&&te&&typeof te.length=="number"){R&&(te=R);var F=0,ne=function(){};return{s:ne,n:function(){return F>=te.length?{done:!0}:{done:!1,value:te[F++]}},e:function(qt){throw qt},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var pe=!0,ht=!1,wt;return{s:function(){R=R.call(te)},n:function(){var qt=R.next();return pe=qt.done,qt},e:function(qt){ht=!0,wt=qt},f:function(){try{!pe&&R.return!=null&&R.return()}finally{if(ht)throw wt}}}}function tr(te,q){if(!!te){if(typeof te=="string")return zt(te,q);var R=Object.prototype.toString.call(te).slice(8,-1);if(R==="Object"&&te.constructor&&(R=te.constructor.name),R==="Map"||R==="Set")return Array.from(te);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return zt(te,q)}}function zt(te,q){(q==null||q>te.length)&&(q=te.length);for(var R=0,F=new Array(q);R<q;R++)F[R]=te[R];return F}var Pt=30;function xt(te){var q=te.characterSet,R=te.getFontWidth,F=te.fontHeight,ne=te.buffer,pe=te.maxCanvasWidth,ht=te.mapping,wt=ht===void 0?{}:ht,At=te.xOffset,qt=At===void 0?0:At,Pr=te.yOffset,vn=Pr===void 0?0:Pr,zn=0,$n=qt;Array.from(q).forEach(function(li,Zi){if(!wt[li]){var $i=R(li,Zi);$n+Pt>pe&&($n=0,zn++),wt[li]={x:$n,y:vn+zn*Pt,width:Pt,height:Pt,advance:$i},$n+=Pt}});var xi=F+ne*2;return{mapping:wt,xOffset:$n,yOffset:vn+zn*xi,canvasHeight:vr(vn+(zn+1)*xi)}}function yr(te,q,R){var F=0,ne=0,pe=0,ht=[],wt={},At=Gt(te),qt;try{for(At.s();!(qt=At.n()).done;){var Pr=qt.value;if(!wt[Pr.id]){var vn=Pr.size;F+vn+q>R&&(ee(wt,ht,ne),F=0,ne=pe+ne+q,pe=0,ht=[]),ht.push({icon:Pr,xOffset:F}),F=F+vn+q,pe=Math.max(pe,vn)}}}catch($n){At.e($n)}finally{At.f()}ht.length>0&&ee(wt,ht,ne);var zn=vr(pe+ne+q);return{mapping:wt,canvasHeight:zn}}function ee(te,q,R){var F=Gt(q),ne;try{for(F.s();!(ne=F.n()).done;){var pe=ne.value,ht=pe.icon,wt=pe.xOffset;te[ht.id]=Yt(Yt({},ht),{},{x:wt,y:R,image:ht.image,width:ht.width,height:ht.height})}}catch(At){F.e(At)}finally{F.f()}}function vr(te){return Math.pow(2,Math.ceil(Math.log2(te)))}var Ct,Ke;function Rt(te,q){var R=typeof Symbol!="undefined"&&te[Symbol.iterator]||te["@@iterator"];if(!R){if(Array.isArray(te)||(R=Xe(te))||q&&te&&typeof te.length=="number"){R&&(te=R);var F=0,ne=function(){};return{s:ne,n:function(){return F>=te.length?{done:!0}:{done:!1,value:te[F++]}},e:function(qt){throw qt},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var pe=!0,ht=!1,wt;return{s:function(){R=R.call(te)},n:function(){var qt=R.next();return pe=qt.done,qt},e:function(qt){ht=!0,wt=qt},f:function(){try{!pe&&R.return!=null&&R.return()}finally{if(ht)throw wt}}}}function Xe(te,q){if(!!te){if(typeof te=="string")return Ut(te,q);var R=Object.prototype.toString.call(te).slice(8,-1);if(R==="Object"&&te.constructor&&(R=te.constructor.name),R==="Map"||R==="Set")return Array.from(te);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return Ut(te,q)}}function Ut(te,q){(q==null||q>te.length)&&(q=te.length);for(var R=0,F=new Array(q);R<q;R++)F[R]=te[R];return F}function _r(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function or(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?_r(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):_r(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}var zr=ir(),he="sans-serif",Re="normal",ye=24,_t=3,ft=.25,Nt=8,Ft=1024,kr=1,cn=1,yn=3,Vi=null;function ir(){for(var te=[],q=32;q<128;q++)te.push(String.fromCharCode(q));return te}function de(te,q,R,F){te.font="".concat(F," ").concat(R,"px ").concat(q),te.fillStyle="black",te.textBaseline="middle"}function Te(te,q){for(var R=0;R<te.length;R++)q.data[4*R+3]=te[R]}var Ue=(Ct=(0,A.b2)(),Ct(Ke=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"fontAtlas",void 0),(0,N.Z)(this,"iconFontMap",void 0),(0,N.Z)(this,"iconFontGlyphs",{}),(0,N.Z)(this,"fontOptions",void 0),(0,N.Z)(this,"key",void 0),(0,N.Z)(this,"cache",new Be.z6(yn))}return(0,L.Z)(te,[{key:"scale",get:function(){return cn}},{key:"canvas",get:function(){var R=this.cache.get(this.key);return R&&R.data}},{key:"mapping",get:function(){var R=this.cache.get(this.key);return R&&R.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:he,fontWeight:Re,characterSet:zr,fontSize:ye,buffer:_t,sdf:!0,cutoff:ft,radius:Nt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(R){var F=this;R.forEach(function(ne){F.iconFontGlyphs[ne.name]=ne.unicode})}},{key:"addIconFont",value:function(R,F){this.iconFontMap.set(R,F)}},{key:"getIconFontKey",value:function(R){return this.iconFontMap.get(R)||R}},{key:"getGlyph",value:function(R){return this.iconFontGlyphs[R]?String.fromCharCode(parseInt(this.iconFontGlyphs[R],16)):""}},{key:"setFontOptions",value:function(R){this.fontOptions=or(or({},this.fontOptions),R),this.key=this.getKey();var F=this.getNewChars(this.key,this.fontOptions.characterSet),ne=this.cache.get(this.key);if(!(ne&&F.length===0)){var pe=this.generateFontAtlas(this.key,F,ne);this.fontAtlas=pe,this.cache.set(this.key,pe)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(R,F,ne){var pe=this.fontOptions,ht=pe.fontFamily,wt=pe.fontWeight,At=pe.fontSize,qt=pe.buffer,Pr=pe.sdf,vn=pe.radius,zn=pe.cutoff,$n=pe.iconfont,xi=ne&&ne.data;xi||(xi=document.createElement("canvas"),xi.width=Ft);var li=xi.getContext("2d");de(li,ht,At,wt);var Zi=xt(or({getFontWidth:function(tu){return li.measureText(tu).width},fontHeight:At*cn,buffer:qt,characterSet:F,maxCanvasWidth:Ft},ne&&{mapping:ne.mapping,xOffset:ne.xOffset,yOffset:ne.yOffset})),$i=Zi.mapping,ba=Zi.canvasHeight,oo=Zi.xOffset,Ia=Zi.yOffset,ho=li.getImageData(0,0,xi.width,xi.height);if(xi.height=ba,li.putImageData(ho,0,0),de(li,ht,At,wt),Pr){var Va=new(Je())(At,qt,vn,zn,ht,wt),ta=li.getImageData(0,0,Va.size,Va.size),da=Rt(F),Na;try{for(da.s();!(Na=da.n()).done;){var ha=Na.value;if($n){var Pa=String.fromCharCode(parseInt(ha.replace("&#x","").replace(";",""),16)),Eo=Va.draw(Pa);Te(Eo,ta)}else Te(Va.draw(ha),ta);li.putImageData(ta,$i[ha].x,$i[ha].y)}}catch(po){da.e(po)}finally{da.f()}}else{var Fo=Rt(F),oa;try{for(Fo.s();!(oa=Fo.n()).done;){var Uo=oa.value;li.fillText(Uo,$i[Uo].x,$i[Uo].y+At*kr)}}catch(po){Fo.e(po)}finally{Fo.f()}}return{xOffset:oo,yOffset:Ia,mapping:$i,data:xi,width:xi.width,height:xi.height}}},{key:"getKey",value:function(){return"key";var R,F,ne,pe,ht,wt,At,qt}},{key:"getNewChars",value:function(R,F){var ne=this.cache.get(R);if(!ne)return F;var pe=[],ht=ne.mapping,wt=new Set(Object.keys(ht)),At=new Set(F);return At.forEach(function(qt){wt.has(qt)||pe.push(qt)}),pe}}]),te}())||Ke),Le=E(63349),kt=E(10379),er=E(46070),w=E(77608),Z,Ee;function je(te){var q=Qe();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function Qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var yt=3,St=1024,jt=64,Et=(Z=(0,A.b2)(),Z(Ee=function(te){(0,kt.Z)(R,te);var q=je(R);function R(){var F;(0,W.Z)(this,R);for(var ne=arguments.length,pe=new Array(ne),ht=0;ht<ne;ht++)pe[ht]=arguments[ht];return F=q.call.apply(q,[this].concat(pe)),(0,N.Z)((0,Le.Z)(F),"canvasHeight",128),(0,N.Z)((0,Le.Z)(F),"texture",void 0),(0,N.Z)((0,Le.Z)(F),"canvas",void 0),(0,N.Z)((0,Le.Z)(F),"iconData",void 0),(0,N.Z)((0,Le.Z)(F),"iconMap",void 0),(0,N.Z)((0,Le.Z)(F),"ctx",void 0),(0,N.Z)((0,Le.Z)(F),"loadingImageCount",0),F}return(0,L.Z)(R,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(ne,pe){var ht=this,wt=new Image;if(this.loadingImageCount++,this.hasImage(ne))throw new Error("Image Id already exists");this.iconData.push({id:ne,size:jt}),this.updateIconMap(),this.loadImage(pe).then(function(At){wt=At;var qt=ht.iconData.find(function(Pr){return Pr.id===ne});qt&&(qt.image=wt,qt.width=wt.width,qt.height=wt.height),ht.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(ne){return this.iconMap.hasOwnProperty(ne)}},{key:"removeImage",value:function(ne){this.hasImage(ne)&&(this.iconData=this.iconData.filter(function(pe){return pe.id!==ne}),delete this.iconMap[ne],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var ne=this;this.canvas.width=St,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(pe){var ht=ne.iconMap[pe],wt=ht.x,At=ht.y,qt=ht.image,Pr=ht.width,vn=Pr===void 0?64:Pr,zn=ht.height,$n=zn===void 0?64:zn,xi=Math.max(vn,$n),li=xi/jt,Zi=$n/li,$i=vn/li;qt&&ne.ctx.drawImage(qt,wt+(jt-$i)/2,At+(jt-Zi)/2,$i,Zi)})}},{key:"updateIconMap",value:function(){var ne=yr(this.iconData,yt,St),pe=ne.mapping,ht=ne.canvasHeight;this.iconMap=pe,this.canvasHeight=ht}},{key:"loadImage",value:function(ne){return new Promise(function(pe,ht){if(ne instanceof HTMLImageElement){pe(ne);return}var wt=new Image;wt.crossOrigin="anonymous",wt.onload=function(){pe(wt)},wt.onerror=function(){ht(new Error("Could not load image at "+ne))},wt.src=ne instanceof File?URL.createObjectURL(ne):ne})}}]),R}(C.EventEmitter))||Ee),Qt=E(28481),ie=E(85975),sr,Br,Lr=(sr=(0,A.b2)(),sr(Br=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"viewport",void 0),(0,N.Z)(this,"overridedViewProjectionMatrix",void 0),(0,N.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,N.Z)(this,"jitteredProjectionMatrix",void 0),(0,N.Z)(this,"viewMatrixInverse",void 0),(0,N.Z)(this,"cameraPosition",void 0)}return(0,L.Z)(te,[{key:"init",value:function(){}},{key:"update",value:function(R){this.viewport=R,this.viewMatrixInverse=ie.create(),ie.invert(this.viewMatrixInverse,R.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var R=this.viewport.getCenter(),F=(0,Qt.Z)(R,2),ne=F[0],pe=F[1];return[ne,pe]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(R,F){return this.viewport.projectFlat(R,F)}},{key:"setViewProjectionMatrix",value:function(R){this.overridedViewProjectionMatrix=R}},{key:"jitterProjectionMatrix",value:function(R,F){var ne=ie.fromTranslation(ie.create(),[R,F,0]);this.jitteredProjectionMatrix=ie.multiply(ie.create(),ne,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=ie.multiply(ie.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),te}())||Br),rt,gt;function pt(te,q){var R=typeof Symbol!="undefined"&&te[Symbol.iterator]||te["@@iterator"];if(!R){if(Array.isArray(te)||(R=dr(te))||q&&te&&typeof te.length=="number"){R&&(te=R);var F=0,ne=function(){};return{s:ne,n:function(){return F>=te.length?{done:!0}:{done:!1,value:te[F++]}},e:function(qt){throw qt},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var pe=!0,ht=!1,wt;return{s:function(){R=R.call(te)},n:function(){var qt=R.next();return pe=qt.done,qt},e:function(qt){ht=!0,wt=qt},f:function(){try{!pe&&R.return!=null&&R.return()}finally{if(ht)throw wt}}}}function dr(te,q){if(!!te){if(typeof te=="string")return Vr(te,q);var R=Object.prototype.toString.call(te).slice(8,-1);if(R==="Object"&&te.constructor&&(R=te.constructor.name),R==="Map"||R==="Set")return Array.from(te);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return Vr(te,q)}}function Vr(te,q){(q==null||q>te.length)&&(q=te.length);for(var R=0,F=new Array(q);R<q;R++)F[R]=te[R];return F}var Ur=(rt=(0,A.b2)(),rt(gt=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"container",void 0),(0,N.Z)(this,"controlCorners",void 0),(0,N.Z)(this,"controlContainer",void 0),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"controls",[]),(0,N.Z)(this,"unAddControls",[])}return(0,L.Z)(te,[{key:"init",value:function(R,F){this.container=R.container,this.scene=F,this.mapsService=F.get(Y.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(R,F){var ne=F.get(Y.v.IMapService);ne.map?(R.addTo(this.scene),this.controls.push(R)):this.unAddControls.push(R)}},{key:"getControlByName",value:function(R){return this.controls.find(function(F){return F.controlOption.name===R})}},{key:"removeControl",value:function(R){var F=this.controls.indexOf(R);return F>-1&&this.controls.splice(F,1),R.remove(),this}},{key:"addControls",value:function(){var R=this;this.unAddControls.forEach(function(F){F.addTo(R.scene),R.controls.push(F)}),this.unAddControls=[]}},{key:"destroy",value:function(){var R=pt(this.controls),F;try{for(R.s();!(F=R.n()).done;){var ne=F.value;ne.remove()}}catch(pe){R.e(pe)}finally{R.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var R=this.controlCorners={},F="l7-",ne=this.controlContainer=Be.SO.create("div",F+"control-container",this.container);function pe(ht,wt){var At=F+ht+" "+F+wt;R[ht+wt]=Be.SO.create("div",At,ne)}pe("top","left"),pe("top","right"),pe("bottom","left"),pe("bottom","right")}},{key:"clearControlPos",value:function(){for(var R in this.controlCorners)this.controlCorners[R]&&Be.SO.remove(this.controlCorners[R]);this.controlContainer&&Be.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),te}())||gt),nn,Jr,Cr=(nn=(0,A.b2)(),nn(Jr=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"container",void 0),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"markers",[]),(0,N.Z)(this,"markerLayers",[]),(0,N.Z)(this,"unAddMarkers",[]),(0,N.Z)(this,"unAddMarkerLayers",[])}return(0,L.Z)(te,[{key:"addMarkerLayer",value:function(R){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(R),R.addTo(this.scene)):this.unAddMarkerLayers.push(R)}},{key:"removeMarkerLayer",value:function(R){R.destroy(),this.markerLayers.indexOf(R);var F=this.markerLayers.indexOf(R);F>-1&&this.markerLayers.splice(F,1)}},{key:"addMarker",value:function(R){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(R),R.addTo(this.scene)):this.unAddMarkers.push(R)}},{key:"addMarkers",value:function(){var R=this;this.unAddMarkers.forEach(function(F){F.addTo(R.scene),R.markers.push(F)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var R=this;this.unAddMarkerLayers.forEach(function(F){R.markerLayers.push(F),F.addTo(R.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(R){R.remove(),this.markers.indexOf(R);var F=this.markers.indexOf(R);F>-1&&this.markers.splice(F,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(R){this.scene=R,this.mapsService=R.get(Y.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(R){R.remove()}),this.markers=[],this.markerLayers.forEach(function(R){R.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(R){R.destroy()}}]),te}())||Jr),kn,Zn,Si=(kn=(0,A.b2)(),kn(Zn=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"popup",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"unAddPopup",void 0)}return(0,L.Z)(te,[{key:"removePopup",value:function(R){R.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(R){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(R.addTo(this.scene),this.popup=R):this.unAddPopup=R}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(R){this.scene=R,this.mapsService=R.get(Y.v.IMapService)}}]),te}())||Zn),zi=E(82492),Ji=E.n(zi),Di={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Oi=Di,X,ce;function me(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function z(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?me(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):me(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}var oe={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},ve={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ae=(X=(0,A.b2)(),X(ce=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"sceneConfigCache",{}),(0,N.Z)(this,"layerConfigCache",{})}return(0,L.Z)(te,[{key:"getSceneConfig",value:function(R){return this.sceneConfigCache[R]}},{key:"getSceneWarninfo",value:function(R){return Oi[R]}},{key:"setSceneConfig",value:function(R,F){this.sceneConfigCache[R]=z(z({},oe),F)}},{key:"getLayerConfig",value:function(R){return this.layerConfigCache[R]}},{key:"setLayerConfig",value:function(R,F,ne){this.layerConfigCache[F]=z({},Ji()({},this.sceneConfigCache[R],ve,ne))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),te}())||ce),se=E(55770),Ce=E(3473),ct=E(98333),xr=Math.PI/180,Ht=512,Jt=4003e4;function Rr(te){var q=te.latitude,R=q===void 0?0:q,F=te.zoom,ne=F===void 0?0:F,pe=te.scale,ht=te.highPrecision,wt=ht===void 0?!1:ht,At=te.flipY,qt=At===void 0?!1:At;pe=pe!==void 0?pe:Math.pow(2,ne);var Pr={},vn=Ht*pe,zn=Math.cos(R*xr),$n=vn/360,xi=$n/zn,li=vn/Jt/zn;if(Pr.pixelsPerMeter=[li,-li,li],Pr.metersPerPixel=[1/li,-1/li,1/li],Pr.pixelsPerDegree=[$n,-xi,li],Pr.degreesPerPixel=[1/$n,-1/xi,1/li],wt){var Zi=xr*Math.tan(R*xr)/zn,$i=$n*Zi/2,ba=vn/Jt*Zi,oo=ba/xi*li;Pr.pixelsPerDegree2=[0,-$i,ba],Pr.pixelsPerMeter2=[oo,0,oo],qt&&(Pr.pixelsPerDegree2[1]=-Pr.pixelsPerDegree2[1],Pr.pixelsPerMeter2[1]=-Pr.pixelsPerMeter2[1])}return qt&&(Pr.pixelsPerMeter[1]=-Pr.pixelsPerMeter[1],Pr.metersPerPixel[1]=-Pr.metersPerPixel[1],Pr.pixelsPerDegree[1]=-Pr.pixelsPerDegree[1],Pr.degreesPerPixel[1]=-Pr.degreesPerPixel[1]),Pr}var Mn=E(47282),Pn,$t,En,on,ln,Ai=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],bn=(Pn=(0,A.b2)(),$t=(0,A.f3)(Y.v.ICameraService),Pn(En=(on=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"needRefresh",!0),(0,se.Z)(this,"cameraService",ln,this),(0,N.Z)(this,"coordinateSystem",void 0),(0,N.Z)(this,"viewportCenter",void 0),(0,N.Z)(this,"viewportCenterProjection",void 0),(0,N.Z)(this,"pixelsPerDegree",void 0),(0,N.Z)(this,"pixelsPerDegree2",void 0),(0,N.Z)(this,"pixelsPerMeter",void 0)}return(0,L.Z)(te,[{key:"refresh",value:function(){var R=this.cameraService.getZoom(),F=this.cameraService.getZoomScale(),ne=this.cameraService.getCenter(),pe=Rr({latitude:ne[1],zoom:R}),ht=pe.pixelsPerMeter,wt=pe.pixelsPerDegree;this.viewportCenter=ne,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=ht,this.pixelsPerDegree=wt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Mn.l.LNGLAT||this.coordinateSystem===Mn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Mn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(ne,R):this.coordinateSystem===Mn.l.P20_OFFSET&&this.calculateLnglatOffset(ne,R,F,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(R){this.coordinateSystem=R}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(R,F,ne,pe){var ht=Rr({latitude:R[1],zoom:F,scale:ne,flipY:pe,highPrecision:!0}),wt=ht.pixelsPerMeter,At=ht.pixelsPerDegree,qt=ht.pixelsPerDegree2,Pr=this.cameraService.getViewMatrix(),vn=this.cameraService.getProjectionMatrix(),zn=ie.multiply([],vn,Pr),$n=this.cameraService.projectFlat([Math.fround(R[0]),Math.fround(R[1])],Math.pow(2,F));this.viewportCenterProjection=ct.fF([],[$n[0],$n[1],0,1],zn),Pr=this.cameraService.getViewMatrixUncentered()||Pr,zn=ie.multiply([],vn,Pr),zn=ie.multiply([],zn,Ai),this.cameraService.setViewProjectionMatrix(zn),this.pixelsPerMeter=wt,this.pixelsPerDegree=At,this.pixelsPerDegree2=qt}}]),te}(),ln=(0,Ce.Z)(on.prototype,"cameraService",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),on))||En),Li=E(50840),Yi=E.n(Li),si=E(89648),Ki,Ni,Ti,ca,Sa;function oi(te){var q=ri();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function ri(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var Gi={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},pa=(Ki=(0,A.b2)(),Ni=(0,A.f3)(Y.v.IMapService),Ki(Ti=(ca=function(te){(0,kt.Z)(R,te);var q=oi(R);function R(){var F;(0,W.Z)(this,R);for(var ne=arguments.length,pe=new Array(ne),ht=0;ht<ne;ht++)pe[ht]=arguments[ht];return F=q.call.apply(q,[this].concat(pe)),(0,se.Z)((0,Le.Z)(F),"mapService",Sa,(0,Le.Z)(F)),(0,N.Z)((0,Le.Z)(F),"hammertime",void 0),(0,N.Z)((0,Le.Z)(F),"lastClickTime",0),(0,N.Z)((0,Le.Z)(F),"lastClickXY",[-1,-1]),(0,N.Z)((0,Le.Z)(F),"clickTimer",void 0),(0,N.Z)((0,Le.Z)(F),"$containter",void 0),(0,N.Z)((0,Le.Z)(F),"onDrag",function(wt){var At=F.interactionEvent(wt);At.type=Gi[At.type],F.emit(si.s.Drag,At)}),(0,N.Z)((0,Le.Z)(F),"onHammer",function(wt){wt.srcEvent.stopPropagation();var At=F.interactionEvent(wt);F.emit(si.s.Hover,At)}),(0,N.Z)((0,Le.Z)(F),"onTouch",function(wt){var At=wt.touches[0];F.onHover({x:At.pageX,y:At.pageY,type:"touch"})}),(0,N.Z)((0,Le.Z)(F),"onHover",function(wt){var At=wt.clientX,qt=wt.clientY,Pr=At,vn=qt,zn=wt.type,$n=F.mapService.getMapContainer();if($n){var xi=$n.getBoundingClientRect(),li=xi.top,Zi=xi.left;Pr=Pr-Zi-$n.clientLeft,vn=vn-li-$n.clientTop}var $i=F.mapService.containerToLngLat([Pr,vn]);if(zn==="click"){if("ontouchstart"in document.documentElement)return;F.isDoubleTap(Pr,vn,$i);return}if(zn==="touch"){F.isDoubleTap(Pr,vn,$i);return}zn!=="click"&&zn!=="dblclick"&&F.emit(si.s.Hover,{x:Pr,y:vn,lngLat:$i,type:zn,target:wt})}),F}return(0,L.Z)(R,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(si.s.Hover)}},{key:"triggerHover",value:function(ne){var pe=ne.x,ht=ne.y;this.emit(si.s.Hover,{x:pe,y:ht})}},{key:"triggerSelect",value:function(ne){this.emit(si.s.Select,{featureId:ne})}},{key:"triggerActive",value:function(ne){this.emit(si.s.Active,{featureId:ne})}},{key:"addEventListenerOnMap",value:function(){var ne=this.mapService.getMapContainer();if(ne){var pe=new(Yi()).Manager(ne);pe.add(new(Yi()).Tap({event:"dblclick",taps:2})),pe.add(new(Yi()).Tap({event:"click"})),pe.add(new(Yi()).Pan({threshold:0,pointers:0})),pe.add(new(Yi()).Press({})),pe.on("dblclick click",this.onHammer),pe.on("panstart panmove panend pancancel",this.onDrag),ne.addEventListener("mousemove",this.onHover),ne.addEventListener("mousedown",this.onHover,!0),ne.addEventListener("mouseup",this.onHover),ne.addEventListener("contextmenu",this.onHover),this.hammertime=pe}}},{key:"removeEventListenerOnMap",value:function(){var ne=this.mapService.getMapContainer();ne&&(ne.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),ne.removeEventListener("mousedown",this.onHover),ne.removeEventListener("mouseup",this.onHover),ne.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(ne){var pe=ne.type,ht=ne.pointerType,wt,At;ht==="touch"?(At=Math.floor(ne.pointers[0].clientY),wt=Math.floor(ne.pointers[0].clientX)):(At=Math.floor(ne.srcEvent.y),wt=Math.floor(ne.srcEvent.x));var qt=this.mapService.getMapContainer();if(qt){var Pr=qt.getBoundingClientRect(),vn=Pr.top,zn=Pr.left;wt-=zn,At-=vn}var $n=this.mapService.containerToLngLat([wt,At]);return{x:wt,y:At,lngLat:$n,type:pe,target:ne.srcEvent}}},{key:"isDoubleTap",value:function(ne,pe,ht){var wt=this,At=new Date().getTime(),qt="click";At-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-ne)<10&&Math.abs(this.lastClickXY[1]-pe)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),qt="dblclick",this.emit(si.s.Hover,{x:ne,y:pe,lngLat:ht,type:qt})):(this.lastClickTime=At,this.lastClickXY=[ne,pe],this.clickTimer=setTimeout(function(){qt="click",wt.emit(si.s.Hover,{x:ne,y:pe,lngLat:ht,type:qt})},400))}}]),R}(p()),Sa=(0,Ce.Z)(ca.prototype,"mapService",[Ni],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ca))||Ti),Ho=E(92137),ya=E(87757),yi=E.n(ya),ga=E(7648),Ws,Ea,Ao,Xa,Ya,Wo,Ui,To,Lo,lo,Ro;function Hi(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function Ra(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Hi(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Hi(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}var Fa=(Ws=(0,A.b2)(),Ea=(0,A.f3)(Y.v.IRendererService),Ao=(0,A.f3)(Y.v.IGlobalConfigService),Xa=(0,A.f3)(Y.v.IInteractionService),Ya=(0,A.f3)(Y.v.ILayerService),Ws(Wo=(Ui=function(){function te(){var q=this;(0,W.Z)(this,te),(0,se.Z)(this,"rendererService",To,this),(0,se.Z)(this,"configService",Lo,this),(0,se.Z)(this,"interactionService",lo,this),(0,se.Z)(this,"layerService",Ro,this),(0,N.Z)(this,"pickingFBO",void 0),(0,N.Z)(this,"width",0),(0,N.Z)(this,"height",0),(0,N.Z)(this,"alreadyInPicking",!1),(0,N.Z)(this,"pickBufferScale",1),(0,N.Z)(this,"pickFromPickingFBO",function(R,F){var ne,pe=F.x,ht=F.y,wt=F.lngLat,At=F.type,qt=F.target,Pr=!1,vn=q.rendererService,zn=vn.getViewportSize,$n=vn.readPixels,xi=vn.getContainer,li=xi().getBoundingClientRect(),Zi=li.width,$i=li.height;Zi*=Be.SO.DPR,$i*=Be.SO.DPR;var ba=R.getLayerConfig(),oo=ba.enableHighlight,Ia=ba.enableSelect,ho=pe*Be.SO.DPR,Va=ht*Be.SO.DPR;if(ho>Zi-1*Be.SO.DPR||ho<0||Va>$i-1*Be.SO.DPR||Va<0)return!1;var ta;if(ta=$n({x:Math.floor(ho/q.pickBufferScale),y:Math.floor(($i-(ht+1)*Be.SO.DPR)/q.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:q.pickingFBO}),ta[0]!==0||ta[1]!==0||ta[2]!==0){var da=(0,Be.W0)(ta),Na=R.getSource().getFeatureById(da);da!==R.getCurrentPickId()&&At==="mousemove"&&(At="mouseenter");var ha={x:pe,y:ht,type:At,lngLat:wt,featureId:da,feature:Na,target:qt};Na&&(Pr=!0,R.setCurrentPickId(da),q.triggerHoverOnLayer(R,ha))}else{var Pa={x:pe,y:ht,lngLat:wt,type:R.getCurrentPickId()!==null&&At==="mousemove"?"mouseout":"un"+At,featureId:null,target:qt,feature:null};q.triggerHoverOnLayer(R,Ra(Ra({},Pa),{},{type:"unpick"})),q.triggerHoverOnLayer(R,Pa),R.setCurrentPickId(null)}if(oo&&q.highlightPickedFeature(R,ta),Ia&&At==="click"&&((ne=ta)===null||ne===void 0?void 0:ne.toString())!==[0,0,0,0].toString()){var Eo=(0,Be.W0)(ta);R.getCurrentSelectedId()===null||Eo!==R.getCurrentSelectedId()?(q.selectFeature(R,ta),R.setCurrentSelectedId(Eo)):(q.selectFeature(R,new Uint8Array([0,0,0,0])),R.setCurrentSelectedId(null))}return Pr})}return(0,L.Z)(te,[{key:"init",value:function(R){var F=this.rendererService,ne=F.createTexture2D,pe=F.createFramebuffer,ht=F.getViewportSize,wt=F.getContainer,At=wt().getBoundingClientRect(),qt=At.width,Pr=At.height;qt*=Be.SO.DPR,Pr*=Be.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(R).pickBufferScale||1,this.pickingFBO=pe({color:ne({width:Math.round(qt/this.pickBufferScale),height:Math.round(Pr/this.pickBufferScale),wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})}),this.interactionService.on(si.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var q=(0,Ho.Z)(yi().mark(function F(ne,pe,ht){var wt=this,At,qt,Pr,vn;return yi().wrap(function($n){for(;;)switch($n.prev=$n.next){case 0:At=this.rendererService,qt=At.useFramebuffer,Pr=At.clear,vn=At.getContainer,this.resizePickingFBO(),qt(this.pickingFBO,function(){Pr({framebuffer:wt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ne.hooks.beforePickingEncode.call(),ne.renderModels(),ne.hooks.afterPickingEncode.call();var xi=wt.pickBox(ne,pe);ht(xi)});case 3:case"end":return $n.stop()}},F,this)}));function R(F,ne,pe){return q.apply(this,arguments)}return R}()},{key:"pickBox",value:function(R,F){var ne=this,pe=F.map(function(Pa){var Eo=Pa<0?0:Pa;return Math.floor(Eo*Be.SO.DPR/ne.pickBufferScale)}),ht=(0,Qt.Z)(pe,4),wt=ht[0],At=ht[1],qt=ht[2],Pr=ht[3],vn=this.rendererService,zn=vn.getViewportSize,$n=vn.readPixels,xi=vn.getContainer,li=xi().getBoundingClientRect(),Zi=li.width,$i=li.height;if(Zi*=Be.SO.DPR,$i*=Be.SO.DPR,wt>(Zi-1)*Be.SO.DPR/this.pickBufferScale||qt<0||At>($i-1)*Be.SO.DPR/this.pickBufferScale||Pr<0)return[];var ba,oo=Math.min(Zi/this.pickBufferScale,qt)-wt,Ia=Math.min($i/this.pickBufferScale,Pr)-At;ba=$n({x:wt,y:Math.floor($i/this.pickBufferScale-(Pr+1)),width:oo,height:Ia,data:new Uint8Array(oo*Ia*4),framebuffer:this.pickingFBO});for(var ho=[],Va={},ta=0;ta<ba.length/4;ta=ta+1){var da=ba.slice(ta*4,ta*4+4),Na=(0,Be.W0)(da);if(Na!==-1&&!Va[Na]){var ha=R.getSource().getFeatureById(Na);ho.push(ha),Va[Na]=!0}}return ho}},{key:"pickingAllLayer",value:function(){var q=(0,Ho.Z)(yi().mark(function F(ne){return yi().wrap(function(ht){for(;;)switch(ht.prev=ht.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){ht.next=2;break}return ht.abrupt("return");case 2:return this.alreadyInPicking=!0,ht.next=5,this.pickingLayers(ne);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return ht.stop()}},F,this)}));function R(F){return q.apply(this,arguments)}return R}()},{key:"resizePickingFBO",value:function(){var R=this.rendererService.getContainer,F=R().getBoundingClientRect(),ne=F.width,pe=F.height;ne*=Be.SO.DPR,pe*=Be.SO.DPR,(this.width!==ne||this.height!==pe)&&(this.pickingFBO.resize({width:Math.round(ne/this.pickBufferScale),height:Math.round(pe/this.pickBufferScale)}),this.width=ne,this.height=pe)}},{key:"pickingLayers",value:function(){var q=(0,Ho.Z)(yi().mark(function F(ne){var pe=this,ht,wt,At,qt,Pr;return yi().wrap(function(zn){for(;;)switch(zn.prev=zn.next){case 0:ht=this.rendererService,wt=ht.getViewportSize,At=ht.useFramebuffer,qt=ht.clear,Pr=ht.getContainer,this.resizePickingFBO(),At(this.pickingFBO,function(){var $n=pe.layerService.getLayers();$n.filter(function(xi){return xi.needPick(ne.type)}).reverse().some(function(xi){qt({framebuffer:pe.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),xi.hooks.beforePickingEncode.call(),xi.renderModels(),xi.hooks.afterPickingEncode.call();var li=pe.pickFromPickingFBO(xi,ne);return li&&!xi.getLayerConfig().enablePropagation})});case 3:case"end":return zn.stop()}},F,this)}));function R(F){return q.apply(this,arguments)}return R}()},{key:"triggerHoverOnLayer",value:function(R,F){R.emit(F.type,F)}},{key:"isEventCrash",value:function(R){var F=!0;return R.target.path.map(function(ne){ne.classList&&ne.classList.forEach(function(pe){(pe==="l7-marker"||pe==="l7-popup")&&(F=!1)})}),F}},{key:"highlightPickedFeature",value:function(R,F){var ne=(0,Qt.Z)(F,3),pe=ne[0],ht=ne[1],wt=ne[2];R.hooks.beforeHighlight.call([pe,ht,wt])}},{key:"selectFeature",value:function(R,F){var ne=(0,Qt.Z)(F,3),pe=ne[0],ht=ne[1],wt=ne[2];R.hooks.beforeSelect.call([pe,ht,wt])}}]),te}(),To=(0,Ce.Z)(Ui.prototype,"rendererService",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lo=(0,Ce.Z)(Ui.prototype,"configService",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lo=(0,Ce.Z)(Ui.prototype,"interactionService",[Xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ro=(0,Ce.Z)(Ui.prototype,"layerService",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ui))||Wo),ms=function(){function te(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,W.Z)(this,te),(0,N.Z)(this,"autoStart",void 0),(0,N.Z)(this,"startTime",0),(0,N.Z)(this,"oldTime",0),(0,N.Z)(this,"running",!1),(0,N.Z)(this,"elapsedTime",0),this.autoStart=q}return(0,L.Z)(te,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var R=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var F=(typeof performance=="undefined"?Date:performance).now();R=(F-this.oldTime)/1e3,this.oldTime=F,this.elapsedTime+=R}return R}}]),te}(),_a,xe,ke,ut,Xt,Xr,Kn,gi=(_a=(0,A.b2)(),xe=(0,A.f3)(Y.v.IRendererService),ke=(0,A.f3)(Y.v.IGlobalConfigService),_a(ut=(Xt=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"clock",new ms),(0,N.Z)(this,"alreadyInRendering",!1),(0,N.Z)(this,"layers",[]),(0,N.Z)(this,"layerRenderID",void 0),(0,N.Z)(this,"sceneInited",!1),(0,N.Z)(this,"animateInstanceCount",0),(0,se.Z)(this,"renderService",Xr,this),(0,se.Z)(this,"configService",Kn,this)}return(0,L.Z)(te,[{key:"add",value:function(R){this.sceneInited&&R.init(),this.layers.push(R)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(R){R.inited||R.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(R){return this.layers.find(function(F){return F.id===R})}},{key:"getLayerByName",value:function(R){return this.layers.find(function(F){return F.name===R})}},{key:"remove",value:function(R){var F=this.layers.indexOf(R);F>-1&&this.layers.splice(F,1),R.emit("remove",null),R.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(R){return R.inited}).filter(function(R){return R.isVisible()}).forEach(function(R){R.hooks.beforeRenderData.call(),R.hooks.beforeRender.call(),R.render(),R.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(R,F){return R.zIndex-F.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(R){return R.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),te}(),Xr=(0,Ce.Z)(Xt.prototype,"renderService",[xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kn=(0,Ce.Z)(Xt.prototype,"configService",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt))||ut),io=E(81253),Ka=E(85061),co=E(14293),Xo=E.n(co),Xs=function(){function te(q){var R=this;(0,W.Z)(this,te),(0,N.Z)(this,"name",void 0),(0,N.Z)(this,"type",void 0),(0,N.Z)(this,"scale",void 0),(0,N.Z)(this,"descriptor",void 0),(0,N.Z)(this,"featureBufferLayout",[]),(0,N.Z)(this,"needRescale",!1),(0,N.Z)(this,"needRemapping",!1),(0,N.Z)(this,"needRegenerateVertices",!1),(0,N.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,N.Z)(this,"vertexAttribute",void 0),(0,N.Z)(this,"defaultCallback",function(F){if(F.length===0){var ne;return((ne=R.scale)===null||ne===void 0?void 0:ne.defaultValues)||[]}return F.map(function(pe,ht){var wt,At=(wt=R.scale)===null||wt===void 0?void 0:wt.scalers[ht].func,qt=At(pe);return qt})}),this.setProps(q)}return(0,L.Z)(te,[{key:"setProps",value:function(R){Object.assign(this,R)}},{key:"mapping",value:function(R){var F;if((F=this.scale)!==null&&F!==void 0&&F.callback){var ne,pe=(ne=this.scale)===null||ne===void 0?void 0:ne.callback.apply(ne,(0,Ka.Z)(R));if(!Xo()(pe))return[pe]}return this.defaultCallback(R)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),te}(),ys,mo,ls,No,Yo,_o;function Ei(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function Cs(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Ei(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Ei(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function As(te){return new Promise(function(q){return setTimeout(q,te)})}var gs=(ys={},(0,N.Z)(ys,ga.gl.FLOAT,4),(0,N.Z)(ys,ga.gl.UNSIGNED_BYTE,1),(0,N.Z)(ys,ga.gl.UNSIGNED_SHORT,2),ys),Aa=(mo=(0,A.b2)(),ls=(0,A.f3)(Y.v.IRendererService),mo(No=(Yo=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"attributesAndIndices",void 0),(0,se.Z)(this,"rendererService",_o,this),(0,N.Z)(this,"attributes",[]),(0,N.Z)(this,"triangulation",void 0),(0,N.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,L.Z)(te,[{key:"registerStyleAttribute",value:function(R){var F=this.getLayerStyleAttribute(R.name||"");return F?F.setProps(R):(F=new Xs(R),this.attributes.push(F)),F}},{key:"updateStyleAttribute",value:function(R,F,ne){var pe=this.getLayerStyleAttribute(R);pe||(pe=this.registerStyleAttribute(Cs(Cs({},F),{},{name:R})));var ht=F.scale;ht&&pe&&(pe.scale=ht,pe.needRescale=!0,pe.needRemapping=!0,pe.needRegenerateVertices=!0,ne&&ne.featureRange&&(pe.featureRange=ne.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(R){return this.attributes.find(function(F){return F.name===R})}},{key:"getLayerAttributeScale",value:function(R){var F,ne=this.getLayerStyleAttribute(R),pe=ne==null||(F=ne.scale)===null||F===void 0?void 0:F.scalers;return pe&&pe[0]?pe[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(R,F){var ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,pe=arguments.length>3?arguments[3]:void 0,ht=this.attributes.find(function(Ia){return Ia.name===R});if(ht&&ht.descriptor){var wt=ht.descriptor,At=wt.update,qt=wt.buffer,Pr=wt.size,vn=Pr===void 0?0:Pr,zn=gs[qt.type||ga.gl.FLOAT];if(At){var $n=this.featureLayout,xi=$n.elements,li=$n.sizePerElement,Zi=xi.slice(ne,pe);if(!Zi.length)return;var $i=Zi[0].offset,ba=$i*vn*zn,oo=Zi.map(function(Ia,ho){for(var Va=Ia.featureIdx,ta=Ia.vertices,da=Ia.normals,Na=ta.length/li,ha=[],Pa=0;Pa<Na;Pa++){var Eo=da?da.slice(Pa*3,Pa*3+3):[];ha.push.apply(ha,(0,Ka.Z)(At(F[Va],Va,ta.slice(Pa*li,Pa*li+li),ho,Eo)))}return ha}).reduce(function(Ia,ho){return Ia.push.apply(Ia,(0,Ka.Z)(ho)),Ia},[]);ht.vertexAttribute.updateBuffer({data:oo,offset:ba})}}}},{key:"createAttributesAndIndices",value:function(R,F,ne){var pe=this;this.featureLayout={sizePerElement:0,elements:[]},F&&(this.triangulation=F);var ht=this.attributes.map(function(ba){return ba.resetDescriptor(),ba.descriptor}),wt=0,At=[],qt=[],Pr=[],vn=3;R.forEach(function(ba,oo){var Ia=pe.triangulation(ba,ne),ho=Ia.indices,Va=Ia.vertices,ta=Ia.normals,da=Ia.size;ho.forEach(function(Eo){qt.push(Eo+wt)}),vn=da;var Na=Va.length/da;pe.featureLayout.sizePerElement=vn,pe.featureLayout.elements.push({featureIdx:oo,vertices:Va,normals:ta,offset:wt}),wt+=Na;for(var ha=function(Fo){var oa=(ta==null?void 0:ta.slice(Fo*3,Fo*3+3))||[],Uo=Va.slice(Fo*da,Fo*da+da);ht.forEach(function(po,tu){if(po&&po.update){var xc;(xc=po.buffer.data).push.apply(xc,(0,Ka.Z)(po.update(ba,oo,Uo,Fo,oa)))}})},Pa=0;Pa<Na;Pa++)ha(Pa)});var zn=this.rendererService,$n=zn.createAttribute,xi=zn.createBuffer,li=zn.createElements,Zi={};ht.forEach(function(ba,oo){if(ba){var Ia=ba.buffer,ho=ba.update,Va=ba.name,ta=(0,io.Z)(ba,["buffer","update","name"]),da=$n(Cs({buffer:xi(Ia)},ta));Zi[ba.name||""]=da,pe.attributes[oo].vertexAttribute=da}});var $i=li({data:qt,type:ga.gl.UNSIGNED_INT,count:qt.length});return this.attributesAndIndices={attributes:Zi,elements:$i},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var R;this.attributes.forEach(function(F){F.vertexAttribute&&F.vertexAttribute.destroy()}),(R=this.attributesAndIndices)===null||R===void 0||R.elements.destroy(),this.attributes=[]}}]),te}(),_o=(0,Ce.Z)(Yo.prototype,"rendererService",[ls],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yo))||No),Po=E(46343),mu=E(67709),bl=E.n(mu),Zu=window.document.documentElement.style,Vl=0;function tl(te){var q=te;if(typeof te=="string"&&(q=document.getElementById(te)),q){var R=document.createElement("div");return R.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,R.id="l7-scene-".concat(Vl++),R.classList.add("l7-scene"),q.appendChild(R),R}return null}var yu,Ba,ju,m,S,j,O,ue,Ie,st,Lt,It,wr,jr,Qn,Mi,fi,qn,wa,ka,Qi,cs,xo,Ts,au,Bs,rl,Ys,Ks,$s,ao,wu,nl;function fs(te){var q=Gl();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function Gl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var ou=(yu=(0,A.b2)(),Ba=(0,A.f3)(Y.v.SceneID),ju=(0,A.f3)(Y.v.IIconService),m=(0,A.f3)(Y.v.IFontService),S=(0,A.f3)(Y.v.IControlService),j=(0,A.f3)(Y.v.IGlobalConfigService),O=(0,A.f3)(Y.v.IMapService),ue=(0,A.f3)(Y.v.ICoordinateSystemService),Ie=(0,A.f3)(Y.v.IRendererService),st=(0,A.f3)(Y.v.ILayerService),Lt=(0,A.f3)(Y.v.ICameraService),It=(0,A.f3)(Y.v.IInteractionService),wr=(0,A.f3)(Y.v.IPickingService),jr=(0,A.f3)(Y.v.IShaderModuleService),Qn=(0,A.f3)(Y.v.IMarkerService),Mi=(0,A.f3)(Y.v.IPopupService),yu(fi=(qn=function(te){(0,kt.Z)(R,te);var q=fs(R);function R(){var F;return(0,W.Z)(this,R),F=q.call(this),(0,N.Z)((0,Le.Z)(F),"destroyed",!1),(0,N.Z)((0,Le.Z)(F),"loaded",!1),(0,N.Z)((0,Le.Z)(F),"loadFont",!1),(0,N.Z)((0,Le.Z)(F),"fontFamily",""),(0,se.Z)((0,Le.Z)(F),"id",wa,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"iconService",ka,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"fontService",Qi,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"controlService",cs,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"configService",xo,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"map",Ts,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"coordinateSystemService",au,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"rendererService",Bs,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"layerService",rl,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"cameraService",Ys,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"interactionService",Ks,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"pickingService",$s,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"shaderModuleService",ao,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"markerService",wu,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"popupService",nl,(0,Le.Z)(F)),(0,N.Z)((0,Le.Z)(F),"inited",!1),(0,N.Z)((0,Le.Z)(F),"initPromise",void 0),(0,N.Z)((0,Le.Z)(F),"rendering",!1),(0,N.Z)((0,Le.Z)(F),"$container",void 0),(0,N.Z)((0,Le.Z)(F),"canvas",void 0),(0,N.Z)((0,Le.Z)(F),"markerContainer",void 0),(0,N.Z)((0,Le.Z)(F),"hooks",void 0),(0,N.Z)((0,Le.Z)(F),"handleWindowResized",function(){F.emit("resize"),F.$container&&(F.initContainer(),Be.SO.triggerResize(),F.coordinateSystemService.needRefresh=!0,F.render())}),(0,N.Z)((0,Le.Z)(F),"handleMapCameraChanged",function(ne){F.cameraService.update(ne),F.render()}),F.hooks={init:new Po.zj},F}return(0,L.Z)(R,[{key:"init",value:function(ne){var pe=this;this.configService.setSceneConfig(this.id,ne),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ho.Z)(yi().mark(function ht(){return yi().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:return At.next=2,new Promise(function(qt){pe.map.onCameraChanged(function(Pr){pe.cameraService.init(),pe.cameraService.update(Pr),pe.map.version!=="GAODE2.x"&&qt()}),pe.map.version!=="GAODE2.x"?pe.map.init():qt()});case 2:if(!(pe.map.version==="GAODE2.x"&&pe.map.initViewPort)){At.next=6;break}return At.next=5,pe.map.init();case 5:pe.map.initViewPort();case 6:pe.map.onCameraChanged(pe.handleMapCameraChanged),pe.map.addMarkerContainer(),pe.markerService.addMarkers(),pe.markerService.addMarkerLayers(),pe.popupService.initPopup(),pe.interactionService.init(),pe.interactionService.on(si.s.Drag,pe.addSceneEvent.bind(pe));case 13:case"end":return At.stop()}},ht)}))),this.hooks.init.tapPromise("initRenderer",(0,Ho.Z)(yi().mark(function ht(){var wt;return yi().wrap(function(qt){for(;;)switch(qt.prev=qt.next){case 0:if(wt=tl(pe.configService.getSceneConfig(pe.id).id||""),pe.$container=wt,!wt){qt.next=11;break}return pe.canvas=Be.SO.create("canvas","",wt),pe.setCanvas(),qt.next=7,pe.rendererService.init(pe.canvas,pe.configService.getSceneConfig(pe.id));case 7:bl()(pe.$container,pe.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(pe.handleWindowResized),qt.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:pe.pickingService.init(pe.id);case 13:case"end":return qt.stop()}},ht)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(ne){this.layerService.add(ne),this.render()}},{key:"render",value:function(){var F=(0,Ho.Z)(yi().mark(function pe(){return yi().wrap(function(wt){for(;;)switch(wt.prev=wt.next){case 0:if(!(this.rendering||this.destroyed)){wt.next=2;break}return wt.abrupt("return");case 2:if(this.rendering=!0,this.inited){wt.next=15;break}return wt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){wt.next=10;break}return wt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(),this.rendering=!1;case 17:case"end":return wt.stop()}},pe,this)}));function ne(){return F.apply(this,arguments)}return ne}()},{key:"addFontFace",value:function(ne,pe){this.fontFamily=ne;var ht=document.createElement("style");ht.type="text/css",ht.innerText=`
        @font-face{
            font-family: '`.concat(ne,`';
            src: url('`).concat(pe,`') format('woff2'),
            url('`).concat(pe,`') format('woff'),
            url('`).concat(pe,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(ht),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(ne){var pe,ht=(pe=this.$container)===null||pe===void 0?void 0:pe.getElementsByTagName("canvas")[0];this.render();var wt=ne==="jpg"?ht==null?void 0:ht.toDataURL("image/jpeg"):ht==null?void 0:ht.toDataURL("image/png");return wt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var ne=this.$container.parentElement;ne!==null&&(this.markerContainer=Be.SO.create("div","l7-marker-container",ne))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,mu.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var ne,pe,ht=Be.SO.DPR,wt=((ne=this.$container)===null||ne===void 0?void 0:ne.clientWidth)||400,At=((pe=this.$container)===null||pe===void 0?void 0:pe.clientHeight)||300,qt=this.canvas;qt&&(qt.width=wt*ht,qt.height=At*ht,qt.style.width="".concat(wt,"px"),qt.style.height="".concat(At,"px")),this.rendererService.viewport({x:0,y:0,width:ht*wt,height:ht*At})}},{key:"setCanvas",value:function(){var ne,pe,ht=Be.SO.DPR,wt=((ne=this.$container)===null||ne===void 0?void 0:ne.clientWidth)||400,At=((pe=this.$container)===null||pe===void 0?void 0:pe.clientHeight)||300,qt=this.canvas;qt.width=wt*ht,qt.height=At*ht,qt.style.width="".concat(wt,"px"),qt.style.height="".concat(At,"px")}},{key:"addSceneEvent",value:function(ne){this.emit(ne.type,ne)}}]),R}(C.EventEmitter),wa=(0,Ce.Z)(qn.prototype,"id",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ka=(0,Ce.Z)(qn.prototype,"iconService",[ju],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qi=(0,Ce.Z)(qn.prototype,"fontService",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cs=(0,Ce.Z)(qn.prototype,"controlService",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xo=(0,Ce.Z)(qn.prototype,"configService",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ts=(0,Ce.Z)(qn.prototype,"map",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),au=(0,Ce.Z)(qn.prototype,"coordinateSystemService",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bs=(0,Ce.Z)(qn.prototype,"rendererService",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rl=(0,Ce.Z)(qn.prototype,"layerService",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ys=(0,Ce.Z)(qn.prototype,"cameraService",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks=(0,Ce.Z)(qn.prototype,"interactionService",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$s=(0,Ce.Z)(qn.prototype,"pickingService",[wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ao=(0,Ce.Z)(qn.prototype,"shaderModuleService",[jr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wu=(0,Ce.Z)(qn.prototype,"markerService",[Qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nl=(0,Ce.Z)(qn.prototype,"popupService",[Mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qn))||fi),Ns=E(44908),uc=E.n(Ns);function Cu(te){var q=0;switch(te){case"vec2":case"ivec2":q=2;break;case"vec3":case"ivec3":q=3;break;case"vec4":case"ivec4":case"mat2":q=4;break;case"mat3":q=9;break;case"mat4":q=16;break;default:}return q}var Ta=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Au(te){var q={};return te=te.replace(Ta,function(R,F,ne){var pe=ne.split(":"),ht=pe[0].trim(),wt="";switch(pe.length>1&&(wt=pe[1].trim()),F){case"bool":wt=wt==="true";break;case"float":case"int":wt=Number(wt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":wt?wt=wt.replace("[","").replace("]","").split(",").reduce(function(At,qt){return At.push(Number(qt.trim())),At},[]):wt=new Array(Cu(F)).fill(0);break;default:}return q[ht]=wt,"uniform ".concat(F," ").concat(ht,`;
`)}),{content:te,uniforms:q}}var Hl,Tu;function lc(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function cc(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?lc(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):lc(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}var Rc="#define PI 3.14159265359",kc=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Sl=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,gu=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,il=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,al=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Vu=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,ol=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Gu=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,zs=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,fc=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,hc=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Dc=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Hu=/precision\s+(high|low|medium)p\s+float/,El=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Wl=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,pc=(Hl=(0,A.b2)(),Hl(Tu=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"moduleCache",{}),(0,N.Z)(this,"rawContentCache",{})}return(0,L.Z)(te,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Rc,fs:Rc}),this.registerModule("decode",{vs:kc,fs:""}),this.registerModule("projection",{vs:ol,fs:""}),this.registerModule("project",{vs:Vu,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Gu}),this.registerModule("lighting",{vs:gu,fs:""}),this.registerModule("light",{vs:Sl,fs:""}),this.registerModule("picking",{vs:al,fs:il}),this.registerModule("styleMapping",{vs:zs,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:fc,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:hc,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Dc,fs:""})}},{key:"registerModule",value:function(R,F){if(!this.rawContentCache[R]){var ne=F.vs,pe=F.fs,ht=F.uniforms,wt=Au(ne),At=wt.content,qt=wt.uniforms,Pr=Au(pe),vn=Pr.content,zn=Pr.uniforms;this.rawContentCache[R]={fs:vn,uniforms:cc(cc(cc({},qt),zn),ht),vs:At}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(R){var F=this;if(this.moduleCache[R])return this.moduleCache[R];var ne=this.rawContentCache[R].vs,pe=this.rawContentCache[R].fs,ht=this.processModule(ne,[],"vs"),wt=ht.content,At=ht.includeList,qt=this.processModule(pe,[],"fs"),Pr=qt.content,vn=qt.includeList,zn=Pr,$n=uc()(At.concat(vn).concat(R)).reduce(function(xi,li){return cc(cc({},xi),F.rawContentCache[li].uniforms)},{});return Hu.test(Pr)||(zn=El+Pr),this.moduleCache[R]={fs:zn.trim(),uniforms:$n,vs:wt.trim()},this.moduleCache[R]}},{key:"processModule",value:function(R,F,ne){var pe=this,ht=R.replace(Wl,function(wt,At){var qt=At.split(" "),Pr=qt[0].replace(/"/g,"");if(F.indexOf(Pr)>-1)return"";var vn=pe.rawContentCache[Pr][ne];F.push(Pr);var zn=pe.processModule(vn,F,ne),$n=zn.content;return $n});return{content:ht,includeList:F}}}]),te}())||Tu),Wu=E(66213),wl=E(92364),Cl,Pu,Xl,za,Mu,sl=(Cl=(0,A.b2)(),Pu=(0,A.f3)(Y.v.IShaderModuleService),Cl(Xl=(za=function(){function te(){(0,W.Z)(this,te),(0,se.Z)(this,"shaderModuleService",Mu,this),(0,N.Z)(this,"rendererService",void 0),(0,N.Z)(this,"cameraService",void 0),(0,N.Z)(this,"mapService",void 0),(0,N.Z)(this,"interactionService",void 0),(0,N.Z)(this,"layerService",void 0),(0,N.Z)(this,"config",void 0)}return(0,L.Z)(te,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return wl.G.Normal}},{key:"init",value:function(R,F){this.config=F,this.rendererService=R.getContainer().get(Y.v.IRendererService),this.cameraService=R.getContainer().get(Y.v.ICameraService),this.mapService=R.getContainer().get(Y.v.IMapService),this.interactionService=R.getContainer().get(Y.v.IInteractionService),this.layerService=R.getContainer().get(Y.v.ILayerService)}},{key:"render",value:function(R){}}]),te}(),Mu=(0,Ce.Z)(za.prototype,"shaderModuleService",[Pu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),za))||Xl),Yl,Kl;function Xu(te){var q=$c();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function $c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var ul=(Yl=(0,A.b2)(),Yl(Kl=function(te){(0,kt.Z)(R,te);var q=Xu(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(ne,pe){(0,Wu.Z)((0,w.Z)(R.prototype),"init",this).call(this,ne,pe)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),R}(sl))||Kl),$a,ll,Yu,Js,ia;function Ua(te,q){var R=typeof Symbol!="undefined"&&te[Symbol.iterator]||te["@@iterator"];if(!R){if(Array.isArray(te)||(R=_s(te))||q&&te&&typeof te.length=="number"){R&&(te=R);var F=0,ne=function(){};return{s:ne,n:function(){return F>=te.length?{done:!0}:{done:!1,value:te[F++]}},e:function(qt){throw qt},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var pe=!0,ht=!1,wt;return{s:function(){R=R.call(te)},n:function(){var qt=R.next();return pe=qt.done,qt},e:function(qt){ht=!0,wt=qt},f:function(){try{!pe&&R.return!=null&&R.return()}finally{if(ht)throw wt}}}}function _s(te,q){if(!!te){if(typeof te=="string")return Al(te,q);var R=Object.prototype.toString.call(te).slice(8,-1);if(R==="Object"&&te.constructor&&(R=te.constructor.name),R==="Map"||R==="Set")return Array.from(te);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return Al(te,q)}}function Al(te,q){(q==null||q>te.length)&&(q=te.length);for(var R=0,F=new Array(q);R<q;R++)F[R]=te[R];return F}var Iu=($a=(0,A.b2)(),ll=(0,A.f3)(Y.v.IPostProcessor),$a(Yu=(Js=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"passes",[]),(0,se.Z)(this,"postProcessor",ia,this),(0,N.Z)(this,"layer",void 0),(0,N.Z)(this,"renderFlag",void 0),(0,N.Z)(this,"width",0),(0,N.Z)(this,"height",0)}return(0,L.Z)(te,[{key:"setLayer",value:function(R){this.layer=R}},{key:"setRenderFlag",value:function(R){this.renderFlag=R}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var q=(0,Ho.Z)(yi().mark(function F(){var ne,pe,ht;return yi().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:ne=Ua(this.passes),At.prev=1,ne.s();case 3:if((pe=ne.n()).done){At.next=9;break}return ht=pe.value,At.next=7,ht.render(this.layer);case 7:At.next=3;break;case 9:At.next=14;break;case 11:At.prev=11,At.t0=At.catch(1),ne.e(At.t0);case 14:return At.prev=14,ne.f(),At.finish(14);case 17:this.layer.renderModels();case 18:case"end":return At.stop()}},F,this,[[1,11,14,17]])}));function R(){return q.apply(this,arguments)}return R}()},{key:"resize",value:function(R,F){(this.width!==R||this.height!==F)&&(this.width=R,this.height=F)}},{key:"add",value:function(R,F){R.getType()===wl.G.PostProcessing?this.postProcessor.add(R,this.layer,F):(R.init(this.layer,F),this.passes.push(R))}},{key:"insert",value:function(R,F,ne){R.init(this.layer,F),this.passes.splice(ne,0,R)}},{key:"destroy",value:function(){this.passes.length=0}}]),te}(),ia=(0,Ce.Z)(Js.prototype,"postProcessor",[ll],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Js))||Yu),Tl,Jc;function Qc(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function Pl(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Qc(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Qc(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function $l(te){var q=Ou();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function Ou(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var ko=(Tl=(0,A.b2)(),Tl(Jc=function(te){(0,kt.Z)(R,te);var q=$l(R);function R(){var F;(0,W.Z)(this,R);for(var ne=arguments.length,pe=new Array(ne),ht=0;ht<ne;ht++)pe[ht]=arguments[ht];return F=q.call.apply(q,[this].concat(pe)),(0,N.Z)((0,Le.Z)(F),"pickingFBO",void 0),(0,N.Z)((0,Le.Z)(F),"layer",void 0),(0,N.Z)((0,Le.Z)(F),"width",0),(0,N.Z)((0,Le.Z)(F),"height",0),(0,N.Z)((0,Le.Z)(F),"alreadyInRendering",!1),(0,N.Z)((0,Le.Z)(F),"pickFromPickingFBO",function(wt){var At=wt.x,qt=wt.y,Pr=wt.lngLat,vn=wt.type;if(!(!F.layer.isVisible()||!F.layer.needPick(vn))){var zn=F.rendererService,$n=zn.getViewportSize,xi=zn.readPixels,li=zn.useFramebuffer,Zi=$n(),$i=Zi.width,ba=Zi.height,oo=F.layer.getLayerConfig(),Ia=oo.enableHighlight,ho=oo.enableSelect,Va=At*Be.SO.DPR,ta=qt*Be.SO.DPR;if(!(Va>$i||Va<0||ta>ba||ta<0)){var da;li(F.pickingFBO,function(){var Na;if(da=xi({x:Math.round(Va),y:Math.round(ba-(qt+1)*Be.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:F.pickingFBO}),da[0]!==0||da[1]!==0||da[2]!==0){var ha=(0,Be.W0)(da),Pa=F.layer.getSource().getFeatureById(ha),Eo={x:At,y:qt,type:vn,lngLat:Pr,featureId:ha,feature:Pa};Pa&&(F.layer.setCurrentPickId(ha),F.triggerHoverOnLayer(Eo))}else{var Fo={x:At,y:qt,lngLat:Pr,type:F.layer.getCurrentPickId()===null?"un"+vn:"mouseout",featureId:null,feature:null};F.triggerHoverOnLayer(Pl(Pl({},Fo),{},{type:"unpick"})),F.triggerHoverOnLayer(Fo),F.layer.setCurrentPickId(null)}Ia&&F.highlightPickedFeature(da),ho&&vn==="click"&&((Na=da)===null||Na===void 0?void 0:Na.toString())!==[0,0,0,0].toString()&&F.selectFeature(da)})}}}),F}return(0,L.Z)(R,[{key:"getType",value:function(){return wl.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(ne,pe){(0,Wu.Z)((0,w.Z)(R.prototype),"init",this).call(this,ne,pe),this.layer=ne;var ht=this.rendererService,wt=ht.createTexture2D,At=ht.createFramebuffer,qt=ht.getViewportSize,Pr=qt(),vn=Pr.width,zn=Pr.height;this.pickingFBO=At({color:wt({width:vn,height:zn,wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})}),this.interactionService.on(si.s.Hover,this.pickFromPickingFBO),this.interactionService.on(si.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(si.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(ne){var pe=this;if(!this.alreadyInRendering){var ht=this.rendererService,wt=ht.getViewportSize,At=ht.useFramebuffer,qt=ht.clear,Pr=wt(),vn=Pr.width,zn=Pr.height;this.alreadyInRendering=!0,(this.width!==vn||this.height!==zn)&&(this.pickingFBO.resize({width:vn,height:zn}),this.width=vn,this.height=zn),At(this.pickingFBO,function(){qt({framebuffer:pe.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var $n=pe.layer.multiPassRenderer.getRenderFlag();pe.layer.multiPassRenderer.setRenderFlag(!1),ne.hooks.beforePickingEncode.call(),ne.render(),ne.hooks.afterPickingEncode.call(),pe.layer.multiPassRenderer.setRenderFlag($n),pe.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(ne){this.layer.emit(ne.type,ne)}},{key:"highlightPickedFeature",value:function(ne){var pe=(0,Qt.Z)(ne,3),ht=pe[0],wt=pe[1],At=pe[2];this.layer.hooks.beforeHighlight.call([ht,wt,At]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(ne){var pe=(0,Qt.Z)(ne,3),ht=pe[0],wt=pe[1],At=pe[2];this.layer.hooks.beforeSelect.call([ht,wt,At]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(ne){var pe=ne.featureId,ht=(0,Be.Z6)(pe);this.selectFeature(new Uint8Array(ht))}},{key:"highlightFeatureHandle",value:function(ne){var pe=ne.featureId,ht=(0,Be.Z6)(pe);this.highlightPickedFeature(new Uint8Array(ht))}}]),R}(sl))||Jc),Us=E(69530),cl,bo;function Dn(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function fo(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Dn(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Dn(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function Lu(te){var q=fl();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function fl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var Qs=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Ps=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,dc=(cl=(0,A.b2)(),cl(bo=function(te){(0,kt.Z)(R,te);var q=Lu(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Ps,fs:Qs});var ne=this.shaderModuleService.getModule("blur-pass"),pe=ne.vs,ht=ne.fs,wt=ne.uniforms,At=this.rendererService.getViewportSize(),qt=At.width,Pr=At.height;return{vs:pe,fs:ht,uniforms:fo(fo({},wt),{},{u_ViewportSize:[qt,Pr]})}}},{key:"convertOptionsToUniforms",value:function(ne){var pe={};return Xo()(ne.blurRadius)||(pe.u_BlurDir=[ne.blurRadius,0]),pe}}]),R}(Us.Z))||bo),dn,Jl;function Ql(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function Ru(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Ql(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Ql(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function ja(te){var q=Ms();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function Ms(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var ql=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,_u=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Is=(dn=(0,A.b2)(),dn(Jl=function(te){(0,kt.Z)(R,te);var q=ja(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:_u,fs:ql});var ne=this.shaderModuleService.getModule("blur-pass"),pe=ne.vs,ht=ne.fs,wt=ne.uniforms,At=this.rendererService.getViewportSize(),qt=At.width,Pr=At.height;return{vs:pe,fs:ht,uniforms:Ru(Ru({},wt),{},{u_ViewportSize:[qt,Pr]})}}},{key:"convertOptionsToUniforms",value:function(ne){var pe={};return Xo()(ne.blurRadius)||(pe.u_BlurDir=[0,ne.blurRadius]),pe}}]),R}(Us.Z))||Jl),su,Fc;function Ml(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function vc(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Ml(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Ml(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function Bc(te){var q=qs();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function qs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var Os=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,qi=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xu=(su=(0,A.b2)(),su(Fc=function(te){(0,kt.Z)(R,te);var q=Bc(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:qi,fs:Os});var ne=this.shaderModuleService.getModule("colorhalftone-pass"),pe=ne.vs,ht=ne.fs,wt=ne.uniforms,At=this.rendererService.getViewportSize(),qt=At.width,Pr=At.height;return{vs:pe,fs:ht,uniforms:vc(vc({},wt),{},{u_ViewportSize:[qt,Pr]})}}}]),R}(Us.Z))||Fc),Zs,zo;function hl(te){var q=uu();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function uu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var lu=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,So=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ku=(Zs=(0,A.b2)(),Zs(zo=function(te){(0,kt.Z)(R,te);var q=hl(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:So,fs:lu}),this.shaderModuleService.getModule("copy-pass")}}]),R}(Us.Z))||zo),ai,Hn;function Il(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function ns(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Il(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Il(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function eu(te){var q=Ko();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var cu=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,mc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ec=(ai=(0,A.b2)(),ai(Hn=function(te){(0,kt.Z)(R,te);var q=eu(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:mc,fs:cu});var ne=this.shaderModuleService.getModule("hexagonalpixelate-pass"),pe=ne.vs,ht=ne.fs,wt=ne.uniforms,At=this.rendererService.getViewportSize(),qt=At.width,Pr=At.height;return{vs:pe,fs:ht,uniforms:ns(ns({},wt),{},{u_ViewportSize:[qt,Pr]})}}}]),R}(Us.Z))||Hn),Wi,Do;function Nc(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function xs(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Nc(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Nc(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function tc(te){var q=bs();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function bs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var hs=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,pl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,fu=(Wi=(0,A.b2)(),Wi(Do=function(te){(0,kt.Z)(R,te);var q=tc(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:pl,fs:hs});var ne=this.shaderModuleService.getModule("ink-pass"),pe=ne.vs,ht=ne.fs,wt=ne.uniforms,At=this.rendererService.getViewportSize(),qt=At.width,Pr=At.height;return{vs:pe,fs:ht,uniforms:xs(xs({},wt),{},{u_ViewportSize:[qt,Pr]})}}}]),R}(Us.Z))||Do),Ol,Ku;function Ll(te){var q=zc();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function zc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var Rl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,dl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yc=(Ol=(0,A.b2)(),Ol(Ku=function(te){(0,kt.Z)(R,te);var q=Ll(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:dl,fs:Rl}),this.shaderModuleService.getModule("noise-pass")}}]),R}(Us.Z))||Ku),Du,Fu;function gc(te){var q=Bu();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function Bu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var js=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_c=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Nu=(Du=(0,A.b2)(),Du(Fu=function(te){(0,kt.Z)(R,te);var q=gc(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:js,fs:_c}),this.shaderModuleService.getModule("sepia-pass")}}]),R}(Us.Z))||Fu),kl,$u,n,u,a,h,g=(kl=(0,A.b2)(),$u=(0,A.f3)(Y.v.IRendererService),n=(0,A.zY)(),kl(u=(a=function(){function te(){(0,W.Z)(this,te),(0,se.Z)(this,"rendererService",h,this),(0,N.Z)(this,"passes",[]),(0,N.Z)(this,"readFBO",void 0),(0,N.Z)(this,"writeFBO",void 0)}return(0,L.Z)(te,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var q=(0,Ho.Z)(yi().mark(function F(ne){var pe,ht;return yi().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:pe=0;case 1:if(!(pe<this.passes.length)){At.next=10;break}return ht=this.passes[pe],ht.setRenderToScreen(this.isLastEnabledPass(pe)),At.next=6,ht.render(ne);case 6:pe!==this.passes.length-1&&this.swap();case 7:pe++,At.next=1;break;case 10:case"end":return At.stop()}},F,this)}));function R(F){return q.apply(this,arguments)}return R}()},{key:"resize",value:function(R,F){this.readFBO.resize({width:R,height:F}),this.writeFBO.resize({width:R,height:F})}},{key:"add",value:function(R,F,ne){R.init(F,ne),this.passes.push(R)}},{key:"insert",value:function(R,F,ne,pe){R.init(ne,pe),this.passes.splice(F,0,R)}},{key:"getPostProcessingPassByName",value:function(R){return this.passes.find(function(F){return F.getName()===R})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(R){for(var F=R+1;F<this.passes.length;F++)if(this.passes[F].isEnabled())return!1;return!0}},{key:"swap",value:function(){var R=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=R}}]),te}(),h=(0,Ce.Z)(a.prototype,"rendererService",[$u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Ce.Z)(a.prototype,"init",[n],Object.getOwnPropertyDescriptor(a.prototype,"init"),a.prototype),a))||u),b,P;function D(te){var q=H();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function H(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var ae=(b=(0,A.b2)(),b(P=function(te){(0,kt.Z)(R,te);var q=D(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"getType",value:function(){return wl.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(ne,pe){(0,Wu.Z)((0,w.Z)(R.prototype),"init",this).call(this,ne,pe)}},{key:"render",value:function(ne){var pe=this.rendererService,ht=pe.useFramebuffer,wt=pe.clear;ht(null,function(){wt({color:[0,0,0,0],depth:1,stencil:0}),ne.multiPassRenderer.setRenderFlag(!1),ne.render(),ne.multiPassRenderer.setRenderFlag(!0)})}}]),R}(sl))||P),be,we,Pe,We,Ve;function nt(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(te,ne).enumerable})),R.push.apply(R,F)}return R}function ze(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?nt(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):nt(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function ot(te){var q=bt();return function(){var F=(0,w.Z)(te),ne;if(q){var pe=(0,w.Z)(this).constructor;ne=Reflect.construct(F,arguments,pe)}else ne=F.apply(this,arguments);return(0,er.Z)(this,ne)}}function bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var Zt=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,hr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,ur=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function gr(te,q){for(var R=0,F=1/q,ne=te;ne>0;)R=R+F*(ne%q),ne=Math.floor(ne/q),F=F/q;return R}var Nr=1,an=(be=(0,A.b2)(),we=(0,A.f3)(Y.v.IShaderModuleService),be(Pe=(We=function(te){(0,kt.Z)(R,te);var q=ot(R);function R(){var F;(0,W.Z)(this,R);for(var ne=arguments.length,pe=new Array(ne),ht=0;ht<ne;ht++)pe[ht]=arguments[ht];return F=q.call.apply(q,[this].concat(pe)),(0,se.Z)((0,Le.Z)(F),"shaderModuleService",Ve,(0,Le.Z)(F)),(0,N.Z)((0,Le.Z)(F),"haltonSequence",[]),(0,N.Z)((0,Le.Z)(F),"accumulatingId",0),(0,N.Z)((0,Le.Z)(F),"frame",0),(0,N.Z)((0,Le.Z)(F),"timer",void 0),(0,N.Z)((0,Le.Z)(F),"sampleRenderTarget",void 0),(0,N.Z)((0,Le.Z)(F),"prevRenderTarget",void 0),(0,N.Z)((0,Le.Z)(F),"outputRenderTarget",void 0),(0,N.Z)((0,Le.Z)(F),"copyRenderTarget",void 0),(0,N.Z)((0,Le.Z)(F),"blendModel",void 0),(0,N.Z)((0,Le.Z)(F),"outputModel",void 0),(0,N.Z)((0,Le.Z)(F),"copyModel",void 0),F}return(0,L.Z)(R,[{key:"getType",value:function(){return wl.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(ne,pe){(0,Wu.Z)((0,w.Z)(R.prototype),"init",this).call(this,ne,pe);var ht=this.rendererService,wt=ht.createFramebuffer,At=ht.createTexture2D;this.sampleRenderTarget=wt({color:At({width:1,height:1,wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=wt({color:At({width:1,height:1,wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=wt({color:At({width:1,height:1,wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=wt({color:At({width:1,height:1,wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})});for(var qt=0;qt<30;qt++)this.haltonSequence.push([gr(qt,2),gr(qt,3)]);this.blendModel=this.createTriangleModel("blend-pass",Zt),this.outputModel=this.createTriangleModel("copy-pass",hr,{blend:{enable:!0,func:{srcRGB:ga.gl.ONE,dstRGB:ga.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:ga.gl.ONE,dstAlpha:ga.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:ga.gl.FUNC_ADD,alpha:ga.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",hr)}},{key:"render",value:function(ne){var pe=this,ht=this.rendererService,wt=ht.clear,At=ht.getViewportSize,qt=ht.useFramebuffer,Pr=At(),vn=Pr.width,zn=Pr.height;this.sampleRenderTarget.resize({width:vn,height:zn}),this.prevRenderTarget.resize({width:vn,height:zn}),this.outputRenderTarget.resize({width:vn,height:zn}),this.copyRenderTarget.resize({width:vn,height:zn}),this.resetFrame(),this.stopAccumulating();var $n=ne.multiPassRenderer.getPostProcessor().getReadFBO();qt($n,function(){wt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:$n}),ne.multiPassRenderer.setRenderFlag(!1),ne.render(),ne.multiPassRenderer.setRenderFlag(!0)});var xi=function li(Zi){!pe.accumulatingId||Zi!==pe.accumulatingId||pe.isFinished()||(pe.doRender(ne),requestAnimationFrame(function(){li(Zi)}))};this.accumulatingId=Nr++,this.timer=window.setTimeout(function(){xi(pe.accumulatingId)},50)}},{key:"doRender",value:function(ne){var pe=this,ht=this.rendererService,wt=ht.clear,At=ht.getViewportSize,qt=ht.useFramebuffer,Pr=At(),vn=Pr.width,zn=Pr.height,$n=ne.getLayerConfig(),xi=$n.jitterScale,li=xi===void 0?1:xi,Zi=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Zi[0]*2-1)/vn*li,(Zi[1]*2-1)/zn*li),ne.multiPassRenderer.setRenderFlag(!1),ne.hooks.beforeRender.call(),qt(this.sampleRenderTarget,function(){wt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:pe.sampleRenderTarget}),ne.render()}),ne.hooks.afterRender.call(),ne.multiPassRenderer.setRenderFlag(!0);var $i=ne.getLayerConfig();qt(this.outputRenderTarget,function(){pe.blendModel.draw({uniforms:{u_opacity:$i.opacity||1,u_MixRatio:pe.frame===0?1:.9,u_Diffuse1:pe.sampleRenderTarget,u_Diffuse2:pe.frame===0?ne.multiPassRenderer.getPostProcessor().getReadFBO():pe.prevRenderTarget}})}),this.frame===0&&wt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(qt(this.copyRenderTarget,function(){pe.outputModel.draw({uniforms:{u_Texture:pe.outputRenderTarget}})}),qt(ne.multiPassRenderer.getPostProcessor().getReadFBO(),function(){pe.copyModel.draw({uniforms:{u_Texture:pe.copyRenderTarget}})}),ne.multiPassRenderer.getPostProcessor().render(ne));var ba=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ba,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(ne,pe,ht){this.shaderModuleService.registerModule(ne,{vs:ur,fs:pe});var wt=this.shaderModuleService.getModule(ne),At=wt.vs,qt=wt.fs,Pr=wt.uniforms,vn=this.rendererService,zn=vn.createAttribute,$n=vn.createBuffer,xi=vn.createModel;return xi(ze({vs:At,fs:qt,attributes:{a_Position:zn({buffer:$n({data:[-4,-4,4,-4,0,4],type:ga.gl.FLOAT}),size:2})},uniforms:ze({},Pr),depth:{enable:!1},count:3},ht))}}]),R}(sl),Ve=(0,Ce.Z)(We.prototype,"shaderModuleService",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We))||Pe),Hr=new A.W2;Hr.bind(Y.v.IGlobalConfigService).to(Ae).inSingletonScope(),Hr.bind(Y.v.IShaderModuleService).to(pc).inSingletonScope(),(0,A.GW)((0,A.b2)(),C.EventEmitter),Hr.bind(Y.v.IEventEmitter).to(C.EventEmitter);var In=(0,Q.Z)(Hr,!1),ni=function(q){var R=In.lazyInject(q);return function(F,ne,pe){R.call(this,F,ne),pe&&(pe.initializer=function(){return F[ne]})}},hi=function(q){var R=In.lazyMultiInject(q);return function(F,ne,pe){R.call(this,F,ne),pe&&(pe.initializer=function(){return F[ne]})}},ii=Hr,ea=0;function Bn(){var te=new A.W2;return te.parent=Hr,te.bind(Y.v.SceneID).toConstantValue("".concat(ea++)),te.bind(Y.v.ILayerService).to(gi).inSingletonScope(),te.bind(Y.v.ISceneService).to(ou).inSingletonScope(),te.bind(Y.v.ICameraService).to(Lr).inSingletonScope(),te.bind(Y.v.ICoordinateSystemService).to(bn).inSingletonScope(),te.bind(Y.v.IInteractionService).to(pa).inSingletonScope(),te.bind(Y.v.IPickingService).to(Fa).inSingletonScope(),te.bind(Y.v.IControlService).to(Ur).inSingletonScope(),te.bind(Y.v.IMarkerService).to(Cr).inSingletonScope(),te.bind(Y.v.IIconService).to(Et).inSingletonScope(),te.bind(Y.v.IFontService).to(Ue).inSingletonScope(),te.bind(Y.v.IPopupService).to(Si).inSingletonScope(),te.bind(Y.v.INormalPass).to(ul).whenTargetNamed("clear"),te.bind(Y.v.INormalPass).to(ko).whenTargetNamed("pixelPicking"),te.bind(Y.v.INormalPass).to(ae).whenTargetNamed("render"),te.bind(Y.v.INormalPass).to(an).whenTargetNamed("taa"),te.bind(Y.v.IFactoryNormalPass).toFactory(function(q){return function(R){return q.container.getNamed(Y.v.INormalPass,R)}}),te.bind(Y.v.IPostProcessingPass).to(ku).whenTargetNamed("copy"),te.bind(Y.v.IPostProcessingPass).to(dc).whenTargetNamed("blurH"),te.bind(Y.v.IPostProcessingPass).to(Is).whenTargetNamed("blurV"),te.bind(Y.v.IPostProcessingPass).to(yc).whenTargetNamed("noise"),te.bind(Y.v.IPostProcessingPass).to(Nu).whenTargetNamed("sepia"),te.bind(Y.v.IPostProcessingPass).to(xu).whenTargetNamed("colorHalftone"),te.bind(Y.v.IPostProcessingPass).to(ec).whenTargetNamed("hexagonalPixelate"),te.bind(Y.v.IPostProcessingPass).to(fu).whenTargetNamed("ink"),te.bind(Y.v.IFactoryPostProcessingPass).toFactory(function(q){return function(R){var F=q.container.getNamed(Y.v.IPostProcessingPass,R);return F.setName(R),F}}),te}function _i(te){var q=new A.W2;return q.parent=te,q.bind(Y.v.IStyleAttributeService).to(Aa).inSingletonScope(),q.bind(Y.v.IMultiPassRenderer).to(Iu).inSingletonScope(),q.bind(Y.v.IPostProcessor).to(g).inSingletonScope(),q}},2811:function(){},64532:function(){},4594:function(Or,U,E){"use strict";E.d(U,{l:function(){return le}});var le={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(Or,U,E){"use strict";E.d(U,{d:function(){return le}});var le;(function(C){C.TOPRIGHT="topright",C.TOPLEFT="topleft",C.BOTTOMRIGHT="bottomright",C.BOTTOMLEFT="bottomleft"})(le||(le={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(Or,U,E){"use strict";E.d(U,{l:function(){return le},k:function(){return C}});var le;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(le||(le={}));var C={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(Or,U,E){"use strict";E.d(U,{s:function(){return le}});var le;(function(C){C.Hover="hover",C.Click="click",C.Select="select",C.Active="active",C.Drag="drag"})(le||(le={}))},90919:function(){},77252:function(Or,U,E){"use strict";E.d(U,{h:function(){return le}});var le;(function(C){C.normal="normal",C.additive="additive",C.subtractive="subtractive",C.min="min",C.max="max",C.none="none"})(le||(le={}))},31251:function(Or,U,E){"use strict";E.d(U,{vY:function(){return le},ee:function(){return C},GC:function(){return p}});var le;(function(A){A.LINEAR="linear",A.POWER="power",A.LOG="log",A.IDENTITY="identity",A.TIME="time",A.QUANTILE="quantile",A.QUANTIZE="quantize",A.THRESHOLD="threshold",A.CAT="cat"})(le||(le={}));var C;(function(A){A.CONSTANT="constant",A.VARIABLE="variable"})(C||(C={}));var p;(function(A){A[A.Attribute=0]="Attribute",A[A.InstancedAttribute=1]="InstancedAttribute",A[A.Uniform=2]="Uniform"})(p||(p={}))},16606:function(Or,U,E){"use strict";E.d(U,{I:function(){return le}});var le=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(Or,U,E){"use strict";E.d(U,{G:function(){return le}});var le;(function(C){C.Normal="normal",C.PostProcessing="post-processing"})(le||(le={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(Or,U,E){"use strict";E.d(U,{gl:function(){return le}});var le;(function(C){C[C.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",C[C.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",C[C.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",C[C.POINTS=0]="POINTS",C[C.LINES=1]="LINES",C[C.LINE_LOOP=2]="LINE_LOOP",C[C.LINE_STRIP=3]="LINE_STRIP",C[C.TRIANGLES=4]="TRIANGLES",C[C.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",C[C.TRIANGLE_FAN=6]="TRIANGLE_FAN",C[C.ZERO=0]="ZERO",C[C.ONE=1]="ONE",C[C.SRC_COLOR=768]="SRC_COLOR",C[C.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",C[C.SRC_ALPHA=770]="SRC_ALPHA",C[C.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",C[C.DST_ALPHA=772]="DST_ALPHA",C[C.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",C[C.DST_COLOR=774]="DST_COLOR",C[C.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",C[C.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",C[C.FUNC_ADD=32774]="FUNC_ADD",C[C.BLEND_EQUATION=32777]="BLEND_EQUATION",C[C.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",C[C.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",C[C.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",C[C.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",C[C.MAX_EXT=32776]="MAX_EXT",C[C.MIN_EXT=32775]="MIN_EXT",C[C.BLEND_DST_RGB=32968]="BLEND_DST_RGB",C[C.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",C[C.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",C[C.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",C[C.CONSTANT_COLOR=32769]="CONSTANT_COLOR",C[C.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",C[C.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",C[C.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",C[C.BLEND_COLOR=32773]="BLEND_COLOR",C[C.ARRAY_BUFFER=34962]="ARRAY_BUFFER",C[C.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",C[C.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",C[C.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",C[C.STREAM_DRAW=35040]="STREAM_DRAW",C[C.STATIC_DRAW=35044]="STATIC_DRAW",C[C.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",C[C.BUFFER_SIZE=34660]="BUFFER_SIZE",C[C.BUFFER_USAGE=34661]="BUFFER_USAGE",C[C.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",C[C.FRONT=1028]="FRONT",C[C.BACK=1029]="BACK",C[C.FRONT_AND_BACK=1032]="FRONT_AND_BACK",C[C.CULL_FACE=2884]="CULL_FACE",C[C.BLEND=3042]="BLEND",C[C.DITHER=3024]="DITHER",C[C.STENCIL_TEST=2960]="STENCIL_TEST",C[C.DEPTH_TEST=2929]="DEPTH_TEST",C[C.SCISSOR_TEST=3089]="SCISSOR_TEST",C[C.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",C[C.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",C[C.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",C[C.NO_ERROR=0]="NO_ERROR",C[C.INVALID_ENUM=1280]="INVALID_ENUM",C[C.INVALID_VALUE=1281]="INVALID_VALUE",C[C.INVALID_OPERATION=1282]="INVALID_OPERATION",C[C.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",C[C.CW=2304]="CW",C[C.CCW=2305]="CCW",C[C.LINE_WIDTH=2849]="LINE_WIDTH",C[C.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",C[C.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",C[C.CULL_FACE_MODE=2885]="CULL_FACE_MODE",C[C.FRONT_FACE=2886]="FRONT_FACE",C[C.DEPTH_RANGE=2928]="DEPTH_RANGE",C[C.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",C[C.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",C[C.DEPTH_FUNC=2932]="DEPTH_FUNC",C[C.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",C[C.STENCIL_FUNC=2962]="STENCIL_FUNC",C[C.STENCIL_FAIL=2964]="STENCIL_FAIL",C[C.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",C[C.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",C[C.STENCIL_REF=2967]="STENCIL_REF",C[C.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",C[C.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",C[C.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",C[C.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",C[C.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",C[C.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",C[C.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",C[C.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",C[C.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",C[C.VIEWPORT=2978]="VIEWPORT",C[C.SCISSOR_BOX=3088]="SCISSOR_BOX",C[C.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",C[C.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",C[C.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",C[C.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",C[C.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",C[C.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",C[C.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",C[C.RED_BITS=3410]="RED_BITS",C[C.GREEN_BITS=3411]="GREEN_BITS",C[C.BLUE_BITS=3412]="BLUE_BITS",C[C.ALPHA_BITS=3413]="ALPHA_BITS",C[C.DEPTH_BITS=3414]="DEPTH_BITS",C[C.STENCIL_BITS=3415]="STENCIL_BITS",C[C.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",C[C.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",C[C.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",C[C.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",C[C.SAMPLES=32937]="SAMPLES",C[C.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",C[C.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",C[C.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",C[C.DONT_CARE=4352]="DONT_CARE",C[C.FASTEST=4353]="FASTEST",C[C.NICEST=4354]="NICEST",C[C.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",C[C.BYTE=5120]="BYTE",C[C.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",C[C.SHORT=5122]="SHORT",C[C.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",C[C.INT=5124]="INT",C[C.UNSIGNED_INT=5125]="UNSIGNED_INT",C[C.FLOAT=5126]="FLOAT",C[C.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",C[C.ALPHA=6406]="ALPHA",C[C.RGB=6407]="RGB",C[C.RGBA=6408]="RGBA",C[C.LUMINANCE=6409]="LUMINANCE",C[C.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",C[C.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",C[C.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",C[C.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",C[C.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",C[C.VERTEX_SHADER=35633]="VERTEX_SHADER",C[C.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",C[C.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",C[C.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",C[C.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",C[C.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",C[C.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",C[C.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",C[C.SHADER_TYPE=35663]="SHADER_TYPE",C[C.DELETE_STATUS=35712]="DELETE_STATUS",C[C.LINK_STATUS=35714]="LINK_STATUS",C[C.VALIDATE_STATUS=35715]="VALIDATE_STATUS",C[C.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",C[C.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",C[C.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",C[C.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",C[C.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",C[C.NEVER=512]="NEVER",C[C.LESS=513]="LESS",C[C.EQUAL=514]="EQUAL",C[C.LEQUAL=515]="LEQUAL",C[C.GREATER=516]="GREATER",C[C.NOTEQUAL=517]="NOTEQUAL",C[C.GEQUAL=518]="GEQUAL",C[C.ALWAYS=519]="ALWAYS",C[C.KEEP=7680]="KEEP",C[C.REPLACE=7681]="REPLACE",C[C.INCR=7682]="INCR",C[C.DECR=7683]="DECR",C[C.INVERT=5386]="INVERT",C[C.INCR_WRAP=34055]="INCR_WRAP",C[C.DECR_WRAP=34056]="DECR_WRAP",C[C.VENDOR=7936]="VENDOR",C[C.RENDERER=7937]="RENDERER",C[C.VERSION=7938]="VERSION",C[C.NEAREST=9728]="NEAREST",C[C.LINEAR=9729]="LINEAR",C[C.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",C[C.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",C[C.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",C[C.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",C[C.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",C[C.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",C[C.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",C[C.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",C[C.TEXTURE_2D=3553]="TEXTURE_2D",C[C.TEXTURE=5890]="TEXTURE",C[C.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",C[C.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",C[C.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",C[C.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",C[C.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",C[C.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",C[C.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",C[C.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",C[C.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",C[C.TEXTURE0=33984]="TEXTURE0",C[C.TEXTURE1=33985]="TEXTURE1",C[C.TEXTURE2=33986]="TEXTURE2",C[C.TEXTURE3=33987]="TEXTURE3",C[C.TEXTURE4=33988]="TEXTURE4",C[C.TEXTURE5=33989]="TEXTURE5",C[C.TEXTURE6=33990]="TEXTURE6",C[C.TEXTURE7=33991]="TEXTURE7",C[C.TEXTURE8=33992]="TEXTURE8",C[C.TEXTURE9=33993]="TEXTURE9",C[C.TEXTURE10=33994]="TEXTURE10",C[C.TEXTURE11=33995]="TEXTURE11",C[C.TEXTURE12=33996]="TEXTURE12",C[C.TEXTURE13=33997]="TEXTURE13",C[C.TEXTURE14=33998]="TEXTURE14",C[C.TEXTURE15=33999]="TEXTURE15",C[C.TEXTURE16=34e3]="TEXTURE16",C[C.TEXTURE17=34001]="TEXTURE17",C[C.TEXTURE18=34002]="TEXTURE18",C[C.TEXTURE19=34003]="TEXTURE19",C[C.TEXTURE20=34004]="TEXTURE20",C[C.TEXTURE21=34005]="TEXTURE21",C[C.TEXTURE22=34006]="TEXTURE22",C[C.TEXTURE23=34007]="TEXTURE23",C[C.TEXTURE24=34008]="TEXTURE24",C[C.TEXTURE25=34009]="TEXTURE25",C[C.TEXTURE26=34010]="TEXTURE26",C[C.TEXTURE27=34011]="TEXTURE27",C[C.TEXTURE28=34012]="TEXTURE28",C[C.TEXTURE29=34013]="TEXTURE29",C[C.TEXTURE30=34014]="TEXTURE30",C[C.TEXTURE31=34015]="TEXTURE31",C[C.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",C[C.REPEAT=10497]="REPEAT",C[C.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",C[C.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",C[C.FLOAT_VEC2=35664]="FLOAT_VEC2",C[C.FLOAT_VEC3=35665]="FLOAT_VEC3",C[C.FLOAT_VEC4=35666]="FLOAT_VEC4",C[C.INT_VEC2=35667]="INT_VEC2",C[C.INT_VEC3=35668]="INT_VEC3",C[C.INT_VEC4=35669]="INT_VEC4",C[C.BOOL=35670]="BOOL",C[C.BOOL_VEC2=35671]="BOOL_VEC2",C[C.BOOL_VEC3=35672]="BOOL_VEC3",C[C.BOOL_VEC4=35673]="BOOL_VEC4",C[C.FLOAT_MAT2=35674]="FLOAT_MAT2",C[C.FLOAT_MAT3=35675]="FLOAT_MAT3",C[C.FLOAT_MAT4=35676]="FLOAT_MAT4",C[C.SAMPLER_2D=35678]="SAMPLER_2D",C[C.SAMPLER_CUBE=35680]="SAMPLER_CUBE",C[C.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",C[C.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",C[C.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",C[C.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",C[C.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",C[C.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",C[C.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",C[C.COMPILE_STATUS=35713]="COMPILE_STATUS",C[C.LOW_FLOAT=36336]="LOW_FLOAT",C[C.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",C[C.HIGH_FLOAT=36338]="HIGH_FLOAT",C[C.LOW_INT=36339]="LOW_INT",C[C.MEDIUM_INT=36340]="MEDIUM_INT",C[C.HIGH_INT=36341]="HIGH_INT",C[C.FRAMEBUFFER=36160]="FRAMEBUFFER",C[C.RENDERBUFFER=36161]="RENDERBUFFER",C[C.RGBA4=32854]="RGBA4",C[C.RGB5_A1=32855]="RGB5_A1",C[C.RGB565=36194]="RGB565",C[C.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",C[C.STENCIL_INDEX=6401]="STENCIL_INDEX",C[C.STENCIL_INDEX8=36168]="STENCIL_INDEX8",C[C.DEPTH_STENCIL=34041]="DEPTH_STENCIL",C[C.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",C[C.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",C[C.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",C[C.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",C[C.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",C[C.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",C[C.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",C[C.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",C[C.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",C[C.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",C[C.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",C[C.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",C[C.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",C[C.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",C[C.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",C[C.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",C[C.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",C[C.NONE=0]="NONE",C[C.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",C[C.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",C[C.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",C[C.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",C[C.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",C[C.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",C[C.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",C[C.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",C[C.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",C[C.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",C[C.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",C[C.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",C[C.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",C[C.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(le||(le={}))},69530:function(Or,U,E){"use strict";E.d(U,{Z:function(){return Xe}});var le=E(55770),C=E(6610),p=E(5991),A=E(96156),Q=E(3473),Y=E(11700),W=E.n(Y),L=E(14293),N=E.n(L),Be=E(68929),Ye=E.n(Be),Je=E(86700),et=E(28660),Yt=E.n(et),Gt=E(7648),tr=E(72302),zt=E(92364),Pt,xt,yr,ee,vr;function Ct(Ut,_r){var or=Object.keys(Ut);if(Object.getOwnPropertySymbols){var zr=Object.getOwnPropertySymbols(Ut);_r&&(zr=zr.filter(function(he){return Object.getOwnPropertyDescriptor(Ut,he).enumerable})),or.push.apply(or,zr)}return or}function Ke(Ut){for(var _r=1;_r<arguments.length;_r++){var or=arguments[_r]!=null?arguments[_r]:{};_r%2?Ct(Object(or),!0).forEach(function(zr){(0,A.Z)(Ut,zr,or[zr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ut,Object.getOwnPropertyDescriptors(or)):Ct(Object(or)).forEach(function(zr){Object.defineProperty(Ut,zr,Object.getOwnPropertyDescriptor(or,zr))})}return Ut}var Rt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xe=(Pt=(0,Je.b2)(),xt=(0,Je.f3)(tr.v.IShaderModuleService),Pt(yr=(ee=function(){function Ut(){(0,C.Z)(this,Ut),(0,le.Z)(this,"shaderModuleService",vr,this),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"config",void 0),(0,A.Z)(this,"quad",Rt),(0,A.Z)(this,"enabled",!0),(0,A.Z)(this,"renderToScreen",!1),(0,A.Z)(this,"model",void 0),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"optionsToUpdate",{})}return(0,p.Z)(Ut,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(or){this.name=or}},{key:"getType",value:function(){return zt.G.PostProcessing}},{key:"init",value:function(or,zr){this.config=zr,this.rendererService=or.getContainer().get(tr.v.IRendererService);var he=this.rendererService,Re=he.createAttribute,ye=he.createBuffer,_t=he.createModel,ft=this.setupShaders(),Nt=ft.vs,Ft=ft.fs,kr=ft.uniforms;this.model=_t({vs:Nt,fs:Ft,attributes:{a_Position:Re({buffer:ye({data:[-4,-4,4,-4,0,4],type:Gt.gl.FLOAT}),size:2})},uniforms:Ke(Ke({u_Texture:null},kr),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(or){var zr=this,he=or.multiPassRenderer.getPostProcessor(),Re=this.rendererService,ye=Re.useFramebuffer,_t=Re.getViewportSize,ft=Re.clear,Nt=_t(),Ft=Nt.width,kr=Nt.height;ye(this.renderToScreen?null:he.getWriteFBO(),function(){ft({framebuffer:he.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),zr.model.draw({uniforms:Ke({u_Texture:he.getReadFBO(),u_ViewportSize:[Ft,kr]},zr.convertOptionsToUniforms(zr.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(or){this.enabled=or}},{key:"setRenderToScreen",value:function(or){this.renderToScreen=or}},{key:"updateOptions",value:function(or){this.optionsToUpdate=Ke(Ke({},this.optionsToUpdate),or)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(or){var zr={};return Object.keys(or).forEach(function(he){N()(or[he])||(zr["u_".concat(W()(Ye()(he)))]=or[he])}),zr}}]),Ut}(),vr=(0,Q.Z)(ee.prototype,"shaderModuleService",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee))||yr)},19793:function(Or,U,E){"use strict";E.d(U,{P:function(){return le}});var le=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(Or,U,E){"use strict";E.d(U,{v:function(){return le}});var le={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(Or,U,E){"use strict";var le=E(74691),C=null;function p(Xe){return C.indexOf(Xe)}var A=2,Q=4,Y=64,W=128,L=256,N=512,Be=8192,Ye=16384,Je=32768,et=null,Yt=131072,Gt=262144,tr=524288,zt=1048576,Pt=2097152,xt=4194304,yr=8388608,ee=16777216,vr=null;function Ct(Xe,Ut){return Xe=_clamp(Math.floor(Xe),0,255),Ut=_clamp(Math.floor(Ut),0,255),256*Xe+Ut}function Ke(Xe){var Ut=Xe.color,_r=Xe.radius,or=Xe.tileX,zr=Xe.tileY,he=Xe.shape,Re=Xe.opacity,ye=Xe.stroke,_t=Xe.strokeWidth,ft=Xe.strokeOpacity,Nt=[],Ft=[],kr=[],cn=[Ct(Ut[0],Ut[1]),Ct(Ut[2],Ut[3])],yn=[Ct(ye[0],ye[1]),Ct(ye[2],ye[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Vi){var ir=_slicedToArray(Vi,2),de=ir[0],Te=ir[1];Nt.push([].concat(cn,[(de+1)*yr+(Te+1)*Pt+getShapeIndex(he)*Yt+_r,(or+512)*tr+(zr+512)*Y])),Ft.push([].concat(yn,[_t,ft])),kr.push([Re,0,0,0])}),{packedBuffer:Nt,packedBuffer2:Ft,packedBuffer3:kr}}function Rt(Xe,Ut){if(Xe===0&&!Ut)return 0;if(Xe===1&&Ut)return 4294967295;var _r=Ut?1:0,or=Math.floor(Xe*127);return or*vr+_r*ee+or*Yt+_r*et+or*N+_r*L+or*A+_r}},72278:function(Or,U,E){"use strict";E.d(U,{zP:function(){return xg},JE:function(){return xy},ns:function(){return _g}});var le=E(67294),C=(0,le.createContext)({});function p(){return(0,le.useContext)(C)}var A=E(58881),Q=E(28481),Y=E(6610),W=E(5991),L=E(96156),N=E(63349),Be=E(10379),Ye=E(46070),Je=E(77608),et=E(6901),Yt=E(26729);function Gt(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function tr(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Gt(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Gt(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function zt(i){var c=Pt();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Pt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var xt;(function(i){i.TOPRIGHT="topright",i.TOPLEFT="topleft",i.BOTTOMRIGHT="bottomright",i.BOTTOMLEFT="bottomleft"})(xt||(xt={}));var yr=0,ee=function(i){(0,Be.Z)(o,i);var c=zt(o);function o(s){var l;return(0,Y.Z)(this,o),l=c.call(this),(0,L.Z)((0,N.Z)(l),"controlOption",void 0),(0,L.Z)((0,N.Z)(l),"container",void 0),(0,L.Z)((0,N.Z)(l),"sceneContainer",void 0),(0,L.Z)((0,N.Z)(l),"mapsService",void 0),(0,L.Z)((0,N.Z)(l),"renderService",void 0),(0,L.Z)((0,N.Z)(l),"layerService",void 0),(0,L.Z)((0,N.Z)(l),"controlService",void 0),(0,L.Z)((0,N.Z)(l),"isShow",void 0),l.controlOption=tr(tr({},l.getDefault()),s||{}),l}return(0,W.Z)(o,[{key:"getDefault",value:function(){return{position:xt.TOPRIGHT,name:"".concat(yr++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(A.vK.IMapService),this.renderService=l.get(A.vK.IRendererService),this.layerService=l.get(A.vK.ILayerService),this.controlService=l.get(A.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,_=this.controlOption.position,T=this.controlService.controlCorners[_];return et.SO.addClass(d,"l7-control"),_.indexOf("bottom")!==-1?T.insertBefore(d,T.firstChild):T.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;et.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;et.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;et.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),o}(Yt.EventEmitter);function vr(i){var c=Ct();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ke=function(i){(0,Be.Z)(o,i);var c=vr(o);function o(s){var l;return(0,Y.Z)(this,o),l=c.call(this,s),(0,L.Z)((0,N.Z)(l),"layerControlInputs",void 0),(0,L.Z)((0,N.Z)(l),"layers",void 0),(0,L.Z)((0,N.Z)(l),"lastZIndex",void 0),(0,L.Z)((0,N.Z)(l),"handlingClick",void 0),(0,L.Z)((0,N.Z)(l),"layersLink",void 0),(0,L.Z)((0,N.Z)(l),"baseLayersList",void 0),(0,L.Z)((0,N.Z)(l),"separator",void 0),(0,L.Z)((0,N.Z)(l),"overlaysList",void 0),(0,L.Z)((0,N.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,et.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,N.Z)(l)),l}return(0,W.Z)(o,[{key:"getDefault",value:function(){return{collapsed:!0,position:A.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;et.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var _=d-(this.container.offsetTop+50);return _<this.form.clientHeight?(et.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=_+"px"):et.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return et.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=et.SO.create("div",l),_=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var T=this.form=et.SO.create("form",l+"-list");_&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=et.SO.create("a",l+"-toggle",d);var I=this.layersLink;I.title="Layers",_||this.expand(),this.baseLayersList=et.SO.create("div",l+"-base",T),this.separator=et.SO.create("div",l+"-separator",T),this.overlaysList=et.SO.create("div",l+"-overlays",T),d.appendChild(T)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,_=d.baseLayers,T=_===void 0?{}:_,I=d.overlayers,k=I===void 0?{}:I;Object.keys(T).forEach(function(J,$){l.addLayer(T[J],J,!1)}),Object.keys(k).forEach(function(J,$){l.addLayer(k[J],J,!0)})}},{key:"update",value:function(){if(!this.container)return this;et.SO.empty(this.baseLayersList),et.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,_,T,I=0;for(_=0;_<this.layers.length;_++)T=this.layers[_],this.addItem(T),d=d||T.overlay,l=l||!T.overlay,I+=T.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&I>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,_,T=this.mapsService.getZoom(),I=l.length-1;I>=0;I--)if(d=l[I],_=this.layerService.getLayer(d.layerId),_&&_.inited){var k=_.getMinZoom(),J=_.getMaxZoom();d.disabled=T<k||T>J}}},{key:"addLayer",value:function(l,d,_){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:_});var T=this.controlOption,I=T.sortLayers,k=T.sortFunction,J=T.autoZIndex;I&&this.layers.sort(function($,_e){return k($.layer,_e.layer,$.name,_e.name)}),J&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),_=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;_&&this.emit(_,d)}},{key:"createRadioElement",value:function(l,d){var _='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",T=document.createElement("div");return T.innerHTML=_,T.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),_=this.layerService.getLayer(l.layer.id),T=_&&_.inited&&l.layer.isVisible(),I;l.overlay?(I=document.createElement("input"),I.type="checkbox",I.className="l7-control-layers-selector",I.defaultChecked=T):I=this.createRadioElement("l7-base-layers",T),this.layerControlInputs.push(I),I.layerId=l.layer.id,I.addEventListener("click",this.onInputClick);var k=document.createElement("span");k.innerHTML=" "+l.name;var J=document.createElement("div");d.appendChild(J),J.appendChild(I),J.appendChild(k);var $=l.overlay?this.overlaysList:this.baseLayersList;return $.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,_,T=[],I=[];this.handlingClick=!0;for(var k=l.length-1;k>=0;k--)d=l[k],_=this.layerService.getLayer(d.layerId),d.checked?T.push(_):d.checked||I.push(_);I.forEach(function(J){J.hide()}),T.forEach(function(J){J.show()}),this.handlingClick=!1}}]),o}(ee);function Rt(i){var c=Xe();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Xe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ut=function(i){(0,Be.Z)(o,i);var c=Rt(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getDefault",value:function(){return{position:xt.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=et.SO.create("div",l),_=et.SO.create("a","l7-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://antv.alipay.com/l7",_.setAttribute("aria-label","AntV logo"),_.setAttribute("rel","noopener nofollow"),d.appendChild(_),d}},{key:"onRemove",value:function(){return null}}]),o}(ee);function _r(i){var c=or();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function or(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var zr=function(i){(0,Be.Z)(o,i);var c=_r(o);function o(s){var l;return(0,Y.Z)(this,o),l=c.call(this,s),(0,L.Z)((0,N.Z)(l),"mScale",void 0),(0,L.Z)((0,N.Z)(l),"iScale",void 0),(0,et.Ev)(["update"],(0,N.Z)(l)),l}return(0,W.Z)(o,[{key:"getDefault",value:function(){return{position:xt.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=et.SO.create("div",l);this.addScales(l+"-line",d);var _=this.controlOption.updateWhenIdle;return this.mapsService.on(_?"moveend":"mapmove",this.update),this.mapsService.on(_?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,_=l.getSize()[1]/2,T=l.containerToLngLat([0,_]),I=l.containerToLngLat([d,_]),k=(0,et.yM)([T.lng,T.lat],[I.lng,I.lat]);this.updateScales(k)}},{key:"updateScales",value:function(l){var d=this.controlOption,_=d.metric,T=d.imperial;_&&l&&this.updateMetric(l),T&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),_=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,_,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,_,T,I;d>5280?(_=d/5280,T=this.getRoundNum(_),this.updateScale(this.iScale,T+" mi",T/_)):(I=this.getRoundNum(d),this.updateScale(this.iScale,I+" ft",I/d))}},{key:"updateScale",value:function(l,d,_){var T=this.controlOption.maxWidth;l.style.width=Math.round(T*_)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),_=l/d;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,d*_}},{key:"addScales",value:function(l,d){var _=this.controlOption,T=_.metric,I=_.imperial;T&&(this.mScale=et.SO.create("div",l,d)),I&&(this.iScale=et.SO.create("div",l,d))}}]),o}(ee);function he(i){var c=Re();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Re(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ye=function(i){(0,Be.Z)(o,i);var c=he(o);function o(s){var l;return(0,Y.Z)(this,o),l=c.call(this,s),(0,L.Z)((0,N.Z)(l),"disabled",void 0),(0,L.Z)((0,N.Z)(l),"zoomInButton",void 0),(0,L.Z)((0,N.Z)(l),"zoomOutButton",void 0),(0,et.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,N.Z)(l)),l}return(0,W.Z)(o,[{key:"getDefault",value:function(){return{position:xt.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=et.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,_,T,I){var k=et.SO.create("a",_,T);return k.innerHTML=l,k.title=d,k.href="javascript:void(0)",k.addEventListener("click",I),k}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";et.SO.removeClass(this.zoomInButton,d),et.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&et.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&et.SO.addClass(this.zoomInButton,d)}}]),o}(ee);function _t(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function ft(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?_t(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):_t(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Nt(i){var c=Ft();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ft(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var kr=function(i){(0,Be.Z)(o,i);var c=Nt(o);function o(s){var l;return(0,Y.Z)(this,o),l=c.call(this),(0,L.Z)((0,N.Z)(l),"markerOption",void 0),(0,L.Z)((0,N.Z)(l),"defaultMarker",void 0),(0,L.Z)((0,N.Z)(l),"popup",void 0),(0,L.Z)((0,N.Z)(l),"mapsService",void 0),(0,L.Z)((0,N.Z)(l),"sceneSerive",void 0),(0,L.Z)((0,N.Z)(l),"lngLat",void 0),(0,L.Z)((0,N.Z)(l),"scene",void 0),(0,L.Z)((0,N.Z)(l),"added",!1),(0,L.Z)((0,N.Z)(l),"eventHandle",function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=ft(ft({},l.getDefault()),s),(0,et.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,N.Z)(l)),l.init(),l}return(0,W.Z)(o,[{key:"getDefault",value:function(){return{element:void 0,anchor:et.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(A.vK.IMapService),this.sceneSerive=l.get(A.vK.ISceneService);var d=this.markerOption,_=d.element,T=d.draggable;return this.mapsService.getMarkerContainer().appendChild(_),this.registerMarkerEvent(_),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&et.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var _=this.markerOption.element;return _&&et.SO.remove(_),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,_=l.anchor;this.updatePosition(),et.SO.setTransform(d,"".concat(et.rQ[_]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,_=l.offsets,T=this.lngLat,I=T.lng,k=T.lat,J=this.mapsService.getBounds(),$=this.mapsService.lngLatToContainer([I,k]);if(d){d.style.display="block";var _e=this.mapsService.getContainer(),Ne=0,mt=0;if(_e&&(Ne=_e.scrollWidth,mt=_e.scrollHeight),Math.abs(J[0][0])>180||Math.abs(J[1][0])>180){if($.x>Ne){var Bt=this.mapsService.lngLatToContainer([I-360,k]);$.x=Bt.x}if($.x<0){var mr=this.mapsService.lngLatToContainer([I+360,k]);$.x=mr.x}}($.x>Ne||$.x<0||$.y>mt||$.y<0)&&(d.style.display="none"),d.style.left=$.x+_[0]+"px",d.style.top=$.y-_[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,_=this.markerOption,T=_.color,I=_.anchor;if(!d){this.defaultMarker=!0,d=et.SO.create("div"),this.markerOption.element=d;var k=document.createElementNS("http://www.w3.org/2000/svg","svg");k.setAttributeNS(null,"display","block"),k.setAttributeNS(null,"height","48px"),k.setAttributeNS(null,"width","48px"),k.setAttributeNS(null,"viewBox","0 0 1024 1024");var J=document.createElementNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),J.setAttributeNS(null,"fill",T),k.appendChild(J),d.appendChild(k)}et.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function($){var _e,Ne,mt=((_e=l.markerOption)===null||_e===void 0?void 0:_e.style)&&((Ne=l.markerOption)===null||Ne===void 0?void 0:Ne.style[$]);d&&(d.style[$]=mt)}),d.addEventListener("click",function($){l.onMapClick($)}),d.addEventListener("click",this.eventHandle),(0,et.zi)(d,I,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),o}(Yt.EventEmitter),cn=E(82492),yn=E.n(cn),Vi=E(69848),ir=E.n(Vi);function de(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Te(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?de(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):de(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Ue(i){var c=Le();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Le(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var kt=function(i){(0,Be.Z)(o,i);var c=Ue(o);function o(s){var l,d;return(0,Y.Z)(this,o),d=c.call(this),(0,L.Z)((0,N.Z)(d),"markers",[]),(0,L.Z)((0,N.Z)(d),"markerLayerOption",void 0),(0,L.Z)((0,N.Z)(d),"clusterIndex",void 0),(0,L.Z)((0,N.Z)(d),"points",[]),(0,L.Z)((0,N.Z)(d),"clusterMarkers",[]),(0,L.Z)((0,N.Z)(d),"mapsService",void 0),(0,L.Z)((0,N.Z)(d),"scene",void 0),(0,L.Z)((0,N.Z)(d),"zoom",void 0),(0,L.Z)((0,N.Z)(d),"bbox",void 0),d.markerLayerOption=yn()(d.getDefault(),s),(0,et.Ev)(["update"],(0,N.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,W.Z)(o,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(A.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var _=l.getLnglat(),T=_.lng,I=_.lat,k={geometry:{type:"Point",coordinates:[T,I]},properties:Te(Te({},l.getExtData()),{},{marker_id:d})};this.points.push(k)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,_=l.minZoom,T=_===void 0?0:_,I=l.maxZoom;this.clusterIndex=new(ir())({radius:d,minZoom:T,maxZoom:I}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var _=this,T=l[0].concat(l[1]),I=this.clusterIndex.getClusters(T,d);this.clusterMarkers.forEach(function(k){k.remove()}),this.clusterMarkers=[],I.forEach(function(k){var J,$=_.markerLayerOption.clusterOption,_e=$.field,Ne=$.method;if(k.properties&&(J=k.properties)!==null&&J!==void 0&&J.cluster_id){var mt,Bt=_.getLeaves((mt=k.properties)===null||mt===void 0?void 0:mt.cluster_id);if(k.properties.clusterData=Bt,_e&&Ne){var mr=Bt==null?void 0:Bt.map(function(Xn){var Ci=(0,L.Z)({},_e,Xn.properties[_e]);return Ci}),Sr=et.a5.getColumn(mr,_e),Zr=et.a5.getSatByColumn(Ne,Sr),xn="point_"+Ne;k.properties[xn]=Zr.toFixed(2)}}var Rn=_.clusterMarker(k);_.clusterMarkers.push(Rn),Rn.addTo(_.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,_):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,_=d,T=_.element,I=T===void 0?this.generateElement.bind(this):T,k=new kr({element:I(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return k}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,et.oO)(this.bbox,d))&&(this.bbox=(0,et.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=et.SO.create("div","l7-marker-cluster"),_=et.SO.create("div","",d),T=et.SO.create("span","",_),I=this.markerLayerOption.clusterOption,k=I.field,J=I.method;l.properties.point_count=l.properties.point_count||1;var $=k&&J?l.properties["point_"+J]||l.properties[k]:l.properties.point_count;return T.textContent=$,d}}]),o}(Yt.EventEmitter);function er(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function w(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?er(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):er(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Z(i){var c=Ee();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ee(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var je=function(i){(0,Be.Z)(o,i);var c=Z(o);function o(s){var l;return(0,Y.Z)(this,o),l=c.call(this),(0,L.Z)((0,N.Z)(l),"popupOption",void 0),(0,L.Z)((0,N.Z)(l),"mapsService",void 0),(0,L.Z)((0,N.Z)(l),"sceneSerive",void 0),(0,L.Z)((0,N.Z)(l),"lngLat",void 0),(0,L.Z)((0,N.Z)(l),"content",void 0),(0,L.Z)((0,N.Z)(l),"closeButton",void 0),(0,L.Z)((0,N.Z)(l),"timeoutInstance",void 0),(0,L.Z)((0,N.Z)(l),"container",void 0),(0,L.Z)((0,N.Z)(l),"tip",void 0),(0,L.Z)((0,N.Z)(l),"scene",void 0),l.popupOption=w(w({},l.getdefault()),s),(0,et.Ev)(["update","onClickClose","remove"],(0,N.Z)(l)),l}return(0,W.Z)(o,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(A.vK.IMapService),this.sceneSerive=l.get(A.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),_=window.document.createElement("body"),T;for(_.innerHTML=l;T=_.firstChild,!!T;)d.appendChild(T);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&et.SO.remove(this.content),this.content=et.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=et.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,_){var T=window.document.createElement(l);return d!==void 0&&(T.className=d),_&&_.appendChild(T),T}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:et.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,_=this.popupOption,T=_.className,I=_.maxWidth,k=_.anchor;if(!(!this.mapsService||!d||!this.content)){var J=this.mapsService.getMarkerContainer();if(!this.container&&J){this.container=this.creatDom("div","l7-popup",J),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),T&&T.split(" ").forEach(function(_e){return l.container.classList.add(_e)});var $=this.popupOption.stopPropagation;$&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(_e){l.container.addEventListener(_e,function(Ne){Ne.stopPropagation()})})}I&&this.container.style.maxWidth!==I&&(this.container.style.maxWidth=I),this.updatePosition(),et.SO.setTransform(this.container,"".concat(et.rQ[k])),(0,et.zi)(this.container,k,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,_=l.lat,T=this.popupOption.offsets,I=this.mapsService.lngLatToContainer([d,_]);this.container.style.left=I.x+T[0]+"px",this.container.style.top=I.y-T[1]+"px"}}}]),o}(Yt.EventEmitter);function Qe(i,c){if(c||(c=document),!!c){var o=c.head||c.getElementsByTagName("head")[0];if(!o){o=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(o,s):c.documentElement.appendChild(o)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=i:l.appendChild(c.createTextNode(i)),o.appendChild(l),l}}Qe(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var yt=E(92137),St=E(87757),jt=E.n(St),Et=E(86700),Qt=E(88307),ie=E.n(Qt),sr=E(28660),Br=function(){function i(c,o){(0,Y.Z)(this,i),(0,L.Z)(this,"attribute",void 0),(0,L.Z)(this,"buffer",void 0);var s=o.buffer,l=o.offset,d=o.stride,_=o.normalized,T=o.size,I=o.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:d||0,normalized:_||!1,divisor:I||0},T&&(this.attribute.size=T)}return(0,W.Z)(i,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(o){this.buffer.subData(o)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),i}(),Lr,rt,gt,pt,dr,Vr,Ur,nn,Jr,Cr,kn,Zn,Si,zi,Ji=(Lr={},(0,L.Z)(Lr,A.gl.POINTS,"points"),(0,L.Z)(Lr,A.gl.LINES,"lines"),(0,L.Z)(Lr,A.gl.LINE_LOOP,"line loop"),(0,L.Z)(Lr,A.gl.LINE_STRIP,"line strip"),(0,L.Z)(Lr,A.gl.TRIANGLES,"triangles"),(0,L.Z)(Lr,A.gl.TRIANGLE_FAN,"triangle fan"),(0,L.Z)(Lr,A.gl.TRIANGLE_STRIP,"triangle strip"),Lr),Di=(rt={},(0,L.Z)(rt,A.gl.STATIC_DRAW,"static"),(0,L.Z)(rt,A.gl.DYNAMIC_DRAW,"dynamic"),(0,L.Z)(rt,A.gl.STREAM_DRAW,"stream"),rt),Oi=(gt={},(0,L.Z)(gt,A.gl.BYTE,"int8"),(0,L.Z)(gt,A.gl.UNSIGNED_INT,"int16"),(0,L.Z)(gt,A.gl.INT,"int32"),(0,L.Z)(gt,A.gl.UNSIGNED_BYTE,"uint8"),(0,L.Z)(gt,A.gl.UNSIGNED_SHORT,"uint16"),(0,L.Z)(gt,A.gl.UNSIGNED_INT,"uint32"),(0,L.Z)(gt,A.gl.FLOAT,"float"),gt),X=(pt={},(0,L.Z)(pt,A.gl.ALPHA,"alpha"),(0,L.Z)(pt,A.gl.LUMINANCE,"luminance"),(0,L.Z)(pt,A.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,L.Z)(pt,A.gl.RGB,"rgb"),(0,L.Z)(pt,A.gl.RGBA,"rgba"),(0,L.Z)(pt,A.gl.RGBA4,"rgba4"),(0,L.Z)(pt,A.gl.RGB5_A1,"rgb5 a1"),(0,L.Z)(pt,A.gl.RGB565,"rgb565"),(0,L.Z)(pt,A.gl.DEPTH_COMPONENT,"depth"),(0,L.Z)(pt,A.gl.DEPTH_STENCIL,"depth stencil"),pt),ce=(dr={},(0,L.Z)(dr,A.gl.DONT_CARE,"dont care"),(0,L.Z)(dr,A.gl.NICEST,"nice"),(0,L.Z)(dr,A.gl.FASTEST,"fast"),dr),me=(Vr={},(0,L.Z)(Vr,A.gl.NEAREST,"nearest"),(0,L.Z)(Vr,A.gl.LINEAR,"linear"),(0,L.Z)(Vr,A.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,L.Z)(Vr,A.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,L.Z)(Vr,A.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,L.Z)(Vr,A.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Vr),z=(Ur={},(0,L.Z)(Ur,A.gl.REPEAT,"repeat"),(0,L.Z)(Ur,A.gl.CLAMP_TO_EDGE,"clamp"),(0,L.Z)(Ur,A.gl.MIRRORED_REPEAT,"mirror"),Ur),oe=(nn={},(0,L.Z)(nn,A.gl.NONE,"none"),(0,L.Z)(nn,A.gl.BROWSER_DEFAULT_WEBGL,"browser"),nn),ve=(Jr={},(0,L.Z)(Jr,A.gl.NEVER,"never"),(0,L.Z)(Jr,A.gl.ALWAYS,"always"),(0,L.Z)(Jr,A.gl.LESS,"less"),(0,L.Z)(Jr,A.gl.LEQUAL,"lequal"),(0,L.Z)(Jr,A.gl.GREATER,"greater"),(0,L.Z)(Jr,A.gl.GEQUAL,"gequal"),(0,L.Z)(Jr,A.gl.EQUAL,"equal"),(0,L.Z)(Jr,A.gl.NOTEQUAL,"notequal"),Jr),Ae=(Cr={},(0,L.Z)(Cr,A.gl.FUNC_ADD,"add"),(0,L.Z)(Cr,A.gl.MIN_EXT,"min"),(0,L.Z)(Cr,A.gl.MAX_EXT,"max"),(0,L.Z)(Cr,A.gl.FUNC_SUBTRACT,"subtract"),(0,L.Z)(Cr,A.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Cr),se=(kn={},(0,L.Z)(kn,A.gl.ZERO,"zero"),(0,L.Z)(kn,A.gl.ONE,"one"),(0,L.Z)(kn,A.gl.SRC_COLOR,"src color"),(0,L.Z)(kn,A.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,L.Z)(kn,A.gl.SRC_ALPHA,"src alpha"),(0,L.Z)(kn,A.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,L.Z)(kn,A.gl.DST_COLOR,"dst color"),(0,L.Z)(kn,A.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,L.Z)(kn,A.gl.DST_ALPHA,"dst alpha"),(0,L.Z)(kn,A.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,L.Z)(kn,A.gl.CONSTANT_COLOR,"constant color"),(0,L.Z)(kn,A.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,L.Z)(kn,A.gl.CONSTANT_ALPHA,"constant alpha"),(0,L.Z)(kn,A.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,L.Z)(kn,A.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),kn),Ce=(Zn={},(0,L.Z)(Zn,A.gl.NEVER,"never"),(0,L.Z)(Zn,A.gl.ALWAYS,"always"),(0,L.Z)(Zn,A.gl.LESS,"less"),(0,L.Z)(Zn,A.gl.LEQUAL,"lequal"),(0,L.Z)(Zn,A.gl.GREATER,"greater"),(0,L.Z)(Zn,A.gl.GEQUAL,"gequal"),(0,L.Z)(Zn,A.gl.EQUAL,"equal"),(0,L.Z)(Zn,A.gl.NOTEQUAL,"notequal"),Zn),ct=(Si={},(0,L.Z)(Si,A.gl.ZERO,"zero"),(0,L.Z)(Si,A.gl.KEEP,"keep"),(0,L.Z)(Si,A.gl.REPLACE,"replace"),(0,L.Z)(Si,A.gl.INVERT,"invert"),(0,L.Z)(Si,A.gl.INCR,"increment"),(0,L.Z)(Si,A.gl.DECR,"decrement"),(0,L.Z)(Si,A.gl.INCR_WRAP,"increment wrap"),(0,L.Z)(Si,A.gl.DECR_WRAP,"decrement wrap"),Si),xr=(zi={},(0,L.Z)(zi,A.gl.FRONT,"front"),(0,L.Z)(zi,A.gl.BACK,"back"),zi),Ht=function(){function i(c,o){(0,Y.Z)(this,i),(0,L.Z)(this,"buffer",void 0);var s=o.data,l=o.usage,d=o.type;this.buffer=c.buffer({data:s,usage:Di[l||A.gl.STATIC_DRAW],type:Oi[d||A.gl.UNSIGNED_BYTE]})}return(0,W.Z)(i,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(o){var s=o.data,l=o.offset;this.buffer.subdata(s,l)}}]),i}(),Jt=function(){function i(c,o){(0,Y.Z)(this,i),(0,L.Z)(this,"elements",void 0);var s=o.data,l=o.usage,d=o.type,_=o.count;this.elements=c.elements({data:s,usage:Di[l||A.gl.STATIC_DRAW],type:Oi[d||A.gl.UNSIGNED_BYTE],count:_})}return(0,W.Z)(i,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(o){var s=o.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),i}(),Rr=function(){function i(c,o){(0,Y.Z)(this,i),(0,L.Z)(this,"framebuffer",void 0);var s=o.width,l=o.height,d=o.color,_=o.colors,T=o.depth,I=o.stencil,k={width:s,height:l};Array.isArray(_)&&(k.colors=_.map(function(J){return J.get()})),d&&typeof d!="boolean"&&(k.color=d.get()),this.framebuffer=c.framebuffer(k)}return(0,W.Z)(i,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.framebuffer.resize(s,l)}}]),i}(),Mn=E(90484),Pn=E(36719),$t=E.n(Pn),En=E(68630),on=E.n(En);function ln(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Ai(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?ln(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ln(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var bn=function(){function i(c,o){(0,Y.Z)(this,i),(0,L.Z)(this,"reGl",void 0),(0,L.Z)(this,"destroyed",!1),(0,L.Z)(this,"drawCommand",void 0),(0,L.Z)(this,"drawParams",void 0),(0,L.Z)(this,"options",void 0),(0,L.Z)(this,"uniforms",{}),this.reGl=c;var s=o.vs,l=o.fs,d=o.attributes,_=o.uniforms,T=o.primitive,I=o.count,k=o.elements,J=o.depth,$=o.blend,_e=o.stencil,Ne=o.cull,mt=o.instances,Bt={};this.options=o,_&&(this.uniforms=this.extractUniforms(_),Object.keys(_).forEach(function(Zr){Bt[Zr]=c.prop(Zr)}));var mr={};Object.keys(d).forEach(function(Zr){mr[Zr]=d[Zr].get()});var Sr={attributes:mr,frag:l,uniforms:Bt,vert:s,primitive:Ji[T===void 0?A.gl.TRIANGLES:T]};mt&&(Sr.instances=mt),I&&(Sr.count=I),k&&(Sr.elements=k.get()),this.initDepthDrawParams({depth:J},Sr),this.initBlendDrawParams({blend:$},Sr),this.initStencilDrawParams({stencil:_e},Sr),this.initCullDrawParams({cull:Ne},Sr),this.drawCommand=c(Sr),this.drawParams=Sr}return(0,W.Z)(i,[{key:"addUniforms",value:function(o){this.uniforms=Ai(Ai({},this.uniforms),this.extractUniforms(o))}},{key:"draw",value:function(o){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=Ai(Ai({},this.uniforms),this.extractUniforms(o.uniforms||{})),l={};Object.keys(s).forEach(function(d){var _=(0,Mn.Z)(s[d]);_==="boolean"||_==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?l[d]=s[d]:l[d]=s[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(o){o.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(o,s){var l=o.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:ve[l.func||A.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(o,s){var l=o.blend;if(l){var d=l.enable,_=l.func,T=l.equation,I=l.color,k=I===void 0?[0,0,0,0]:I;s.blend={enable:!!d,func:{srcRGB:se[_&&_.srcRGB||A.gl.SRC_ALPHA],srcAlpha:se[_&&_.srcAlpha||A.gl.SRC_ALPHA],dstRGB:se[_&&_.dstRGB||A.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:se[_&&_.dstAlpha||A.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Ae[T&&T.rgb||A.gl.FUNC_ADD],alpha:Ae[T&&T.alpha||A.gl.FUNC_ADD]},color:k}}}},{key:"initStencilDrawParams",value:function(o,s){var l=o.stencil;if(l){var d=l.enable,_=l.mask,T=_===void 0?-1:_,I=l.func,k=I===void 0?{cmp:A.gl.ALWAYS,ref:0,mask:-1}:I,J=l.opFront,$=J===void 0?{fail:A.gl.KEEP,zfail:A.gl.KEEP,zpass:A.gl.KEEP}:J,_e=l.opBack,Ne=_e===void 0?{fail:A.gl.KEEP,zfail:A.gl.KEEP,zpass:A.gl.KEEP}:_e;s.stencil={enable:!!d,mask:T,func:Ai(Ai({},k),{},{cmp:Ce[k.cmp]}),opFront:{fail:ct[$.fail],zfail:ct[$.zfail],zpass:ct[$.zpass]},opBack:{fail:ct[Ne.fail],zfail:ct[Ne.zfail],zpass:ct[Ne.zpass]}}}}},{key:"initCullDrawParams",value:function(o,s){var l=o.cull;if(l){var d=l.enable,_=l.face,T=_===void 0?A.gl.BACK:_;s.cull={enable:!!d,face:xr[T]}}}},{key:"extractUniforms",value:function(o){var s=this,l={};return Object.keys(o).forEach(function(d){s.extractUniformsRecursively(d,o[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(o,s,l,d){var _=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||$t()(s)||s===""||"resize"in s){l["".concat(d&&d+".").concat(o)]=s;return}on()(s)&&Object.keys(s).forEach(function(T){_.extractUniformsRecursively(T,s[T],l,"".concat(d&&d+".").concat(o))}),Array.isArray(s)&&s.forEach(function(T,I){Object.keys(T).forEach(function(k){_.extractUniformsRecursively(k,T[k],l,"".concat(d&&d+".").concat(o,"[").concat(I,"]"))})})}}]),i}(),Li=function(){function i(c,o){(0,Y.Z)(this,i),(0,L.Z)(this,"texture",void 0),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0);var s=o.data,l=o.type,d=l===void 0?A.gl.UNSIGNED_BYTE:l,_=o.width,T=o.height,I=o.flipY,k=I===void 0?!1:I,J=o.format,$=J===void 0?A.gl.RGBA:J,_e=o.mipmap,Ne=_e===void 0?!1:_e,mt=o.wrapS,Bt=mt===void 0?A.gl.CLAMP_TO_EDGE:mt,mr=o.wrapT,Sr=mr===void 0?A.gl.CLAMP_TO_EDGE:mr,Zr=o.aniso,xn=Zr===void 0?0:Zr,Rn=o.alignment,Xn=Rn===void 0?1:Rn,Ci=o.premultiplyAlpha,Jn=Ci===void 0?!1:Ci,Pi=o.mag,aa=Pi===void 0?A.gl.NEAREST:Pi,ma=o.min,di=ma===void 0?A.gl.NEAREST:ma,Ma=o.colorSpace,eo=Ma===void 0?A.gl.BROWSER_DEFAULT_WEBGL:Ma;this.width=_,this.height=T;var Eu={width:_,height:T,type:Oi[d],format:X[$],wrapS:z[Bt],wrapT:z[Sr],mag:me[aa],min:me[di],alignment:Xn,flipY:k,colorSpace:oe[eo],premultiplyAlpha:Jn,aniso:xn};s&&(Eu.data=s),typeof Ne=="number"?Eu.mipmap=ce[Ne]:typeof Ne=="boolean"&&(Eu.mipmap=Ne),this.texture=c.texture(Eu)}return(0,W.Z)(i,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(o)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),i}(),Yi,si,Ki=(Yi=(0,Et.b2)(),Yi(si=function(){function i(){var c=this;(0,Y.Z)(this,i),(0,L.Z)(this,"extensionObject",void 0),(0,L.Z)(this,"gl",void 0),(0,L.Z)(this,"$container",void 0),(0,L.Z)(this,"canvas",void 0),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0),(0,L.Z)(this,"isDirty",void 0),(0,L.Z)(this,"createModel",function(o){return new bn(c.gl,o)}),(0,L.Z)(this,"createAttribute",function(o){return new Br(c.gl,o)}),(0,L.Z)(this,"createBuffer",function(o){return new Ht(c.gl,o)}),(0,L.Z)(this,"createElements",function(o){return new Jt(c.gl,o)}),(0,L.Z)(this,"createTexture2D",function(o){return new Li(c.gl,o)}),(0,L.Z)(this,"createFramebuffer",function(o){return new Rr(c.gl,o)}),(0,L.Z)(this,"useFramebuffer",function(o,s){c.gl({framebuffer:o?o.get():null})(s)}),(0,L.Z)(this,"clear",function(o){var s=o.color,l=o.depth,d=o.stencil,_=o.framebuffer,T=_===void 0?null:_,I={color:s,depth:l,stencil:d};I.framebuffer=T===null?T:T.get(),c.gl.clear(I)}),(0,L.Z)(this,"viewport",function(o){var s=o.x,l=o.y,d=o.width,_=o.height;c.gl._gl.viewport(s,l,d,_),c.width=d,c.height=_,c.gl._refresh()}),(0,L.Z)(this,"readPixels",function(o){var s=o.framebuffer,l=o.x,d=o.y,_=o.width,T=o.height,I={x:l,y:d,width:_,height:T};return s&&(I.framebuffer=s.get()),c.gl.read(I)}),(0,L.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,L.Z)(this,"getContainer",function(){var o;return(o=c.canvas)===null||o===void 0?void 0:o.parentElement}),(0,L.Z)(this,"getCanvas",function(){return c.canvas}),(0,L.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,L.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,W.Z)(i,[{key:"init",value:function(){var c=(0,yt.Z)(jt().mark(function s(l,d){var _=this;return jt().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return this.canvas=l,I.next=3,new Promise(function(k,J){ie()({canvas:_.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(_e,Ne){(_e||!Ne)&&J(_e),k(Ne)}})});case 3:this.gl=I.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return I.stop()}},s,this)}));function o(s,l){return c.apply(this,arguments)}return o}()},{key:"testExtension",value:function(o){return!!this.getGLContext().getExtension(o)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var o=this.getGLContext();o.disable(o.CULL_FACE)}},{key:"setDirty",value:function(o){this.isDirty=o}},{key:"getDirty",value:function(){return this.isDirty}}]),i}())||si);function Ni(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Ti(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Ni(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ni(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var ca=function(){function i(c){(0,Y.Z)(this,i),(0,L.Z)(this,"sceneService",void 0),(0,L.Z)(this,"mapService",void 0),(0,L.Z)(this,"controlService",void 0),(0,L.Z)(this,"layerService",void 0),(0,L.Z)(this,"iconService",void 0),(0,L.Z)(this,"markerService",void 0),(0,L.Z)(this,"popupService",void 0),(0,L.Z)(this,"fontService",void 0),(0,L.Z)(this,"interactionService",void 0),(0,L.Z)(this,"container",void 0);var o=c.id,s=c.map,l=(0,A.Hp)();this.container=l,s.setContainer(l,o),l.bind(A.vK.IRendererService).to(Ki).inSingletonScope(),this.sceneService=l.get(A.vK.ISceneService),this.mapService=l.get(A.vK.IMapService),this.iconService=l.get(A.vK.IIconService),this.fontService=l.get(A.vK.IFontService),this.controlService=l.get(A.vK.IControlService),this.layerService=l.get(A.vK.ILayerService),this.markerService=l.get(A.vK.IMarkerService),this.interactionService=l.get(A.vK.IInteractionService),this.popupService=l.get(A.vK.IPopupService),this.initComponent(o),this.sceneService.init(c),this.initControl()}return(0,W.Z)(i,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(o){return this.sceneService.exportPng(o)}},{key:"exportMap",value:function(o){return this.sceneService.exportPng(o)}},{key:"registerRenderService",value:function(o){var s=this;if(this.sceneService.loaded){var l=new o(this);l.init()}else this.on("loaded",function(){var d=new o(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(o){var s=(0,A.e7)(this.container);o.setContainer(s),this.sceneService.addLayer(o)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(o){return this.layerService.getLayer(o)}},{key:"getLayerByName",value:function(o){return this.layerService.getLayerByName(o)}},{key:"removeLayer",value:function(o){this.layerService.remove(o)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(o,s){this.fontService.addIconFont(o,s)}},{key:"addIconFonts",value:function(o){var s=this;o.forEach(function(l){var d=(0,Q.Z)(l,2),_=d[0],T=d[1];s.fontService.addIconFont(_,T)})}},{key:"addFontFace",value:function(o,s){this.sceneService.addFontFace(o,s)}},{key:"addImage",value:function(o,s){this.iconService.addImage(o,s)}},{key:"hasImage",value:function(o){return this.iconService.hasImage(o)}},{key:"removeImage",value:function(o){this.iconService.removeImage(o)}},{key:"addIconFontGlyphs",value:function(o,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(o){this.controlService.addControl(o,this.container)}},{key:"removeControl",value:function(o){this.controlService.removeControl(o)}},{key:"getControlByName",value:function(o){return this.controlService.getControlByName(o)}},{key:"addMarker",value:function(o){this.markerService.addMarker(o)}},{key:"addMarkerLayer",value:function(o){this.markerService.addMarkerLayer(o)}},{key:"removeMarkerLayer",value:function(o){this.markerService.removeMarkerLayer(o)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(o){this.popupService.addPopup(o)}},{key:"on",value:function(o,s){A.SceneEventList.indexOf(o)===-1?this.mapService.on(o,s):this.sceneService.on(o,s)}},{key:"once",value:function(o,s){A.SceneEventList.indexOf(o)===-1?this.mapService.once(o,s):this.sceneService.once(o,s)}},{key:"off",value:function(o,s){A.SceneEventList.indexOf(o)===-1?this.mapService.off(o,s):this.sceneService.off(o,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(o){return this.mapService.getCenter(o)}},{key:"setCenter",value:function(o,s){return this.mapService.setCenter(o,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(o){return this.mapService.setPitch(o)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(o){this.mapService.setRotation(o)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(o){this.mapService.panTo(o)}},{key:"panBy",value:function(o){this.mapService.panBy(o)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(o){this.mapService.setZoom(o)}},{key:"fitBounds",value:function(o,s){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,_=l.animate;this.mapService.fitBounds(o,s||Ti(Ti({},d),{},{animate:_}))}},{key:"setZoomAndCenter",value:function(o,s){this.mapService.setZoomAndCenter(o,s)}},{key:"setMapStyle",value:function(o){this.mapService.setMapStyle(o)}},{key:"setMapStatus",value:function(o){this.mapService.setMapStatus(o)}},{key:"pixelToLngLat",value:function(o){return this.mapService.pixelToLngLat(o)}},{key:"lngLatToPixel",value:function(o){return this.mapService.lngLatToPixel(o)}},{key:"containerToLngLat",value:function(o){return this.mapService.containerToLngLat(o)}},{key:"lngLatToContainer",value:function(o){return this.mapService.lngLatToContainer(o)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(o,s){this.container.bind(A.vK.IPostProcessingPass).to(o).whenTargetNamed(s)}},{key:"initComponent",value:function(o){this.controlService.init({container:et.SO.getContainer(o)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var o=this.sceneService.getSceneConfig(),s=o.logoVisible,l=o.logoPosition;s&&this.addControl(new Ut({position:l}))}}]),i}(),Sa=E(81253),oi=E(55770),ri=E(3473),Gi=E(13218),pa=E.n(Gi),Ho=E(23560),ya=E.n(Ho),yi=E(46343),ga,Ws,Ea,Ao,Xa;function Ya(i){return i.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var Wo=(ga=(0,Et.b2)(),Ws=(0,Et.f3)(A.vK.IGlobalConfigService),ga(Ea=(Ao=function(){function i(){(0,Y.Z)(this,i),(0,oi.Z)(this,"configService",Xa,this),(0,L.Z)(this,"enabled",void 0)}return(0,W.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.rendererService,_=s.postProcessingPassFactory,T=s.normalPassFactory;o.hooks.init.tap("MultiPassRendererPlugin",function(){var I=o.getLayerConfig(),k=I.enableMultiPassRenderer,J=I.passes,$=J===void 0?[]:J;l.enabled=!!k&&o.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(o.multiPassRenderer=l.createMultiPassRenderer(o,$,_,T),o.multiPassRenderer.setRenderFlag(!0))}),o.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(o,s,l,d){var _=o.multiPassRenderer,T=o.getLayerConfig(),I=T.enablePicking,k=T.enableTAA;return I&&_.add(d("pixelPicking")),_}}]),i}(),Xa=(0,ri.Z)(Ao.prototype,"configService",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ao))||Ea),Ui,To=(Ui={},(0,L.Z)(Ui,A.BlendType.additive,{enable:!0,func:{srcRGB:A.gl.ONE,dstRGB:A.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,L.Z)(Ui,A.BlendType.none,{enable:!1}),(0,L.Z)(Ui,A.BlendType.normal,{enable:!0,func:{srcRGB:A.gl.SRC_ALPHA,dstRGB:A.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,L.Z)(Ui,A.BlendType.subtractive,{enable:!0,func:{srcRGB:A.gl.ONE,dstRGB:A.gl.ONE,srcAlpha:A.gl.ZERO,dstAlpha:A.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:A.gl.FUNC_SUBTRACT,alpha:A.gl.FUNC_SUBTRACT}}),(0,L.Z)(Ui,A.BlendType.max,{enable:!0,func:{srcRGB:A.gl.ONE,dstRGB:A.gl.ONE},equation:{rgb:A.gl.MAX_EXT}}),(0,L.Z)(Ui,A.BlendType.min,{enable:!0,func:{srcRGB:A.gl.ONE,dstRGB:A.gl.ONE},equation:{rgb:A.gl.MIN_EXT}}),Ui),Lo=E(47037),lo=E.n(Lo),Ro=E(81763),Hi=E.n(Ro),Ra=E(1469),Fa=E.n(Ra),ms=1024;function _a(i,c,o,s,l){c.updateStyleAttribute(i,o,s,l)}function xe(i,c){i.opacity&&ke("opacity",c,i.opacity),i.strokeWidth&&ke("strokeWidth",c,i.strokeWidth),i.strokeOpacity&&ke("strokeOpacity",c,i.strokeOpacity),i.stroke&&Xt("stroke",c,i.stroke),i.offsets&&ut("offsets",c,i.offsets),i.textOffset&&ut("textOffset",c,i.textOffset)}function ke(i,c,o){lo()(o)?_a(i,c,o,function(s){return s}):Hi()(o)?_a(i,c,[o],void 0):Fa()(o)&&o.length===2?lo()(o[0])&&ya()(o[1])||lo()(o[0])&&Fa()(o[1])&&Hi()(o[1][0])&&Hi()(o[1][1])?_a(i,c,o[0],o[1]):_a(i,c,[1],void 0):_a(i,c,[1],void 0)}function ut(i,c,o){lo()(o)?_a(i,c,o,function(s){return s}):Fa()(o)&&o.length===2&&lo()(o[0])&&ya()(o[1])?_a(i,c,o[0],o[1]):Fa()(o)&&o.length===2&&Hi()(o[0])&&Hi()(o[1])?_a(i,c,o,void 0):_a(i,c,[0,0],void 0)}function Xt(i,c,o){lo()(o)?_a(i,c,o,void 0):Fa()(o)&&o.length===2&&(lo()(o[0])&&ya()(o[1])||lo()(o[0])&&Fa()(o[1])&&o[1].length>0)?_a(i,c,o[0],o[1]):_a(i,c,"#fff",void 0)}var Xr,Kn,gi,io,Ka;function co(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=Xo(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){o=o.call(i)},n:function(){var k=o.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw T}}}}function Xo(i,c){if(!!i){if(typeof i=="string")return Xs(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Xs(i,c)}}function Xs(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function ys(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function mo(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?ys(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ys(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ls(i){var c=No();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function No(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Yo=0,_o=(Xr=(0,A.yT)(A.vK.IGlobalConfigService),Kn=(0,A.yT)(A.vK.IShaderModuleService),gi=function(i){(0,Be.Z)(o,i);var c=ls(o);function o(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Y.Z)(this,o),s=c.call(this),(0,L.Z)((0,N.Z)(s),"id","".concat(Yo++)),(0,L.Z)((0,N.Z)(s),"name","".concat(Yo)),(0,L.Z)((0,N.Z)(s),"type",void 0),(0,L.Z)((0,N.Z)(s),"visible",!0),(0,L.Z)((0,N.Z)(s),"zIndex",0),(0,L.Z)((0,N.Z)(s),"minZoom",void 0),(0,L.Z)((0,N.Z)(s),"maxZoom",void 0),(0,L.Z)((0,N.Z)(s),"inited",!1),(0,L.Z)((0,N.Z)(s),"layerModelNeedUpdate",!1),(0,L.Z)((0,N.Z)(s),"pickedFeatureID",null),(0,L.Z)((0,N.Z)(s),"selectedFeatureID",null),(0,L.Z)((0,N.Z)(s),"styleNeedUpdate",!1),(0,L.Z)((0,N.Z)(s),"rendering",void 0),(0,L.Z)((0,N.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,L.Z)((0,N.Z)(s),"hooks",{init:new yi.oI,afterInit:new yi.oI,beforeRender:new yi.oI,beforeRenderData:new yi.gg,afterRender:new yi.ni,beforePickingEncode:new yi.ni,afterPickingEncode:new yi.ni,beforeHighlight:new yi.ni(["pickedColor"]),afterHighlight:new yi.ni,beforeSelect:new yi.ni(["pickedColor"]),afterSelect:new yi.ni,beforeDestroy:new yi.ni,afterDestroy:new yi.ni}),(0,L.Z)((0,N.Z)(s),"models",[]),(0,L.Z)((0,N.Z)(s),"multiPassRenderer",void 0),(0,L.Z)((0,N.Z)(s),"plugins",void 0),(0,L.Z)((0,N.Z)(s),"sourceOption",void 0),(0,L.Z)((0,N.Z)(s),"layerModel",void 0),(0,oi.Z)((0,N.Z)(s),"configService",io,(0,N.Z)(s)),(0,oi.Z)((0,N.Z)(s),"shaderModuleService",Ka,(0,N.Z)(s)),(0,L.Z)((0,N.Z)(s),"cameraService",void 0),(0,L.Z)((0,N.Z)(s),"coordinateService",void 0),(0,L.Z)((0,N.Z)(s),"iconService",void 0),(0,L.Z)((0,N.Z)(s),"fontService",void 0),(0,L.Z)((0,N.Z)(s),"pickingService",void 0),(0,L.Z)((0,N.Z)(s),"rendererService",void 0),(0,L.Z)((0,N.Z)(s),"layerService",void 0),(0,L.Z)((0,N.Z)(s),"interactionService",void 0),(0,L.Z)((0,N.Z)(s),"mapService",void 0),(0,L.Z)((0,N.Z)(s),"styleAttributeService",void 0),(0,L.Z)((0,N.Z)(s),"layerSource",void 0),(0,L.Z)((0,N.Z)(s),"postProcessingPassFactory",void 0),(0,L.Z)((0,N.Z)(s),"normalPassFactory",void 0),(0,L.Z)((0,N.Z)(s),"animateOptions",{enable:!1}),(0,L.Z)((0,N.Z)(s),"container",void 0),(0,L.Z)((0,N.Z)(s),"encodedData",void 0),(0,L.Z)((0,N.Z)(s),"configSchema",void 0),(0,L.Z)((0,N.Z)(s),"currentPickId",null),(0,L.Z)((0,N.Z)(s),"rawConfig",void 0),(0,L.Z)((0,N.Z)(s),"needUpdateConfig",void 0),(0,L.Z)((0,N.Z)(s),"pendingStyleAttributes",[]),(0,L.Z)((0,N.Z)(s),"scaleOptions",{}),(0,L.Z)((0,N.Z)(s),"animateStartTime",void 0),(0,L.Z)((0,N.Z)(s),"aniamateStatus",!1),(0,L.Z)((0,N.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),_=d.autoFit,T=d.fitBoundsOptions;_&&s.fitBounds(T),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,W.Z)(o,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=mo(mo({},this.needUpdateConfig),l);else{var d=this.container.get(A.vK.SceneID);xe(l,this),this.configService.setLayerConfig(d,this.id,mo(mo(mo({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(A.vK.SceneID),_=this.rawConfig.enableMultiPassRenderer,T=_===void 0?!1:_;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:T}),this.iconService=this.container.get(A.vK.IIconService),this.fontService=this.container.get(A.vK.IFontService),this.rendererService=this.container.get(A.vK.IRendererService),this.layerService=this.container.get(A.vK.ILayerService),this.interactionService=this.container.get(A.vK.IInteractionService),this.pickingService=this.container.get(A.vK.IPickingService),this.mapService=this.container.get(A.vK.IMapService),this.cameraService=this.container.get(A.vK.ICameraService),this.coordinateService=this.container.get(A.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(A.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(A.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(A.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(A.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function($){var _e=$.attributeName,Ne=$.attributeField,mt=$.attributeValues,Bt=$.updateOptions;l.styleAttributeService.updateStyleAttribute(_e,{scale:mo({field:Ne},l.splitValuesAndCallbackInAttribute(mt,l.getLayerConfig()[_e]))},Bt)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(A.vK.ILayerPlugin);var I=co(this.plugins),k;try{for(I.s();!(k=I.n()).done;){var J=k.value;J.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch($){I.e($)}finally{I.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(mo(mo({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,_){return this.updateStyleAttribute("color",l,d,_),this}},{key:"texture",value:function(l,d,_){return this.updateStyleAttribute("texture",l,d,_),this}},{key:"rotate",value:function(l,d,_){return this.updateStyleAttribute("rotate",l,d,_),this}},{key:"size",value:function(l,d,_){return this.updateStyleAttribute("size",l,d,_),this}},{key:"filter",value:function(l,d,_){return this.updateStyleAttribute("filter",l,d,_),this}},{key:"shape",value:function(l,d,_){return this.updateStyleAttribute("shape",l,d,_),this}},{key:"label",value:function(l,d,_){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:_}),this}},{key:"animate",value:function(l){var d={};return pa()(l)?(d.enable=!0,d=mo(mo({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return this.sourceOption={data:l,options:d},this}},{key:"setData",value:function(l,d){var _=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){_.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,_=l.passes,T=(0,Sa.Z)(l,["passes"]);return _&&Ya(_).forEach(function(I){var k=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(I[0]);k&&k.updateOptions(I[1])}),this.rawConfig=mo(mo({},this.rawConfig),T),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return pa()(l)?this.scaleOptions=mo(mo({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=pa()(l)?!0:l,pa()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var _=this;if(pa()(l)){var T=l.x,I=T===void 0?0:T,k=l.y,J=k===void 0?0:k;this.updateLayerConfig({highlightColor:pa()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:I,y:J})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:pa()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,et.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=pa()(l)?!0:l,pa()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var _=this;if(pa()(l)){var T=l.x,I=T===void 0?0:T,k=l.y,J=k===void 0?0:k;this.updateLayerConfig({selectColor:pa()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:I,y:J})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:pa()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,et.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),_=d.visible,T=d.minZoom,I=T===void 0?-Infinity:T,k=d.maxZoom,J=k===void 0?Infinity:k;return!!_&&l>=I&&l<=J}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),_=d.extent,T=_.some(function(I){return Math.abs(I)===Infinity});return T?this:(this.mapService.fitBounds([[_[0],_[1]],[_[2],_[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var _=d.ticks().map(function(I){return(0,L.Z)({value:I},l,d(I))});return _}else if(d.invertExtent){var T=d.range().map(function(I){return(0,L.Z)({value:d.invertExtent(I)},l,I)});return T}}else return[]}},{key:"pick",value:function(l){var d=l.x,_=l.y;this.interactionService.triggerHover({x:d,y:_})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,_=l.vertexShader,T=l.fragmentShader,I=l.triangulation,k=l.segmentNumber,J=(0,Sa.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"]);this.shaderModuleService.registerModule(d,{vs:_,fs:T});var $=this.shaderModuleService.getModule(d),_e=$.vs,Ne=$.fs,mt=$.uniforms,Bt=this.rendererService.createModel,mr=this.styleAttributeService.createAttributesAndIndices(this.encodedData,I,k),Sr=mr.attributes,Zr=mr.elements;return Bt(mo({attributes:Sr,uniforms:mt,fs:Ne,vs:_e,elements:Zr,blend:To[A.BlendType.normal]},J))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),_=d.enableHighlight,T=_===void 0?!0:_,I=d.enableSelect,k=I===void 0?!0:I,J=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&k&&(J=!0),l==="mousemove"&&(T||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(J=!0),this.isVisible()&&J}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,d,_,T){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:mo({field:d},this.splitValuesAndCallbackInAttribute(_,this.getLayerConfig()[d]))},T):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:_,updateOptions:T})}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:ya()(l)?void 0:l||d,callback:ya()(l)?l:void 0}}}]),o}(Yt.EventEmitter),io=(0,ri.Z)(gi.prototype,"configService",[Xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ka=(0,ri.Z)(gi.prototype,"shaderModuleService",[Kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gi),Ei=E(85061),Cs=E(18446),As=E.n(Cs),gs=E(2650),Aa,Po,mu,bl,Zu;function Vl(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=tl(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){o=o.call(i)},n:function(){var k=o.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw T}}}}function tl(i,c){if(!!i){if(typeof i=="string")return yu(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return yu(i,c)}}function yu(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}var Ba=(Aa=(0,A.yT)(A.vK.IGlobalConfigService),Po=(0,A.yT)(A.vK.IShaderModuleService),mu=function(){function i(c){(0,Y.Z)(this,i),(0,L.Z)(this,"triangulation",void 0),(0,L.Z)(this,"createTexture2D",void 0),(0,L.Z)(this,"layer",void 0),(0,L.Z)(this,"dataTexture",void 0),(0,L.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,L.Z)(this,"rowCount",void 0),(0,L.Z)(this,"cacheStyleProperties",void 0),(0,L.Z)(this,"cellLength",void 0),(0,L.Z)(this,"cellProperties",void 0),(0,L.Z)(this,"cellTypeLayout",void 0),(0,L.Z)(this,"stylePropertyesExist",void 0),(0,L.Z)(this,"dataTextureTest",void 0),(0,oi.Z)(this,"configService",bl,this),(0,oi.Z)(this,"shaderModuleService",Zu,this),(0,L.Z)(this,"rendererService",void 0),(0,L.Z)(this,"iconService",void 0),(0,L.Z)(this,"fontService",void 0),(0,L.Z)(this,"styleAttributeService",void 0),(0,L.Z)(this,"mapService",void 0),(0,L.Z)(this,"cameraService",void 0),(0,L.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(A.vK.IRendererService),this.styleAttributeService=c.getContainer().get(A.vK.IStyleAttributeService),this.mapService=c.getContainer().get(A.vK.IMapService),this.iconService=c.getContainer().get(A.vK.IIconService),this.fontService=c.getContainer().get(A.vK.IFontService),this.cameraService=c.getContainer().get(A.vK.ICameraService),this.layerService=c.getContainer().get(A.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var o=this.rendererService.createTexture2D;this.createTexture2D=o,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:A.gl.NEAREST,min:A.gl.NEAREST,width:1,height:1}))}return(0,W.Z)(i,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(o){var s=!1;return As()(o.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=o.opacity),As()(o.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=o.strokeOpacity),As()(o.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=o.strokeWidth),As()(o.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=o.stroke),As()(o.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=o.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(o){this.clearLastCalRes(),o.opacity!==void 0&&!Hi()(o.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),o.strokeOpacity!==void 0&&!Hi()(o.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),o.strokeWidth!==void 0&&!Hi()(o.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),o.stroke!==void 0&&!this.isStaticColor(o.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),o.offsets!==void 0&&!this.isOffsetStatic(o.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(o){return lo()(o)?!!(0,gs.ZP)(o):!1}},{key:"getStrokeColor",value:function(o){if(this.isStaticColor(o)){var s=(0,et.CI)(o);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(o){return!!(Fa()(o)&&o.length===2&&Hi()(o[0])&&Hi()(o[1]))}},{key:"patchMod",value:function(o,s){for(var l=0;l<s;l++)o.push(-1)}},{key:"patchData",value:function(o,s,l){var d=Vl(l),_;try{for(d.s();!(_=d.n()).done;){var T=_.value,I=T.attr,k=T.count,J=s[I];J?I==="stroke"?o.push.apply(o,(0,Ei.Z)((0,et.CI)(J))):I==="offsets"?this.isOffsetStatic(J)?o.push(-J[0],J[1]):o.push(0,0):o.push(Hi()(J)?J:1):this.patchMod(o,k)}}catch($){d.e($)}finally{d.f()}}},{key:"calDataFrame",value:function(o,s,l){for(var d=s.length,_=Math.ceil(d*o/this.DATA_TEXTURE_WIDTH),T=_*this.DATA_TEXTURE_WIDTH,I=[],k=0;k<d;k++){var J=s[k];this.patchData(I,J,l)}for(var $=I.length;$<T;$++)I.push(-1);return{data:I,width:this.DATA_TEXTURE_WIDTH,height:_}}},{key:"getBlend",value:function(){var o=this.layer.getLayerConfig(),s=o.blend,l=s===void 0?"normal":s;return To[A.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.duration||4,o.interval||.2,o.trailLength||.1]}},{key:"startModelAnimate",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),i}(),bl=(0,ri.Z)(mu.prototype,"configService",[Aa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zu=(0,ri.Z)(mu.prototype,"shaderModuleService",[Po],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mu),ju=E(9187),m=E.n(ju),S=E(31437),j=S.create(),O=S.create(),ue=S.create(),Ie=S.create(),st=S.create();function Lt(i,c,o,s,l){S.add(i,o,s),S.normalize(i,i),c=S.fromValues(-i[1],i[0]);var d=S.fromValues(-o[1],o[0]);return[l/S.dot(c,d),c]}function It(i,c){return S.set(i,-c[1],c[0])}function wr(i,c,o){return S.sub(i,c,o),S.normalize(i,i),i}function jr(i,c){return i[0]===c[0]&&i[1]===c[1]}function Qn(i){for(var c=new Map,o=0;o<i.length;o++){var s=i[0].toString()+"-"+i[1].toString();c.get(s)?(i.splice(o,1),o++):c.set(s,s)}return i}var Mi=function(){function i(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Y.Z)(this,i),(0,L.Z)(this,"complex",void 0),(0,L.Z)(this,"join",void 0),(0,L.Z)(this,"cap",void 0),(0,L.Z)(this,"miterLimit",void 0),(0,L.Z)(this,"thickness",void 0),(0,L.Z)(this,"normal",void 0),(0,L.Z)(this,"lastFlip",-1),(0,L.Z)(this,"miter",S.fromValues(0,0)),(0,L.Z)(this,"started",!1),(0,L.Z)(this,"dash",!1),(0,L.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,W.Z)(i,[{key:"extrude_gaode2",value:function(o,s){var l=this.complex;if(o.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=o.length,_=l.startIndex,T=1;T<d;T++){var I=o[T-1],k=s[T-1],J=o[T],$=s[T],_e=T<o.length-1?o[T+1]:null,Ne=T<s.length-1?s[T+1]:null,mt=this.segment_gaode2(l,_,I,J,_e,k,$,Ne);_+=mt}if(this.dash)for(var Bt=0;Bt<l.positions.length/6;Bt++)l.positions[Bt*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(o){var s=this.complex;if(o.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=o.length,d=s.startIndex,_=1;_<l;_++){var T=o[_-1],I=o[_],k=_<o.length-1?o[_+1]:null,J=this.segment(s,d,T,I,k);d+=J}if(this.dash)for(var $=0;$<s.positions.length/6;$++)s.positions[$*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(o,s,l,d,_,T,I,k){var J=0,$=o.indices,_e=o.positions,Ne=o.normals,mt=this.cap==="square",Bt=this.join==="bevel",mr=(0,et.Z)([I[0],I[1]]),Sr=(0,et.Z)([T[0],T[1]]);wr(ue,d,l);var Zr=0;if(this.dash&&(Zr=this.lineSegmentDistance(mr,Sr),this.totalDistance+=Zr),this.normal||(this.normal=S.create(),It(this.normal,ue)),!this.started)if(this.started=!0,mt){var xn=S.create(),Rn=S.create();S.add(xn,this.normal,ue),S.add(Rn,this.normal,ue),Ne.push(Rn[0],Rn[1],0),Ne.push(xn[0],xn[1],0),_e.push(l[0],l[1],0,this.totalDistance-Zr,-this.thickness,0),_e.push(l[0],l[1],0,this.totalDistance-Zr,this.thickness,0)}else this.extrusions(_e,Ne,l,this.normal,this.thickness,this.totalDistance-Zr);if($.push(s+0,s+1,s+2),_){jr(d,_)&&S.add(_,d,S.normalize(_,S.subtract(_,d,l))),wr(Ie,_,d);var Jn=Lt(st,S.create(),ue,Ie,this.thickness),Pi=(0,Q.Z)(Jn,2),aa=Pi[0],ma=Pi[1],di=S.dot(st,this.normal)<0?-1:1,Ma=Bt;if(!Ma&&this.join==="miter"){var eo=aa;eo>this.miterLimit&&(Ma=!0)}Ma?(Ne.push(this.normal[0],this.normal[1],0),Ne.push(ma[0],ma[1],0),_e.push(d[0],d[1],0,this.totalDistance,-this.thickness*di,0),_e.push(d[0],d[1],0,this.totalDistance,this.thickness*di,0),$.push.apply($,(0,Ei.Z)(this.lastFlip!==-di?[s,s+2,s+3]:[s+2,s+1,s+3])),$.push(s+2,s+3,s+4),It(j,Ie),S.copy(this.normal,j),Ne.push(this.normal[0],this.normal[1],0),_e.push(d[0],d[1],0,this.totalDistance,-this.thickness*di,0),J+=3):(this.extrusions(_e,Ne,d,ma,aa,this.totalDistance),$.push.apply($,(0,Ei.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),di=-1,S.copy(this.normal,ma),J+=2),this.lastFlip=di}else{if(It(this.normal,ue),mt){var Xn=S.create(),Ci=S.create();S.sub(Ci,ue,this.normal),S.add(Xn,ue,this.normal),Ne.push(Ci[0],Ci[1],0),Ne.push(Xn[0],Xn[1],0),_e.push(d[0],d[1],0,this.totalDistance,this.thickness,0),_e.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(_e,Ne,d,this.normal,this.thickness,this.totalDistance);$.push.apply($,(0,Ei.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),J+=2}return J}},{key:"segment",value:function(o,s,l,d,_){var T=0,I=o.indices,k=o.positions,J=o.normals,$=this.cap==="square",_e=this.join==="bevel",Ne=(0,et.Z)([d[0],d[1]]),mt=(0,et.Z)([l[0],l[1]]);wr(ue,Ne,mt);var Bt=0;if(this.dash&&(Bt=this.lineSegmentDistance(Ne,mt),this.totalDistance+=Bt),this.normal||(this.normal=S.create(),It(this.normal,ue)),!this.started)if(this.started=!0,$){var mr=S.create(),Sr=S.create();S.add(mr,this.normal,ue),S.add(Sr,this.normal,ue),J.push(Sr[0],Sr[1],0),J.push(mr[0],mr[1],0),k.push(l[0],l[1],0,this.totalDistance-Bt,-this.thickness,0),k.push(l[0],l[1],0,this.totalDistance-Bt,this.thickness,0)}else this.extrusions(k,J,l,this.normal,this.thickness,this.totalDistance-Bt);if(I.push(s+0,s+1,s+2),_){var Rn=(0,et.Z)([_[0],_[1]]);jr(Ne,Rn)&&S.add(Rn,Ne,S.normalize(Rn,S.subtract(Rn,Ne,mt))),wr(Ie,Rn,Ne);var Xn=Lt(st,S.create(),ue,Ie,this.thickness),Ci=(0,Q.Z)(Xn,2),Jn=Ci[0],Pi=Ci[1],aa=S.dot(st,this.normal)<0?-1:1,ma=_e;if(!ma&&this.join==="miter"){var di=Jn;di>this.miterLimit&&(ma=!0)}ma?(J.push(this.normal[0],this.normal[1],0),J.push(Pi[0],Pi[1],0),k.push(d[0],d[1],0,this.totalDistance,-this.thickness*aa,0),k.push(d[0],d[1],0,this.totalDistance,this.thickness*aa,0),I.push.apply(I,(0,Ei.Z)(this.lastFlip!==-aa?[s,s+2,s+3]:[s+2,s+1,s+3])),I.push(s+2,s+3,s+4),It(j,Ie),S.copy(this.normal,j),J.push(this.normal[0],this.normal[1],0),k.push(d[0],d[1],0,this.totalDistance,-this.thickness*aa,0),T+=3):(this.extrusions(k,J,d,Pi,Jn,this.totalDistance),I.push.apply(I,(0,Ei.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),aa=-1,S.copy(this.normal,Pi),T+=2),this.lastFlip=aa}else{if(It(this.normal,ue),$){var Zr=S.create(),xn=S.create();S.sub(xn,ue,this.normal),S.add(Zr,ue,this.normal),J.push(xn[0],xn[1],0),J.push(Zr[0],Zr[1],0),k.push(d[0],d[1],0,this.totalDistance,this.thickness,0),k.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(k,J,d,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,Ei.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),T+=2}return T}},{key:"extrusions",value:function(o,s,l,d,_,T){s.push(d[0],d[1],0),s.push(d[0],d[1],0),o.push(l[0],l[1],0,T,-_,0),o.push(l[0],l[1],0,T,_,0)}},{key:"lineSegmentDistance",value:function(o,s){var l=s[0]-o[0],d=s[1]-o[1];return Math.sqrt(l*l+d*d)}}]),i}();function fi(i){if(Hi()(i[0]))return i;if(Hi()(i[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Hi()(i[0][0][0])){var c=i,o=0,s=0,l=0;return c.forEach(function(d){d.forEach(function(_){o+=_[0],s+=_[1],l++})}),[o/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var qn=E(77160);function wa(i){var c=i[0][0],o=i[0][i[0].length-1];c[0]===o[0]&&c[1]===o[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var s=i[0].length,l=m().flatten(i),d=l.vertices,_=l.dimensions,T=[],I=[],k=0;k<d.length/_;k++)_===2?T.push(d[k*2],d[k*2+1],1):T.push(d[k*3],d[k*3+1],1);var J=m()(l.vertices,l.holes,l.dimensions);I.push.apply(I,(0,Ei.Z)(J));for(var $=function(mt){var Bt=l.vertices.slice(mt*_,(mt+1)*_),mr=l.vertices.slice((mt+1)*_,(mt+2)*_);mr.length===0&&(mr=l.vertices.slice(0,_));var Sr=T.length/3;T.push(Bt[0],Bt[1],1,mr[0],mr[1],1,Bt[0],Bt[1],0,mr[0],mr[1],0),I.push.apply(I,(0,Ei.Z)([0,2,1,2,3,1].map(function(Zr){return Zr+Sr})))},_e=0;_e<s;_e++)$(_e);return{positions:T,index:I}}function ka(i){var c=m().flatten(i),o=m()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:o}}function Qi(i){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=i[0][0],s=i[0][i[0].length-1];o[0]===s[0]&&o[1]===s[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var l=i[0].length,d=m().flatten(i),_=d.vertices,T=d.dimensions,I=[],k=[],J=[],$=0;$<_.length/T;$++)T===2?I.push(_[$*2],_[$*2+1],1,-1,-1):I.push(_[$*3],_[$*3+1],1,-1,-1),J.push(0,0,1);var _e=m()(d.vertices,d.holes,d.dimensions);k.push.apply(k,(0,Ei.Z)(_e));for(var Ne=function(mr){var Sr=d.vertices.slice(mr*T,(mr+1)*T),Zr=d.vertices.slice((mr+1)*T,(mr+2)*T);Zr.length===0&&(Zr=d.vertices.slice(0,T));var xn=I.length/5;I.push(Sr[0],Sr[1],1,0,0,Zr[0],Zr[1],1,.1,0,Sr[0],Sr[1],0,0,.8,Zr[0],Zr[1],0,.1,.8);var Rn=cs([Zr[0],Zr[1],1],[Sr[0],Sr[1],0],[Sr[0],Sr[1],1],c);J.push.apply(J,(0,Ei.Z)(Rn).concat((0,Ei.Z)(Rn),(0,Ei.Z)(Rn),(0,Ei.Z)(Rn))),k.push.apply(k,(0,Ei.Z)([1,2,0,3,2,1].map(function(Xn){return Xn+xn})))},mt=0;mt<l;mt++)Ne(mt);return{positions:I,index:k,normals:J}}function cs(i,c,o){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=qn.create(),d=qn.create(),_=qn.create();s&&(i=(0,et.vP)(i),c=(0,et.vP)(c),o=(0,et.vP)(o));var T=qn.fromValues.apply(qn,(0,Ei.Z)(i)),I=qn.fromValues.apply(qn,(0,Ei.Z)(c)),k=qn.fromValues.apply(qn,(0,Ei.Z)(o));qn.sub(l,k,I),qn.sub(d,T,I),qn.cross(_,l,d);var J=qn.create();return qn.normalize(J,_),J}var xo,Ts;(function(i){i.CYLINDER="cylinder",i.SQUARECOLUMN="squareColumn",i.TRIANGLECOLUMN="triangleColumn",i.HEXAGONCOLUMN="hexagonColumn",i.PENTAGONCOLUMN="pentagonColumn"})(Ts||(Ts={}));var au;(function(i){i.CIRCLE="circle",i.SQUARE="square",i.TRIANGLE="triangle",i.HEXAGON="hexagon",i.PENTAGON="pentagon"})(au||(au={}));function Bs(i){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=Math.PI*2/i,s=[],l=0;l<i;l++)s.push(o*l+c*Math.PI/12);var d=s.map(function(_){var T=Math.sin(_+Math.PI/4),I=Math.cos(_+Math.PI/4);return[T,I,0]});return d}function rl(){return Bs(30)}function Ys(){return Bs(4)}function Ks(){return Bs(3)}function $s(){return Bs(6,1)}function ao(){return Bs(5)}var wu=(xo={},(0,L.Z)(xo,au.CIRCLE,rl),(0,L.Z)(xo,au.HEXAGON,$s),(0,L.Z)(xo,au.TRIANGLE,Ks),(0,L.Z)(xo,au.SQUARE,Ys),(0,L.Z)(xo,au.PENTAGON,ao),(0,L.Z)(xo,Ts.CYLINDER,rl),(0,L.Z)(xo,Ts.HEXAGONCOLUMN,$s),(0,L.Z)(xo,Ts.TRIANGLECOLUMN,Ks),(0,L.Z)(xo,Ts.SQUARECOLUMN,Ys),(0,L.Z)(xo,Ts.PENTAGONCOLUMN,ao),xo),nl={};function fs(i){var c=fi(i.coordinates);return{vertices:[].concat((0,Ei.Z)(c),(0,Ei.Z)(c),(0,Ei.Z)(c),(0,Ei.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function Gl(i){var c=i.shape,o=lc(c,!1),s=o.positions,l=o.index,d=o.normals;return{vertices:s,indices:l,normals:d,size:5}}function ou(i){var c=fi(i.coordinates);return{vertices:(0,Ei.Z)(c),indices:[0],size:c.length}}function Ns(i){var c=i.coordinates,o=i.originCoordinates,s=i.version,l=new Mi({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=c;Array.isArray(d[0][0])||(d=[c]);var _=o;Array.isArray(_[0][0])||(_=[o]);for(var T=0;T<d.length;T++){var I=d[T],k=_[T];l.extrude_gaode2(I,k)}}else{var J=c;Array.isArray(J[0][0])||(J=[c]),J.forEach(function(_e){l.extrude(_e)})}var $=l.complex;return{vertices:$.positions,indices:$.indices,normals:$.normals,size:6}}function uc(i){var c=i.coordinates,o=m().flatten(c),s=o.vertices,l=o.dimensions,d=o.holes;return{indices:m()(s,d,l),vertices:s,size:l}}function Cu(i){var c=i.coordinates,o=Qi(c,!0),s=o.positions,l=o.index,d=o.normals;return{vertices:s,indices:l,normals:d,size:5}}function Ta(i){var c=i.shape,o=Sl(c),s=o.positions,l=o.index;return{vertices:s,indices:l,size:3}}function Au(i){var c=i.coordinates,o=[].concat((0,Ei.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,Ei.Z)(c[1]),[0,1,0],(0,Ei.Z)(c[0]),[0,0,1],(0,Ei.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:o,indices:s,size:5}}function Hl(i,c){for(var o=c||30,s=i.coordinates,l=[],d=[],_=function(k){l.push(k,1,k,s[0][0],s[0][1],s[1][0],s[1][1],k,-1,k,s[0][0],s[0][1],s[1][0],s[1][1]),k!==o-1&&d.push.apply(d,(0,Ei.Z)([0,1,2,1,3,2].map(function(J){return k*2+J})))},T=0;T<o;T++)_(T);return{vertices:l,indices:d,size:7}}function Tu(i){var c=i.coordinates;c.length===2&&c.push(0);var o=i.size,s=gu(-1,1),l=gu(1,1),d=gu(-1,-1),_=gu(1,-1),T=[].concat((0,Ei.Z)(c),(0,Ei.Z)(s),(0,Ei.Z)(c),(0,Ei.Z)(d),(0,Ei.Z)(c),(0,Ei.Z)(_),(0,Ei.Z)(c),(0,Ei.Z)(l)),I=[0,1,2,3,0,2];return{vertices:T,indices:I,size:5}}function lc(i){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(nl&&nl[i])return nl[i];var o=wu[i]?wu[i]():wu.cylinder(),s=Qi([o],c);return nl[i]=s,s}function cc(i,c){for(var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(i.length/o*3),d,_,T,I=vec3.create(),k=vec3.create(),J=vec3.create(),$=0,_e=c.length;$<_e;$+=3){d=c[$+0]*3,_=c[$+1]*3,T=c[$+2]*3;var Ne=[i[d],i[d+1]],mt=[i[_],i[_+1]],Bt=[i[T],i[T+1]];s&&(Ne=lngLatToMeters(Ne),mt=lngLatToMeters(mt),Bt=lngLatToMeters(Bt));var mr=Ne,Sr=_slicedToArray(mr,2),Zr=Sr[0],xn=Sr[1],Rn=vec3.fromValues(Zr,xn,i[d+2]),Xn=mt,Ci=_slicedToArray(Xn,2),Jn=Ci[0],Pi=Ci[1],aa=vec3.fromValues(Jn,Pi,i[_+2]),ma=Bt,di=_slicedToArray(ma,2),Ma=di[0],eo=di[1],Eu=vec3.fromValues(Ma,eo,i[T+2]);vec3.sub(I,Eu,aa),vec3.sub(k,Rn,aa),vec3.cross(J,I,k),l[d]+=I[0],l[d+1]+=I[1],l[d+2]+=I[2],l[_]+=I[0],l[_+1]+=I[1],l[_+2]+=I[2],l[T]+=I[0],l[T+1]+=I[1],l[T+2]+=I[2]}return Rc(l),l}function Rc(i){for(var c=0,o=i.length;c<o;c+=3){var s=vec3.fromValues(i[c],i[c+1],i[c+2]),l=vec3.create();vec3.normalize(l,s),i.set(l,c)}}function kc(i){var c=i[0][0],o=i[0][i[0].length-1];return c[0]===o[0]&&c[1]===o[1]}function Sl(i){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],o=wu[i]?wu[i]():wu.circle(),s=c.indexOf(i)===-1?ka([o]):wa([o]);return s}function gu(i,c){var o=(i+1)/2,s=(c+1)/2;return[o,s]}function il(i){var c=al();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function al(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Vu=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ol=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Gu=function(i){(0,Be.Z)(o,i);var c=il(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.baseColor,I=T===void 0?"rgb(16,16,16)":T,k=l.brightColor,J=k===void 0?"rgb(255,176,38)":k,$=l.windowColor,_e=$===void 0?"rgb(30,60,89)":$,Ne=l.time,mt=Ne===void 0?0:Ne;return{u_opacity:_,u_baseColor:(0,et.CI)(I),u_brightColor:(0,et.CI)(J),u_windowColor:(0,et.CI)(_e),u_time:this.layer.getLayerAnimateTime()||mt}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:ol,fragmentShader:Vu,triangulation:Cu})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(d,_,T,I,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(d,_,T,I){var k=d.size,J=k===void 0?10:k;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(d,_,T,I){var k=d.size;return[T[3],T[4]]}}})}}]),o}(Ba);function zs(i){var c=fc();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function fc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var hc=function(i){(0,Be.Z)(o,i);var c=zs(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","PolygonLayer"),s}return(0,W.Z)(o,[{key:"buildModels",value:function(){this.layerModel=new Gu(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),o}(_o);function Dc(i){var c=Hu();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Hu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var El=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Wl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,pc=function(i){(0,Be.Z)(o,i);var c=Dc(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:_||.9,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:El,fragmentShader:Wl,triangulation:Ta,depth:{enable:!1},primitive:A.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:A.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(d,_){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),o}(Ba);function Wu(i){var c=wl();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function wl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Cl=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,Pu=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Xl=function(i){(0,Be.Z)(o,i);var c=Wu(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:_||1,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Cl,fragmentShader:Pu,triangulation:Gl,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(d,_,T,I){var k=d.size;return Array.isArray(k)?[k[0]]:[k]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(d,_,T,I,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:A.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(d,_){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),o}(Ba),za=E(85975);function Mu(i,c){for(var o=[],s=[],l=[],d=i+1,_=c+1,T=i/2,I=c/2,k=0;k<_;k++)for(var J=k-I,$=0;$<d;$++){var _e=$-T;s.push(_e/T,-J/I,0),l.push($/i),l.push(1-k/c)}for(var Ne=0;Ne<c;Ne++)for(var mt=0;mt<i;mt++){var Bt=mt+d*Ne,mr=mt+d*(Ne+1),Sr=mt+1+d*(Ne+1),Zr=mt+1+d*Ne;o.push(Bt,mr,Zr),o.push(mr,Sr,Zr)}return{vertices:s,indices:o,uvs:l}}var sl,Yl;function Kl(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Xu(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Kl(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Kl(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function $c(i){var c=ul();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ul(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var $a=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,ll=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,Yu=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,Js=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,ia=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Ua=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,_s=(sl=(0,Et.b2)(),sl(Yl=function(i){(0,Be.Z)(o,i);var c=$c(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"colorTexture",void 0),(0,L.Z)((0,N.Z)(s),"heatmapFramerBuffer",void 0),(0,L.Z)((0,N.Z)(s),"intensityModel",void 0),(0,L.Z)((0,N.Z)(s),"colorModel",void 0),(0,L.Z)((0,N.Z)(s),"shapeType",void 0),s}return(0,W.Z)(o,[{key:"render",value:function(){var l=this,d=this.rendererService,_=d.clear,T=d.useFramebuffer;T(this.heatmapFramerBuffer,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,_=d.createFramebuffer,T=d.clear,I=d.getViewportSize,k=d.createTexture2D,J=d.useFramebuffer,$=this.styleAttributeService.getLayerStyleAttribute("shape"),_e=($==null||(l=$.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=_e,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=_e==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Ne=this.layer.getLayerConfig(),mt=Ne.rampColors,Bt=(0,et.Cl)(mt),mr=I(),Sr=mr.width,Zr=mr.height;return this.heatmapFramerBuffer=_({color:k({width:Math.floor(Sr/4),height:Math.floor(Zr/4),wrapS:A.gl.CLAMP_TO_EDGE,wrapT:A.gl.CLAMP_TO_EDGE,min:A.gl.LINEAR,mag:A.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:A.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(d,_,T,I){return[T[3],T[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(d,_,T,I){var k=d.size,J=k===void 0?1:k;return[J]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:ia,fragmentShader:Js,triangulation:Tu,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:A.gl.ONE,srcAlpha:1,dstRGB:A.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:Ua,fs:Yu});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,_=l.fs,T=l.uniforms,I=this.rendererService,k=I.createAttribute,J=I.createElements,$=I.createBuffer,_e=I.createModel;return _e({vs:d,fs:_,attributes:{a_Position:k({buffer:$({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:A.gl.FLOAT}),size:3}),a_Uv:k({buffer:$({data:[0,1,1,1,0,0,1,0],type:A.gl.FLOAT}),size:2})},uniforms:Xu({},T),depth:{enable:!1},blend:this.getBlend(),count:6,elements:J({data:[0,2,1,2,3,1],type:A.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.intensity,T=_===void 0?10:_,I=l.radius,k=I===void 0?5:I;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:k,u_intensity:T}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=za.create();za.invert(_,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Ei.Z)(_)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),_=d.width,T=d.height,I=Mu(_/4,T/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:ll,fs:$a});var k=this.shaderModuleService.getModule("heatmap3dColor"),J=k.vs,$=k.fs,_e=k.uniforms,Ne=this.rendererService,mt=Ne.createAttribute,Bt=Ne.createElements,mr=Ne.createBuffer,Sr=Ne.createModel;return Sr({vs:J,fs:$,attributes:{a_Position:mt({buffer:mr({data:I.vertices,type:A.gl.FLOAT}),size:3}),a_Uv:mt({buffer:mr({data:I.uvs,type:A.gl.FLOAT}),size:2})},primitive:A.gl.TRIANGLES,uniforms:Xu({},_e),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:A.gl.SRC_ALPHA,srcAlpha:1,dstRGB:A.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Bt({data:I.indices,type:A.gl.UNSIGNED_INT,count:I.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),_=d.rampColors,T=(0,et.Cl)(_);this.colorTexture=l({data:new Uint8Array(T.data),width:T.width,height:T.height,wrapS:A.gl.CLAMP_TO_EDGE,wrapT:A.gl.CLAMP_TO_EDGE,min:A.gl.NEAREST,mag:A.gl.NEAREST,flipY:!1})}}]),o}(Ba))||Yl);function Al(i){var c=Iu();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Iu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Tl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Jc=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Qc=function(i){(0,Be.Z)(o,i);var c=Al(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:_||.9,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Jc,fragmentShader:Tl,triangulation:Ta,depth:{enable:!1},primitive:A.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:A.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(d,_){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),o}(Ba),Pl={heatmap:_s,heatmap3d:_s,grid:pc,grid3d:Xl,hexagon:Qc},$l=Pl;function Ou(i){var c=ko();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Us=function(i){(0,Be.Z)(o,i);var c=Ou(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","HeatMapLayer"),s}return(0,W.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new $l[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(_){return _.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=this.getLayerConfig(),T=_.shape3d,I=this.getSource(),k=I.data.type,J=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return J==="heatmap"||J==="heatmap3d"?"heatmap":k==="hexagon"?(T==null?void 0:T.indexOf(J))===-1?"hexagon":"grid3d":k==="grid"?(T==null?void 0:T.indexOf(J))===-1?"grid":"grid3d":"heatmap"}}]),o}(_o);function cl(i){var c=bo();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function bo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Dn=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,fo=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Lu=function(i){(0,Be.Z)(o,i);var c=cl(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),s}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),_=this.rendererService.createTexture2D;return this.texture=_({height:0,width:0}),d.data.images.then(function(T){l.texture=_({data:T[0],width:T[0].width,height:T[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:fo,fragmentShader:Dn,triangulation:Au,primitive:A.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(d,_,T,I){return[T[3],T[4]]}}})}}]),o}(Ba),fl={image:Lu},Qs=fl;function Ps(i){var c=dc();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function dc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var dn=function(i){(0,Be.Z)(o,i);var c=Ps(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","ImageLayer"),s}return(0,W.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Qs[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),o}(_o);function Jl(i){var c=Ql();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ql(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ru=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,ja=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // v_arcDistrance *= 8.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Ms={solid:0,dash:1},ql=function(i){(0,Be.Z)(o,i);var c=Jl(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:A.gl.NEAREST,min:A.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,k=I===void 0?"normal":I,J=l.lineType,$=J===void 0?"solid":J,_e=l.dashArray,Ne=_e===void 0?[10,5]:_e,mt=l.forward,Bt=mt===void 0?!0:mt,mr=l.lineTexture,Sr=mr===void 0?!1:mr,Zr=l.iconStep,xn=Zr===void 0?100:Zr,Rn=l.segmentNumber,Xn=Rn===void 0?30:Rn;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Ci=this.layer.getEncodedData(),Jn=this.calDataFrame(this.cellLength,Ci,this.cellProperties),Pi=Jn.data,aa=Jn.width,ma=Jn.height;this.rowCount=ma,this.dataTexture=this.cellLength>0&&Pi.length>0?this.createTexture2D({flipY:!0,data:Pi,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:aa,height:ma}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}Ne.length===2&&Ne.push(0,0);var di=0,Ma=[0,0,0,0],eo=[0,0,0,0];return _&&T&&(Ma=(0,et.CI)(_),eo=(0,et.CI)(T),di=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(d)?d:1,u_textureBlend:k==="normal"?0:1,segmentNumber:Xn,u_line_type:Ms[$||"solid"],u_dash_array:Ne,u_blur:.9,u_lineDir:Bt?1:-1,u_texture:this.texture,u_line_texture:Sr?1:0,u_icon_step:xn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:di,u_sourceColor:Ma,u_targetColor:eo}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),d=l.segmentNumber,_=d===void 0?30:d;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:ja,fragmentShader:Ru,triangulation:Hl,depth:{enable:!1},blend:this.getBlend(),segmentNumber:_})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size,$=J===void 0?1:J;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:A.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:4,update:function(_,T,I,k){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=l.iconService.getIconMap(),$=_.texture,_e=J[$]||{x:0,y:0},Ne=_e.x,mt=_e.y;return[Ne,mt]}}})}}]),o}(Ba);function _u(i){var c=Is();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var su=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Fc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Ml={solid:0,dash:1},vc=function(i){(0,Be.Z)(o,i);var c=_u(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:A.gl.NEAREST,min:A.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,k=I===void 0?"normal":I,J=l.lineType,$=J===void 0?"solid":J,_e=l.dashArray,Ne=_e===void 0?[10,5]:_e,mt=l.lineTexture,Bt=mt===void 0?!1:mt,mr=l.iconStep,Sr=mr===void 0?100:mr,Zr=l.segmentNumber,xn=Zr===void 0?30:Zr;Ne.length===2&&Ne.push(0,0);var Rn=0,Xn=[0,0,0,0],Ci=[0,0,0,0];if(_&&T&&(Xn=(0,et.CI)(_),Ci=(0,et.CI)(T),Rn=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Jn=this.layer.getEncodedData(),Pi=this.calDataFrame(this.cellLength,Jn,this.cellProperties),aa=Pi.data,ma=Pi.width,di=Pi.height;this.rowCount=di,this.dataTexture=this.cellLength>0&&aa.length>0?this.createTexture2D({flipY:!0,data:aa,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:ma,height:di}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(d)?d:1,u_textureBlend:k==="normal"?0:1,segmentNumber:xn,u_line_type:Ml[$]||0,u_dash_array:Ne,u_texture:this.texture,u_line_texture:Bt?1:0,u_icon_step:Sr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Rn,u_sourceColor:Xn,u_targetColor:Ci}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:Fc,fragmentShader:su,triangulation:Hl,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size,$=J===void 0?1:J;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:A.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:4,update:function(_,T,I,k){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=l.iconService.getIconMap(),$=_.texture,_e=J[$]||{x:0,y:0},Ne=_e.x,mt=_e.y;return[Ne,mt]}}})}}]),o}(Ba);function Bc(i){var c=qs();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function qs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Os=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,qi=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // v_arcDistrance = length(source - target);
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance = v_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
    //   v_arcDistrance *= 10.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,xu={solid:0,dash:1},Zs=function(i){(0,Be.Z)(o,i);var c=Bc(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:A.gl.NEAREST,min:A.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,k=I===void 0?"normal":I,J=l.lineType,$=J===void 0?"solid":J,_e=l.dashArray,Ne=_e===void 0?[10,5]:_e,mt=l.lineTexture,Bt=mt===void 0?!1:mt,mr=l.iconStep,Sr=mr===void 0?100:mr,Zr=l.segmentNumber,xn=Zr===void 0?30:Zr;Ne.length===2&&Ne.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Rn=0,Xn=[0,0,0,0],Ci=[0,0,0,0];if(_&&T&&(Xn=(0,et.CI)(_),Ci=(0,et.CI)(T),Rn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Jn=this.layer.getEncodedData(),Pi=this.calDataFrame(this.cellLength,Jn,this.cellProperties),aa=Pi.data,ma=Pi.width,di=Pi.height;this.rowCount=di,this.dataTexture=this.cellLength>0&&aa.length>0?this.createTexture2D({flipY:!0,data:aa,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:ma,height:di}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(d)?d:1,u_textureBlend:k==="normal"?0:1,segmentNumber:xn,u_line_type:xu[$]||0,u_dash_array:Ne,u_texture:this.texture,u_line_texture:Bt?1:0,u_icon_step:Sr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Rn,u_sourceColor:Xn,u_targetColor:Ci}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:qi,fragmentShader:Os,triangulation:Hl,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size,$=J===void 0?1:J;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:A.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:4,update:function(_,T,I,k){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=l.iconService.getIconMap(),$=_.texture,_e=J[$]||{x:0,y:0},Ne=_e.x,mt=_e.y;return[Ne,mt]}}})}}]),o}(Ba);function zo(i){var c=hl();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var uu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,lu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    v_pixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);
  

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,So={solid:0,dash:1},ku=function(i){(0,Be.Z)(o,i);var c=zo(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:A.gl.NEAREST,min:A.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,k=I===void 0?"normal":I,J=l.lineType,$=J===void 0?"solid":J,_e=l.dashArray,Ne=_e===void 0?[10,5,0,0]:_e,mt=l.lineTexture,Bt=mt===void 0?!1:mt,mr=l.iconStep,Sr=mr===void 0?100:mr;Ne.length===2&&Ne.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Zr=0,xn=[0,0,0,0],Rn=[0,0,0,0];if(_&&T&&(xn=(0,et.CI)(_),Rn=(0,et.CI)(T),Zr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Xn=this.layer.getEncodedData(),Ci=this.calDataFrame(this.cellLength,Xn,this.cellProperties),Jn=Ci.data,Pi=Ci.width,aa=Ci.height;this.rowCount=aa,this.dataTexture=this.cellLength>0&&Jn.length>0?this.createTexture2D({flipY:!0,data:Jn,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:Pi,height:aa}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(d)?d:1,u_textureBlend:k==="normal"?0:1,u_line_type:So[$],u_dash_array:Ne,u_texture:this.texture,u_line_texture:Bt?1:0,u_icon_step:Sr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:xn,u_targetColor:Rn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:lu,fragmentShader:uu,triangulation:Ns,primitive:A.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.lineType,T=_===void 0?"solid":_;this.styleAttributeService.registerStyleAttribute({name:"distance",type:A.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(k,J,$,_e){return[$[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:A.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(k,J,$,_e){return[$[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(k,J,$,_e){var Ne=k.size,mt=Ne===void 0?1:Ne;return Array.isArray(mt)?[mt[0],mt[1]]:[mt,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(k,J,$,_e,Ne){return Ne}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:A.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(k,J,$,_e){return[$[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(k,J,$,_e){var Ne=l.iconService.getIconMap(),mt=k.texture,Bt=Ne[mt]||{x:0,y:0},mr=Bt.x,Sr=Bt.y;return[mr,Sr]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,_){if(l instanceof HTMLImageElement){d(l);return}var T=new Image;T.crossOrigin="anonymous",T.onload=function(){d(T)},T.onerror=function(){_(new Error("Could not load image at "+l))},T.src=l instanceof File?URL.createObjectURL(l):l})}}]),o}(Ba),ai={arc:ql,arc3d:vc,greatcircle:Zs,line:ku},Hn=ai;function Il(i){var c=ns();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ns(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var eu=function(i){(0,Be.Z)(o,i);var c=Il(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","LineLayer"),s}return(0,W.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Hn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return _||"line"}}]),o}(_o);function Ko(i){var c=cu();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var mc=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ec=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Wi=function(i){(0,Be.Z)(o,i);var c=Ko(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),k=I.data,J=I.width,$=I.height;this.rowCount=$,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:J,height:$}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:ec,fragmentShader:mc,triangulation:Gl,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(d,_,T,I){var k=d.size;if(k){var J=[];return Array.isArray(k)&&(J=k.length===2?[k[0],k[0],k[1]]:k),Array.isArray(k)||(J=[k]),J}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(d,_,T,I,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:A.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(d,_){var T=fi(d.coordinates);return[T[0],T[1],0]}}})}}]),o}(Ba);function Do(i){var c=Nc();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Nc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var xs=`#define Animate 0.0

uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

}
`,tc=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,bs=function(i){(0,Be.Z)(o,i);var c=Do(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.strokeOpacity,I=T===void 0?1:T,k=l.strokeWidth,J=k===void 0?0:k,$=l.stroke,_e=$===void 0?"rgba(0,0,0,0)":$,Ne=l.offsets,mt=Ne===void 0?[0,0]:Ne;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeOpacity:I,strokeWidth:J,stroke:_e,offsets:mt})){this.judgeStyleAttributes({opacity:_,strokeOpacity:I,strokeWidth:J,stroke:_e,offsets:mt});var Bt=this.layer.getEncodedData(),mr=this.calDataFrame(this.cellLength,Bt,this.cellProperties),Sr=mr.data,Zr=mr.width,xn=mr.height;this.rowCount=xn,this.dataTexture=this.cellLength>0&&Sr.length>0?this.createTexture2D({flipY:!0,data:Sr,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:Zr,height:xn}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1,u_stroke_opacity:Hi()(I)?I:1,u_stroke_width:Hi()(J)?J:0,u_stroke_color:this.getStrokeColor(_e),u_offsets:this.isOffsetStatic(mt)?mt:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),fs)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:tc,fragmentShader:xs,triangulation:fs,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:A.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=[1,1,-1,1,-1,-1,1,-1],$=k%4*2;return[J[$],J[$+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size,$=J===void 0?5:J;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:A.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.shape,$=J===void 0?2:J,_e=l.layer.getLayerConfig().shape2d,Ne=_e.indexOf($);return[Ne]}}})}}]),o}(Ba);function hs(i){var c=pl();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var fu=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Ol=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Ku=function(i){(0,Be.Z)(o,i);var c=hs(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),s}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:Ol,fragmentShader:fu,triangulation:ou,primitive:A.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=l.fontService.mapping,$=_.shape,_e=l.fontService.getGlyph($),Ne=J[_e],mt=Ne.x,Bt=Ne.y;return[mt,Bt]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:A.gl.LINEAR,min:A.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.fontWeight,T=_===void 0?"normal":_,I=d.fontFamily,k=I===void 0?"sans-serif":I,J=this.layer.getEncodedData(),$=[];J.forEach(function(_e){var Ne=_e.shape,mt=Ne===void 0?"":Ne;mt=mt.toString();var Bt=l.fontService.getGlyph(mt);$.indexOf(Bt)===-1&&$.push(Bt)}),this.fontService.setFontOptions({characterSet:$,fontWeight:T,fontFamily:k,fontSize:48})}}]),o}(Ba);function Ll(i){var c=zc();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function zc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Rl=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,dl=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,yc=function(i){(0,Be.Z)(o,i);var c=Ll(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.renderLayers();return}s.texture=T({data:s.iconService.getCanvas(),mag:A.gl.LINEAR,min:A.gl.LINEAR,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=l.offsets,T=_===void 0?[0,0]:_;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:T})){this.judgeStyleAttributes({opacity:d,offsets:T});var I=this.layer.getEncodedData(),k=this.calDataFrame(this.cellLength,I,this.cellProperties),J=k.data,$=k.width,_e=k.height;this.rowCount=_e,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:$,height:_e}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Hi()(d)?d:1,u_offsets:this.isOffsetStatic(T)?T:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:dl,fragmentShader:Rl,triangulation:ou,primitive:A.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size,$=J===void 0?5:J;return Array.isArray($)?[$[0]]:[$]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=l.iconService.getIconMap(),$=_.shape,_e=J[$]||{x:0,y:0},Ne=_e.x,mt=_e.y;return[Ne,mt]}}})}}]),o}(Ba);function Du(i){var c=Fu();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Fu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var gc=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Bu=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;



uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function js(i){var c=i.coordinates;return{vertices:(0,Ei.Z)(c),indices:[0],size:c.length}}var _c=function(i){(0,Be.Z)(o,i);var c=Du(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.offsets,I=T===void 0?[0,0]:T;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,offsets:I})){this.judgeStyleAttributes({opacity:_,offsets:I});var k=this.layer.getEncodedData(),J=this.calDataFrame(this.cellLength,k,this.cellProperties),$=J.data,_e=J.width,Ne=J.height;this.rowCount=Ne,this.dataTexture=this.cellLength>0&&$.length>0?this.createTexture2D({flipY:!0,data:$,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:_e,height:Ne}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1,u_offsets:this.isOffsetStatic(I)?I:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:Bu,fragmentShader:gc,triangulation:js,depth:{enable:!1},primitive:A.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(d,_,T,I){var k=d.size,J=k===void 0?1:k;return Array.isArray(J)?[J[0]]:[J]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:A.BlendType.additive}}}]),o}(Ba),Nu=E(98333);function kl(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=$u(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){o=o.call(i)},n:function(){var k=o.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw T}}}}function $u(i,c){if(!!i){if(typeof i=="string")return n(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return n(i,c)}}function n(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}var u=function(){function i(c,o,s){(0,Y.Z)(this,i),(0,L.Z)(this,"boxCells",[]),(0,L.Z)(this,"xCellCount",void 0),(0,L.Z)(this,"yCellCount",void 0),(0,L.Z)(this,"boxKeys",void 0),(0,L.Z)(this,"bboxes",void 0),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0),(0,L.Z)(this,"xScale",void 0),(0,L.Z)(this,"yScale",void 0),(0,L.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(o/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=o,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/o,this.boxUid=0}return(0,W.Z)(i,[{key:"insert",value:function(o,s,l,d,_){this.forEachCell(s,l,d,_,this.insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(_)}},{key:"query",value:function(o,s,l,d,_){return this.queryHitTest(o,s,l,d,!1,_)}},{key:"hitTest",value:function(o,s,l,d,_){return this.queryHitTest(o,s,l,d,!0,_)}},{key:"insertBoxCell",value:function(o,s,l,d,_,T){this.boxCells[_].push(T)}},{key:"queryHitTest",value:function(o,s,l,d,_,T){if(l<0||o>this.width||d<0||s>this.height)return _?!1:[];var I=[];if(o<=0&&s<=0&&this.width<=l&&this.height<=d){if(_)return!0;for(var k=0;k<this.boxKeys.length;k++)I.push({key:this.boxKeys[k],x1:this.bboxes[k*4],y1:this.bboxes[k*4+1],x2:this.bboxes[k*4+2],y2:this.bboxes[k*4+3]});return T?I.filter(T):I}var J={hitTest:_,seenUids:{box:{},circle:{}}};return this.forEachCell(o,s,l,d,this.queryCell,I,J,T),_?I.length>0:I}},{key:"queryCell",value:function(o,s,l,d,_,T,I,k){var J=I.seenUids,$=this.boxCells[_];if($!==null){var _e=this.bboxes,Ne=kl($),mt;try{for(Ne.s();!(mt=Ne.n()).done;){var Bt=mt.value;if(!J.box[Bt]){J.box[Bt]=!0;var mr=Bt*4;if(o<=_e[mr+2]&&s<=_e[mr+3]&&l>=_e[mr+0]&&d>=_e[mr+1]&&(!k||k(this.boxKeys[Bt]))){if(I.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Bt],x1:_e[mr],y1:_e[mr+1],x2:_e[mr+2],y2:_e[mr+3]})}}}}catch(Sr){Ne.e(Sr)}finally{Ne.f()}}return!1}},{key:"forEachCell",value:function(o,s,l,d,_,T,I,k){for(var J=this.convertToXCellCoord(o),$=this.convertToYCellCoord(s),_e=this.convertToXCellCoord(l),Ne=this.convertToYCellCoord(d),mt=J;mt<=_e;mt++)for(var Bt=$;Bt<=Ne;Bt++){var mr=this.xCellCount*Bt+mt;if(_.call(this,o,s,l,d,mr,T,I,k))return}}},{key:"convertToXCellCoord",value:function(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}},{key:"convertToYCellCoord",value:function(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}}]),i}(),a=u,h=function(){function i(c,o){(0,Y.Z)(this,i),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0),(0,L.Z)(this,"grid",void 0),(0,L.Z)(this,"viewportPadding",100),(0,L.Z)(this,"screenRightBoundary",void 0),(0,L.Z)(this,"screenBottomBoundary",void 0),(0,L.Z)(this,"gridRightBoundary",void 0),(0,L.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=o,this.viewportPadding=Math.max(c,o),this.grid=new a(c+this.viewportPadding,o+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=o+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=o+2*this.viewportPadding}return(0,W.Z)(i,[{key:"placeCollisionBox",value:function(o){var s=o.x1+o.anchorPointX+this.viewportPadding,l=o.y1+o.anchorPointY+this.viewportPadding,d=o.x2+o.anchorPointX+this.viewportPadding,_=o.y2+o.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,d,_)||this.grid.hitTest(s,l,d,_)?{box:[]}:{box:[s,l,d,_]}}},{key:"insertCollisionBox",value:function(o,s){var l={featureIndex:s};this.grid.insert(l,o[0],o[1],o[2],o[3])}},{key:"project",value:function(o,s,l){var d=Nu.al(s,l,0,1),_=Nu.Ue(),T=za.fromValues.apply(za,(0,Ei.Z)(o));return Nu.fF(_,d,T),{x:(_[0]/_[3]+1)/2*this.width+this.viewportPadding,y:(-_[1]/_[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(o,s,l,d){return l>=0&&o<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),i}();function g(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=b(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){o=o.call(i)},n:function(){var k=o.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw T}}}}function b(i,c){if(!!i){if(typeof i=="string")return P(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return P(i,c)}}function P(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function D(i){var c=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0;break;default:o=.5}return{horizontalAlign:c,verticalAlign:o}}function H(i,c,o,s,l){if(!!l){var d=i[s],_=d.glyph;if(_)for(var T=c[_].advance*d.scale,I=(i[s].x+T)*l,k=o;k<=s;k++)i[k].x-=I}}function ae(i,c,o,s,l,d,_){var T=(c-o)*l,I=(-s*_+.5)*d,k=g(i),J;try{for(k.s();!(J=k.n()).done;){var $=J.value;$.x+=T,$.y+=I}}catch(_e){k.e(_e)}finally{k.f()}}function be(i,c,o,s,l,d,_){var T=-8,I=0,k=T,J=0,$=i.positionedGlyphs,_e=d==="right"?1:d==="left"?0:.5,Ne=$.length;o.forEach(function(Zr){if(Zr.split("").forEach(function(Rn){var Xn=c[Rn],Ci=0;Xn&&($.push({glyph:Rn,x:I,y:k+Ci,vertical:!1,scale:1,metrics:Xn}),I+=Xn.advance+_)}),$.length!==Ne){var xn=I-_;J=Math.max(xn,J),H($,c,Ne,$.length-1,_e)}I=0,k+=s});var mt=D(l),Bt=mt.horizontalAlign,mr=mt.verticalAlign;ae($,_e,Bt,mr,J,s,o.length);var Sr=k-T;i.top+=-mr*Sr,i.bottom=i.top+Sr,i.left+=-Bt*J,i.right=i.left+J}function we(i,c,o,s,l,d,_){var T=-8,I=0,k=T,J=0,$=i.positionedGlyphs,_e=d==="right"?1:d==="left"?0:.5,Ne=$.length;o.forEach(function(Zr){var xn=c[Zr],Rn=0;if(xn&&($.push({glyph:Zr,x:I,y:k+Rn,vertical:!1,scale:1,metrics:xn}),I+=xn.advance+_),$.length!==Ne){var Xn=I-_;J=Math.max(Xn,J),H($,c,Ne,$.length-1,_e)}I=0,k+=s});var mt=D(l),Bt=mt.horizontalAlign,mr=mt.verticalAlign;ae($,_e,Bt,mr,J,s,o.length);var Sr=k-T;i.top+=-mr*Sr,i.bottom=i.top+Sr,i.left+=-Bt*J,i.right=i.left+J}function Pe(i,c,o,s,l,d){var _=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],T=arguments.length>7?arguments[7]:void 0,I=i.split(`
`),k=[],J={positionedGlyphs:k,top:_[1],bottom:_[1],left:_[0],right:_[0],lineCount:I.length,text:i};return T?we(J,c,I,o,s,l,d):be(J,c,I,o,s,l,d),k.length?J:!1}function We(i){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],o=arguments.length>2?arguments[2]:void 0,s=i.positionedGlyphs,l=s===void 0?[]:s,d=[],_=g(l),T;try{for(_.s();!(T=_.n()).done;){var I=T.value,k=I.metrics,J=4,$=k.advance*I.scale/2,_e=o?[I.x+$,I.y]:[0,0],Ne=o?[0,0]:[I.x+$+c[0],I.y+c[1]],mt=(0-J)*I.scale-$+Ne[0],Bt=(0-J)*I.scale+Ne[1],mr=mt+k.width*I.scale,Sr=Bt+k.height*I.scale,Zr={x:mt,y:Bt},xn={x:mr,y:Bt},Rn={x:mt,y:Sr},Xn={x:mr,y:Sr};d.push({tl:Zr,tr:xn,bl:Rn,br:Xn,tex:k,glyphOffset:_e})}}catch(Ci){_.e(Ci)}finally{_.f()}return d}function Ve(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=nt(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){o=o.call(i)},n:function(){var k=o.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw T}}}}function nt(i,c){if(!!i){if(typeof i=="string")return ze(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ze(i,c)}}function ze(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function ot(i){var c=bt();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Zt=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,hr=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ur(i){var c=this,o=i.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[o])return{vertices:[],indices:[],size:7};var d=c.glyphInfoMap[o].centroid,_=d.length===2?[d[0],d[1],0]:d;return c.glyphInfoMap[o].glyphQuads.forEach(function(T,I){s.push.apply(s,(0,Ei.Z)(_).concat([T.tex.x,T.tex.y+T.tex.height,T.tl.x,T.tl.y],(0,Ei.Z)(_),[T.tex.x+T.tex.width,T.tex.y+T.tex.height,T.tr.x,T.tr.y],(0,Ei.Z)(_),[T.tex.x+T.tex.width,T.tex.y,T.br.x,T.br.y],(0,Ei.Z)(_),[T.tex.x,T.tex.y,T.bl.x,T.bl.y])),l.push(0+I*4,1+I*4,2+I*4,2+I*4,3+I*4,0+I*4)}),{vertices:s,indices:l,size:7}}var gr=function(i){(0,Be.Z)(o,i);var c=ot(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"glyphInfo",void 0),(0,L.Z)((0,N.Z)(s),"glyphInfoMap",{}),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"currentZoom",-1),(0,L.Z)((0,N.Z)(s),"extent",void 0),(0,L.Z)((0,N.Z)(s),"textureHeight",0),(0,L.Z)((0,N.Z)(s),"textCount",0),(0,L.Z)((0,N.Z)(s),"preTextStyle",{}),(0,L.Z)((0,N.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:hr,fragmentShader:Zt,triangulation:ur.bind((0,N.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.stroke,I=T===void 0?"#fff":T,k=l.strokeWidth,J=k===void 0?0:k,$=l.textAnchor,_e=$===void 0?"center":$,Ne=l.textAllowOverlap,mt=Ne===void 0?!1:Ne,Bt=l.halo,mr=Bt===void 0?.5:Bt,Sr=l.gamma,Zr=Sr===void 0?2:Sr,xn=this.fontService,Rn=xn.canvas,Xn=xn.mapping;if(Object.keys(Xn).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Xn).length),this.preTextStyle={textAnchor:_e,textAllowOverlap:mt},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeWidth:J,stroke:I})){this.judgeStyleAttributes({opacity:_,strokeWidth:J,stroke:I});var Ci=this.layer.getEncodedData(),Jn=this.calDataFrame(this.cellLength,Ci,this.cellProperties),Pi=Jn.data,aa=Jn.width,ma=Jn.height;this.rowCount=ma,this.dataTexture=this.cellLength>0&&Pi.length>0?this.createTexture2D({flipY:!0,data:Pi,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:aa,height:ma}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1,u_stroke_width:Hi()(J)?J:0,u_stroke_color:this.getStrokeColor(I),u_sdf_map:this.texture,u_halo_blur:mr,u_gamma_scale:Zr,u_sdf_map_size:[Rn.width,Rn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,_=d===void 0?"center":d,T=l.textAllowOverlap,I=T===void 0?!0:T;return this.preTextStyle={textAnchor:_,textAllowOverlap:I},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,_=d===void 0?!1:d,T=this.mapService.getZoom(),I=this.mapService.getBounds(),k=(0,et.oO)(this.extent,I);return!_&&(Math.abs(this.currentZoom-T)>1||!k)||_!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:A.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(d,_,T,I){var k=d.rotate,J=k===void 0?0:k;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:A.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(d,_,T,I){return[T[5],T[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(d,_,T,I){var k=d.size,J=k===void 0?12:k;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:A.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(d,_,T,I){return[T[3],T[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,et.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,_=d===void 0?"400":d,T=l.fontFamily,I=T===void 0?"sans-serif":T,k=this.layer.getEncodedData(),J=[];k.forEach(function($){var _e=$.shape,Ne=_e===void 0?"":_e;Ne=Ne.toString();var mt=Ve(Ne),Bt;try{for(mt.s();!(Bt=mt.n()).done;){var mr=Bt.value;J.indexOf(mr)===-1&&J.push(mr)}}catch(Sr){mt.e(Sr)}finally{mt.f()}}),this.fontService.setFontOptions({characterSet:J,fontWeight:_,fontFamily:I,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,_=d===void 0?"400":d,T=l.fontFamily,I=T===void 0?"sans-serif":T,k=this.layer.getEncodedData(),J=[];k.forEach(function($){var _e=$.shape,Ne=_e===void 0?"":_e;Ne=Ne.toString(),J.indexOf(Ne)===-1&&J.push(Ne)}),this.fontService.setFontOptions({characterSet:J,fontWeight:_,fontFamily:I,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,_=this.fontService.mapping,T=this.layer.getLayerConfig(),I=T.spacing,k=I===void 0?2:I,J=T.textAnchor,$=J===void 0?"center":J,_e=this.layer.getEncodedData();this.glyphInfo=_e.map(function(Ne){var mt=Ne.shape,Bt=mt===void 0?"":mt,mr=Ne.id,Sr=Ne.size,Zr=Sr===void 0?1:Sr,xn=Ne.textOffset,Rn=xn===void 0?[0,0]:xn,Xn=Pe(Bt.toString(),_,Zr,$,"center",k,Rn,l),Ci=We(Xn,Rn,!1);return Ne.shaping=Xn,Ne.glyphQuads=Ci,Ne.centroid=fi(Ne.coordinates),Ne.originCentroid=Ne.version==="GAODE2.x"?fi(Ne.originCoordinates):Ne.originCentroid=Ne.centroid,d.glyphInfoMap[mr]={shaping:Xn,glyphQuads:Ci,centroid:fi(Ne.coordinates)},Ne})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),_=d.padding,T=_===void 0?[4,4]:_,I=d.textAllowOverlap,k=I===void 0?!1:I;if(!k){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var J=this.rendererService.getViewportSize(),$=J.width,_e=J.height,Ne=new h($,_e),mt=this.glyphInfo.filter(function(Bt){var mr=Bt.shaping,Sr=Bt.id,Zr=Sr===void 0?0:Sr,xn=Bt.version==="GAODE2.x"?Bt.originCentroid:Bt.centroid,Rn=Bt.size,Xn=Rn/24,Ci=l.mapService.lngLatToContainer(xn),Jn=Ne.placeCollisionBox({x1:mr.left*Xn-T[0],x2:mr.right*Xn+T[0],y1:mr.top*Xn-T[1],y2:mr.bottom*Xn+T[1],anchorPointX:Ci.x,anchorPointY:Ci.y}),Pi=Jn.box;return Pi&&Pi.length?(Ne.insertCollisionBox(Pi,Zr),!0):!1});mt.forEach(function(Bt){l.glyphInfoMap[Bt.id]=Bt})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,_=d===void 0?!1:d;_?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(_)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:A.gl.LINEAR,min:A.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:hr,fragmentShader:Zt,triangulation:ur.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),o}(Ba),Nr={fill:bs,image:yc,normal:_c,extrude:Wi,text:gr,icon:Ku},an=Nr;function Hr(i){var c=In();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function In(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ni=function(i){(0,Be.Z)(o,i);var c=Hr(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","PointLayer"),s}return(0,W.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new an[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),_=d.shape2d,T=d.shape3d,I=this.iconService.getIconMap(),k=l.find(function($){return $.hasOwnProperty("shape")});if(k){var J=k.shape;return J==="dot"?"normal":(_==null?void 0:_.indexOf(J))!==-1?"fill":(T==null?void 0:T.indexOf(J))!==-1?"extrude":I.hasOwnProperty(J)?"image":this.fontService.getGlyph(J)!==""?"icon":"text"}else return"normal"}}]),o}(_o);function hi(i){var c=ii();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ii(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ea=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Bn=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,_i=function(i){(0,Be.Z)(o,i);var c=hi(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),k=I.data,J=I.width,$=I.height;this.rowCount=$,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:J,height:$}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:Bn,fragmentShader:ea,triangulation:Cu})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(d,_,T,I,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(d,_,T,I){var k=d.size,J=k===void 0?10:k;return Array.isArray(J)?[J[0]]:[J]}}})}}]),o}(Ba);function te(i){var c=q();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function q(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var R=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,F=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,ne=function(i){(0,Be.Z)(o,i);var c=te(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),k=I.data,J=I.width,$=I.height;this.rowCount=$,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:J,height:$}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:F,fragmentShader:R,triangulation:uc,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),o}(Ba),pe={fill:ne,line:ku,extrude:_i,text:gr,point_fill:bs,point_image:yc,point_normal:_c,point_extrude:Wi},ht=pe;function wt(i){var c=At();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function At(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var qt=function(i){(0,Be.Z)(o,i);var c=wt(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","PolygonLayer"),s}return(0,W.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new ht[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return _==="fill"?"fill":_==="extrude"?"extrude":_==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),_=d.shape2d,T=d.shape3d,I=this.iconService.getIconMap(),k=l.find(function($){return $.hasOwnProperty("shape")});if(k){var J=k.shape;return J==="dot"?"point_normal":(_==null?void 0:_.indexOf(J))!==-1?"point_fill":(T==null?void 0:T.indexOf(J))!==-1?"point_extrude":I.hasOwnProperty(J)?"point_image":"text"}else return"fill"}}]),o}(_o);function Pr(i){var c=vn();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function vn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var zn=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,$n=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,xi=function(i){(0,Be.Z)(o,i);var c=Pr(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"colorTexture",void 0),s}return(0,W.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,_=d===void 0?1:d,T=l.clampLow,I=T===void 0?!0:T,k=l.clampHigh,J=k===void 0?!0:k,$=l.noDataValue,_e=$===void 0?-9999999:$,Ne=l.domain,mt=Ne===void 0?[0,1]:Ne;return this.updateColorTexure(),{u_opacity:_||1,u_texture:this.texture,u_domain:mt,u_clampLow:I,u_clampHigh:typeof J!="undefined"?J:I,u_noDataValue:_e,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,_=l.data.dataArray[0];this.texture=d({data:_.data,width:_.width,height:_.height,format:A.gl.LUMINANCE,type:A.gl.FLOAT});var T=this.layer.getLayerConfig(),I=T.rampColors,k=(0,et.Cl)(I);return this.colorTexture=d({data:k.data,width:k.width,height:k.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:$n,fragmentShader:zn,triangulation:Au,primitive:A.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(d,_,T,I){return[T[3],T[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),_=d.rampColors,T=(0,et.Cl)(_);this.colorTexture=l({data:T.data,width:T.width,height:T.height,flipY:!1})}}]),o}(Ba),li={raster:xi,raster3d:xi},Zi=li;function $i(i){var c=ba();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ba(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var oo=function(i){(0,Be.Z)(o,i);var c=$i(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return s=c.call.apply(c,[this].concat(d)),(0,L.Z)((0,N.Z)(s),"type","RasterLayer"),s}return(0,W.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Zi[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),o}(_o),Ia=E(50361),ho=E.n(Ia),Va,ta,da,Na,ha,Pa,Eo,Fo,oa;function Uo(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function po(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Uo(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Uo(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var tu=(Va=(0,Et.b2)(),ta=(0,Et.f3)(A.vK.IGlobalConfigService),da=(0,Et.f3)(A.vK.IMapService),Na=(0,Et.f3)(A.vK.IFontService),Va(ha=(Pa=function(){function i(){(0,Y.Z)(this,i),(0,oi.Z)(this,"configService",Eo,this),(0,oi.Z)(this,"mapService",Fo,this),(0,oi.Z)(this,"fontService",oa,this)}return(0,W.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(o,{styleAttributeService:d})}),o.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return o.dataState.dataMappingNeedUpdate=!1,l.generateMaping(o,{styleAttributeService:d}),!0}),o.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!o.layerModelNeedUpdate){var _=d.getLayerStyleAttributes()||[],T=d.getLayerStyleAttribute("filter"),I=o.getSource().data.dataArray,k=_.filter(function($){return $.needRemapping}),J=I;T!=null&&T.needRemapping&&T!==null&&T!==void 0&&T.scale&&(J=I.filter(function($){return l.applyAttributeMapping(T,$)[0]})),k.length&&(T!=null&&T.needRemapping?(o.setEncodedData(l.mapping(_,J)),T.needRemapping=!1):o.setEncodedData(l.mapping(k,J,o.getEncodedData())),o.emit("remapping",null))}})}},{key:"generateMaping",value:function(o,s){var l=this,d=s.styleAttributeService,_=d.getLayerStyleAttributes()||[],T=d.getLayerStyleAttribute("filter"),I=o.getSource().data.dataArray,k=I;T!=null&&T.scale&&(k=I.filter(function(J){return l.applyAttributeMapping(T,J)[0]})),o.setEncodedData(this.mapping(_,k))}},{key:"mapping",value:function(o,s,l){var d=this,_=s.map(function(T,I){var k=l?l[I]:{},J=po({id:T._id,coordinates:T.coordinates},k);return o.filter(function($){return $.scale!==void 0}).forEach(function($){var _e=d.applyAttributeMapping($,T);$.needRemapping=!1,$.name==="color"&&(_e=_e.map(function(Ne){return(0,et.CI)(Ne)})),J[$.name]=Array.isArray(_e)&&_e.length===1?_e[0]:_e,$.name==="shape"&&(J.shape=d.fontService.getIconFontKey(J[$.name]))}),J});return _.length>0&&this.mapService.version==="GAODE2.x"&&(typeof _[0].coordinates[0]=="number"?_.map(function(T){T.version="GAODE2.x",T.originCoordinates=ho()(T.coordinates),T.coordinates=d.mapService.lngLatToCoord(T.coordinates)}):_.map(function(T){T.version="GAODE2.x",T.originCoordinates=ho()(T.coordinates),T.coordinates=d.mapService.lngLatToCoords(T.coordinates)})),_}},{key:"applyAttributeMapping",value:function(o,s){var l;if(!o.scale)return[];var d=(o==null||(l=o.scale)===null||l===void 0?void 0:l.scalers)||[],_=[];return d.forEach(function(T){var I,k=T.field;(s.hasOwnProperty(k)||((I=o.scale)===null||I===void 0?void 0:I.type)==="variable")&&_.push(s[k])}),o.mapping?o.mapping(_):[]}}]),i}(),Eo=(0,ri.Z)(Pa.prototype,"configService",[ta],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fo=(0,ri.Z)(Pa.prototype,"mapService",[da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oa=(0,ri.Z)(Pa.prototype,"fontService",[Na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pa))||ha),xc={},Dl={},Ju=function(c){return Dl[c]},hu=function(c,o){Dl[c]=o},Fl=function(c){return xc[c]},Vs=function(c,o){xc[c]=o},vl={},ml={},pu=34,Mo=10,qc=13;function ef(i){return new Function("d","return {"+i.map(function(c,o){return JSON.stringify(c)+": d["+o+'] || ""'}).join(",")+"}")}function pf(i,c){var o=ef(i);return function(s,l){return c(o(s),l,i)}}function Rf(i){var c=Object.create(null),o=[];return i.forEach(function(s){for(var l in s)l in c||o.push(c[l]=l)}),o}function ru(i,c){var o=i+"",s=o.length;return s<c?new Array(c-s+1).join(0)+o:o}function tf(i){return i<0?"-"+ru(-i,6):i>9999?"+"+ru(i,6):ru(i,4)}function bc(i){var c=i.getUTCHours(),o=i.getUTCMinutes(),s=i.getUTCSeconds(),l=i.getUTCMilliseconds();return isNaN(i)?"Invalid Date":tf(i.getUTCFullYear(),4)+"-"+ru(i.getUTCMonth()+1,2)+"-"+ru(i.getUTCDate(),2)+(l?"T"+ru(c,2)+":"+ru(o,2)+":"+ru(s,2)+"."+ru(l,3)+"Z":s?"T"+ru(c,2)+":"+ru(o,2)+":"+ru(s,2)+"Z":o||c?"T"+ru(c,2)+":"+ru(o,2)+"Z":"")}function _p(i){var c=new RegExp('["'+i+`
\r]`),o=i.charCodeAt(0);function s($,_e){var Ne,mt,Bt=l($,function(mr,Sr){if(Ne)return Ne(mr,Sr-1);mt=mr,Ne=_e?pf(mr,_e):ef(mr)});return Bt.columns=mt||[],Bt}function l($,_e){var Ne=[],mt=$.length,Bt=0,mr=0,Sr,Zr=mt<=0,xn=!1;$.charCodeAt(mt-1)===Mo&&--mt,$.charCodeAt(mt-1)===qc&&--mt;function Rn(){if(Zr)return ml;if(xn)return xn=!1,vl;var Ci,Jn=Bt,Pi;if($.charCodeAt(Jn)===pu){for(;Bt++<mt&&$.charCodeAt(Bt)!==pu||$.charCodeAt(++Bt)===pu;);return(Ci=Bt)>=mt?Zr=!0:(Pi=$.charCodeAt(Bt++))===Mo?xn=!0:Pi===qc&&(xn=!0,$.charCodeAt(Bt)===Mo&&++Bt),$.slice(Jn+1,Ci-1).replace(/""/g,'"')}for(;Bt<mt;){if((Pi=$.charCodeAt(Ci=Bt++))===Mo)xn=!0;else if(Pi===qc)xn=!0,$.charCodeAt(Bt)===Mo&&++Bt;else if(Pi!==o)continue;return $.slice(Jn,Ci)}return Zr=!0,$.slice(Jn,mt)}for(;(Sr=Rn())!==ml;){for(var Xn=[];Sr!==vl&&Sr!==ml;)Xn.push(Sr),Sr=Rn();_e&&(Xn=_e(Xn,mr++))==null||Ne.push(Xn)}return Ne}function d($,_e){return $.map(function(Ne){return _e.map(function(mt){return J(Ne[mt])}).join(i)})}function _($,_e){return _e==null&&(_e=Rf($)),[_e.map(J).join(i)].concat(d($,_e)).join(`
`)}function T($,_e){return _e==null&&(_e=Rf($)),d($,_e).join(`
`)}function I($){return $.map(k).join(`
`)}function k($){return $.map(J).join(i)}function J($){return $==null?"":$ instanceof Date?bc($):c.test($+="")?'"'+$.replace(/"/g,'""')+'"':$}return{parse:s,parseRows:l,format:_,formatBody:T,formatRows:I,formatRow:k,formatValue:J}}var Bl=_p(","),nh=Bl.parse,Sc=Bl.parseRows,df=Bl.format,Vp=Bl.formatBody,vf=Bl.formatRows,Dh=Bl.formatRow,Gp=Bl.formatValue,xp=E(6563),ih=E.n(xp);function Fh(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function kf(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Fh(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Fh(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Bh(i,c){var o=c.x,s=c.y,l=c.x1,d=c.y1,_=c.coordinates,T=[];return i.forEach(function(I,k){var J=[];if(o&&s&&(J=[parseFloat(I[o]),parseFloat(I[s])]),o&&s&&l&&d){var $=[parseFloat(I[o]),parseFloat(I[s])],_e=[parseFloat(I[l]),parseFloat(I[d])];J=[$,_e]}if(_){var Ne="Polygon";Array.isArray(_[0])||(Ne="Point"),Array.isArray(_[0])&&!Array.isArray(_[0][0])&&(Ne="LineString");var mt={type:Ne,coordinates:(0,Ei.Z)(I[_])};ih()(mt,!0),J=mt.coordinates}var Bt=kf(kf({},I),{},{_id:k,coordinates:J});T.push(Bt)}),{dataArray:T}}function rf(i,c){var o=nh(i);return Bh(o,c)}var Nh=E(40271);function is(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Df(i){if(Array.isArray(i))return i;if(i.type==="Feature"){if(i.geometry!==null)return i.geometry.coordinates}else if(i.coordinates)return i.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function zh(i){if(i.length>1&&isNumber(i[0])&&isNumber(i[1]))return!0;if(Array.isArray(i[0])&&i[0].length)return zh(i[0]);throw new Error("coordinates must only contain numbers")}function ah(i,c,o){if(!c||!o)throw new Error("type and name required");if(!i||i.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+i.type)}function oh(i,c,o){if(!i)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!i||i.type!=="Feature"||!i.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!i.geometry||i.geometry.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+i.geometry.type)}function nf(i,c,o){if(!i)throw new Error("No featureCollection passed");if(!o)throw new Error(".collectionOf() requires a name");if(!i||i.type!=="FeatureCollection")throw new Error("Invalid input to "+o+", FeatureCollection required");for(var s=0,l=i.features;s<l.length;s++){var d=l[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!d.geometry||d.geometry.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+d.geometry.type)}}function Ff(i){return i.type==="Feature"?i.geometry:i}function Bf(i,c){return i.type==="FeatureCollection"?"FeatureCollection":i.type==="GeometryCollection"?"GeometryCollection":i.type==="Feature"&&i.geometry!==null?i.geometry.type:i.type}function yl(i,c,o){if(i!==null)for(var s,l,d,_,T,I,k,J=0,$=0,_e,Ne=i.type,mt=Ne==="FeatureCollection",Bt=Ne==="Feature",mr=mt?i.features.length:1,Sr=0;Sr<mr;Sr++){k=mt?i.features[Sr].geometry:Bt?i.geometry:i,_e=k?k.type==="GeometryCollection":!1,T=_e?k.geometries.length:1;for(var Zr=0;Zr<T;Zr++){var xn=0,Rn=0;if(_=_e?k.geometries[Zr]:k,_!==null){I=_.coordinates;var Xn=_.type;switch(J=o&&(Xn==="Polygon"||Xn==="MultiPolygon")?1:0,Xn){case null:break;case"Point":if(c(I,$,Sr,xn,Rn)===!1)return!1;$++,xn++;break;case"LineString":case"MultiPoint":for(s=0;s<I.length;s++){if(c(I[s],$,Sr,xn,Rn)===!1)return!1;$++,Xn==="MultiPoint"&&xn++}Xn==="LineString"&&xn++;break;case"Polygon":case"MultiLineString":for(s=0;s<I.length;s++){for(l=0;l<I[s].length-J;l++){if(c(I[s][l],$,Sr,xn,Rn)===!1)return!1;$++}Xn==="MultiLineString"&&xn++,Xn==="Polygon"&&Rn++}Xn==="Polygon"&&xn++;break;case"MultiPolygon":for(s=0;s<I.length;s++){for(Rn=0,l=0;l<I[s].length;l++){for(d=0;d<I[s][l].length-J;d++){if(c(I[s][l][d],$,Sr,xn,Rn)===!1)return!1;$++}Rn++}xn++}break;case"GeometryCollection":for(s=0;s<_.geometries.length;s++)if(yl(_.geometries[s],c,o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Nf(i,c,o,s){var l=o;return yl(i,function(d,_,T,I,k){_===0&&o===void 0?l=d:l=c(l,d,_,T,I,k)},s),l}function af(i,c){var o;switch(i.type){case"FeatureCollection":for(o=0;o<i.features.length&&c(i.features[o].properties,o)!==!1;o++);break;case"Feature":c(i.properties,0);break}}function sh(i,c,o){var s=o;return af(i,function(l,d){d===0&&o===void 0?s=l:s=c(s,l,d)}),s}function Ec(i,c){if(i.type==="Feature")c(i,0);else if(i.type==="FeatureCollection")for(var o=0;o<i.features.length&&c(i.features[o],o)!==!1;o++);}function Uh(i,c,o){var s=o;return Ec(i,function(l,d){d===0&&o===void 0?s=l:s=c(s,l,d)}),s}function mf(i){var c=[];return yl(i,function(o){c.push(o)}),c}function yf(i,c){var o,s,l,d,_,T,I,k,J,$,_e=0,Ne=i.type==="FeatureCollection",mt=i.type==="Feature",Bt=Ne?i.features.length:1;for(o=0;o<Bt;o++){for(T=Ne?i.features[o].geometry:mt?i.geometry:i,k=Ne?i.features[o].properties:mt?i.properties:{},J=Ne?i.features[o].bbox:mt?i.bbox:void 0,$=Ne?i.features[o].id:mt?i.id:void 0,I=T?T.type==="GeometryCollection":!1,_=I?T.geometries.length:1,l=0;l<_;l++){if(d=I?T.geometries[l]:T,d===null){if(c(null,_e,k,J,$)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(d,_e,k,J,$)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(c(d.geometries[s],_e,k,J,$)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_e++}}function gf(i,c,o){var s=o;return yf(i,function(l,d,_,T,I){d===0&&o===void 0?s=l:s=c(s,l,d,_,T,I)}),s}function Nl(i,c){yf(i,function(o,s,l,d,_){var T=o===null?null:o.type;switch(T){case null:case"Point":case"LineString":case"Polygon":return c((0,Nh.zL)(o,l,{bbox:d,id:_}),s,0)===!1?!1:void 0}var I;switch(T){case"MultiPoint":I="Point";break;case"MultiLineString":I="LineString";break;case"MultiPolygon":I="Polygon";break}for(var k=0;k<o.coordinates.length;k++){var J=o.coordinates[k],$={type:I,coordinates:J};if(c((0,Nh.zL)($,l),s,k)===!1)return!1}})}function bu(i,c,o){var s=o;return Nl(i,function(l,d,_){d===0&&_===0&&o===void 0?s=l:s=c(s,l,d,_)}),s}function _f(i,c){Nl(i,function(o,s,l){var d=0;if(!!o.geometry){var _=o.geometry.type;if(!(_==="Point"||_==="MultiPoint")){var T,I=0,k=0,J=0;if(yl(o,function($,_e,Ne,mt,Bt){if(T===void 0||s>I||mt>k||Bt>J){T=$,I=s,k=mt,J=Bt,d=0;return}var mr=lineString([T,$],o.properties);if(c(mr,s,l,Bt,d)===!1)return!1;d++,T=$})===!1)return!1}}})}function zf(i,c,o){var s=o,l=!1;return _f(i,function(d,_,T,I,k){l===!1&&o===void 0?s=d:s=c(s,d,_,T,I,k),l=!0}),s}function xf(i,c){if(!i)throw new Error("geojson is required");Nl(i,function(o,s,l){if(o.geometry!==null){var d=o.geometry.type,_=o.geometry.coordinates;switch(d){case"LineString":if(c(o,s,l,0,0)===!1)return!1;break;case"Polygon":for(var T=0;T<_.length;T++)if(c(lineString(_[T],o.properties),s,l,T)===!1)return!1;break}}})}function Zh(i,c,o){var s=o;return xf(i,function(l,d,_,T){d===0&&o===void 0?s=l:s=c(s,l,d,_,T)}),s}function bf(i,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var o=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.segmentIndex||0,_=c.properties,T;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),_=_||i.features[o].properties,T=i.features[o].geometry;break;case"Feature":_=_||i.properties,T=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":T=i;break;default:throw new Error("geojson is invalid")}if(T===null)return null;var I=T.coordinates;switch(T.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=I.length+d-1),lineString([I[d],I[d+1]],_,c);case"Polygon":return l<0&&(l=I.length+l),d<0&&(d=I[l].length+d-1),lineString([I[l][d],I[l][d+1]],_,c);case"MultiLineString":return s<0&&(s=I.length+s),d<0&&(d=I[s].length+d-1),lineString([I[s][d],I[s][d+1]],_,c);case"MultiPolygon":return s<0&&(s=I.length+s),l<0&&(l=I[s].length+l),d<0&&(d=I[s][l].length-d-1),lineString([I[s][l][d],I[s][l][d+1]],_,c)}throw new Error("geojson is invalid")}function gl(i,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var o=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.coordIndex||0,_=c.properties,T;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),_=_||i.features[o].properties,T=i.features[o].geometry;break;case"Feature":_=_||i.properties,T=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":T=i;break;default:throw new Error("geojson is invalid")}if(T===null)return null;var I=T.coordinates;switch(T.type){case"Point":return point(I,_,c);case"MultiPoint":return s<0&&(s=I.length+s),point(I[s],_,c);case"LineString":return d<0&&(d=I.length+d),point(I[d],_,c);case"Polygon":return l<0&&(l=I.length+l),d<0&&(d=I[l].length+d),point(I[l][d],_,c);case"MultiLineString":return s<0&&(s=I.length+s),d<0&&(d=I[s].length+d),point(I[s][d],_,c);case"MultiPolygon":return s<0&&(s=I.length+s),l<0&&(l=I[s].length+l),d<0&&(d=I[s][l].length-d),point(I[s][l][d],_,c)}throw new Error("geojson is invalid")}function uh(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Uf(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?uh(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):uh(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function jh(i,c){var o=[],s={};if(i.features=i.features.filter(function(d){var _=d.geometry;return d!=null&&_&&_.type&&_.coordinates&&_.coordinates.length>0}),ih()(i,!0),i.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return Nl(i,function(d,_){var T=Df(d),I=_,k=Uf(Uf({},d.properties),{},{coordinates:T,_id:I});o.push(k)}),{dataArray:o,featureKeys:s}}function lh(i,c){var o=c.extent,s=new Promise(function(d){bp(i,function(_){d(_)})}),l={images:s,_id:1,dataArray:[{_id:0,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return l}function bp(i,c){var o=i,s=[];if(typeof o=="string")(0,et.gJ)({url:o},function(_,T){s.push(T),c(s)});else{var l=o.length,d=0;o.forEach(function(_){(0,et.gJ)({url:_},function(T,I){d++,s.push(I),d===l&&c(s)})})}return lh}function wc(i,c){var o=c.extent,s=c.width,l=c.height,d=c.min,_=c.max,T={_id:1,dataArray:[{_id:1,data:Array.from(i),width:s,height:l,min:d,max:_,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return T}var Uc=E(30236),Vh=E.n(Uc);function Sf(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function of(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Sf(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Sf(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function zu(i,c){var o=c.radius,s=o===void 0?40:o,l=c.maxZoom,d=l===void 0?18:l,_=c.minZoom,T=_===void 0?0:_,I=c.zoom,k=I===void 0?2:I;if(i.pointIndex){var J=i.pointIndex.getClusters(i.extent,Math.floor(k));return i.dataArray=Sp(J),i}var $=new(ir())({radius:s,minZoom:T,maxZoom:d}),_e={type:"FeatureCollection",features:[]};return _e.features=i.dataArray.map(function(Ne){return{type:"Feature",geometry:{type:"Point",coordinates:Ne.coordinates},properties:of({},Ne)}}),$.load(_e.features),$}function Sp(i){return i.map(function(c,o){return of({coordinates:c.geometry.coordinates,_id:o+1},c.properties)})}function zl(i){if(i.length===0)throw new Error("max requires at least one data point");for(var c=i[0],o=1;o<i.length;o++)i[o]>c&&(c=i[o]);return c}function Gh(i){if(i.length===0)throw new Error("min requires at least one data point");for(var c=i[0],o=1;o<i.length;o++)i[o]<c&&(c=i[o]);return c}function _l(i){if(i.length===0)return 0;for(var c=i[0],o=0,s,l=1;l<i.length;l++)s=c+i[l]*1,Math.abs(c)>=Math.abs(i[l])?o+=c-s+i[l]:o+=i[l]-s+c,c=s;return c+o*1}function rc(i){if(i.length===0)throw new Error("mean requires at least one data point");return _l(i)/i.length}var Hh={min:Gh,max:zl,mean:rc,sum:_l};function ch(i,c){return i.map(function(o){return o[c]*1})}function Ef(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function fh(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Ef(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ef(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ps(i){var c=Zo();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Zo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function as(i,c){if(Array.isArray(c))return c}var du=function(i){(0,Be.Z)(o,i);var c=ps(o);function o(s,l){var d;return(0,Y.Z)(this,o),d=c.call(this),(0,L.Z)((0,N.Z)(d),"data",void 0),(0,L.Z)((0,N.Z)(d),"extent",void 0),(0,L.Z)((0,N.Z)(d),"hooks",{init:new yi.ni}),(0,L.Z)((0,N.Z)(d),"parser",{type:"geojson"}),(0,L.Z)((0,N.Z)(d),"transforms",[]),(0,L.Z)((0,N.Z)(d),"cluster",!1),(0,L.Z)((0,N.Z)(d),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,L.Z)((0,N.Z)(d),"mapService",void 0),(0,L.Z)((0,N.Z)(d),"invalidExtent",!1),(0,L.Z)((0,N.Z)(d),"originData",void 0),(0,L.Z)((0,N.Z)(d),"rawData",void 0),(0,L.Z)((0,N.Z)(d),"cfg",{}),(0,L.Z)((0,N.Z)(d),"clusterIndex",void 0),d.originData=s,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,W.Z)(o,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,_=this.clusterOptions,T=_.method,I=T===void 0?"sum":T,k=_.field,J=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,J.forEach(function($){$.id||($.properties.point_count=1)}),(k||ya()(I))&&(J=J.map(function($){var _e=$.id;if(_e){var Ne=d.clusterIndex.getLeaves(_e,Infinity),mt=Ne.map(function(Sr){return Sr.properties}),Bt;if(lo()(I)&&k){var mr=ch(mt,k);Bt=Hh[I](mr)}ya()(I)&&(Bt=I(mt)),$.properties.stat=Bt}else $.properties.point_count=1;return $})),this.data=Ju("geojson")({type:"FeatureCollection",features:J}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,_=d===void 0?"geojson":d;if(_==="geojson"&&!this.cluster){var T=l<this.originData.features.length?this.originData.features[l]:"null",I=ho()(T);if(this.transforms.length!==0){var k=this.data.dataArray.find(function(J){return J._id===l});I.properties=k}return I}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var _=this.data.dataArray.find(function(T){return T[l]===name});return _==null?void 0:_._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,et.yA)((0,et.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=Vh()(this.cfg,l,as);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=fh(fh({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",_=Ju(d);this.data=_(this.originData,l),this.extent=(0,et.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(_){var T=_.type,I=Fl(T)(l.data,_);Object.assign(l.data,I)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=zu(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),o}(Yt.EventEmitter);function hh(i,c){var o=c.callback;return o&&(i.dataArray=i.dataArray.filter(o)),i}function Wh(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=Xh(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,T;return{s:function(){o=o.call(i)},n:function(){var k=o.next();return d=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw T}}}}function Xh(i,c){if(!!i){if(typeof i=="string")return Yh(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Yh(i,c)}}function Yh(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}var ph=6378e3;function Kh(i,c){var o=i.dataArray,s=c.size,l=s===void 0?10:s,d=l/(2*Math.PI*ph)*(256<<20)/2,_=$h(o,l),T=_.gridHash,I=_.gridOffset,k=Jh(T,I,c);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:k}}function $h(i,c){var o=Infinity,s=-Infinity,l,d=Wh(i),_;try{for(d.s();!(_=d.n()).done;){var T=_.value;l=T.coordinates[1],Number.isFinite(l)&&(o=l<o?l:o,s=l>s?l:s)}}catch(xn){d.e(xn)}finally{d.f()}var I=(o+s)/2,k=Ep(c,I);if(k.xOffset<=0||k.yOffset<=0)return{gridHash:{},gridOffset:k};var J={},$=Wh(i),_e;try{for($.s();!(_e=$.n()).done;){var Ne=_e.value,mt=Ne.coordinates[1],Bt=Ne.coordinates[0];if(Number.isFinite(mt)&&Number.isFinite(Bt)){var mr=Math.floor((mt+90)/k.yOffset),Sr=Math.floor((Bt+180)/k.xOffset),Zr="".concat(mr,"-").concat(Sr);J[Zr]=J[Zr]||{count:0,points:[]},J[Zr].count+=1,J[Zr].points.push(Ne)}}}catch(xn){$.e(xn)}finally{$.f()}return{gridHash:J,gridOffset:k}}function Ep(i,c){var o=wp(i),s=wf(c,i);return{yOffset:o,xOffset:s}}function wp(i){return i/ph*(180/Math.PI)}function wf(i,c){return c/ph*(180/Math.PI)/Math.cos(i*Math.PI/180)}function Jh(i,c,o){return Object.keys(i).reduce(function(s,l,d){var _=l.split("-"),T=parseInt(_[0],10),I=parseInt(_[1],10),k={};if(o.field&&o.method){var J=et.a5.getColumn(i[l].points,o.field);k[o.method]=et.a5.statMap[o.method](J)}return Object.assign(k,{_id:d,coordinates:(0,et.Z)([-180+c.xOffset*(I+.5),-90+c.yOffset*(T+.5)]),rawData:i[l].points,count:i[l].count}),s.push(k),s},[])}var Cc=Math.PI/3,Cf=[0,Cc,2*Cc,3*Cc,4*Cc,5*Cc];function Ja(i){return i[0]}function Qh(i){return i[1]}function nc(){var i=0,c=0,o=1,s=1,l=Ja,d=Qh,_,T,I;function k($){var _e={},Ne=[],mt,Bt=$.length;for(mt=0;mt<Bt;++mt)if(!(isNaN(Sr=+l.call(null,mr=$[mt],mt,$))||isNaN(Zr=+d.call(null,mr,mt,$)))){var mr,Sr,Zr,xn=Math.round(Zr=Zr/I),Rn=Math.round(Sr=Sr/T-(xn&1)/2),Xn=Zr-xn;if(Math.abs(Xn)*3>1){var Ci=Sr-Rn,Jn=Rn+(Sr<Rn?-1:1)/2,Pi=xn+(Zr<xn?-1:1),aa=Sr-Jn,ma=Zr-Pi;Ci*Ci+Xn*Xn>aa*aa+ma*ma&&(Rn=Jn+(xn&1?1:-1)/2,xn=Pi)}var di=Rn+"-"+xn,Ma=_e[di];Ma?Ma.push(mr):(Ne.push(Ma=_e[di]=[mr]),Ma.x=(Rn+(xn&1)/2)*T,Ma.y=xn*I)}return Ne}function J($){var _e=0,Ne=0;return Cf.map(function(mt){var Bt=Math.sin(mt)*$,mr=-Math.cos(mt)*$,Sr=Bt-_e,Zr=mr-Ne;return _e=Bt,Ne=mr,[Sr,Zr]})}return k.hexagon=function($){return"m"+J($==null?_:+$).join("l")+"z"},k.centers=function(){for(var $=[],_e=Math.round(c/I),Ne=Math.round(i/T),mt=_e*I;mt<s+_;mt+=I,++_e)for(var Bt=Ne*T+(_e&1)*T/2;Bt<o+T/2;Bt+=T)$.push([Bt,mt]);return $},k.mesh=function(){var $=J(_).slice(0,4).join("l");return k.centers().map(function(_e){return"M"+_e+"m"+$}).join("")},k.x=function($){return arguments.length?(l=$,k):l},k.y=function($){return arguments.length?(d=$,k):d},k.radius=function($){return arguments.length?(_=+$,T=_*2*Math.sin(Cc),I=_*1.5,k):_},k.size=function($){return arguments.length?(i=c=0,o=+$[0],s=+$[1],k):[o-i,s-c]},k.extent=function($){return arguments.length?(i=+$[0][0],c=+$[0][1],o=+$[1][0],s=+$[1][1],k):[[i,c],[o,s]]},k.radius(1)}function Ac(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function dh(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Ac(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ac(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var V=6378e3;function Me(i,c){var o=i.dataArray,s=c.size,l=s===void 0?10:s,d=c.method,_=d===void 0?"sum":d,T=l/(2*Math.PI*V)*(256<<20)/2,I=o.map(function(_e){var Ne=(0,et.Z)(_e.coordinates),mt=(0,Q.Z)(Ne,2),Bt=mt[0],mr=mt[1];return dh(dh({},_e),{},{coordinates:[Bt,mr]})}),k=nc().radius(T).x(function(_e){return _e.coordinates[0]}).y(function(_e){return _e.coordinates[1]}),J=k(I),$={dataArray:J.map(function(_e,Ne){var mt;if(c.field&&_){var Bt=et.a5.getColumn(_e,c.field);_e[_]=et.a5.statMap[_](Bt)}return mt={},(0,L.Z)(mt,c.method,_e[_]),(0,L.Z)(mt,"count",_e.length),(0,L.Z)(mt,"rawData",_e),(0,L.Z)(mt,"coordinates",[_e.x,_e.y]),(0,L.Z)(mt,"_id",Ne),mt}),radius:T,xOffset:T,yOffset:T,type:"hexagon"};return $}function $e(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function ar(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?$e(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):$e(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Mr(i,c){var o=c.sourceField,s=c.targetField,l=c.data,d={};return l.forEach(function(_){d[_[o]]=_}),i.dataArray=i.dataArray.map(function(_){var T=_[s];return ar(ar({},_),d[T])}),i}function rr(i,c){var o=c.callback;return o&&(i.dataArray=i.dataArray.map(o)),i}var Er=E(4771),Fr=du;hu("geojson",jh),hu("image",lh),hu("csv",rf),hu("json",Bh),hu("raster",wc),Vs("cluster",zu),Vs("filter",hh),Vs("join",Mr),Vs("map",rr),Vs("grid",Kh),Vs("hexagon",Me);var Gr,Kr,Qr=(Gr=(0,Et.b2)(),Gr(Kr=function(){function i(){(0,Y.Z)(this,i),(0,L.Z)(this,"mapService",void 0)}return(0,W.Z)(i,[{key:"apply",value:function(o){var s=this;this.mapService=o.getContainer().get(A.vK.IMapService),o.hooks.init.tap("DataSourcePlugin",function(){var l=o.getSource();if(!l){var d=o.sourceOption,_=d.data,T=d.options;o.setSource(new Fr(_,T))}s.updateClusterData(o)}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(o),d=o.dataState.dataSourceNeedUpdate;return o.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(o){var s=o.getSource(),l=s.cluster,d=s.clusterOptions,_=d.zoom,T=_===void 0?0:_,I=d.maxZoom,k=I===void 0?16:I,J=this.mapService.getZoom()-1,$=o.dataState.dataSourceNeedUpdate;return l&&($||Math.abs(T-J)>1)&&k>T?(s.updateClusterData(Math.floor(J)),!0):!1}}]),i}())||Kr),tn=E(44908),pn=E.n(tn),Wr=E(14293),en=E.n(Wr);function Ot(i,c){return i<c?-1:i>c?1:i>=c?0:NaN}function pr(i){return i.length===1&&(i=Yr(i)),{left:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;i(c[d],o)<0?s=d+1:l=d}return s},right:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;i(c[d],o)>0?l=d:s=d+1}return s}}}function Yr(i){return function(c,o){return Ot(i(c),o)}}var Cn=pr(Ot),Ar=Cn.right,wn=Cn.left,qr=Ar;function ci(i,c){var o=i.length,s=-1,l,d,_;if(c==null){for(;++s<o;)if((l=i[s])!=null&&l>=l)for(d=_=l;++s<o;)(l=i[s])!=null&&(d>l&&(d=l),_<l&&(_=l))}else for(;++s<o;)if((l=c(i[s],s,i))!=null&&l>=l)for(d=_=l;++s<o;)(l=c(i[s],s,i))!=null&&(d>l&&(d=l),_<l&&(_=l));return[d,_]}var Tr=Array.prototype,br=Tr.slice,Wn=Tr.map,hn=Math.sqrt(50),$r=Math.sqrt(10),gn=Math.sqrt(2);function Sn(i,c,o){var s,l=-1,d,_,T;if(c=+c,i=+i,o=+o,i===c&&o>0)return[i];if((s=c<i)&&(d=i,i=c,c=d),(T=Ri(i,c,o))===0||!isFinite(T))return[];if(T>0)for(i=Math.ceil(i/T),c=Math.floor(c/T),_=new Array(d=Math.ceil(c-i+1));++l<d;)_[l]=(i+l)*T;else for(i=Math.floor(i*T),c=Math.ceil(c*T),_=new Array(d=Math.ceil(i-c+1));++l<d;)_[l]=(i-l)/T;return s&&_.reverse(),_}function Ri(i,c,o){var s=(c-i)/Math.max(0,o),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=hn?10:d>=$r?5:d>=gn?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=hn?10:d>=$r?5:d>=gn?2:1)}function Ii(i,c,o){var s=Math.abs(c-i)/Math.max(0,o),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=hn?l*=10:d>=$r?l*=5:d>=gn&&(l*=2),c<i?-l:l}function Tn(){var i=identity,c=extent,o=sturges;function s(l){var d,_=l.length,T,I=new Array(_);for(d=0;d<_;++d)I[d]=i(l[d],d,l);var k=c(I),J=k[0],$=k[1],_e=o(I,J,$);Array.isArray(_e)||(_e=tickStep(J,$,_e),_e=range(Math.ceil(J/_e)*_e,$,_e));for(var Ne=_e.length;_e[0]<=J;)_e.shift(),--Ne;for(;_e[Ne-1]>$;)_e.pop(),--Ne;var mt=new Array(Ne+1),Bt;for(d=0;d<=Ne;++d)Bt=mt[d]=[],Bt.x0=d>0?_e[d-1]:J,Bt.x1=d<Ne?_e[d]:$;for(d=0;d<_;++d)T=I[d],J<=T&&T<=$&&mt[bisect(_e,T,0,Ne)].push(l[d]);return mt}return s.value=function(l){return arguments.length?(i=typeof l=="function"?l:constant(l),s):i},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):o},s}function An(i,c,o){return i=map.call(i,number).sort(ascending),Math.ceil((o-c)/(2*(quantile(i,.75)-quantile(i,.25))*Math.pow(i.length,-1/3)))}function wi(i){return i===null?NaN:+i}function Bi(i,c,o){if(o==null&&(o=wi),!!(s=i.length)){if((c=+c)<=0||s<2)return+o(i[0],0,i);if(c>=1)return+o(i[s-1],s-1,i);var s,l=(s-1)*c,d=Math.floor(l),_=+o(i[d],d,i),T=+o(i[d+1],d+1,i);return _+(T-_)*(l-d)}}var Fi="$";function vo(){}vo.prototype=wo.prototype={constructor:vo,has:function(i){return Fi+i in this},get:function(i){return this[Fi+i]},set:function(i,c){return this[Fi+i]=c,this},remove:function(i){var c=Fi+i;return c in this&&delete this[c]},clear:function(){for(var i in this)i[0]===Fi&&delete this[i]},keys:function(){var i=[];for(var c in this)c[0]===Fi&&i.push(c.slice(1));return i},values:function(){var i=[];for(var c in this)c[0]===Fi&&i.push(this[c]);return i},entries:function(){var i=[];for(var c in this)c[0]===Fi&&i.push({key:c.slice(1),value:this[c]});return i},size:function(){var i=0;for(var c in this)c[0]===Fi&&++i;return i},empty:function(){for(var i in this)if(i[0]===Fi)return!1;return!0},each:function(i){for(var c in this)c[0]===Fi&&i(this[c],c.slice(1),this)}};function wo(i,c){var o=new vo;if(i instanceof vo)i.each(function(T,I){o.set(I,T)});else if(Array.isArray(i)){var s=-1,l=i.length,d;if(c==null)for(;++s<l;)o.set(s,i[s]);else for(;++s<l;)o.set(c(d=i[s],s,i),d)}else if(i)for(var _ in i)o.set(_,i[_]);return o}var ra=wo;function Ls(){var i=[],c=[],o,s,l;function d(T,I,k,J){if(I>=i.length)return o!=null&&T.sort(o),s!=null?s(T):T;for(var $=-1,_e=T.length,Ne=i[I++],mt,Bt,mr=map(),Sr,Zr=k();++$<_e;)(Sr=mr.get(mt=Ne(Bt=T[$])+""))?Sr.push(Bt):mr.set(mt,[Bt]);return mr.each(function(xn,Rn){J(Zr,Rn,d(xn,I,k,J))}),Zr}function _(T,I){if(++I>i.length)return T;var k,J=c[I-1];return s!=null&&I>=i.length?k=T.entries():(k=[],T.each(function($,_e){k.push({key:_e,values:_($,I)})})),J!=null?k.sort(function($,_e){return J($.key,_e.key)}):k}return l={object:function(T){return d(T,0,so,ds)},map:function(T){return d(T,0,jo,os)},entries:function(T){return _(d(T,0,jo,os),0)},key:function(T){return i.push(T),l},sortKeys:function(T){return c[i.length-1]=T,l},sortValues:function(T){return o=T,l},rollup:function(T){return s=T,l}}}function so(){return{}}function ds(i,c,o){i[c]=o}function jo(){return map()}function os(i,c,o){i.set(c,o)}function $o(){}var Co=ra.prototype;$o.prototype=Vo.prototype={constructor:$o,has:Co.has,add:function(i){return i+="",this[Fi+i]=i,this},remove:Co.remove,clear:Co.clear,values:Co.keys,size:Co.size,empty:Co.empty,each:Co.each};function Vo(i,c){var o=new $o;if(i instanceof $o)i.each(function(d){o.add(d)});else if(i){var s=-1,l=i.length;if(c==null)for(;++s<l;)o.add(i[s]);else for(;++s<l;)o.add(c(i[s],s,i))}return o}var ji=null,Jo=Array.prototype,xa=Jo.map,ro=Jo.slice;function vi(i,c){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(c).domain(i);break}return this}function sa(i,c){switch(arguments.length){case 0:break;case 1:this.interpolator(i);break;default:this.interpolator(c).domain(i);break}return this}var Ga={name:"implicit"};function uo(){var i=ra(),c=[],o=[],s=Ga;function l(d){var _=d+"",T=i.get(_);if(!T){if(s!==Ga)return s;i.set(_,T=c.push(d))}return o[(T-1)%o.length]}return l.domain=function(d){if(!arguments.length)return c.slice();c=[],i=ra();for(var _=-1,T=d.length,I,k;++_<T;)i.has(k=(I=d[_])+"")||i.set(k,c.push(I));return l},l.range=function(d){return arguments.length?(o=ro.call(d),l):o.slice()},l.unknown=function(d){return arguments.length?(s=d,l):s},l.copy=function(){return uo(c,o).unknown(s)},vi.apply(l,arguments),l}function Qu(){var i=ordinal().unknown(void 0),c=i.domain,o=i.range,s=[0,1],l,d,_=!1,T=0,I=0,k=.5;delete i.unknown;function J(){var $=c().length,_e=s[1]<s[0],Ne=s[_e-0],mt=s[1-_e];l=(mt-Ne)/Math.max(1,$-T+I*2),_&&(l=Math.floor(l)),Ne+=(mt-Ne-l*($-T))*k,d=l*(1-T),_&&(Ne=Math.round(Ne),d=Math.round(d));var Bt=sequence($).map(function(mr){return Ne+l*mr});return o(_e?Bt.reverse():Bt)}return i.domain=function($){return arguments.length?(c($),J()):c()},i.range=function($){return arguments.length?(s=[+$[0],+$[1]],J()):s.slice()},i.rangeRound=function($){return s=[+$[0],+$[1]],_=!0,J()},i.bandwidth=function(){return d},i.step=function(){return l},i.round=function($){return arguments.length?(_=!!$,J()):_},i.padding=function($){return arguments.length?(T=Math.min(1,I=+$),J()):T},i.paddingInner=function($){return arguments.length?(T=Math.min(1,$),J()):T},i.paddingOuter=function($){return arguments.length?(I=+$,J()):I},i.align=function($){return arguments.length?(k=Math.max(0,Math.min(1,$)),J()):k},i.copy=function(){return Qu(c(),s).round(_).paddingInner(T).paddingOuter(I).align(k)},initRange.apply(J(),arguments)}function He(i){var c=i.copy;return i.padding=i.paddingOuter,delete i.paddingInner,delete i.paddingOuter,i.copy=function(){return He(c())},i}function cr(){return He(Qu.apply(null,arguments).paddingInner(1))}var Kt=E(26257),Fn=E(73626);function ua(i,c){return i=+i,c=+c,function(o){return Math.round(i*(1-o)+c*o)}}function De(i){return function(){return i}}function Se(i){return+i}var it=[0,1];function Tt(i){return i}function nr(i,c){return(c-=i=+i)?function(o){return(o-i)/c}:De(isNaN(c)?NaN:.5)}function dt(i){var c=i[0],o=i[i.length-1],s;return c>o&&(s=c,c=o,o=s),function(l){return Math.max(c,Math.min(o,l))}}function lt(i,c,o){var s=i[0],l=i[1],d=c[0],_=c[1];return l<s?(s=nr(l,s),d=o(_,d)):(s=nr(s,l),d=o(d,_)),function(T){return d(s(T))}}function at(i,c,o){var s=Math.min(i.length,c.length)-1,l=new Array(s),d=new Array(s),_=-1;for(i[s]<i[0]&&(i=i.slice().reverse(),c=c.slice().reverse());++_<s;)l[_]=nr(i[_],i[_+1]),d[_]=o(c[_],c[_+1]);return function(T){var I=qr(i,T,1,s)-1;return d[I](l[I](T))}}function Oe(i,c){return c.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function tt(){var i=it,c=it,o=Kt.Z,s,l,d,_=Tt,T,I,k;function J(){return T=Math.min(i.length,c.length)>2?at:lt,I=k=null,$}function $(_e){return isNaN(_e=+_e)?d:(I||(I=T(i.map(s),c,o)))(s(_(_e)))}return $.invert=function(_e){return _(l((k||(k=T(c,i.map(s),Fn.Z)))(_e)))},$.domain=function(_e){return arguments.length?(i=xa.call(_e,Se),_===Tt||(_=dt(i)),J()):i.slice()},$.range=function(_e){return arguments.length?(c=ro.call(_e),J()):c.slice()},$.rangeRound=function(_e){return c=ro.call(_e),o=ua,J()},$.clamp=function(_e){return arguments.length?(_=_e?dt(i):Tt,$):_!==Tt},$.interpolate=function(_e){return arguments.length?(o=_e,J()):o},$.unknown=function(_e){return arguments.length?(d=_e,$):d},function(_e,Ne){return s=_e,l=Ne,J()}}function Fe(i,c){return tt()(i,c)}var Dt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Vt(i){if(!(c=Dt.exec(i)))throw new Error("invalid format: "+i);var c;return new Dr({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}Vt.prototype=Dr.prototype;function Dr(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}Dr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function fn(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function sn(i,c){if((o=(i=c?i.toExponential(c-1):i.toExponential()).indexOf("e"))<0)return null;var o,s=i.slice(0,o);return[s.length>1?s[0]+s.slice(2):s,+i.slice(o+1)]}function _n(i){return i=sn(Math.abs(i)),i?i[1]:NaN}function un(i,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_n(c)/3)))*3-_n(Math.abs(i)))}function Yn(i,c){return function(o,s){for(var l=o.length,d=[],_=0,T=i[0],I=0;l>0&&T>0&&(I+T+1>s&&(T=Math.max(1,s-I)),d.push(o.substring(l-=T,l+T)),!((I+=T+1)>s));)T=i[_=(_+1)%i.length];return d.reverse().join(c)}}function On(i){return function(c){return c.replace(/[0-9]/g,function(o){return i[+o]})}}function jn(i){e:for(var c=i.length,o=1,s=-1,l;o<c;++o)switch(i[o]){case".":s=l=o;break;case"0":s===0&&(s=o),l=o;break;default:if(!+i[o])break e;s>0&&(s=0);break}return s>0?i.slice(0,s)+i.slice(l+1):i}var Vn;function Gn(i,c){var o=sn(i,c);if(!o)return i+"";var s=o[0],l=o[1],d=l-(Vn=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,_=s.length;return d===_?s:d>_?s+new Array(d-_+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+sn(i,Math.max(0,c+d-1))[0]}function pi(i,c){var o=sn(i,c);if(!o)return i+"";var s=o[0],l=o[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var Ha={"%":function(i,c){return(i*100).toFixed(c)},b:function(i){return Math.round(i).toString(2)},c:function(i){return i+""},d:fn,e:function(i,c){return i.toExponential(c)},f:function(i,c){return i.toFixed(c)},g:function(i,c){return i.toPrecision(c)},o:function(i){return Math.round(i).toString(8)},p:function(i,c){return pi(i*100,c)},r:pi,s:Gn,X:function(i){return Math.round(i).toString(16).toUpperCase()},x:function(i){return Math.round(i).toString(16)}};function Bo(i){return i}var xl=Array.prototype.map,Qa=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Oa(i){var c=i.grouping===void 0||i.thousands===void 0?Bo:Yn(xl.call(i.grouping,Number),i.thousands+""),o=i.currency===void 0?"":i.currency[0]+"",s=i.currency===void 0?"":i.currency[1]+"",l=i.decimal===void 0?".":i.decimal+"",d=i.numerals===void 0?Bo:On(xl.call(i.numerals,String)),_=i.percent===void 0?"%":i.percent+"",T=i.minus===void 0?"-":i.minus+"",I=i.nan===void 0?"NaN":i.nan+"";function k($){$=Vt($);var _e=$.fill,Ne=$.align,mt=$.sign,Bt=$.symbol,mr=$.zero,Sr=$.width,Zr=$.comma,xn=$.precision,Rn=$.trim,Xn=$.type;Xn==="n"?(Zr=!0,Xn="g"):Ha[Xn]||(xn===void 0&&(xn=12),Rn=!0,Xn="g"),(mr||_e==="0"&&Ne==="=")&&(mr=!0,_e="0",Ne="=");var Ci=Bt==="$"?o:Bt==="#"&&/[boxX]/.test(Xn)?"0"+Xn.toLowerCase():"",Jn=Bt==="$"?s:/[%p]/.test(Xn)?_:"",Pi=Ha[Xn],aa=/[defgprs%]/.test(Xn);xn=xn===void 0?6:/[gprs]/.test(Xn)?Math.max(1,Math.min(21,xn)):Math.max(0,Math.min(20,xn));function ma(di){var Ma=Ci,eo=Jn,Eu,vp,mp;if(Xn==="c")eo=Pi(di)+eo,di="";else{di=+di;var yp=di<0||1/di<0;if(di=isNaN(di)?I:Pi(Math.abs(di),xn),Rn&&(di=jn(di)),yp&&+di==0&&mt!=="+"&&(yp=!1),Ma=(yp?mt==="("?mt:T:mt==="-"||mt==="("?"":mt)+Ma,eo=(Xn==="s"?Qa[8+Vn/3]:"")+eo+(yp&&mt==="("?")":""),aa){for(Eu=-1,vp=di.length;++Eu<vp;)if(mp=di.charCodeAt(Eu),48>mp||mp>57){eo=(mp===46?l+di.slice(Eu+1):di.slice(Eu))+eo,di=di.slice(0,Eu);break}}}Zr&&!mr&&(di=c(di,Infinity));var gp=Ma.length+di.length+eo.length,Kc=gp<Sr?new Array(Sr-gp+1).join(_e):"";switch(Zr&&mr&&(di=c(Kc+di,Kc.length?Sr-eo.length:Infinity),Kc=""),Ne){case"<":di=Ma+di+eo+Kc;break;case"=":di=Ma+Kc+di+eo;break;case"^":di=Kc.slice(0,gp=Kc.length>>1)+Ma+di+eo+Kc.slice(gp);break;default:di=Kc+Ma+di+eo;break}return d(di)}return ma.toString=function(){return $+""},ma}function J($,_e){var Ne=k(($=Vt($),$.type="f",$)),mt=Math.max(-8,Math.min(8,Math.floor(_n(_e)/3)))*3,Bt=Math.pow(10,-mt),mr=Qa[8+mt/3];return function(Sr){return Ne(Bt*Sr)+mr}}return{format:k,formatPrefix:J}}var Ss,Uu,Su;vh({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function vh(i){return Ss=Oa(i),Uu=Ss.format,Su=Ss.formatPrefix,Ss}function qu(i,c){return i=Math.abs(i),c=Math.abs(c)-i,Math.max(0,_n(c)-_n(i))+1}function Zf(i){return Math.max(0,-_n(Math.abs(i)))}function Af(i,c,o,s){var l=Ii(i,c,o),d;switch(s=Vt(s==null?",f":s),s.type){case"s":{var _=Math.max(Math.abs(i),Math.abs(c));return s.precision==null&&!isNaN(d=un(l,_))&&(s.precision=d),Su(s,_)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=qu(l,Math.max(Math.abs(i),Math.abs(c))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=Zf(l))&&(s.precision=d-(s.type==="%")*2);break}}return Uu(s)}function Tc(i){var c=i.domain;return i.ticks=function(o){var s=c();return Sn(s[0],s[s.length-1],o==null?10:o)},i.tickFormat=function(o,s){var l=c();return Af(l[0],l[l.length-1],o==null?10:o,s)},i.nice=function(o){o==null&&(o=10);var s=c(),l=0,d=s.length-1,_=s[l],T=s[d],I;return T<_&&(I=_,_=T,T=I,I=l,l=d,d=I),I=Ri(_,T,o),I>0?(_=Math.floor(_/I)*I,T=Math.ceil(T/I)*I,I=Ri(_,T,o)):I<0&&(_=Math.ceil(_*I)/I,T=Math.floor(T*I)/I,I=Ri(_,T,o)),I>0?(s[l]=Math.floor(_/I)*I,s[d]=Math.ceil(T/I)*I,c(s)):I<0&&(s[l]=Math.ceil(_*I)/I,s[d]=Math.floor(T*I)/I,c(s)),i},i}function Cp(){var i=Fe(Tt,Tt);return i.copy=function(){return Oe(i,Cp())},vi.apply(i,arguments),Tc(i)}function ss(i){var c;function o(s){return isNaN(s=+s)?c:s}return o.invert=o,o.domain=o.range=function(s){return arguments.length?(i=xa.call(s,Se),o):i.slice()},o.unknown=function(s){return arguments.length?(c=s,o):c},o.copy=function(){return ss(i).unknown(c)},i=arguments.length?xa.call(i,Se):[0,1],Tc(o)}function jf(i,c){i=i.slice();var o=0,s=i.length-1,l=i[o],d=i[s],_;return d<l&&(_=o,o=s,s=_,_=l,l=d,d=_),i[o]=c.floor(l),i[s]=c.ceil(d),i}function Pc(i){return Math.log(i)}function mh(i){return Math.exp(i)}function qh(i){return-Math.log(-i)}function Ap(i){return-Math.exp(-i)}function Vf(i){return isFinite(i)?+("1e"+i):i<0?0:i}function Zc(i){return i===10?Vf:i===Math.E?Math.exp:function(c){return Math.pow(i,c)}}function Hp(i){return i===Math.E?Math.log:i===10&&Math.log10||i===2&&Math.log2||(i=Math.log(i),function(c){return Math.log(c)/i})}function Tp(i){return function(c){return-i(-c)}}function wd(i){var c=i(Pc,mh),o=c.domain,s=10,l,d;function _(){return l=Hp(s),d=Zc(s),o()[0]<0?(l=Tp(l),d=Tp(d),i(qh,Ap)):i(Pc,mh),c}return c.base=function(T){return arguments.length?(s=+T,_()):s},c.domain=function(T){return arguments.length?(o(T),_()):o()},c.ticks=function(T){var I=o(),k=I[0],J=I[I.length-1],$;($=J<k)&&(_e=k,k=J,J=_e);var _e=l(k),Ne=l(J),mt,Bt,mr,Sr=T==null?10:+T,Zr=[];if(!(s%1)&&Ne-_e<Sr){if(_e=Math.round(_e)-1,Ne=Math.round(Ne)+1,k>0){for(;_e<Ne;++_e)for(Bt=1,mt=d(_e);Bt<s;++Bt)if(mr=mt*Bt,!(mr<k)){if(mr>J)break;Zr.push(mr)}}else for(;_e<Ne;++_e)for(Bt=s-1,mt=d(_e);Bt>=1;--Bt)if(mr=mt*Bt,!(mr<k)){if(mr>J)break;Zr.push(mr)}}else Zr=Sn(_e,Ne,Math.min(Ne-_e,Sr)).map(d);return $?Zr.reverse():Zr},c.tickFormat=function(T,I){if(I==null&&(I=s===10?".0e":","),typeof I!="function"&&(I=Uu(I)),T===Infinity)return I;T==null&&(T=10);var k=Math.max(1,s*T/c.ticks().length);return function(J){var $=J/d(Math.round(l(J)));return $*s<s-.5&&($*=s),$<=k?I(J):""}},c.nice=function(){return o(jf(o(),{floor:function(T){return d(Math.floor(l(T)))},ceil:function(T){return d(Math.ceil(l(T)))}}))},c}function Es(){var i=wd(tt()).domain([1,10]);return i.copy=function(){return Oe(i,Es()).base(i.base())},vi.apply(i,arguments),i}function jc(i){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/i))}}function Pp(i){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*i}}function e(i){var c=1,o=i(jc(c),Pp(c));return o.constant=function(s){return arguments.length?i(jc(c=+s),Pp(c)):c},linearish(o)}function t(){var i=e(transformer());return i.copy=function(){return copy(i,t()).constant(i.constant())},initRange.apply(i,arguments)}function r(i){return function(c){return c<0?-Math.pow(-c,i):Math.pow(c,i)}}function f(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function v(i){return i<0?-i*i:i*i}function y(i){var c=i(Tt,Tt),o=1;function s(){return o===1?i(Tt,Tt):o===.5?i(f,v):i(r(o),r(1/o))}return c.exponent=function(l){return arguments.length?(o=+l,s()):o},Tc(c)}function x(){var i=y(tt());return i.copy=function(){return Oe(i,x()).exponent(i.exponent())},vi.apply(i,arguments),i}function M(){return x.apply(null,arguments).exponent(.5)}function B(){var i=[],c=[],o=[],s;function l(){var _=0,T=Math.max(1,c.length);for(o=new Array(T-1);++_<T;)o[_-1]=Bi(i,_/T);return d}function d(_){return isNaN(_=+_)?s:c[qr(o,_)]}return d.invertExtent=function(_){var T=c.indexOf(_);return T<0?[NaN,NaN]:[T>0?o[T-1]:i[0],T<o.length?o[T]:i[i.length-1]]},d.domain=function(_){if(!arguments.length)return i.slice();i=[];for(var T=0,I=_.length,k;T<I;++T)k=_[T],k!=null&&!isNaN(k=+k)&&i.push(k);return i.sort(Ot),l()},d.range=function(_){return arguments.length?(c=ro.call(_),l()):c.slice()},d.unknown=function(_){return arguments.length?(s=_,d):s},d.quantiles=function(){return o.slice()},d.copy=function(){return B().domain(i).range(c).unknown(s)},vi.apply(d,arguments)}function G(){var i=0,c=1,o=1,s=[.5],l=[0,1],d;function _(I){return I<=I?l[qr(s,I,0,o)]:d}function T(){var I=-1;for(s=new Array(o);++I<o;)s[I]=((I+1)*c-(I-o)*i)/(o+1);return _}return _.domain=function(I){return arguments.length?(i=+I[0],c=+I[1],T()):[i,c]},_.range=function(I){return arguments.length?(o=(l=ro.call(I)).length-1,T()):l.slice()},_.invertExtent=function(I){var k=l.indexOf(I);return k<0?[NaN,NaN]:k<1?[i,s[0]]:k>=o?[s[o-1],c]:[s[k-1],s[k]]},_.unknown=function(I){return arguments.length&&(d=I),_},_.thresholds=function(){return s.slice()},_.copy=function(){return G().domain([i,c]).range(l).unknown(d)},vi.apply(Tc(_),arguments)}function K(){var i=[.5],c=[0,1],o,s=1;function l(d){return d<=d?c[qr(i,d,0,s)]:o}return l.domain=function(d){return arguments.length?(i=ro.call(d),s=Math.min(i.length,c.length-1),l):i.slice()},l.range=function(d){return arguments.length?(c=ro.call(d),s=Math.min(i.length,c.length-1),l):c.slice()},l.invertExtent=function(d){var _=c.indexOf(d);return[i[_-1],i[_]]},l.unknown=function(d){return arguments.length?(o=d,l):o},l.copy=function(){return K().domain(i).range(c).unknown(o)},vi.apply(l,arguments)}var re=new Date,fe=new Date;function ge(i,c,o,s){function l(d){return i(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return i(d=new Date(+d)),d},l.ceil=function(d){return i(d=new Date(d-1)),c(d,1),i(d),d},l.round=function(d){var _=l(d),T=l.ceil(d);return d-_<T-d?_:T},l.offset=function(d,_){return c(d=new Date(+d),_==null?1:Math.floor(_)),d},l.range=function(d,_,T){var I=[],k;if(d=l.ceil(d),T=T==null?1:Math.floor(T),!(d<_)||!(T>0))return I;do I.push(k=new Date(+d)),c(d,T),i(d);while(k<d&&d<_);return I},l.filter=function(d){return ge(function(_){if(_>=_)for(;i(_),!d(_);)_.setTime(_-1)},function(_,T){if(_>=_)if(T<0)for(;++T<=0;)for(;c(_,-1),!d(_););else for(;--T>=0;)for(;c(_,1),!d(_););})},o&&(l.count=function(d,_){return re.setTime(+d),fe.setTime(+_),i(re),i(fe),Math.floor(o(re,fe))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(s?function(_){return s(_)%d==0}:function(_){return l.count(0,_)%d==0}):l}),l}var Ze=ge(function(i){i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,c){i.setFullYear(i.getFullYear()+c)},function(i,c){return c.getFullYear()-i.getFullYear()},function(i){return i.getFullYear()});Ze.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:ge(function(c){c.setFullYear(Math.floor(c.getFullYear()/i)*i),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,o){c.setFullYear(c.getFullYear()+o*i)})};var Ge=Ze,vt=Ze.range,qe=ge(function(i){i.setDate(1),i.setHours(0,0,0,0)},function(i,c){i.setMonth(i.getMonth()+c)},function(i,c){return c.getMonth()-i.getMonth()+(c.getFullYear()-i.getFullYear())*12},function(i){return i.getMonth()}),Mt=qe,Wt=qe.range,lr=1e3,fr=6e4,Ir=36e5,rn=864e5,mn=6048e5;function ei(i){return ge(function(c){c.setDate(c.getDate()-(c.getDay()+7-i)%7),c.setHours(0,0,0,0)},function(c,o){c.setDate(c.getDate()+o*7)},function(c,o){return(o-c-(o.getTimezoneOffset()-c.getTimezoneOffset())*fr)/mn})}var Ln=ei(0),ui=ei(1),Nn=ei(2),na=ei(3),bi=ei(4),ti=ei(5),la=ei(6),Xi=Ln.range,Ca=ui.range,mi=Nn.range,Da=na.range,Io=bi.range,Qo=ti.range,Go=la.range,yo=ge(function(i){i.setHours(0,0,0,0)},function(i,c){i.setDate(i.getDate()+c)},function(i,c){return(c-i-(c.getTimezoneOffset()-i.getTimezoneOffset())*fr)/rn},function(i){return i.getDate()-1}),Oo=yo,Rs=yo.range,vs=ge(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*lr-i.getMinutes()*fr)},function(i,c){i.setTime(+i+c*Ir)},function(i,c){return(c-i)/Ir},function(i){return i.getHours()}),nu=vs,Ds=vs.range,Gs=ge(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*lr)},function(i,c){i.setTime(+i+c*fr)},function(i,c){return(c-i)/fr},function(i){return i.getMinutes()}),qo=Gs,Fs=Gs.range,fa=ge(function(i){i.setTime(i-i.getMilliseconds())},function(i,c){i.setTime(+i+c*lr)},function(i,c){return(c-i)/lr},function(i){return i.getUTCSeconds()}),no=fa,qa=fa.range,va=ge(function(){},function(i,c){i.setTime(+i+c)},function(i,c){return c-i});va.every=function(i){return i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?ge(function(c){c.setTime(Math.floor(c/i)*i)},function(c,o){c.setTime(+c+o*i)},function(c,o){return(o-c)/i}):va};var vu=va,iu=va.range;function Za(i){return ge(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-i)%7),c.setUTCHours(0,0,0,0)},function(c,o){c.setUTCDate(c.getUTCDate()+o*7)},function(c,o){return(o-c)/mn})}var es=Za(0),ws=Za(1),La=Za(2),Mc=Za(3),Hs=Za(4),Ic=Za(5),ts=Za(6),Vc=es.range,ic=ws.range,yh=La.range,Gf=Mc.range,gh=Hs.range,sf=Ic.range,_h=ts.range,xh=ge(function(i){i.setUTCHours(0,0,0,0)},function(i,c){i.setUTCDate(i.getUTCDate()+c)},function(i,c){return(c-i)/rn},function(i){return i.getUTCDate()-1}),Tf=xh,ep=xh.range,Hf=ge(function(i){i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,c){i.setUTCFullYear(i.getUTCFullYear()+c)},function(i,c){return c.getUTCFullYear()-i.getUTCFullYear()},function(i){return i.getUTCFullYear()});Hf.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:ge(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/i)*i),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,o){c.setUTCFullYear(c.getUTCFullYear()+o*i)})};var uf=Hf,lf=Hf.range;function Pf(i){if(0<=i.y&&i.y<100){var c=new Date(-1,i.m,i.d,i.H,i.M,i.S,i.L);return c.setFullYear(i.y),c}return new Date(i.y,i.m,i.d,i.H,i.M,i.S,i.L)}function cf(i){if(0<=i.y&&i.y<100){var c=new Date(Date.UTC(-1,i.m,i.d,i.H,i.M,i.S,i.L));return c.setUTCFullYear(i.y),c}return new Date(Date.UTC(i.y,i.m,i.d,i.H,i.M,i.S,i.L))}function Ul(i,c,o){return{y:i,m:c,d:o,H:0,M:0,S:0,L:0}}function Wf(i){var c=i.dateTime,o=i.date,s=i.time,l=i.periods,d=i.days,_=i.shortDays,T=i.months,I=i.shortMonths,k=Gc(l),J=Hc(l),$=Gc(d),_e=Hc(d),Ne=Gc(_),mt=Hc(_),Bt=Gc(T),mr=Hc(T),Sr=Gc(I),Zr=Hc(I),xn={a:yp,A:gp,b:Kc,B:Fg,c:null,d:Op,e:Op,f:sp,g:lp,G:Lc,H:ap,I:Oc,j:op,L:Jf,m:up,M:Lp,p:Bg,q:Ng,Q:zp,s:th,S:Yp,u:Th,U:Kp,V:$p,w:Jp,W:Qp,x:null,X:null,y:el,Y:qp,Z:Td,"%":fp},Rn={a:zg,A:Ug,b:Zg,B:jg,c:null,d:kp,e:kp,f:eh,g:ad,G:od,H:Mf,I:Qf,j:qf,L:If,m:ed,M:td,p:Vg,q:Gg,Q:zp,s:th,S:rd,u:nd,U:Dp,V:Wc,w:id,W:Fp,x:null,X:null,y:Bp,Y:Np,Z:sd,"%":fp},Xn={a:ma,A:di,b:Ma,B:eo,c:Eu,d:np,e:np,f:ac,g:Kf,G:ff,H:ip,I:ip,j:Xp,L:rs,m:Wp,M:Cd,p:aa,q:Mp,Q:hf,s:Ip,S:Ah,u:Xf,U:rp,V:Yf,w:tp,W:Ch,x:vp,X:mp,y:Kf,Y:ff,Z:$f,"%":Ad};xn.x=Ci(o,xn),xn.X=Ci(s,xn),xn.c=Ci(c,xn),Rn.x=Ci(o,Rn),Rn.X=Ci(s,Rn),Rn.c=Ci(c,Rn);function Ci(ki,to){return function(go){var Un=[],jl=-1,us=0,oc=ki.length,sc,kh,vm;for(go instanceof Date||(go=new Date(+go));++jl<oc;)ki.charCodeAt(jl)===37&&(Un.push(ki.slice(us,jl)),(kh=bh[sc=ki.charAt(++jl)])!=null?sc=ki.charAt(++jl):kh=sc==="e"?" ":"0",(vm=to[sc])&&(sc=vm(go,kh)),Un.push(sc),us=jl+1);return Un.push(ki.slice(us,jl)),Un.join("")}}function Jn(ki,to){return function(go){var Un=Ul(1900,void 0,1),jl=Pi(Un,ki,go+="",0),us,oc;if(jl!=go.length)return null;if("Q"in Un)return new Date(Un.Q);if("s"in Un)return new Date(Un.s*1e3+("L"in Un?Un.L:0));if(to&&!("Z"in Un)&&(Un.Z=0),"p"in Un&&(Un.H=Un.H%12+Un.p*12),Un.m===void 0&&(Un.m="q"in Un?Un.q:0),"V"in Un){if(Un.V<1||Un.V>53)return null;"w"in Un||(Un.w=1),"Z"in Un?(us=cf(Ul(Un.y,0,1)),oc=us.getUTCDay(),us=oc>4||oc===0?ws.ceil(us):ws(us),us=Tf.offset(us,(Un.V-1)*7),Un.y=us.getUTCFullYear(),Un.m=us.getUTCMonth(),Un.d=us.getUTCDate()+(Un.w+6)%7):(us=Pf(Ul(Un.y,0,1)),oc=us.getDay(),us=oc>4||oc===0?ui.ceil(us):ui(us),us=Oo.offset(us,(Un.V-1)*7),Un.y=us.getFullYear(),Un.m=us.getMonth(),Un.d=us.getDate()+(Un.w+6)%7)}else("W"in Un||"U"in Un)&&("w"in Un||(Un.w="u"in Un?Un.u%7:"W"in Un?1:0),oc="Z"in Un?cf(Ul(Un.y,0,1)).getUTCDay():Pf(Ul(Un.y,0,1)).getDay(),Un.m=0,Un.d="W"in Un?(Un.w+6)%7+Un.W*7-(oc+5)%7:Un.w+Un.U*7-(oc+6)%7);return"Z"in Un?(Un.H+=Un.Z/100|0,Un.M+=Un.Z%100,cf(Un)):Pf(Un)}}function Pi(ki,to,go,Un){for(var jl=0,us=to.length,oc=go.length,sc,kh;jl<us;){if(Un>=oc)return-1;if(sc=to.charCodeAt(jl++),sc===37){if(sc=to.charAt(jl++),kh=Xn[sc in bh?to.charAt(jl++):sc],!kh||(Un=kh(ki,go,Un))<0)return-1}else if(sc!=go.charCodeAt(Un++))return-1}return Un}function aa(ki,to,go){var Un=k.exec(to.slice(go));return Un?(ki.p=J[Un[0].toLowerCase()],go+Un[0].length):-1}function ma(ki,to,go){var Un=Ne.exec(to.slice(go));return Un?(ki.w=mt[Un[0].toLowerCase()],go+Un[0].length):-1}function di(ki,to,go){var Un=$.exec(to.slice(go));return Un?(ki.w=_e[Un[0].toLowerCase()],go+Un[0].length):-1}function Ma(ki,to,go){var Un=Sr.exec(to.slice(go));return Un?(ki.m=Zr[Un[0].toLowerCase()],go+Un[0].length):-1}function eo(ki,to,go){var Un=Bt.exec(to.slice(go));return Un?(ki.m=mr[Un[0].toLowerCase()],go+Un[0].length):-1}function Eu(ki,to,go){return Pi(ki,c,to,go)}function vp(ki,to,go){return Pi(ki,o,to,go)}function mp(ki,to,go){return Pi(ki,s,to,go)}function yp(ki){return _[ki.getDay()]}function gp(ki){return d[ki.getDay()]}function Kc(ki){return I[ki.getMonth()]}function Fg(ki){return T[ki.getMonth()]}function Bg(ki){return l[+(ki.getHours()>=12)]}function Ng(ki){return 1+~~(ki.getMonth()/3)}function zg(ki){return _[ki.getUTCDay()]}function Ug(ki){return d[ki.getUTCDay()]}function Zg(ki){return I[ki.getUTCMonth()]}function jg(ki){return T[ki.getUTCMonth()]}function Vg(ki){return l[+(ki.getUTCHours()>=12)]}function Gg(ki){return 1+~~(ki.getUTCMonth()/3)}return{format:function(ki){var to=Ci(ki+="",xn);return to.toString=function(){return ki},to},parse:function(ki){var to=Jn(ki+="",!1);return to.toString=function(){return ki},to},utcFormat:function(ki){var to=Ci(ki+="",Rn);return to.toString=function(){return ki},to},utcParse:function(ki){var to=Jn(ki+="",!0);return to.toString=function(){return ki},to}}}var bh={"-":"",_:" ","0":"0"},ks=/^\s*\d+/,Sh=/^%/,Eh=/[\\^$*+?|[\]().{}]/g;function Wa(i,c,o){var s=i<0?"-":"",l=(s?-i:i)+"",d=l.length;return s+(d<o?new Array(o-d+1).join(c)+l:l)}function wh(i){return i.replace(Eh,"\\$&")}function Gc(i){return new RegExp("^(?:"+i.map(wh).join("|")+")","i")}function Hc(i){for(var c={},o=-1,s=i.length;++o<s;)c[i[o].toLowerCase()]=o;return c}function tp(i,c,o){var s=ks.exec(c.slice(o,o+1));return s?(i.w=+s[0],o+s[0].length):-1}function Xf(i,c,o){var s=ks.exec(c.slice(o,o+1));return s?(i.u=+s[0],o+s[0].length):-1}function rp(i,c,o){var s=ks.exec(c.slice(o,o+2));return s?(i.U=+s[0],o+s[0].length):-1}function Yf(i,c,o){var s=ks.exec(c.slice(o,o+2));return s?(i.V=+s[0],o+s[0].length):-1}function Ch(i,c,o){var s=ks.exec(c.slice(o,o+2));return s?(i.W=+s[0],o+s[0].length):-1}function ff(i,c,o){var s=ks.exec(c.slice(o,o+4));return s?(i.y=+s[0],o+s[0].length):-1}function Kf(i,c,o){var s=ks.exec(c.slice(o,o+2));return s?(i.y=+s[0]+(+s[0]>68?1900:2e3),o+s[0].length):-1}function $f(i,c,o){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(o,o+6));return s?(i.Z=s[1]?0:-(s[2]+(s[3]||"00")),o+s[0].length):-1}function Mp(i,c,o){var s=ks.exec(c.slice(o,o+1));return s?(i.q=s[0]*3-3,o+s[0].length):-1}function Wp(i,c,o){var s=ks.exec(c.slice(o,o+2));return s?(i.m=s[0]-1,o+s[0].length):-1}function np(i,c,o){var s=ks.exec(c.slice(o,o+2));return s?(i.d=+s[0],o+s[0].length):-1}function Xp(i,c,o){var s=ks.exec(c.slice(o,o+3));return s?(i.m=0,i.d=+s[0],o+s[0].length):-1}function ip(i,c,o){var s=ks.exec(c.slice(o,o+2));return s?(i.H=+s[0],o+s[0].length):-1}function Cd(i,c,o){var s=ks.exec(c.slice(o,o+2));return s?(i.M=+s[0],o+s[0].length):-1}function Ah(i,c,o){var s=ks.exec(c.slice(o,o+2));return s?(i.S=+s[0],o+s[0].length):-1}function rs(i,c,o){var s=ks.exec(c.slice(o,o+3));return s?(i.L=+s[0],o+s[0].length):-1}function ac(i,c,o){var s=ks.exec(c.slice(o,o+6));return s?(i.L=Math.floor(s[0]/1e3),o+s[0].length):-1}function Ad(i,c,o){var s=Sh.exec(c.slice(o,o+1));return s?o+s[0].length:-1}function hf(i,c,o){var s=ks.exec(c.slice(o));return s?(i.Q=+s[0],o+s[0].length):-1}function Ip(i,c,o){var s=ks.exec(c.slice(o));return s?(i.s=+s[0],o+s[0].length):-1}function Op(i,c){return Wa(i.getDate(),c,2)}function ap(i,c){return Wa(i.getHours(),c,2)}function Oc(i,c){return Wa(i.getHours()%12||12,c,2)}function op(i,c){return Wa(1+Oo.count(Ge(i),i),c,3)}function Jf(i,c){return Wa(i.getMilliseconds(),c,3)}function sp(i,c){return Jf(i,c)+"000"}function up(i,c){return Wa(i.getMonth()+1,c,2)}function Lp(i,c){return Wa(i.getMinutes(),c,2)}function Yp(i,c){return Wa(i.getSeconds(),c,2)}function Th(i){var c=i.getDay();return c===0?7:c}function Kp(i,c){return Wa(Ln.count(Ge(i)-1,i),c,2)}function Rp(i){var c=i.getDay();return c>=4||c===0?bi(i):bi.ceil(i)}function $p(i,c){return i=Rp(i),Wa(bi.count(Ge(i),i)+(Ge(i).getDay()===4),c,2)}function Jp(i){return i.getDay()}function Qp(i,c){return Wa(ui.count(Ge(i)-1,i),c,2)}function el(i,c){return Wa(i.getFullYear()%100,c,2)}function lp(i,c){return i=Rp(i),Wa(i.getFullYear()%100,c,2)}function qp(i,c){return Wa(i.getFullYear()%1e4,c,4)}function Lc(i,c){var o=i.getDay();return i=o>=4||o===0?bi(i):bi.ceil(i),Wa(i.getFullYear()%1e4,c,4)}function Td(i){var c=i.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+Wa(c/60|0,"0",2)+Wa(c%60,"0",2)}function kp(i,c){return Wa(i.getUTCDate(),c,2)}function Mf(i,c){return Wa(i.getUTCHours(),c,2)}function Qf(i,c){return Wa(i.getUTCHours()%12||12,c,2)}function qf(i,c){return Wa(1+Tf.count(uf(i),i),c,3)}function If(i,c){return Wa(i.getUTCMilliseconds(),c,3)}function eh(i,c){return If(i,c)+"000"}function ed(i,c){return Wa(i.getUTCMonth()+1,c,2)}function td(i,c){return Wa(i.getUTCMinutes(),c,2)}function rd(i,c){return Wa(i.getUTCSeconds(),c,2)}function nd(i){var c=i.getUTCDay();return c===0?7:c}function Dp(i,c){return Wa(es.count(uf(i)-1,i),c,2)}function cp(i){var c=i.getUTCDay();return c>=4||c===0?Hs(i):Hs.ceil(i)}function Wc(i,c){return i=cp(i),Wa(Hs.count(uf(i),i)+(uf(i).getUTCDay()===4),c,2)}function id(i){return i.getUTCDay()}function Fp(i,c){return Wa(ws.count(uf(i)-1,i),c,2)}function Bp(i,c){return Wa(i.getUTCFullYear()%100,c,2)}function ad(i,c){return i=cp(i),Wa(i.getUTCFullYear()%100,c,2)}function Np(i,c){return Wa(i.getUTCFullYear()%1e4,c,4)}function od(i,c){var o=i.getUTCDay();return i=o>=4||o===0?Hs(i):Hs.ceil(i),Wa(i.getUTCFullYear()%1e4,c,4)}function sd(){return"+0000"}function fp(){return"%"}function zp(i){return+i}function th(i){return Math.floor(+i/1e3)}var Of,Ph,Pd,ud,Md;Id({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Id(i){return Of=Wf(i),Ph=Of.format,Pd=Of.parse,ud=Of.utcFormat,Md=Of.utcParse,Of}var Mh=1e3,Ih=Mh*60,Oh=Ih*60,Lh=Oh*24,Od=Lh*7,ld=Lh*30,Zl=Lh*365;function hp(i){return new Date(i)}function cd(i){return i instanceof Date?+i:+new Date(+i)}function rh(i,c,o,s,l,d,_,T,I){var k=Fe(Tt,Tt),J=k.invert,$=k.domain,_e=I(".%L"),Ne=I(":%S"),mt=I("%I:%M"),Bt=I("%I %p"),mr=I("%a %d"),Sr=I("%b %d"),Zr=I("%B"),xn=I("%Y"),Rn=[[_,1,Mh],[_,5,5*Mh],[_,15,15*Mh],[_,30,30*Mh],[d,1,Ih],[d,5,5*Ih],[d,15,15*Ih],[d,30,30*Ih],[l,1,Oh],[l,3,3*Oh],[l,6,6*Oh],[l,12,12*Oh],[s,1,Lh],[s,2,2*Lh],[o,1,Od],[c,1,ld],[c,3,3*ld],[i,1,Zl]];function Xn(Jn){return(_(Jn)<Jn?_e:d(Jn)<Jn?Ne:l(Jn)<Jn?mt:s(Jn)<Jn?Bt:c(Jn)<Jn?o(Jn)<Jn?mr:Sr:i(Jn)<Jn?Zr:xn)(Jn)}function Ci(Jn,Pi,aa,ma){if(Jn==null&&(Jn=10),typeof Jn=="number"){var di=Math.abs(aa-Pi)/Jn,Ma=pr(function(eo){return eo[2]}).right(Rn,di);Ma===Rn.length?(ma=Ii(Pi/Zl,aa/Zl,Jn),Jn=i):Ma?(Ma=Rn[di/Rn[Ma-1][2]<Rn[Ma][2]/di?Ma-1:Ma],ma=Ma[1],Jn=Ma[0]):(ma=Math.max(Ii(Pi,aa,Jn),1),Jn=T)}return ma==null?Jn:Jn.every(ma)}return k.invert=function(Jn){return new Date(J(Jn))},k.domain=function(Jn){return arguments.length?$(xa.call(Jn,cd)):$().map(hp)},k.ticks=function(Jn,Pi){var aa=$(),ma=aa[0],di=aa[aa.length-1],Ma=di<ma,eo;return Ma&&(eo=ma,ma=di,di=eo),eo=Ci(Jn,ma,di,Pi),eo=eo?eo.range(ma,di+1):[],Ma?eo.reverse():eo},k.tickFormat=function(Jn,Pi){return Pi==null?Xn:I(Pi)},k.nice=function(Jn,Pi){var aa=$();return(Jn=Ci(Jn,aa[0],aa[aa.length-1],Pi))?$(jf(aa,Jn)):k},k.copy=function(){return Oe(k,rh(i,c,o,s,l,d,_,T,I))},k}function fd(){return vi.apply(rh(Ge,Mt,Ln,Oo,nu,qo,no,vu,Ph).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Hg(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function hd(){var i=0,c=1,o,s,l,d,_=identity,T=!1,I;function k(J){return isNaN(J=+J)?I:_(l===0?.5:(J=(d(J)-o)*l,T?Math.max(0,Math.min(1,J)):J))}return k.domain=function(J){return arguments.length?(o=d(i=+J[0]),s=d(c=+J[1]),l=o===s?0:1/(s-o),k):[i,c]},k.clamp=function(J){return arguments.length?(T=!!J,k):T},k.interpolator=function(J){return arguments.length?(_=J,k):_},k.unknown=function(J){return arguments.length?(I=J,k):I},function(J){return d=J,o=J(i),s=J(c),l=o===s?0:1/(s-o),k}}function pd(i,c){return c.domain(i.domain()).interpolator(i.interpolator()).clamp(i.clamp()).unknown(i.unknown())}function mm(){var i=linearish(hd()(identity));return i.copy=function(){return pd(i,mm())},initInterpolator.apply(i,arguments)}function ym(){var i=loggish(hd()).domain([1,10]);return i.copy=function(){return pd(i,ym()).base(i.base())},initInterpolator.apply(i,arguments)}function gm(){var i=symlogish(hd());return i.copy=function(){return pd(i,gm()).constant(i.constant())},initInterpolator.apply(i,arguments)}function Ud(){var i=powish(hd());return i.copy=function(){return pd(i,Ud()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function Wg(){return Ud.apply(null,arguments).exponent(.5)}function _m(){var i=[],c=identity;function o(s){if(!isNaN(s=+s))return c((bisect(i,s)-1)/(i.length-1))}return o.domain=function(s){if(!arguments.length)return i.slice();i=[];for(var l=0,d=s.length,_;l<d;++l)_=s[l],_!=null&&!isNaN(_=+_)&&i.push(_);return i.sort(ascending),o},o.interpolator=function(s){return arguments.length?(c=s,o):c},o.copy=function(){return _m(c).domain(i)},initInterpolator.apply(o,arguments)}function dd(){var i=0,c=.5,o=1,s,l,d,_,T,I=identity,k,J=!1,$;function _e(Ne){return isNaN(Ne=+Ne)?$:(Ne=.5+((Ne=+k(Ne))-l)*(Ne<l?_:T),I(J?Math.max(0,Math.min(1,Ne)):Ne))}return _e.domain=function(Ne){return arguments.length?(s=k(i=+Ne[0]),l=k(c=+Ne[1]),d=k(o=+Ne[2]),_=s===l?0:.5/(l-s),T=l===d?0:.5/(d-l),_e):[i,c,o]},_e.clamp=function(Ne){return arguments.length?(J=!!Ne,_e):J},_e.interpolator=function(Ne){return arguments.length?(I=Ne,_e):I},_e.unknown=function(Ne){return arguments.length?($=Ne,_e):$},function(Ne){return k=Ne,s=Ne(i),l=Ne(c),d=Ne(o),_=s===l?0:.5/(l-s),T=l===d?0:.5/(d-l),_e}}function xm(){var i=linearish(dd()(identity));return i.copy=function(){return copy(i,xm())},initInterpolator.apply(i,arguments)}function bm(){var i=loggish(dd()).domain([.1,1,10]);return i.copy=function(){return copy(i,bm()).base(i.base())},initInterpolator.apply(i,arguments)}function Sm(){var i=symlogish(dd());return i.copy=function(){return copy(i,Sm()).constant(i.constant())},initInterpolator.apply(i,arguments)}function Zd(){var i=powish(dd());return i.copy=function(){return copy(i,Zd()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function Xg(){return Zd.apply(null,arguments).exponent(.5)}var Xc,jd,Vd,Gd,Ld,Hd,Em=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,wm=(Xc={},(0,L.Z)(Xc,A.ScaleTypes.LINEAR,Cp),(0,L.Z)(Xc,A.ScaleTypes.POWER,x),(0,L.Z)(Xc,A.ScaleTypes.LOG,Es),(0,L.Z)(Xc,A.ScaleTypes.IDENTITY,ss),(0,L.Z)(Xc,A.ScaleTypes.TIME,fd),(0,L.Z)(Xc,A.ScaleTypes.QUANTILE,B),(0,L.Z)(Xc,A.ScaleTypes.QUANTIZE,G),(0,L.Z)(Xc,A.ScaleTypes.THRESHOLD,K),(0,L.Z)(Xc,A.ScaleTypes.CAT,uo),Xc),Cm=(jd=(0,Et.b2)(),Vd=(0,Et.f3)(A.vK.IGlobalConfigService),jd(Gd=(Ld=function(){function i(){(0,Y.Z)(this,i),(0,oi.Z)(this,"configService",Hd,this),(0,L.Z)(this,"scaleCache",{}),(0,L.Z)(this,"scaleOptions",{})}return(0,W.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var _=d.getLayerStyleAttributes(),T=o.getSource().data.dataArray;T.length!==0&&l.caculateScalesForAttributes(_||[],T)}),o.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var _=d.getLayerStyleAttributes(),T=o.getSource().data.dataArray;return l.caculateScalesForAttributes(_||[],T),o.layerModelNeedUpdate=!0,!0}),o.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!o.layerModelNeedUpdate){l.scaleOptions=o.getScaleOptions();var _=d.getLayerStyleAttributes();if(_){var T=o.getSource().data.dataArray;if(T.length===0)return;var I=_.filter(function(k){return k.needRescale});I.length&&l.caculateScalesForAttributes(I,T)}}})}},{key:"isNumber",value:function(o){return!isNaN(parseFloat(o))&&isFinite(o)}},{key:"caculateScalesForAttributes",value:function(o,s){var l=this;this.scaleCache={},o.forEach(function(d){if(d.scale){var _=d.scale,T=d.name;_.names=l.parseFields(d.scale.field||[]);var I=[];_.names.forEach(function(k){I.push(l.getOrCreateScale(k,d,s))}),I.some(function(k){return k.type===A.StyleScaleType.VARIABLE})?(_.type=A.StyleScaleType.VARIABLE,I.forEach(function(k){if(!_.callback){var J;if(_.values&&_.values!=="text"){var $;if((($=k.option)===null||$===void 0?void 0:$.type)==="linear"&&_.values.length>2){var _e=k.scale.ticks(_.values.length);T==="color"&&k.scale.domain(_e)}k.scale.range(_.values)}else((J=k.option)===null||J===void 0?void 0:J.type)==="cat"&&k.scale.range(k.option.domain)}})):(_.type=A.StyleScaleType.CONSTANT,_.defaultValues=I.map(function(k,J){return k.scale(_.names[J])})),_.scalers=I.map(function(k){return{field:k.field,func:k.scale,option:k.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(o,s,l){var d,_=[o,s.name].join("_"),T=(d=s.scale)===null||d===void 0?void 0:d.values,I=this.createScale(o,s.name,T,l);return I}},{key:"parseFields",value:function(o){return Array.isArray(o)?o:lo()(o)?o.split("*"):[o]}},{key:"createScale",value:function(o,s,l,d){var _,T,I=this.scaleOptions[s]&&((_=this.scaleOptions[s])===null||_===void 0?void 0:_.field)===o?this.scaleOptions[s]:this.scaleOptions[o],k={field:o,scale:void 0,type:A.StyleScaleType.VARIABLE,option:I};if(!d||!d.length)return I&&I.type?k.scale=this.createDefaultScale(I):(k.scale=uo([o]),k.type=A.StyleScaleType.CONSTANT),k;var J=(T=d.find(function(Ne){return!en()(Ne[o])}))===null||T===void 0?void 0:T[o];if(this.isNumber(o)||en()(J)&&!I)k.scale=uo([o]),k.type=A.StyleScaleType.CONSTANT;else{var $=I&&I.type||this.getDefaultType(J);l==="text"&&($=A.ScaleTypes.CAT);var _e=this.createDefaultScaleConfig($,o,d);Object.assign(_e,I),k.scale=this.createDefaultScale(_e),k.option=_e}return k}},{key:"getDefaultType",value:function(o){var s=A.ScaleTypes.LINEAR;return typeof o=="string"&&(s=Em.test(o)?A.ScaleTypes.TIME:A.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(o,s,l){var d={type:o},_=(l==null?void 0:l.map(function(T){return T[s]}))||[];return o!==A.ScaleTypes.CAT&&o!==A.ScaleTypes.QUANTILE?d.domain=ci(_):o===A.ScaleTypes.CAT?d.domain=pn()(_):o===A.ScaleTypes.QUANTILE&&(d.domain=_),d}},{key:"createDefaultScale",value:function(o){var s=o.type,l=o.domain,d=wm[s]();return l&&d.domain(l),d}}]),i}(),Hd=(0,ri.Z)(Ld.prototype,"configService",[Vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ld))||Gd),Wd,Xd,Yd,Kd,vd,$d,Jd;function Qd(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Am(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Qd(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Qd(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var Tm=(Wd=(0,Et.b2)(),Xd=(0,Et.f3)(A.vK.ICameraService),Yd=(0,Et.f3)(A.vK.IRendererService),Wd(Kd=(vd=function(){function i(){(0,Y.Z)(this,i),(0,oi.Z)(this,"cameraService",$d,this),(0,oi.Z)(this,"rendererService",Jd,this)}return(0,W.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){o.models.forEach(function(s){s.addUniforms(Am({},o.layerModel.getAnimateUniforms()))})})}}]),i}(),$d=(0,ri.Z)(vd.prototype,"cameraService",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jd=(0,ri.Z)(vd.prototype,"rendererService",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vd))||Kd),qd,ev,Pm=(qd=(0,Et.b2)(),qd(ev=function(){function i(){(0,Y.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(o){o.hooks.init.tap("LayerModelPlugin",function(){o.prepareBuildModel(),o.buildModels(),o.styleNeedUpdate=!1}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return o.prepareBuildModel(),o.clearModels(),o.buildModels(),o.layerModelNeedUpdate=!1,!1})}}]),i}())||ev),tv,rv,Mm=(tv=(0,Et.b2)(),tv(rv=function(){function i(){(0,Y.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(o){o.hooks.afterInit.tap("LayerStylePlugin",function(){o.updateLayerConfig({});var s=o.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&setTimeout(function(){o.fitBounds(d)},100)})}}]),i}())||rv),nv,iv;function av(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Up(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?av(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):av(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var ov={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Im={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Om={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Lm={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},Yg=null;function Rm(i){var c={u_DirectionalLights:new Array(3).fill(Up({},Om)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Up({},Lm)),u_NumOfSpotLights:0};return(!i||!i.length)&&(i=[Im]),i.forEach(function(o,s){var l=o.type,d=l===void 0?"directional":l,_=(0,Sa.Z)(o,["type"]),T=ov[d].lights,I=ov[d].num,k=c[I];c[T][k]=Up(Up({},c[T][k]),_),c[I]++}),c}var km=(nv=(0,Et.b2)(),nv(iv=function(){function i(){(0,Y.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LightingPlugin",function(){var s=o.getLayerConfig(),l=s.enableLighting;l&&o.models.forEach(function(d){return d.addUniforms(Up({},Rm()))})})}}]),i}())||iv),sv,uv,md={NONE:0,ENCODE:1,HIGHLIGHT:2},Dm=(sv=(0,Et.b2)(),sv(uv=function(){function i(){(0,Y.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(o,s){var l=s.rendererService,d=s.styleAttributeService;o.hooks.init.tap("PixelPickingPlugin",function(){var _=o.getLayerConfig(),T=_.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:A.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:A.gl.FLOAT},size:3,update:function(k,J){var $=k.id;return T?(0,et.Z6)($):[0,0,0]}}})}),o.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var _=o.getLayerConfig(),T=_.enablePicking;T&&o.isVisible()&&o.models.forEach(function(I){return I.addUniforms({u_PickingStage:md.ENCODE})})}),o.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var _=o.getLayerConfig(),T=_.enablePicking;T&&o.isVisible()&&o.models.forEach(function(I){return I.addUniforms({u_PickingStage:md.HIGHLIGHT})})}),o.hooks.beforeHighlight.tap("PixelPickingPlugin",function(_){var T=o.getLayerConfig(),I=T.highlightColor,k=typeof I=="string"?(0,et.CI)(I):I||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,et.W0)(new Uint8Array(_))}),o.models.forEach(function(J){return J.addUniforms({u_PickingStage:md.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:k.map(function($){return $*255})})})}),o.hooks.beforeSelect.tap("PixelPickingPlugin",function(_){var T=o.getLayerConfig(),I=T.selectColor,k=typeof I=="string"?(0,et.CI)(I):I||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,et.W0)(new Uint8Array(_))}),o.models.forEach(function(J){return J.addUniforms({u_PickingStage:md.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:k.map(function($){return $*255})})})})}}]),i}())||uv),lv,cv,Fm=(lv=(0,Et.b2)(),lv(cv=function(){function i(){(0,Y.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(o){o.registerStyleAttribute({name:"position",type:A.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:A.gl.FLOAT},size:3,update:function(l,d,_){return _.length===2?[_[0],_[1],0]:[_[0],_[1],_[2]]}}}),o.registerStyleAttribute({name:"filter",type:A.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(l,d){var _=l.filter;return _?[1]:[0]}}}),o.registerStyleAttribute({name:"color",type:A.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:4,update:function(l,d){var _=l.color;return!_||!_.length?[1,1,1,1]:_}}}),o.registerStyleAttribute({name:"vertexId",type:A.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(l,d,_,T){return[d]}}})}}]),i}())||cv),fv,hv,pv,dv,vv,mv,pp,yv,gv,_v,xv,Bm=(fv=(0,Et.b2)(),hv=(0,Et.f3)(A.vK.ICameraService),pv=(0,Et.f3)(A.vK.ICoordinateSystemService),dv=(0,Et.f3)(A.vK.IRendererService),vv=(0,Et.f3)(A.vK.IMapService),fv(mv=(pp=function(){function i(){(0,Y.Z)(this,i),(0,oi.Z)(this,"cameraService",yv,this),(0,oi.Z)(this,"coordinateSystemService",gv,this),(0,oi.Z)(this,"rendererService",_v,this),(0,oi.Z)(this,"mapService",xv,this)}return(0,W.Z)(i,[{key:"apply",value:function(o){var s=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_=[0,0];o.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),_=s.mapService.getCustomCoordCenter());var T=s.rendererService.getViewportSize(),I=T.width,k=T.height;o.models.forEach(function(J){var $;J.addUniforms(($={},(0,L.Z)($,A.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,L.Z)($,A.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,L.Z)($,A.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,L.Z)($,A.CameraUniform.Zoom,s.cameraService.getZoom()),(0,L.Z)($,A.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,L.Z)($,A.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,L.Z)($,A.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,L.Z)($,A.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,L.Z)($,A.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,L.Z)($,A.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,L.Z)($,A.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,L.Z)($,A.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,L.Z)($,A.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,L.Z)($,A.CoordinateUniform.Mvp,d),(0,L.Z)($,"u_SceneCenterMKT",_),(0,L.Z)($,"u_ViewportSize",[I,k]),(0,L.Z)($,"u_DevicePixelRatio",window.devicePixelRatio),(0,L.Z)($,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,L.Z)($,"u_PickingBuffer",o.getLayerConfig().pickingBuffer||0),$))})})}}]),i}(),yv=(0,ri.Z)(pp.prototype,"cameraService",[hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gv=(0,ri.Z)(pp.prototype,"coordinateSystemService",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_v=(0,ri.Z)(pp.prototype,"rendererService",[dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xv=(0,ri.Z)(pp.prototype,"mapService",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pp))||mv),bv,Sv,Nm=(bv=(0,Et.b2)(),bv(Sv=function(){function i(){(0,Y.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("UpdateModelPlugin",function(){o.layerModel&&o.layerModel.needUpdate()})}}]),i}())||Sv),Ev,wv,zm=(Ev=(0,Et.b2)(),Ev(wv=function(){function i(){(0,Y.Z)(this,i)}return(0,W.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(o,{styleAttributeService:d})}),o.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){o.layerModelNeedUpdate||l.updateStyleAtrribute(o,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(o,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[],_=l.getLayerStyleAttribute("filter"),T=l.getLayerStyleAttribute("shape");if(_&&_.needRegenerateVertices||T&&T.needRegenerateVertices){o.layerModelNeedUpdate=!0,d.forEach(function(I){return I.needRegenerateVertices=!1});return}d.filter(function(I){return I.needRegenerateVertices}).forEach(function(I){l.updateAttributeByFeatureRange(I.name,o.getEncodedData(),I.featureRange.startIndex,I.featureRange.endIndex),I.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(o,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[];d.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){l.updateAttributeByFeatureRange(_.name,o.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}}]),i}())||wv);A.nC.bind(A.vK.ILayerPlugin).to(Qr).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Fm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Cm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(tu).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Mm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(zm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Nm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Wo).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Bm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Tm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(km).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Dm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Pm).inRequestScope();var Kg="2.5.12";function Cv(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function $g(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Cv(Object(o),!0).forEach(function(s){Um(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Cv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Um(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function Jg(i,c){return Gm(i)||Vm(i,c)||jm(i,c)||Zm()}function Zm(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jm(i,c){if(!!i){if(typeof i=="string")return Av(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Av(i,c)}}function Av(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function Vm(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,_,T;try{for(o=o.call(i);!(l=(_=o.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function Gm(i){if(Array.isArray(i))return i}var Qg=null,qg=null,Tv,Rd,Pv;function Mv(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Iv(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Mv(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Mv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var Hm=(Tv=(0,A.yT)(A.vK.IGlobalConfigService),Rd=function(){function i(c){(0,Y.Z)(this,i),(0,oi.Z)(this,"configService",Pv,this),(0,L.Z)(this,"config",void 0),this.config=c}return(0,W.Z)(i,[{key:"setContainer",value:function(o,s){o.bind(A.vK.MapConfig).toConstantValue(Iv(Iv({},this.config),{},{id:s})),o.bind(A.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),i}(),Pv=(0,ri.Z)(Rd.prototype,"configService",[Tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd),Wm=E(6158),Xm=E.n(Wm),kd;(function(i){i["GAODE1.x"]="GAODE1.x",i["GAODE2.x"]="GAODE2.x",i.MAPBOX="MAPBOX",i.L7MAP="L7MAP"})(kd||(kd={}));function Zp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function yd(i,c){var o=Nu.fF([],c,i);return Nu.bA(o,o,1/o[3]),o}function e0(i,c){var o=i%c;return o<0?c+o:o}function t0(i,c,o){return o*c+(1-o)*i}function Rh(i,c){if(!i)throw new Error(c||"viewport-mercator-project: assertion failed.")}var Yc=Math.PI,Ov=Yc/4,Lf=Yc/180,Lv=180/Yc,Dd=512,Fd=4003e4,Ym=1.5;function Rv(i){return Math.pow(2,i)}function Km(i){return Math.log2(i)}function gd(i,c){var o=(0,Q.Z)(i,2),s=o[0],l=o[1];Rh(Number.isFinite(s)&&Number.isFinite(c)),Rh(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=Dd;var d=s*Lf,_=l*Lf,T=c*(d+Yc)/(2*Yc),I=c*(Yc-Math.log(Math.tan(Ov+_*.5)))/(2*Yc);return[T,I]}function Bd(i,c){var o=(0,Q.Z)(i,2),s=o[0],l=o[1];c*=Dd;var d=s/c*(2*Yc)-Yc,_=2*(Math.atan(Math.exp(Yc-l/c*(2*Yc)))-Ov);return[d*Lv,_*Lv]}function r0(i){var c=i.latitude;assert(Number.isFinite(c));var o=Math.cos(c*Lf);return Km(Fd*o)-9}function kv(i){var c=i.latitude,o=i.longitude,s=i.zoom,l=i.scale,d=i.highPrecision,_=d===void 0?!1:d;l=l!==void 0?l:Rv(s),Rh(Number.isFinite(c)&&Number.isFinite(o)&&Number.isFinite(l));var T={},I=Dd*l,k=Math.cos(c*Lf),J=I/360,$=J/k,_e=I/Fd/k;if(T.pixelsPerMeter=[_e,-_e,_e],T.metersPerPixel=[1/_e,-1/_e,1/_e],T.pixelsPerDegree=[J,-$,_e],T.degreesPerPixel=[1/J,-1/$,1/_e],_){var Ne=Lf*Math.tan(c*Lf)/k,mt=J*Ne/2,Bt=I/Fd*Ne,mr=Bt/$*_e;T.pixelsPerDegree2=[0,-mt,Bt],T.pixelsPerMeter2=[mr,0,mr]}return T}function n0(i,c){var o=_slicedToArray(i,3),s=o[0],l=o[1],d=o[2],_=_slicedToArray(c,3),T=_[0],I=_[1],k=_[2],J=1,$=kv({longitude:s,latitude:l,scale:J,highPrecision:!0}),_e=$.pixelsPerMeter,Ne=$.pixelsPerMeter2,mt=gd(i,J);mt[0]+=T*(_e[0]+Ne[0]*I),mt[1]+=I*(_e[1]+Ne[1]*I);var Bt=Bd(mt,J),mr=(d||0)+(k||0);return Number.isFinite(d)||Number.isFinite(k)?[Bt[0],Bt[1],mr]:Bt}function $m(i){var c=i.height,o=i.pitch,s=i.bearing,l=i.altitude,d=i.center,_=d===void 0?null:d,T=i.flipY,I=T===void 0?!1:T,k=Zp();return za.translate(k,k,[0,0,-l]),za.scale(k,k,[1,1,1/c]),za.rotateX(k,k,-o*Lf),za.rotateZ(k,k,s*Lf),I&&za.scale(k,k,[1,-1,1]),_&&za.translate(k,k,qn.negate([],_)),k}function Jm(i){var c=i.width,o=i.height,s=i.altitude,l=s===void 0?Ym:s,d=i.pitch,_=d===void 0?0:d,T=i.nearZMultiplier,I=T===void 0?1:T,k=i.farZMultiplier,J=k===void 0?1:k,$=_*Lf,_e=Math.atan(.5/l),Ne=Math.sin(_e)*l/Math.sin(Math.PI/2-$-_e),mt=Math.cos(Math.PI/2-$)*Ne+l;return{fov:2*Math.atan(o/2/l),aspect:c/o,focalDistance:l,near:I,far:mt*J}}function Qm(i){var c=i.width,o=i.height,s=i.pitch,l=i.altitude,d=i.nearZMultiplier,_=i.farZMultiplier,T=Jm({width:c,height:o,altitude:l,pitch:s,nearZMultiplier:d,farZMultiplier:_}),I=T.fov,k=T.aspect,J=T.near,$=T.far,_e=za.perspective([],I,k,J,$);return _e}function qm(i,c){var o=(0,Q.Z)(i,3),s=o[0],l=o[1],d=o[2],_=d===void 0?0:d;return Rh(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(_)),yd(c,[s,l,_,1])}function Dv(i,c){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,Q.Z)(i,3),l=s[0],d=s[1],_=s[2];if(Rh(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(_)){var T=yd(c,[l,d,_,1]);return T}var I=yd(c,[l,d,0,1]),k=yd(c,[l,d,1,1]),J=I[2],$=k[2],_e=J===$?0:((o||0)-J)/($-J);return S.lerp([],I,k,_e)}var Fv=Zp(),ey=function(){function i(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=c.width,s=c.height,l=c.viewMatrix,d=l===void 0?Fv:l,_=c.projectionMatrix,T=_===void 0?Fv:_;(0,Y.Z)(this,i),this.width=o||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=T;var I=Zp();za.multiply(I,I,this.projectionMatrix),za.multiply(I,I,this.viewMatrix),this.viewProjectionMatrix=I;var k=Zp();za.scale(k,k,[this.width/2,-this.height/2,1]),za.translate(k,k,[1,-1,0]),za.multiply(k,k,this.viewProjectionMatrix);var J=za.invert(Zp(),k);if(!J)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=k,this.pixelUnprojectionMatrix=J,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,W.Z)(i,[{key:"equals",value:function(o){return o instanceof i?o.width===this.width&&o.height===this.height&&za.equals(o.projectionMatrix,this.projectionMatrix)&&za.equals(o.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,_=this.projectPosition(o),T=qm(_,this.pixelProjectionMatrix),I=(0,Q.Z)(T,2),k=I[0],J=I[1],$=d?J:this.height-J;return o.length===2?[k,$]:[k,$,T[2]]}},{key:"unproject",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,_=s.targetZ,T=(0,Q.Z)(o,3),I=T[0],k=T[1],J=T[2],$=d?k:this.height-k,_e=_&&_*this.pixelsPerMeter,Ne=Dv([I,$,J],this.pixelUnprojectionMatrix,_e),mt=this.unprojectPosition(Ne),Bt=(0,Q.Z)(mt,3),mr=Bt[0],Sr=Bt[1],Zr=Bt[2];return Number.isFinite(J)?[mr,Sr,Zr]:Number.isFinite(_)?[mr,Sr,_]:[mr,Sr]}},{key:"projectPosition",value:function(o){var s=this.projectFlat(o),l=(0,Q.Z)(s,2),d=l[0],_=l[1],T=(o[2]||0)*this.pixelsPerMeter;return[d,_,T]}},{key:"unprojectPosition",value:function(o){var s=this.unprojectFlat(o),l=(0,Q.Z)(s,2),d=l[0],_=l[1],T=(o[2]||0)/this.pixelsPerMeter;return[d,_,T]}},{key:"projectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}},{key:"unprojectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}}]),i}();function ty(i){var c=i.width,o=i.height,s=i.bounds,l=i.minExtent,d=l===void 0?0:l,_=i.maxZoom,T=_===void 0?24:_,I=i.padding,k=I===void 0?0:I,J=i.offset,$=J===void 0?[0,0]:J,_e=(0,Q.Z)(s,2),Ne=(0,Q.Z)(_e[0],2),mt=Ne[0],Bt=Ne[1],mr=(0,Q.Z)(_e[1],2),Sr=mr[0],Zr=mr[1];if(Number.isFinite(k)){var xn=k;k={top:xn,bottom:xn,left:xn,right:xn}}else Rh(Number.isFinite(k.top)&&Number.isFinite(k.bottom)&&Number.isFinite(k.left)&&Number.isFinite(k.right));var Rn=new Bv({width:c,height:o,longitude:0,latitude:0,zoom:0}),Xn=Rn.project([mt,Zr]),Ci=Rn.project([Sr,Bt]),Jn=[Math.max(Math.abs(Ci[0]-Xn[0]),d),Math.max(Math.abs(Ci[1]-Xn[1]),d)],Pi=[c-k.left-k.right-Math.abs($[0])*2,o-k.top-k.bottom-Math.abs($[1])*2];Rh(Pi[0]>0&&Pi[1]>0);var aa=Pi[0]/Jn[0],ma=Pi[1]/Jn[1],di=(k.right-k.left)/2/aa,Ma=(k.bottom-k.top)/2/ma,eo=[(Ci[0]+Xn[0])/2+di,(Ci[1]+Xn[1])/2+Ma],Eu=Rn.unproject(eo),vp=Rn.zoom+Math.log2(Math.abs(Math.min(aa,ma)));return{longitude:Eu[0],latitude:Eu[1],zoom:Math.min(vp,T)}}var Bv=function(i){(0,Be.Z)(c,i);function c(){var o,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,d=s.height,_=s.latitude,T=_===void 0?0:_,I=s.longitude,k=I===void 0?0:I,J=s.zoom,$=J===void 0?0:J,_e=s.pitch,Ne=_e===void 0?0:_e,mt=s.bearing,Bt=mt===void 0?0:mt,mr=s.altitude,Sr=mr===void 0?1.5:mr,Zr=s.nearZMultiplier,xn=s.farZMultiplier;(0,Y.Z)(this,c),l=l||1,d=d||1;var Rn=Rv($);Sr=Math.max(.75,Sr);var Xn=gd([k,T],Rn);Xn[2]=0;var Ci=Qm({width:l,height:d,pitch:Ne,bearing:Bt,altitude:Sr,nearZMultiplier:Zr||1/d,farZMultiplier:xn||1.01}),Jn=$m({height:d,center:Xn,pitch:Ne,bearing:Bt,altitude:Sr,flipY:!0});return o=(0,Ye.Z)(this,(0,Je.Z)(c).call(this,{width:l,height:d,viewMatrix:Jn,projectionMatrix:Ci})),o.latitude=T,o.longitude=k,o.zoom=$,o.pitch=Ne,o.bearing=Bt,o.altitude=Sr,o.scale=Rn,o.center=Xn,o.pixelsPerMeter=kv((0,N.Z)((0,N.Z)(o))).pixelsPerMeter[2],Object.freeze((0,N.Z)((0,N.Z)(o))),o}return(0,W.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return gd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Bd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,d=s.pos,_=Dv(d,this.pixelUnprojectionMatrix),T=gd(l,this.scale),I=S.add([],T,S.negate([],_)),k=S.add([],this.center,I);return Bd(k,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,_=this.height,T=ty(Object.assign({width:d,height:_,bounds:s},l)),I=T.longitude,k=T.latitude,J=T.zoom;return new c({width:d,height:_,longitude:I,latitude:k,zoom:J})}}]),c}(ey),ry=function(){function i(){(0,Y.Z)(this,i),(0,L.Z)(this,"viewport",void 0)}return(0,W.Z)(i,[{key:"syncWithMapCamera",value:function(o){var s=o.center,l=o.zoom,d=o.pitch,_=o.bearing,T=o.viewportHeight,I=o.viewportWidth;this.viewport=new Bv({width:I,height:T,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:d,bearing:_})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(o,s){return this.viewport.projectFlat(o,s)}}]),i}(),Nv={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},zv,Uv,Zv,jv,Vv,Gv,dp,Hv,Wv,Xv,Yv;function Kv(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function ny(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Kv(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Kv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function iy(i,c){if(c||(c=document),!!c){var o=c.head||c.getElementsByTagName("head")[0];if(!o){o=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(o,s):c.documentElement.appendChild(o)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=i:l.appendChild(c.createTextNode(i)),o.appendChild(l),l}}iy(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Xm();var $v={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},ay=0,oy=12,Jv="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",sy=(zv=(0,Et.b2)(),Uv=(0,Et.f3)(A.vK.MapConfig),Zv=(0,Et.f3)(A.vK.IGlobalConfigService),jv=(0,Et.f3)(A.vK.ICoordinateSystemService),Vv=(0,Et.f3)(A.vK.IEventEmitter),zv(Gv=(dp=function(){function i(){var c=this;(0,Y.Z)(this,i),(0,L.Z)(this,"version",kd.MAPBOX),(0,L.Z)(this,"map",void 0),(0,oi.Z)(this,"config",Hv,this),(0,oi.Z)(this,"configService",Wv,this),(0,oi.Z)(this,"coordinateSystemService",Xv,this),(0,oi.Z)(this,"eventEmitter",Yv,this),(0,L.Z)(this,"viewport",void 0),(0,L.Z)(this,"markerContainer",void 0),(0,L.Z)(this,"cameraChangedCallback",void 0),(0,L.Z)(this,"$mapContainer",void 0),(0,L.Z)(this,"handleCameraChanged",function(){var o=c.map.getCenter().wrap(),s=o.lat,l=o.lng;c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var d=c.config.offsetZoom,_=d===void 0?oy:d;c.viewport.getZoom()>_?c.coordinateSystemService.setCoordinateSystem(A.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(A.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,W.Z)(i,[{key:"addMarkerContainer",value:function(){var o=this.map.getCanvasContainer();this.markerContainer=et.SO.create("div","l7-marker-container",o),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(o,s){A.MapServiceEvent.indexOf(o)!==-1?this.eventEmitter.on(o,s):this.map.on($v[o]||o,s)}},{key:"off",value:function(o,s){this.map.off($v[o]||o,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var o=this.map.transform;return[o.width,o.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(o){return this.map.setZoom(o)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(o){this.map.setCenter(o)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(o){this.map.setBearing(o)}},{key:"zoomIn",value:function(o,s){this.map.zoomIn(o,s)}},{key:"zoomOut",value:function(o,s){this.map.zoomOut(o,s)}},{key:"setPitch",value:function(o){return this.map.setPitch(o)}},{key:"panTo",value:function(o){this.map.panTo(o)}},{key:"panBy",value:function(o){this.panTo(o)}},{key:"fitBounds",value:function(o,s){this.map.fitBounds(o,s)}},{key:"setMaxZoom",value:function(o){this.map.setMaxZoom(o)}},{key:"setMinZoom",value:function(o){this.map.setMinZoom(o)}},{key:"setMapStatus",value:function(o){o.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),o.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),o.dragEnable===!1&&this.map.dragPan.disable(),o.dragEnable===!0&&this.map.dragPan.enable(),o.rotateEnable===!1&&this.map.dragRotate.disable(),o.rotateEnable===!0&&this.map.dragRotate.enable(),o.keyboardEnable===!1&&this.map.keyboard.disable(),o.keyboardEnable===!0&&this.map.keyboard.enable(),o.zoomEnable===!1&&this.map.scrollZoom.disable(),o.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(o,s){this.map.flyTo({zoom:o,center:s})}},{key:"setMapStyle",value:function(o){this.map.setStyle(this.getMapStyle(o))}},{key:"pixelToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToPixel",value:function(o){return this.map.project(o)}},{key:"containerToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToContainer",value:function(o){return this.map.project(o)}},{key:"lngLatToMercator",value:function(o,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),d=l.x,_=d===void 0?0:d,T=l.y,I=T===void 0?0:T,k=l.z,J=k===void 0?0:k;return{x:_,y:I,z:J}}},{key:"getModelMatrix",value:function(o,s,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},T=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),I=T.meterInMercatorCoordinateUnits(),k=za.create();return za.translate(k,k,qn.fromValues(T.x-_.x,T.y-_.y,T.z||0-_.z)),za.scale(k,k,qn.fromValues(I*d[0],-I*d[1],I*d[2])),za.rotateX(k,k,l[0]),za.rotateY(k,k,l[1]),za.rotateZ(k,k,l[2]),k}},{key:"init",value:function(){var c=(0,yt.Z)(jt().mark(function s(){var l,d,_,T,I,k,J,$,_e,Ne,mt,Bt,mr;return jt().wrap(function(Zr){for(;;)switch(Zr.prev=Zr.next){case 0:l=this.config,d=l.id,_=d===void 0?"map":d,T=l.attributionControl,I=T===void 0?!1:T,k=l.style,J=k===void 0?"light":k,$=l.token,_e=$===void 0?Jv:$,Ne=l.rotation,mt=Ne===void 0?0:Ne,Bt=l.mapInstance,mr=(0,Sa.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new ry,!Bt&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),_e===Jv&&J!=="blank"&&!window.mapboxgl.accessToken&&!Bt&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Bt&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=_e),Bt?(this.map=Bt,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(_),this.map=new window.mapboxgl.Map(ny({container:this.$mapContainer,style:this.getMapStyle(J),attributionControl:I,bearing:mt},mr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Zr.stop()}},s,this)}));function o(){return c.apply(this,arguments)}return o}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(o){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),_=1;_<l;_++)d[_-1]=arguments[_];(s=this.eventEmitter).emit.apply(s,[o].concat(d))}},{key:"once",value:function(o){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),_=1;_<l;_++)d[_-1]=arguments[_];(s=this.eventEmitter).once.apply(s,[o].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(o){var s=this.map.getCanvas(),l=o==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(o){this.cameraChangedCallback=o}},{key:"creatAmapContainer",value:function(o){var s=o;typeof o=="string"&&(s=document.getElementById(o));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+ay++,s.appendChild(l),l}},{key:"getMapStyle",value:function(o){return typeof o!="string"?o:Nv[o]?Nv[o]:o}}]),i}(),Hv=(0,ri.Z)(dp.prototype,"config",[Uv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wv=(0,ri.Z)(dp.prototype,"configService",[Zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xv=(0,ri.Z)(dp.prototype,"coordinateSystemService",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yv=(0,ri.Z)(dp.prototype,"eventEmitter",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dp))||Gv);function uy(i){var c=ly();return function(){var s=(0,Je.Z)(i),l;if(c){var d=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ly(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function cy(i,c){if(c||(c=document),!!c){var o=c.head||c.getElementsByTagName("head")[0];if(!o){o=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(o,s):c.documentElement.appendChild(o)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=i:l.appendChild(c.createTextNode(i)),o.appendChild(l),l}}cy(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var fy=function(i){(0,Be.Z)(o,i);var c=uy(o);function o(){return(0,Y.Z)(this,o),c.apply(this,arguments)}return(0,W.Z)(o,[{key:"getServiceConstructor",value:function(){return sy}}]),o}(Hm);function Qv(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function qv(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Qv(Object(o),!0).forEach(function(s){hy(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Qv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function hy(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function py(i,c){return gy(i)||yy(i,c)||vy(i,c)||dy()}function dy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vy(i,c){if(!!i){if(typeof i=="string")return em(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return em(i,c)}}function em(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function yy(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,_,T;try{for(o=o.call(i);!(l=(_=o.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function gy(i){if(Array.isArray(i))return i}var _y=le.memo(function(i){var c=i.style,o=i.className,s=i.map,l=i.option,d=i.onSceneLoaded,_=(0,le.createRef)(),T=(0,le.useState)(),I=py(T,2),k=I[0],J=I[1];return(0,le.useEffect)(function(){var $=new ca(qv(qv({id:_.current},l),{},{map:new fy(s)}));return $.on("loaded",function(){J($),d&&d($)}),function(){$.destroy()}},[]),(0,le.useEffect)(function(){k&&s.style&&k.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,le.useEffect)(function(){k&&s.zoom&&k.setZoom(s.zoom)},[s.zoom]),(0,le.useEffect)(function(){k&&s.center&&k.setCenter(s.center)},[JSON.stringify(s.center)]),(0,le.useEffect)(function(){k&&s.pitch!==void 0&&k.setPitch(s.pitch||0)},[s.pitch]),(0,le.useEffect)(function(){k&&s.rotation&&k.setRotation(s.rotation)},[s.rotation]),le.createElement(C.Provider,{value:k},(0,le.createElement)("div",{ref:_,style:c,className:o},k&&i.children))}),xy=_y;function tm(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function i0(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?tm(Object(o),!0).forEach(function(s){by(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):tm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function by(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function a0(i,c){return Cy(i)||wy(i,c)||Ey(i,c)||Sy()}function Sy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ey(i,c){if(!!i){if(typeof i=="string")return rm(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return rm(i,c)}}function rm(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function wy(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,_,T;try{for(o=o.call(i);!(l=(_=o.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function Cy(i){if(Array.isArray(i))return i}var o0=null,s0=null;function nm(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function u0(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?nm(Object(o),!0).forEach(function(s){Ay(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):nm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Ay(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function l0(i,c){return Iy(i)||My(i,c)||Py(i,c)||Ty()}function Ty(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Py(i,c){if(!!i){if(typeof i=="string")return im(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return im(i,c)}}function im(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function My(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,_,T;try{for(o=o.call(i);!(l=(_=o.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function Iy(i){if(Array.isArray(i))return i}var c0=null,f0=null;function h0(i,c){return ky(i)||Ry(i,c)||Ly(i,c)||Oy()}function Oy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ly(i,c){if(!!i){if(typeof i=="string")return am(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return am(i,c)}}function am(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function Ry(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,_,T;try{for(o=o.call(i);!(l=(_=o.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function ky(i){if(Array.isArray(i))return i}var p0=null,d0=null;function om(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function v0(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?om(Object(o),!0).forEach(function(s){Dy(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):om(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Dy(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function m0(i,c){if(i==null)return{};var o=Fy(i,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(o[s]=i[s]))}return o}function Fy(i,c){if(i==null)return{};var o={},s=Object.keys(i),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(o[l]=i[l]);return o}var y0=null,sm=E(73935);function By(i,c){return Zy(i)||Uy(i,c)||zy(i,c)||Ny()}function Ny(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zy(i,c){if(!!i){if(typeof i=="string")return um(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return um(i,c)}}function um(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function Uy(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,_,T;try{for(o=o.call(i);!(l=(_=o.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function Zy(i){if(Array.isArray(i))return i}var jy=le.useEffect,Vy=le.useState;function g0(i){var c=i.className,o=i.style,s=i.children,l=i.position,d=useSceneValue(),_=Vy(function(){return document.createElement("div")}),T=By(_,1),I=T[0];return jy(function(){var k=new Control({position:l});return k.onAdd=function(){if(c&&(I.className=c),o){var J=Object.keys(o).map(function($){return"".concat($,":").concat(o[$])}).join(";");I.style.cssText=J}return I},d.addControl(k),function(){d.removeControl(k)}},[]),createPortal(s,I)}var lm=(0,le.createContext)({});function _0(){return useContext(lm)}var Gy=le.useEffect,Hy=le.memo(function(c){var o=c.layer,s=c.active;return Gy(function(){o.active(s.option)},[JSON.stringify(s)]),null}),Wy=le.useEffect,Xy=le.memo(function(c){var o=c.layer,s=c.animate;return Wy(function(){o.animate(s)},[JSON.stringify(s)]),null}),Yy=le.useEffect,Ky=le.memo(function(c){var o=c.layer,s=c.color;return Yy(function(){s.field?o.color(s.field,s.values):o.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),$y=le.useEffect,Jy=le.memo(function(c){var o=c.layer,s=c.filter;return $y(function(){s.field&&o.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Qy=le.useEffect,qy=le.memo(function(c){var o=c.layer,s=c.scale;return Qy(function(){o.scale(s.values)},[s.values]),null}),eg=le.useEffect,tg=le.memo(function(c){var o=c.layer,s=c.select;return eg(function(){o.select(s.option)},[JSON.stringify(s)]),null}),rg=le.useEffect,ng=le.memo(function(c){var o=c.layer,s=c.shape;return rg(function(){s.field?o.shape(s.field,s.values):o.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),ig=le.useEffect,ag=le.memo(function(c){var o=c.layer,s=c.size;return ig(function(){s.field?o.size(s.field,s.values):o.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),og=["data"];function sg(i,c){if(i==null)return{};var o=ug(i,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(o[s]=i[s]))}return o}function ug(i,c){if(i==null)return{};var o={},s=Object.keys(i),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(o[l]=i[l]);return o}var lg=le.useEffect,cg=le.memo(function(c){var o=c.layer,s=c.source,l=s.data,d=sg(s,og);return lg(function(){o.inited?o.setData(l,d):o.source(l,d),d.autoFit&&o.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),fg=le.useEffect,hg=le.memo(function(c){var o=c.layer,s=c.style;return fg(function(){o.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function pg(i,c){return yg(i)||mg(i,c)||vg(i,c)||dg()}function dg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vg(i,c){if(!!i){if(typeof i=="string")return cm(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return cm(i,c)}}function cm(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function mg(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,_,T;try{for(o=o.call(i);!(l=(_=o.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){d=!0,T=I}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function yg(i){if(Array.isArray(i))return i}var jp=le.useEffect,gg=le.useState;function fm(i,c){var o=c.source,s=c.color,l=c.shape,d=c.style,_=c.size,T=c.scale,I=c.active,k=c.select,J=c.filter,$=c.animate,_e=c.options,Ne=c.onLayerLoaded,mt=p(),Bt=gg(function(){var Zr;switch(i){case"polygonLayer":Zr=new qt(_e);break;case"lineLayer":Zr=new eu(_e);break;case"pointLayer":Zr=new ni(_e);break;case"heatmapLayer":Zr=new Us(_e);break;case"rasterLayer":Zr=new oo(_e);break;case"imageLayer":Zr=new dn(_e);break;case"citybuildingLayer":Zr=new hc(_e);break;default:Zr=new qt(_e)}return Zr.on("inited",function(){Ne&&Ne(Zr,mt)}),Zr}),mr=pg(Bt,1),Sr=mr[0];return jp(function(){return mt.addLayer(Sr),function(){mt.removeLayer(Sr)}},[]),jp(function(){Sr.inited&&_e&&Sr.updateLayerConfig(_e)},[_e==null?void 0:_e.minZoom,_e==null?void 0:_e.maxZoom,_e==null?void 0:_e.visible]),jp(function(){Sr.inited&&(_e==null?void 0:_e.zIndex)&&Sr.setIndex(_e.zIndex)},[_e==null?void 0:_e.zIndex]),jp(function(){Sr.inited&&(_e==null?void 0:_e.blend)&&Sr.setBlend(_e.blend)},[_e==null?void 0:_e.blend]),jp(function(){mt.render()}),le.createElement(lm.Provider,{value:Sr},le.createElement(cg,{layer:Sr,source:o}),T&&le.createElement(qy,{layer:Sr,scale:T}),s&&le.createElement(Ky,{layer:Sr,color:s}),_&&le.createElement(ag,{layer:Sr,size:_}),l&&le.createElement(ng,{layer:Sr,shape:l}),d&&le.createElement(hg,{layer:Sr,style:d}),I&&le.createElement(Hy,{layer:Sr,active:I}),k&&le.createElement(tg,{layer:Sr,select:k}),J&&le.createElement(Jy,{layer:Sr,filter:J}),$&&le.createElement(Xy,{layer:Sr,animate:$}),c.children)}var x0=null,b0=null,_g=le.memo(function(c){return fm("pointLayer",c)}),xg=le.memo(function(c){return fm("heatmapLayer",c)}),S0=null,E0=null,w0=null,C0=le.useEffect,A0=null,T0=null;function _d(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_d=function(o){return typeof o}:_d=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_d(i)}function hm(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function xd(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?hm(Object(o),!0).forEach(function(s){bg(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):hm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function bg(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function Sg(i,c){if(!(i instanceof c))throw new TypeError("Cannot call a class as a function")}function pm(i,c){for(var o=0;o<c.length;o++){var s=c[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function Eg(i,c,o){return c&&pm(i.prototype,c),o&&pm(i,o),i}function wg(i,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(c&&c.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),c&&Nd(i,c)}function Nd(i,c){return Nd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Nd(i,c)}function Cg(i){var c=Pg();return function(){var s=bd(i),l;if(c){var d=bd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Ag(this,l)}}function Ag(i,c){return c&&(_d(c)==="object"||typeof c=="function")?c:Tg(i)}function Tg(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Pg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function bd(i){return bd=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},bd(i)}var P0=function(i){wg(o,i);var c=Cg(o);function o(s){var l;return Sg(this,o),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return Eg(o,[{key:"componentDidMount",value:function(){var l,d=this.props,_=d.lnglat,T=d.children,I=d.option,k=d.lngLat,J=new je(xd(xd({},I),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));_&&J.setLnglat(_),k&&J.setLnglat(k),T&&J.setDOMContent(this.el),this.popup=J,this.scene.addPopup(J)}},{key:"componentDidUpdate",value:function(l){var d,_,T,I,k,J,$=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(_=l.lnglat)===null||_===void 0?void 0:_.lat],_e=Array.isArray(this.props.lnglat)?this.props.lnglat:[(T=this.props)===null||T===void 0||(I=T.lnglat)===null||I===void 0?void 0:I.lng,(k=this.props)===null||k===void 0||(J=k.lnglat)===null||J===void 0?void 0:J.lat],Ne=$.toString()!==_e.toString();if(Ne){var mt;this.popup.remove(),this.popup=new je(xd(xd({},this.props.option),{},{stopPropagation:(mt=this.props.option)===null||mt===void 0?void 0:mt.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return le.createElement(C.Consumer,{},function(d){return d&&(l.scene=d),(0,sm.createPortal)(l.props.children,l.el)})}}]),o}(le.PureComponent);function Sd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Sd=function(o){return typeof o}:Sd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Sd(i)}function Mg(i,c){if(!(i instanceof c))throw new TypeError("Cannot call a class as a function")}function dm(i,c){for(var o=0;o<c.length;o++){var s=c[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function Ig(i,c,o){return c&&dm(i.prototype,c),o&&dm(i,o),i}function Og(i,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(c&&c.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),c&&zd(i,c)}function zd(i,c){return zd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},zd(i,c)}function Lg(i){var c=Dg();return function(){var s=Ed(i),l;if(c){var d=Ed(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Rg(this,l)}}function Rg(i,c){return c&&(Sd(c)==="object"||typeof c=="function")?c:kg(i)}function kg(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Dg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Ed(i){return Ed=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Ed(i)}var M0=function(i){Og(o,i);var c=Lg(o);function o(s){var l;return Mg(this,o),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return Ig(o,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,_=l.children,T=l.option,I=l.onMarkerLoaded,k=new kr(T);d&&k.setLnglat(d),_&&k.setElement(this.el),this.marker=k,I&&I(k),this.scene.addMarker(k)}},{key:"componentDidUpdate",value:function(l){var d,_=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());_&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return le.createElement(C.Consumer,{},function(d){return d&&(l.scene=d),(0,sm.createPortal)(l.props.children,l.el)})}}]),o}(le.PureComponent),I0=le.useEffect,O0=null,L0=null,R0=le.useEffect,k0=null},4771:function(){},6563:function(Or,U,E){var le=E(31795);Or.exports=C;function C(L,N){switch(L&&L.type||null){case"FeatureCollection":return L.features=L.features.map(p(C,N)),L;case"GeometryCollection":return L.geometries=L.geometries.map(p(C,N)),L;case"Feature":return L.geometry=C(L.geometry,N),L;case"Polygon":case"MultiPolygon":return A(L,N);default:return L}}function p(L,N){return function(Be){return L(Be,N)}}function A(L,N){return L.type==="Polygon"?L.coordinates=Q(L.coordinates,N):L.type==="MultiPolygon"&&(L.coordinates=L.coordinates.map(p(Q,N))),L}function Q(L,N){N=!!N,L[0]=Y(L[0],N);for(var Be=1;Be<L.length;Be++)L[Be]=Y(L[Be],!N);return L}function Y(L,N){return W(L)===N?L:L.reverse()}function W(L){return le.ring(L)>=0}},6901:function(Or,U,E){"use strict";E.d(U,{SO:function(){return le},z6:function(){return gt},a5:function(){return C},Z:function(){return Et},rQ:function(){return kn},bV:function(){return Cr},zi:function(){return Zn},ds:function(){return rt},Ev:function(){return pt},oO:function(){return Lr},W0:function(){return Ur},Z6:function(){return nn},We:function(){return er},Cl:function(){return Jr},gJ:function(){return Ue},vP:function(){return je},yM:function(){return ie},yA:function(){return Br},CI:function(){return Vr}});var le={};E.r(le),E.d(le,{DPR:function(){return Ke},addClass:function(){return et},create:function(){return Ye},empty:function(){return Pt},getClass:function(){return zt},getContainer:function(){return W},getViewPortScale:function(){return Ct},hasClass:function(){return Gt},printCanvas:function(){return vr},remove:function(){return Je},removeClass:function(){return Yt},setClass:function(){return tr},setTransform:function(){return yr},splitWords:function(){return N},triggerResize:function(){return ee},trim:function(){return L}});var C={};E.r(C),E.d(C,{getColumn:function(){return ce},getSatByColumn:function(){return me},max:function(){return Si},mean:function(){return Di},min:function(){return zi},mode:function(){return Oi},statMap:function(){return X},sum:function(){return Ji}});function p(z){var oe=131,ve=137,Ae=0;z+="x";for(var se=Math.floor(9007199254740991/ve),Ce=0;Ce<z.length;Ce++)Ae>se&&(Ae=Math.floor(Ae/ve)),Ae=Ae*oe+z.charCodeAt(Ce);return Ae}function A(z){z=z.toString();for(var oe=5381,ve=z.length;ve;)oe=oe*33^z.charCodeAt(--ve);return oe>>>0}var Q=E(28481),Y=window.document.documentElement.style;function W(z){var oe=z;return typeof z=="string"&&(oe=document.getElementById(z)),oe}function L(z){return z.trim?z.trim():z.replace(/^\s+|\s+$/g,"")}function N(z){return L(z).split(/\s+/)}function Be(z){if(!Y)return z[0];for(var oe in z)if(z[oe]&&z[oe]in Y)return z[oe];return z[0]}function Ye(z,oe,ve){var Ae=document.createElement(z);return Ae.className=oe||"",ve&&ve.appendChild(Ae),Ae}function Je(z){var oe=z.parentNode;oe&&oe.removeChild(z)}function et(z,oe){if(z.classList!==void 0)for(var ve=N(oe),Ae=0,se=ve.length;Ae<se;Ae++)z.classList.add(ve[Ae]);else if(!Gt(z,oe)){var Ce=zt(z);tr(z,(Ce?Ce+" ":"")+oe)}}function Yt(z,oe){z.classList!==void 0?z.classList.remove(oe):tr(z,L((" "+zt(z)+" ").replace(" "+oe+" "," ")))}function Gt(z,oe){if(z.classList!==void 0)return z.classList.contains(oe);var ve=zt(z);return ve.length>0&&new RegExp("(^|\\s)"+oe+"(\\s|$)").test(ve)}function tr(z,oe){z instanceof HTMLElement?z.className=oe:z.className.baseVal=oe}function zt(z){return z instanceof SVGElement&&(z=z.correspondingElement),z.className.baseVal===void 0?z.className:z.className.baseVal}function Pt(z){for(;z&&z.firstChild;)z.removeChild(z.firstChild)}var xt=Be(["transform","WebkitTransform"]);function yr(z,oe){z.style[xt]=oe}function ee(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var z=window.document.createEvent("UIEvents");z.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(z)}}function vr(z){var oe=["padding: "+(z.height/2-8)+"px "+z.width/2+"px;","line-height: "+z.height+"px;","background-image: url("+z.toDataURL()+");"];console.log(`%c
`,oe.join(""))}function Ct(){var z,oe=document.querySelector('meta[name="viewport"]');if(!oe)return 1;var ve=(z=oe.content)===null||z===void 0?void 0:z.split(","),Ae=ve.find(function(se){var Ce=se.split("="),ct=(0,Q.Z)(Ce,2),xr=ct[0],Ht=ct[1];return xr==="initial-scale"});return Ae?Ae.split("=")[1]*1:1}var Ke=Ct()<1?1:window.devicePixelRatio,Rt=E(6610),Xe=E(5991),Ut=E(63349),_r=E(10379),or=E(46070),zr=E(77608),he=E(14665);function Re(z){return Function.toString.call(z).indexOf("[native code]")!==-1}var ye=E(51814);function _t(z,oe,ve){return(0,ye.Z)()?_t=Reflect.construct:_t=function(se,Ce,ct){var xr=[null];xr.push.apply(xr,Ce);var Ht=Function.bind.apply(se,xr),Jt=new Ht;return ct&&(0,he.Z)(Jt,ct.prototype),Jt},_t.apply(null,arguments)}function ft(z){var oe=typeof Map=="function"?new Map:void 0;return ft=function(Ae){if(Ae===null||!Re(Ae))return Ae;if(typeof Ae!="function")throw new TypeError("Super expression must either be null or a function");if(typeof oe!="undefined"){if(oe.has(Ae))return oe.get(Ae);oe.set(Ae,se)}function se(){return _t(Ae,arguments,(0,zr.Z)(this).constructor)}return se.prototype=Object.create(Ae.prototype,{constructor:{value:se,enumerable:!1,writable:!0,configurable:!0}}),(0,he.Z)(se,Ae)},ft(z)}var Nt=E(96156);function Ft(z){var oe=kr();return function(){var Ae=(0,zr.Z)(z),se;if(oe){var Ce=(0,zr.Z)(this).constructor;se=Reflect.construct(Ae,arguments,Ce)}else se=Ae.apply(this,arguments);return(0,or.Z)(this,se)}}function kr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var cn=function(z){(0,_r.Z)(ve,z);var oe=Ft(ve);function ve(Ae,se,Ce){var ct;return(0,Rt.Z)(this,ve),ct=oe.call(this,Ae),(0,Nt.Z)((0,Ut.Z)(ct),"status",void 0),(0,Nt.Z)((0,Ut.Z)(ct),"url",void 0),ct.status=se,ct.url=Ce,ct.name=ct.constructor.name,ct.message=Ae,ct}return(0,Xe.Z)(ve,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),ve}(ft(Error));function yn(z){var oe=new XMLHttpRequest;oe.open("GET",z.url,!0);for(var ve in z.headers)z.headers.hasOwnProperty(ve)&&oe.setRequestHeader(ve,z.headers[ve]);return oe.withCredentials=z.credentials==="include",oe}var Vi=function(oe,ve){var Ae=yn(oe);return Ae.setRequestHeader("Accept","application/json"),Ae.onerror=function(){ve(new Error(Ae.statusText))},Ae.onload=function(){if(Ae.status>=200&&Ae.status<300&&Ae.response){var se;try{se=JSON.parse(Ae.response)}catch(Ce){return ve(Ce)}ve(null,se)}else Ae.status===401?ve(new cn("".concat(Ae.statusText),Ae.status,oe.url)):ve(new cn(Ae.statusText,Ae.status,oe.url))},Ae.send(),Ae},ir=function(oe,ve){var Ae=yn(oe);return Ae.responseType="arraybuffer",Ae.onerror=function(){ve(new Error(Ae.statusText))},Ae.onload=function(){var se=Ae.response;if(se.byteLength===0&&Ae.status===200)return ve(new Error("http status 200 returned without content."));Ae.status>=200&&Ae.status<300&&Ae.response?ve(null,{data:se,cacheControl:Ae.getResponseHeader("Cache-Control"),expires:Ae.getResponseHeader("Expires")}):ve(new cn(Ae.statusText,Ae.status,oe.url))},Ae.send(),Ae};function de(z){var oe=window.document.createElement("a");return oe.href=z,oe.protocol===window.document.location.protocol&&oe.host===window.document.location.host}var Te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ue=function(oe,ve){return ir(oe,function(Ae,se){if(Ae)ve(Ae);else if(se){var Ce=new window.Image;Ce.crossOrigin="anonymous";var ct=window.URL||window.webkitURL;Ce.onload=function(){ve(null,Ce),ct.revokeObjectURL(Ce.src)};var xr=new window.Blob([new Uint8Array(se.data)],{type:"image/png"});Ce.src=se.data.byteLength?ct.createObjectURL(xr):Te}})},Le=E(40271),kt=2*Math.PI*6378137/2;function er(z){var oe=[Infinity,Infinity,-Infinity,-Infinity];return z.forEach(function(ve){var Ae=ve.coordinates;w(oe,Ae)}),oe}function w(z,oe){return Array.isArray(oe[0])?oe.forEach(function(ve){w(z,ve)}):(z[0]>oe[0]&&(z[0]=oe[0]),z[1]>oe[1]&&(z[1]=oe[1]),z[2]<oe[0]&&(z[2]=oe[0]),z[3]<oe[1]&&(z[3]=oe[1])),z}function Z(z,oe){return Ee(z,oe)}function Ee(z,oe){return Array.isArray(z[0])?z.map(function(ve){return Ee(ve,oe)}):oe(z)}function je(z){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,ve=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};z=jt(z,oe);var Ae=z[0],se=z[1],Ce=Ae*kt/180,ct=Math.log(Math.tan((90+se)*Math.PI/360))/(Math.PI/180);return ct=ct*kt/180,ve.enable&&(Ce=Number(Ce.toFixed(ve.decimal)),ct=Number(ct.toFixed(ve.decimal))),z.length===3?[Ce,ct,z[2]]:[Ce,ct]}function Qe(z){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,ve=z[0],Ae=z[1],se=ve/kt*180,Ce=Ae/kt*180;return Ce=180/Math.PI*(2*Math.atan(Math.exp(Ce*Math.PI/180))-Math.PI/2),oe!=null&&(se=Number(se.toFixed(oe)),Ce=Number(Ce.toFixed(oe))),z.length===3?[se,Ce,z[2]]:[se,Ce]}function yt(z){if(z==null)throw new Error("lng is required");return(z>180||z<-180)&&(z=z%360,z>180&&(z=-360+z),z<-180&&(z=360+z),z===0&&(z=0)),z}function St(z){if(z==null)throw new Error("lat is required");return(z>90||z<-90)&&(z=z%180,z>90&&(z=-180+z),z<-90&&(z=180+z),z===0&&(z=0)),z}function jt(z,oe){if(oe===!1)return z;var ve=yt(z[0]),Ae=St(z[1]);return Ae>85&&(Ae=85),Ae<-85&&(Ae=-85),z.length===3?[ve,Ae,z[2]]:[ve,Ae]}function Et(z){var oe=85.0511287798,ve=Math.max(Math.min(oe,z[1]),-oe),Ae=256<<20,se=Math.PI/180,Ce=z[0]*se,ct=ve*se;ct=Math.log(Math.tan(Math.PI/4+ct/2));var xr=.5/Math.PI,Ht=.5,Jt=-.5/Math.PI;return se=.5,Ce=Ae*(xr*Ce+Ht),ct=Ae*(Jt*ct+se),[Math.floor(Ce),Math.floor(ct)]}function Qt(z){var oe=.5/Math.PI,ve=.5,Ae=-.5/Math.PI,se=.5,Ce=256<<20,ct=_slicedToArray(z,2),xr=ct[0],Ht=ct[1];xr=(xr/Ce-ve)/oe,Ht=(Ht/Ce-se)/Ae,Ht=(Math.atan(Math.pow(Math.E,Ht))-Math.PI/4)*2,se=Math.PI/180;var Jt=Ht/se,Rr=xr/se;return[Rr,Jt]}function ie(z,oe,ve){var Ae=(0,Le.Ht)(oe[1]-z[1]),se=(0,Le.Ht)(oe[0]-z[0]),Ce=(0,Le.Ht)(z[1]),ct=(0,Le.Ht)(oe[1]),xr=Math.pow(Math.sin(Ae/2),2)+Math.pow(Math.sin(se/2),2)*Math.cos(Ce)*Math.cos(ct);return(0,Le.DL)(2*Math.atan2(Math.sqrt(xr),Math.sqrt(1-xr)),ve="meters")}function sr(z){var oe=Math.PI/180,ve=85.0511287798,Ae=6378137,se=Math.max(Math.min(ve,z[1]),-ve),Ce=Math.sin(se*oe),ct=Ae*z[0]*oe,xr=Ae*Math.log((1+Ce)/(1-Ce))/2;return[ct,xr]}function Br(z,oe){var ve=Math.abs(z[1][1]-z[0][1])*oe,Ae=Math.abs(z[1][0]-z[0][0])*oe;return[[z[0][0]-Ae,z[0][1]-ve],[z[1][0]+Ae,z[1][1]+ve]]}function Lr(z,oe){return z[0][0]<=oe[0][0]&&z[0][1]<=oe[0][1]&&z[1][0]>=oe[1][0]&&z[1][1]>=oe[1][1]}function rt(z){return[[z[0],z[1]],[z[2],z[3]]]}var gt=function(){function z(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,ve=arguments.length>1?arguments[1]:void 0;(0,Rt.Z)(this,z),(0,Nt.Z)(this,"limit",void 0),(0,Nt.Z)(this,"cache",void 0),(0,Nt.Z)(this,"destroy",void 0),(0,Nt.Z)(this,"order",void 0),this.limit=oe,this.destroy=ve||this.defaultDestroy,this.order=[],this.clear()}return(0,Xe.Z)(z,[{key:"clear",value:function(){var ve=this;this.order.forEach(function(Ae){ve.delete(Ae)}),this.cache={},this.order=[]}},{key:"get",value:function(ve){var Ae=this.cache[ve];return Ae&&(this.deleteOrder(ve),this.appendOrder(ve)),Ae}},{key:"set",value:function(ve,Ae){this.cache[ve]?(this.delete(ve),this.cache[ve]=Ae,this.appendOrder(ve)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[ve]=Ae,this.appendOrder(ve))}},{key:"delete",value:function(ve){var Ae=this.cache[ve];Ae&&(this.deleteCache(ve),this.deleteOrder(ve),this.destroy(Ae,ve))}},{key:"deleteCache",value:function(ve){delete this.cache[ve]}},{key:"deleteOrder",value:function(ve){var Ae=this.order.findIndex(function(se){return se===ve});Ae>=0&&this.order.splice(Ae,1)}},{key:"appendOrder",value:function(ve){this.order.push(ve)}},{key:"defaultDestroy",value:function(ve,Ae){return null}}]),z}();function pt(z,oe){z.forEach(function(ve){!oe[ve]||(oe[ve]=oe[ve].bind(oe))})}var dr=E(2650);function Vr(z){var oe=dr.ZP(z),ve=[0,0,0,0];return oe!=null&&(ve[0]=oe.r/255,ve[1]=oe.g/255,ve[2]=oe.b/255,ve[3]=oe.opacity),ve}function Ur(z){var oe=z&&z[0],ve=z&&z[1],Ae=z&&z[2],se=oe+ve*256+Ae*65536-1;return se}function nn(z){return[z+1&255,z+1>>8&255,z+1>>8>>8&255]}function Jr(z){var oe=document.createElement("canvas"),ve=oe.getContext("2d");oe.width=256,oe.height=1;for(var Ae=ve.createLinearGradient(0,0,256,1),se=null,Ce=z.positions[0],ct=z.positions[z.positions.length-1],xr=0;xr<z.colors.length;++xr){var Ht=(z.positions[xr]-Ce)/(ct-Ce);Ae.addColorStop(Ht,z.colors[xr])}return ve.fillStyle=Ae,ve.fillRect(0,0,256,1),se=new Uint8ClampedArray(ve.getImageData(0,0,256,1).data),new ImageData(se,256,1)}var Cr;(function(z){z.CENTER="center",z.TOP="top",z["TOP-LEFT"]="top-left",z["TOP-RIGHT"]="top-right",z.BOTTOM="bottom",z["BOTTOM-LEFT"]="bottom-left",z.LEFT="left",z.RIGHT="right"})(Cr||(Cr={}));var kn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zn(z,oe,ve){var Ae=z.classList;for(var se in kn)kn.hasOwnProperty(se)&&Ae.remove("l7-".concat(ve,"-anchor-").concat(se));Ae.add("l7-".concat(ve,"-anchor-").concat(oe))}function Si(z){if(z.length===0)throw new Error("max requires at least one data point");for(var oe=z[0],ve=1;ve<z.length;ve++)z[ve]>oe&&(oe=z[ve]);return oe*1}function zi(z){if(z.length===0)throw new Error("min requires at least one data point");for(var oe=z[0],ve=1;ve<z.length;ve++)z[ve]<oe&&(oe=z[ve]);return oe*1}function Ji(z){if(z.length===0)return 0;for(var oe=z[0]*1,ve=1;ve<z.length;ve++)oe+=z[ve]*1;return oe}function Di(z){if(z.length===0)throw new Error("mean requires at least one data point");return Ji(z)/z.length}function Oi(z){if(z.length===0)throw new Error("mean requires at least one data point");if(z.length<3)return z[0];z.sort();for(var oe=z[0],ve=NaN,Ae=0,se=1,Ce=1;Ce<z.length+1;Ce++)z[Ce]!==oe?(se>Ae&&(Ae=se,ve=oe),se=1,oe=z[Ce]):se++;return ve*1}var X={min:zi,max:Si,mean:Di,sum:Ji,mode:Oi};function ce(z,oe){return z.map(function(ve){return ve[oe]})}function me(z,oe){return X[z](oe)}},3473:function(Or,U,E){"use strict";E.d(U,{Z:function(){return le}});function le(C,p,A,Q,Y){var W={};return Object.keys(Q).forEach(function(L){W[L]=Q[L]}),W.enumerable=!!W.enumerable,W.configurable=!!W.configurable,("value"in W||W.initializer)&&(W.writable=!0),W=A.slice().reverse().reduce(function(L,N){return N(C,p,L)||L},W),Y&&W.initializer!==void 0&&(W.value=W.initializer?W.initializer.call(Y):void 0,W.initializer=void 0),W.initializer===void 0&&(Object.defineProperty(C,p,W),W=null),W}},66213:function(Or,U,E){"use strict";E.d(U,{Z:function(){return p}});var le=E(77608);function C(A,Q){for(;!Object.prototype.hasOwnProperty.call(A,Q)&&(A=(0,le.Z)(A),A!==null););return A}function p(A,Q,Y){return typeof Reflect!="undefined"&&Reflect.get?p=Reflect.get:p=function(L,N,Be){var Ye=C(L,N);if(!!Ye){var Je=Object.getOwnPropertyDescriptor(Ye,N);return Je.get?Je.get.call(Be):Je.value}},p(A,Q,Y||A)}},55770:function(Or,U,E){"use strict";E.d(U,{Z:function(){return le}});function le(C,p,A,Q){!A||Object.defineProperty(C,p,{enumerable:A.enumerable,configurable:A.configurable,writable:A.writable,value:A.initializer?A.initializer.call(Q):void 0})}},31795:function(Or,U,E){var le=E(75752);Or.exports.geometry=C,Or.exports.ring=A;function C(Y){var W=0,L;switch(Y.type){case"Polygon":return p(Y.coordinates);case"MultiPolygon":for(L=0;L<Y.coordinates.length;L++)W+=p(Y.coordinates[L]);return W;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(L=0;L<Y.geometries.length;L++)W+=C(Y.geometries[L]);return W}}function p(Y){var W=0;if(Y&&Y.length>0){W+=Math.abs(A(Y[0]));for(var L=1;L<Y.length;L++)W-=Math.abs(A(Y[L]))}return W}function A(Y){var W,L,N,Be,Ye,Je,et,Yt=0,Gt=Y.length;if(Gt>2){for(et=0;et<Gt;et++)et===Gt-2?(Be=Gt-2,Ye=Gt-1,Je=0):et===Gt-1?(Be=Gt-1,Ye=0,Je=1):(Be=et,Ye=et+1,Je=et+2),W=Y[Be],L=Y[Ye],N=Y[Je],Yt+=(Q(N[0])-Q(W[0]))*Math.sin(Q(L[1]));Yt=Yt*le.RADIUS*le.RADIUS/2}return Yt}function Q(Y){return Y*Math.PI/180}},49296:function(Or){"use strict";Or.exports=E,Or.exports.default=E;var U=1e20;function E(Q,Y,W,L,N,Be){this.fontSize=Q||24,this.buffer=Y===void 0?3:Y,this.cutoff=L||.25,this.fontFamily=N||"sans-serif",this.fontWeight=Be||"normal",this.radius=W||8;var Ye=this.size=this.fontSize+this.buffer*2,Je=Ye+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ye,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Je*Je),this.gridInner=new Float64Array(Je*Je),this.f=new Float64Array(Je),this.z=new Float64Array(Je+1),this.v=new Uint16Array(Je),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Ye/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function le(Q,Y,W,L,N,Be,Ye){Be.fill(U,0,Y*W),Ye.fill(0,0,Y*W);for(var Je=(Y-L)/2,et=0;et<N;et++)for(var Yt=0;Yt<L;Yt++){var Gt=(et+Je)*Y+Yt+Je,tr=Q.data[4*(et*L+Yt)+3]/255;if(tr===1)Be[Gt]=0,Ye[Gt]=U;else if(tr===0)Be[Gt]=U,Ye[Gt]=0;else{var zt=Math.max(0,.5-tr),Pt=Math.max(0,tr-.5);Be[Gt]=zt*zt,Ye[Gt]=Pt*Pt}}}function C(Q,Y,W,L,N,Be,Ye){for(var Je=0;Je<Y*W;Je++){var et=Math.sqrt(L[Je])-Math.sqrt(N[Je]);Q[Je]=Math.round(255-255*(et/Be+Ye))}}E.prototype._draw=function(Q,Y){var W=this.ctx.measureText(Q),L=W.width,N=2*this.buffer,Be,Ye,Je,et,Yt,Gt,tr,zt;Y&&this.useMetrics?(Yt=Math.floor(W.actualBoundingBoxAscent),zt=this.buffer+Math.ceil(W.actualBoundingBoxAscent),Gt=this.buffer,tr=this.buffer,Ye=Math.min(this.size,Math.ceil(W.actualBoundingBoxRight-W.actualBoundingBoxLeft)),et=Math.min(this.size-Gt,Math.ceil(W.actualBoundingBoxAscent+W.actualBoundingBoxDescent)),Be=Ye+N,Je=et+N,this.ctx.textBaseline="alphabetic"):(Be=Ye=this.size,Je=et=this.size,Yt=19*this.fontSize/24,Gt=tr=0,zt=this.middle,this.ctx.textBaseline="middle");var Pt;Ye&&et&&(this.ctx.clearRect(tr,Gt,Ye,et),this.ctx.fillText(Q,this.buffer,zt),Pt=this.ctx.getImageData(tr,Gt,Ye,et));var xt=new Uint8ClampedArray(Be*Je);return le(Pt,Be,Je,Ye,et,this.gridOuter,this.gridInner),p(this.gridOuter,Be,Je,this.f,this.v,this.z),p(this.gridInner,Be,Je,this.f,this.v,this.z),C(xt,Be,Je,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:xt,metrics:{width:Ye,height:et,sdfWidth:Be,sdfHeight:Je,top:Yt,left:0,advance:L}}},E.prototype.draw=function(Q){return this._draw(Q,!1).data},E.prototype.drawWithMetrics=function(Q){return this._draw(Q,!0)};function p(Q,Y,W,L,N,Be){for(var Ye=0;Ye<Y;Ye++)A(Q,Ye,Y,W,L,N,Be);for(var Je=0;Je<W;Je++)A(Q,Je*Y,1,Y,L,N,Be)}function A(Q,Y,W,L,N,Be,Ye){var Je,et,Yt,Gt;for(Be[0]=0,Ye[0]=-U,Ye[1]=U,Je=0;Je<L;Je++)N[Je]=Q[Y+Je*W];for(Je=1,et=0,Yt=0;Je<L;Je++){do Gt=Be[et],Yt=(N[Je]-N[Gt]+Je*Je-Gt*Gt)/(Je-Gt)/2;while(Yt<=Ye[et]&&--et>-1);et++,Be[et]=Je,Ye[et]=Yt,Ye[et+1]=U}for(Je=0,et=0;Je<L;Je++){for(;Ye[et+1]<Je;)et++;Gt=Be[et],Q[Y+Je*W]=N[Gt]+(Je-Gt)*(Je-Gt)}}},40271:function(Or,U,E){"use strict";E.d(U,{zL:function(){return Q},DL:function(){return xt},Ht:function(){return Ke}});var le=63710088e-1,C={centimeters:le*100,centimetres:le*100,degrees:le/111325,feet:le*3.28084,inches:le*39.37,kilometers:le/1e3,kilometres:le/1e3,meters:le,metres:le,miles:le/1609.344,millimeters:le*1e3,millimetres:le*1e3,nauticalmiles:le/1852,radians:1,yards:le*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/le,yards:1.0936133},A={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Q(he,Re,ye){ye===void 0&&(ye={});var _t={type:"Feature"};return(ye.id===0||ye.id)&&(_t.id=ye.id),ye.bbox&&(_t.bbox=ye.bbox),_t.properties=Re||{},_t.geometry=he,_t}function Y(he,Re,ye){switch(ye===void 0&&(ye={}),he){case"Point":return W(Re).geometry;case"LineString":return Ye(Re).geometry;case"Polygon":return N(Re).geometry;case"MultiPoint":return Gt(Re).geometry;case"MultiLineString":return Yt(Re).geometry;case"MultiPolygon":return tr(Re).geometry;default:throw new Error(he+" is invalid")}}function W(he,Re,ye){if(ye===void 0&&(ye={}),!he)throw new Error("coordinates is required");if(!Array.isArray(he))throw new Error("coordinates must be an Array");if(he.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ut(he[0])||!Ut(he[1]))throw new Error("coordinates must contain numbers");var _t={type:"Point",coordinates:he};return Q(_t,Re,ye)}function L(he,Re,ye){return ye===void 0&&(ye={}),et(he.map(function(_t){return W(_t,Re)}),ye)}function N(he,Re,ye){ye===void 0&&(ye={});for(var _t=0,ft=he;_t<ft.length;_t++){var Nt=ft[_t];if(Nt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Ft=0;Ft<Nt[Nt.length-1].length;Ft++)if(Nt[Nt.length-1][Ft]!==Nt[0][Ft])throw new Error("First and last Position are not equivalent.")}var kr={type:"Polygon",coordinates:he};return Q(kr,Re,ye)}function Be(he,Re,ye){return ye===void 0&&(ye={}),et(he.map(function(_t){return N(_t,Re)}),ye)}function Ye(he,Re,ye){if(ye===void 0&&(ye={}),he.length<2)throw new Error("coordinates must be an array of two or more positions");var _t={type:"LineString",coordinates:he};return Q(_t,Re,ye)}function Je(he,Re,ye){return ye===void 0&&(ye={}),et(he.map(function(_t){return Ye(_t,Re)}),ye)}function et(he,Re){Re===void 0&&(Re={});var ye={type:"FeatureCollection"};return Re.id&&(ye.id=Re.id),Re.bbox&&(ye.bbox=Re.bbox),ye.features=he,ye}function Yt(he,Re,ye){ye===void 0&&(ye={});var _t={type:"MultiLineString",coordinates:he};return Q(_t,Re,ye)}function Gt(he,Re,ye){ye===void 0&&(ye={});var _t={type:"MultiPoint",coordinates:he};return Q(_t,Re,ye)}function tr(he,Re,ye){ye===void 0&&(ye={});var _t={type:"MultiPolygon",coordinates:he};return Q(_t,Re,ye)}function zt(he,Re,ye){ye===void 0&&(ye={});var _t={type:"GeometryCollection",geometries:he};return Q(_t,Re,ye)}function Pt(he,Re){if(Re===void 0&&(Re=0),Re&&!(Re>=0))throw new Error("precision must be a positive number");var ye=Math.pow(10,Re||0);return Math.round(he*ye)/ye}function xt(he,Re){Re===void 0&&(Re="kilometers");var ye=C[Re];if(!ye)throw new Error(Re+" units is invalid");return he*ye}function yr(he,Re){Re===void 0&&(Re="kilometers");var ye=C[Re];if(!ye)throw new Error(Re+" units is invalid");return he/ye}function ee(he,Re){return Ct(yr(he,Re))}function vr(he){var Re=he%360;return Re<0&&(Re+=360),Re}function Ct(he){var Re=he%(2*Math.PI);return Re*180/Math.PI}function Ke(he){var Re=he%360;return Re*Math.PI/180}function Rt(he,Re,ye){if(Re===void 0&&(Re="kilometers"),ye===void 0&&(ye="kilometers"),!(he>=0))throw new Error("length must be a positive number");return xt(yr(he,Re),ye)}function Xe(he,Re,ye){if(Re===void 0&&(Re="meters"),ye===void 0&&(ye="kilometers"),!(he>=0))throw new Error("area must be a positive number");var _t=A[Re];if(!_t)throw new Error("invalid original units");var ft=A[ye];if(!ft)throw new Error("invalid final units");return he/_t*ft}function Ut(he){return!isNaN(he)&&he!==null&&!Array.isArray(he)}function _r(he){return!!he&&he.constructor===Object}function or(he){if(!he)throw new Error("bbox is required");if(!Array.isArray(he))throw new Error("bbox must be an Array");if(he.length!==4&&he.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");he.forEach(function(Re){if(!Ut(Re))throw new Error("bbox must only contain numbers")})}function zr(he){if(!he)throw new Error("id is required");if(["string","number"].indexOf(typeof he)===-1)throw new Error("id must be a number or a string")}},17781:function(Or){Or.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},9187:function(Or){"use strict";Or.exports=U,Or.exports.default=U;function U(he,Re,ye){ye=ye||2;var _t=Re&&Re.length,ft=_t?Re[0]*ye:he.length,Nt=E(he,0,ft,ye,!0),Ft=[];if(!Nt||Nt.next===Nt.prev)return Ft;var kr,cn,yn,Vi,ir,de,Te;if(_t&&(Nt=W(he,Re,Nt,ye)),he.length>80*ye){kr=yn=he[0],cn=Vi=he[1];for(var Ue=ye;Ue<ft;Ue+=ye)ir=he[Ue],de=he[Ue+1],ir<kr&&(kr=ir),de<cn&&(cn=de),ir>yn&&(yn=ir),de>Vi&&(Vi=de);Te=Math.max(yn-kr,Vi-cn),Te=Te!==0?1/Te:0}return C(Nt,Ft,ye,kr,cn,Te),Ft}function E(he,Re,ye,_t,ft){var Nt,Ft;if(ft===zr(he,Re,ye,_t)>0)for(Nt=Re;Nt<ye;Nt+=_t)Ft=Ut(Nt,he[Nt],he[Nt+1],Ft);else for(Nt=ye-_t;Nt>=Re;Nt-=_t)Ft=Ut(Nt,he[Nt],he[Nt+1],Ft);return Ft&&xt(Ft,Ft.next)&&(_r(Ft),Ft=Ft.next),Ft}function le(he,Re){if(!he)return he;Re||(Re=he);var ye=he,_t;do if(_t=!1,!ye.steiner&&(xt(ye,ye.next)||Pt(ye.prev,ye,ye.next)===0)){if(_r(ye),ye=Re=ye.prev,ye===ye.next)break;_t=!0}else ye=ye.next;while(_t||ye!==Re);return Re}function C(he,Re,ye,_t,ft,Nt,Ft){if(!!he){!Ft&&Nt&&Je(he,_t,ft,Nt);for(var kr=he,cn,yn;he.prev!==he.next;){if(cn=he.prev,yn=he.next,Nt?A(he,_t,ft,Nt):p(he)){Re.push(cn.i/ye),Re.push(he.i/ye),Re.push(yn.i/ye),_r(he),he=yn.next,kr=yn.next;continue}if(he=yn,he===kr){Ft?Ft===1?(he=Q(le(he),Re,ye),C(he,Re,ye,_t,ft,Nt,2)):Ft===2&&Y(he,Re,ye,_t,ft,Nt):C(le(he),Re,ye,_t,ft,Nt,1);break}}}}function p(he){var Re=he.prev,ye=he,_t=he.next;if(Pt(Re,ye,_t)>=0)return!1;for(var ft=he.next.next;ft!==he.prev;){if(tr(Re.x,Re.y,ye.x,ye.y,_t.x,_t.y,ft.x,ft.y)&&Pt(ft.prev,ft,ft.next)>=0)return!1;ft=ft.next}return!0}function A(he,Re,ye,_t){var ft=he.prev,Nt=he,Ft=he.next;if(Pt(ft,Nt,Ft)>=0)return!1;for(var kr=ft.x<Nt.x?ft.x<Ft.x?ft.x:Ft.x:Nt.x<Ft.x?Nt.x:Ft.x,cn=ft.y<Nt.y?ft.y<Ft.y?ft.y:Ft.y:Nt.y<Ft.y?Nt.y:Ft.y,yn=ft.x>Nt.x?ft.x>Ft.x?ft.x:Ft.x:Nt.x>Ft.x?Nt.x:Ft.x,Vi=ft.y>Nt.y?ft.y>Ft.y?ft.y:Ft.y:Nt.y>Ft.y?Nt.y:Ft.y,ir=Yt(kr,cn,Re,ye,_t),de=Yt(yn,Vi,Re,ye,_t),Te=he.prevZ,Ue=he.nextZ;Te&&Te.z>=ir&&Ue&&Ue.z<=de;){if(Te!==he.prev&&Te!==he.next&&tr(ft.x,ft.y,Nt.x,Nt.y,Ft.x,Ft.y,Te.x,Te.y)&&Pt(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Ue!==he.prev&&Ue!==he.next&&tr(ft.x,ft.y,Nt.x,Nt.y,Ft.x,Ft.y,Ue.x,Ue.y)&&Pt(Ue.prev,Ue,Ue.next)>=0))return!1;Ue=Ue.nextZ}for(;Te&&Te.z>=ir;){if(Te!==he.prev&&Te!==he.next&&tr(ft.x,ft.y,Nt.x,Nt.y,Ft.x,Ft.y,Te.x,Te.y)&&Pt(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Ue&&Ue.z<=de;){if(Ue!==he.prev&&Ue!==he.next&&tr(ft.x,ft.y,Nt.x,Nt.y,Ft.x,Ft.y,Ue.x,Ue.y)&&Pt(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.nextZ}return!0}function Q(he,Re,ye){var _t=he;do{var ft=_t.prev,Nt=_t.next.next;!xt(ft,Nt)&&yr(ft,_t,_t.next,Nt)&&Ke(ft,Nt)&&Ke(Nt,ft)&&(Re.push(ft.i/ye),Re.push(_t.i/ye),Re.push(Nt.i/ye),_r(_t),_r(_t.next),_t=he=Nt),_t=_t.next}while(_t!==he);return le(_t)}function Y(he,Re,ye,_t,ft,Nt){var Ft=he;do{for(var kr=Ft.next.next;kr!==Ft.prev;){if(Ft.i!==kr.i&&zt(Ft,kr)){var cn=Xe(Ft,kr);Ft=le(Ft,Ft.next),cn=le(cn,cn.next),C(Ft,Re,ye,_t,ft,Nt),C(cn,Re,ye,_t,ft,Nt);return}kr=kr.next}Ft=Ft.next}while(Ft!==he)}function W(he,Re,ye,_t){var ft=[],Nt,Ft,kr,cn,yn;for(Nt=0,Ft=Re.length;Nt<Ft;Nt++)kr=Re[Nt]*_t,cn=Nt<Ft-1?Re[Nt+1]*_t:he.length,yn=E(he,kr,cn,_t,!1),yn===yn.next&&(yn.steiner=!0),ft.push(Gt(yn));for(ft.sort(L),Nt=0;Nt<ft.length;Nt++)ye=N(ft[Nt],ye),ye=le(ye,ye.next);return ye}function L(he,Re){return he.x-Re.x}function N(he,Re){var ye=Be(he,Re);if(!ye)return Re;var _t=Xe(ye,he),ft=le(ye,ye.next);return le(_t,_t.next),Re===ye?ft:Re}function Be(he,Re){var ye=Re,_t=he.x,ft=he.y,Nt=-Infinity,Ft;do{if(ft<=ye.y&&ft>=ye.next.y&&ye.next.y!==ye.y){var kr=ye.x+(ft-ye.y)*(ye.next.x-ye.x)/(ye.next.y-ye.y);if(kr<=_t&&kr>Nt){if(Nt=kr,kr===_t){if(ft===ye.y)return ye;if(ft===ye.next.y)return ye.next}Ft=ye.x<ye.next.x?ye:ye.next}}ye=ye.next}while(ye!==Re);if(!Ft)return null;if(_t===Nt)return Ft;var cn=Ft,yn=Ft.x,Vi=Ft.y,ir=Infinity,de;ye=Ft;do _t>=ye.x&&ye.x>=yn&&_t!==ye.x&&tr(ft<Vi?_t:Nt,ft,yn,Vi,ft<Vi?Nt:_t,ft,ye.x,ye.y)&&(de=Math.abs(ft-ye.y)/(_t-ye.x),Ke(ye,he)&&(de<ir||de===ir&&(ye.x>Ft.x||ye.x===Ft.x&&Ye(Ft,ye)))&&(Ft=ye,ir=de)),ye=ye.next;while(ye!==cn);return Ft}function Ye(he,Re){return Pt(he.prev,he,Re.prev)<0&&Pt(Re.next,he,he.next)<0}function Je(he,Re,ye,_t){var ft=he;do ft.z===null&&(ft.z=Yt(ft.x,ft.y,Re,ye,_t)),ft.prevZ=ft.prev,ft.nextZ=ft.next,ft=ft.next;while(ft!==he);ft.prevZ.nextZ=null,ft.prevZ=null,et(ft)}function et(he){var Re,ye,_t,ft,Nt,Ft,kr,cn,yn=1;do{for(ye=he,he=null,Nt=null,Ft=0;ye;){for(Ft++,_t=ye,kr=0,Re=0;Re<yn&&(kr++,_t=_t.nextZ,!!_t);Re++);for(cn=yn;kr>0||cn>0&&_t;)kr!==0&&(cn===0||!_t||ye.z<=_t.z)?(ft=ye,ye=ye.nextZ,kr--):(ft=_t,_t=_t.nextZ,cn--),Nt?Nt.nextZ=ft:he=ft,ft.prevZ=Nt,Nt=ft;ye=_t}Nt.nextZ=null,yn*=2}while(Ft>1);return he}function Yt(he,Re,ye,_t,ft){return he=32767*(he-ye)*ft,Re=32767*(Re-_t)*ft,he=(he|he<<8)&16711935,he=(he|he<<4)&252645135,he=(he|he<<2)&858993459,he=(he|he<<1)&1431655765,Re=(Re|Re<<8)&16711935,Re=(Re|Re<<4)&252645135,Re=(Re|Re<<2)&858993459,Re=(Re|Re<<1)&1431655765,he|Re<<1}function Gt(he){var Re=he,ye=he;do(Re.x<ye.x||Re.x===ye.x&&Re.y<ye.y)&&(ye=Re),Re=Re.next;while(Re!==he);return ye}function tr(he,Re,ye,_t,ft,Nt,Ft,kr){return(ft-Ft)*(Re-kr)-(he-Ft)*(Nt-kr)>=0&&(he-Ft)*(_t-kr)-(ye-Ft)*(Re-kr)>=0&&(ye-Ft)*(Nt-kr)-(ft-Ft)*(_t-kr)>=0}function zt(he,Re){return he.next.i!==Re.i&&he.prev.i!==Re.i&&!Ct(he,Re)&&(Ke(he,Re)&&Ke(Re,he)&&Rt(he,Re)&&(Pt(he.prev,he,Re.prev)||Pt(he,Re.prev,Re))||xt(he,Re)&&Pt(he.prev,he,he.next)>0&&Pt(Re.prev,Re,Re.next)>0)}function Pt(he,Re,ye){return(Re.y-he.y)*(ye.x-Re.x)-(Re.x-he.x)*(ye.y-Re.y)}function xt(he,Re){return he.x===Re.x&&he.y===Re.y}function yr(he,Re,ye,_t){var ft=vr(Pt(he,Re,ye)),Nt=vr(Pt(he,Re,_t)),Ft=vr(Pt(ye,_t,he)),kr=vr(Pt(ye,_t,Re));return!!(ft!==Nt&&Ft!==kr||ft===0&&ee(he,ye,Re)||Nt===0&&ee(he,_t,Re)||Ft===0&&ee(ye,he,_t)||kr===0&&ee(ye,Re,_t))}function ee(he,Re,ye){return Re.x<=Math.max(he.x,ye.x)&&Re.x>=Math.min(he.x,ye.x)&&Re.y<=Math.max(he.y,ye.y)&&Re.y>=Math.min(he.y,ye.y)}function vr(he){return he>0?1:he<0?-1:0}function Ct(he,Re){var ye=he;do{if(ye.i!==he.i&&ye.next.i!==he.i&&ye.i!==Re.i&&ye.next.i!==Re.i&&yr(ye,ye.next,he,Re))return!0;ye=ye.next}while(ye!==he);return!1}function Ke(he,Re){return Pt(he.prev,he,he.next)<0?Pt(he,Re,he.next)>=0&&Pt(he,he.prev,Re)>=0:Pt(he,Re,he.prev)<0||Pt(he,he.next,Re)<0}function Rt(he,Re){var ye=he,_t=!1,ft=(he.x+Re.x)/2,Nt=(he.y+Re.y)/2;do ye.y>Nt!=ye.next.y>Nt&&ye.next.y!==ye.y&&ft<(ye.next.x-ye.x)*(Nt-ye.y)/(ye.next.y-ye.y)+ye.x&&(_t=!_t),ye=ye.next;while(ye!==he);return _t}function Xe(he,Re){var ye=new or(he.i,he.x,he.y),_t=new or(Re.i,Re.x,Re.y),ft=he.next,Nt=Re.prev;return he.next=Re,Re.prev=he,ye.next=ft,ft.prev=ye,_t.next=ye,ye.prev=_t,Nt.next=_t,_t.prev=Nt,_t}function Ut(he,Re,ye,_t){var ft=new or(he,Re,ye);return _t?(ft.next=_t.next,ft.prev=_t,_t.next.prev=ft,_t.next=ft):(ft.prev=ft,ft.next=ft),ft}function _r(he){he.next.prev=he.prev,he.prev.next=he.next,he.prevZ&&(he.prevZ.nextZ=he.nextZ),he.nextZ&&(he.nextZ.prevZ=he.prevZ)}function or(he,Re,ye){this.i=he,this.x=Re,this.y=ye,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}U.deviation=function(he,Re,ye,_t){var ft=Re&&Re.length,Nt=ft?Re[0]*ye:he.length,Ft=Math.abs(zr(he,0,Nt,ye));if(ft)for(var kr=0,cn=Re.length;kr<cn;kr++){var yn=Re[kr]*ye,Vi=kr<cn-1?Re[kr+1]*ye:he.length;Ft-=Math.abs(zr(he,yn,Vi,ye))}var ir=0;for(kr=0;kr<_t.length;kr+=3){var de=_t[kr]*ye,Te=_t[kr+1]*ye,Ue=_t[kr+2]*ye;ir+=Math.abs((he[de]-he[Ue])*(he[Te+1]-he[de+1])-(he[de]-he[Te])*(he[Ue+1]-he[de+1]))}return Ft===0&&ir===0?0:Math.abs((ir-Ft)/Ft)};function zr(he,Re,ye,_t){for(var ft=0,Nt=Re,Ft=ye-_t;Nt<ye;Nt+=_t)ft+=(he[Ft]-he[Nt])*(he[Nt+1]+he[Ft+1]),Ft=Nt;return ft}U.flatten=function(he){for(var Re=he[0][0].length,ye={vertices:[],holes:[],dimensions:Re},_t=0,ft=0;ft<he.length;ft++){for(var Nt=0;Nt<he[ft].length;Nt++)for(var Ft=0;Ft<Re;Ft++)ye.vertices.push(he[ft][Nt][Ft]);ft>0&&(_t+=he[ft-1].length,ye.holes.push(_t))}return ye}},67709:function(Or){function U(le){var C=le.target||le.srcElement;C.__resizeRAF__&&cancelAnimationFrame(C.__resizeRAF__),C.__resizeRAF__=requestAnimationFrame(function(){var p=C.__resizeTrigger__,A=p&&p.__resizeListeners__;A&&A.forEach(function(Q){Q.call(p,le)})})}var E=function(C,p){var A=this,Q=A.document,Y,W=Q.attachEvent;typeof navigator!="undefined"&&(Y=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function L(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",U)}if(!C.__resizeListeners__)if(C.__resizeListeners__=[],W)C.__resizeTrigger__=C,C.attachEvent("onresize",U);else{getComputedStyle(C).position==="static"&&(C.style.position="relative");var N=C.__resizeTrigger__=Q.createElement("object");N.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),N.setAttribute("class","resize-sensor"),N.setAttribute("tabindex","-1"),N.setAttribute("title",""),N.__resizeElement__=C,N.onload=L,N.type="text/html",Y&&C.appendChild(N),N.data="about:blank",Y||C.appendChild(N)}C.__resizeListeners__.push(p)};Or.exports=typeof window=="undefined"?E:E.bind(window),Or.exports.unbind=function(le,C){var p=document.attachEvent,A=le.__resizeListeners__||[];if(C){var Q=A.indexOf(C);Q!==-1&&A.splice(Q,1)}else A=le.__resizeListeners__=[];if(!A.length){if(p)le.detachEvent("onresize",U);else if(le.__resizeTrigger__){var Y=le.__resizeTrigger__.contentDocument,W=Y&&Y.defaultView;W&&(W.removeEventListener("resize",U),delete W.__resizeTrigger__),le.__resizeTrigger__=!le.removeChild(le.__resizeTrigger__)}delete le.__resizeListeners__}}},26729:function(Or){"use strict";var U=Object.prototype.hasOwnProperty,E="~";function le(){}Object.create&&(le.prototype=Object.create(null),new le().__proto__||(E=!1));function C(Y,W,L){this.fn=Y,this.context=W,this.once=L||!1}function p(Y,W,L,N,Be){if(typeof L!="function")throw new TypeError("The listener must be a function");var Ye=new C(L,N||Y,Be),Je=E?E+W:W;return Y._events[Je]?Y._events[Je].fn?Y._events[Je]=[Y._events[Je],Ye]:Y._events[Je].push(Ye):(Y._events[Je]=Ye,Y._eventsCount++),Y}function A(Y,W){--Y._eventsCount==0?Y._events=new le:delete Y._events[W]}function Q(){this._events=new le,this._eventsCount=0}Q.prototype.eventNames=function(){var W=[],L,N;if(this._eventsCount===0)return W;for(N in L=this._events)U.call(L,N)&&W.push(E?N.slice(1):N);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(L)):W},Q.prototype.listeners=function(W){var L=E?E+W:W,N=this._events[L];if(!N)return[];if(N.fn)return[N.fn];for(var Be=0,Ye=N.length,Je=new Array(Ye);Be<Ye;Be++)Je[Be]=N[Be].fn;return Je},Q.prototype.listenerCount=function(W){var L=E?E+W:W,N=this._events[L];return N?N.fn?1:N.length:0},Q.prototype.emit=function(W,L,N,Be,Ye,Je){var et=E?E+W:W;if(!this._events[et])return!1;var Yt=this._events[et],Gt=arguments.length,tr,zt;if(Yt.fn){switch(Yt.once&&this.removeListener(W,Yt.fn,void 0,!0),Gt){case 1:return Yt.fn.call(Yt.context),!0;case 2:return Yt.fn.call(Yt.context,L),!0;case 3:return Yt.fn.call(Yt.context,L,N),!0;case 4:return Yt.fn.call(Yt.context,L,N,Be),!0;case 5:return Yt.fn.call(Yt.context,L,N,Be,Ye),!0;case 6:return Yt.fn.call(Yt.context,L,N,Be,Ye,Je),!0}for(zt=1,tr=new Array(Gt-1);zt<Gt;zt++)tr[zt-1]=arguments[zt];Yt.fn.apply(Yt.context,tr)}else{var Pt=Yt.length,xt;for(zt=0;zt<Pt;zt++)switch(Yt[zt].once&&this.removeListener(W,Yt[zt].fn,void 0,!0),Gt){case 1:Yt[zt].fn.call(Yt[zt].context);break;case 2:Yt[zt].fn.call(Yt[zt].context,L);break;case 3:Yt[zt].fn.call(Yt[zt].context,L,N);break;case 4:Yt[zt].fn.call(Yt[zt].context,L,N,Be);break;default:if(!tr)for(xt=1,tr=new Array(Gt-1);xt<Gt;xt++)tr[xt-1]=arguments[xt];Yt[zt].fn.apply(Yt[zt].context,tr)}}return!0},Q.prototype.on=function(W,L,N){return p(this,W,L,N,!1)},Q.prototype.once=function(W,L,N){return p(this,W,L,N,!0)},Q.prototype.removeListener=function(W,L,N,Be){var Ye=E?E+W:W;if(!this._events[Ye])return this;if(!L)return A(this,Ye),this;var Je=this._events[Ye];if(Je.fn)Je.fn===L&&(!Be||Je.once)&&(!N||Je.context===N)&&A(this,Ye);else{for(var et=0,Yt=[],Gt=Je.length;et<Gt;et++)(Je[et].fn!==L||Be&&!Je[et].once||N&&Je[et].context!==N)&&Yt.push(Je[et]);Yt.length?this._events[Ye]=Yt.length===1?Yt[0]:Yt:A(this,Ye)}return this},Q.prototype.removeAllListeners=function(W){var L;return W?(L=E?E+W:W,this._events[L]&&A(this,L)):(this._events=new le,this._eventsCount=0),this},Q.prototype.off=Q.prototype.removeListener,Q.prototype.addListener=Q.prototype.on,Q.prefixed=E,Q.EventEmitter=Q,Or.exports=Q},85975:function(Or,U,E){"use strict";E.r(U),E.d(U,{create:function(){return C},clone:function(){return p},copy:function(){return A},fromValues:function(){return Q},set:function(){return Y},identity:function(){return W},transpose:function(){return L},invert:function(){return N},adjoint:function(){return Be},determinant:function(){return Ye},multiply:function(){return Je},translate:function(){return et},scale:function(){return Yt},rotate:function(){return Gt},rotateX:function(){return tr},rotateY:function(){return zt},rotateZ:function(){return Pt},fromTranslation:function(){return xt},fromScaling:function(){return yr},fromRotation:function(){return ee},fromXRotation:function(){return vr},fromYRotation:function(){return Ct},fromZRotation:function(){return Ke},fromRotationTranslation:function(){return Rt},fromQuat2:function(){return Xe},getTranslation:function(){return Ut},getScaling:function(){return _r},getRotation:function(){return or},fromRotationTranslationScale:function(){return zr},fromRotationTranslationScaleOrigin:function(){return he},fromQuat:function(){return Re},frustum:function(){return ye},perspective:function(){return _t},perspectiveFromFieldOfView:function(){return ft},ortho:function(){return Nt},lookAt:function(){return Ft},targetTo:function(){return kr},str:function(){return cn},frob:function(){return yn},add:function(){return Vi},subtract:function(){return ir},multiplyScalar:function(){return de},multiplyScalarAndAdd:function(){return Te},exactEquals:function(){return Ue},equals:function(){return Le},mul:function(){return kt},sub:function(){return er}});var le=E(49685);function C(){var w=new le.WT(16);return le.WT!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0),w[0]=1,w[5]=1,w[10]=1,w[15]=1,w}function p(w){var Z=new le.WT(16);return Z[0]=w[0],Z[1]=w[1],Z[2]=w[2],Z[3]=w[3],Z[4]=w[4],Z[5]=w[5],Z[6]=w[6],Z[7]=w[7],Z[8]=w[8],Z[9]=w[9],Z[10]=w[10],Z[11]=w[11],Z[12]=w[12],Z[13]=w[13],Z[14]=w[14],Z[15]=w[15],Z}function A(w,Z){return w[0]=Z[0],w[1]=Z[1],w[2]=Z[2],w[3]=Z[3],w[4]=Z[4],w[5]=Z[5],w[6]=Z[6],w[7]=Z[7],w[8]=Z[8],w[9]=Z[9],w[10]=Z[10],w[11]=Z[11],w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15],w}function Q(w,Z,Ee,je,Qe,yt,St,jt,Et,Qt,ie,sr,Br,Lr,rt,gt){var pt=new le.WT(16);return pt[0]=w,pt[1]=Z,pt[2]=Ee,pt[3]=je,pt[4]=Qe,pt[5]=yt,pt[6]=St,pt[7]=jt,pt[8]=Et,pt[9]=Qt,pt[10]=ie,pt[11]=sr,pt[12]=Br,pt[13]=Lr,pt[14]=rt,pt[15]=gt,pt}function Y(w,Z,Ee,je,Qe,yt,St,jt,Et,Qt,ie,sr,Br,Lr,rt,gt,pt){return w[0]=Z,w[1]=Ee,w[2]=je,w[3]=Qe,w[4]=yt,w[5]=St,w[6]=jt,w[7]=Et,w[8]=Qt,w[9]=ie,w[10]=sr,w[11]=Br,w[12]=Lr,w[13]=rt,w[14]=gt,w[15]=pt,w}function W(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function L(w,Z){if(w===Z){var Ee=Z[1],je=Z[2],Qe=Z[3],yt=Z[6],St=Z[7],jt=Z[11];w[1]=Z[4],w[2]=Z[8],w[3]=Z[12],w[4]=Ee,w[6]=Z[9],w[7]=Z[13],w[8]=je,w[9]=yt,w[11]=Z[14],w[12]=Qe,w[13]=St,w[14]=jt}else w[0]=Z[0],w[1]=Z[4],w[2]=Z[8],w[3]=Z[12],w[4]=Z[1],w[5]=Z[5],w[6]=Z[9],w[7]=Z[13],w[8]=Z[2],w[9]=Z[6],w[10]=Z[10],w[11]=Z[14],w[12]=Z[3],w[13]=Z[7],w[14]=Z[11],w[15]=Z[15];return w}function N(w,Z){var Ee=Z[0],je=Z[1],Qe=Z[2],yt=Z[3],St=Z[4],jt=Z[5],Et=Z[6],Qt=Z[7],ie=Z[8],sr=Z[9],Br=Z[10],Lr=Z[11],rt=Z[12],gt=Z[13],pt=Z[14],dr=Z[15],Vr=Ee*jt-je*St,Ur=Ee*Et-Qe*St,nn=Ee*Qt-yt*St,Jr=je*Et-Qe*jt,Cr=je*Qt-yt*jt,kn=Qe*Qt-yt*Et,Zn=ie*gt-sr*rt,Si=ie*pt-Br*rt,zi=ie*dr-Lr*rt,Ji=sr*pt-Br*gt,Di=sr*dr-Lr*gt,Oi=Br*dr-Lr*pt,X=Vr*Oi-Ur*Di+nn*Ji+Jr*zi-Cr*Si+kn*Zn;return X?(X=1/X,w[0]=(jt*Oi-Et*Di+Qt*Ji)*X,w[1]=(Qe*Di-je*Oi-yt*Ji)*X,w[2]=(gt*kn-pt*Cr+dr*Jr)*X,w[3]=(Br*Cr-sr*kn-Lr*Jr)*X,w[4]=(Et*zi-St*Oi-Qt*Si)*X,w[5]=(Ee*Oi-Qe*zi+yt*Si)*X,w[6]=(pt*nn-rt*kn-dr*Ur)*X,w[7]=(ie*kn-Br*nn+Lr*Ur)*X,w[8]=(St*Di-jt*zi+Qt*Zn)*X,w[9]=(je*zi-Ee*Di-yt*Zn)*X,w[10]=(rt*Cr-gt*nn+dr*Vr)*X,w[11]=(sr*nn-ie*Cr-Lr*Vr)*X,w[12]=(jt*Si-St*Ji-Et*Zn)*X,w[13]=(Ee*Ji-je*Si+Qe*Zn)*X,w[14]=(gt*Ur-rt*Jr-pt*Vr)*X,w[15]=(ie*Jr-sr*Ur+Br*Vr)*X,w):null}function Be(w,Z){var Ee=Z[0],je=Z[1],Qe=Z[2],yt=Z[3],St=Z[4],jt=Z[5],Et=Z[6],Qt=Z[7],ie=Z[8],sr=Z[9],Br=Z[10],Lr=Z[11],rt=Z[12],gt=Z[13],pt=Z[14],dr=Z[15];return w[0]=jt*(Br*dr-Lr*pt)-sr*(Et*dr-Qt*pt)+gt*(Et*Lr-Qt*Br),w[1]=-(je*(Br*dr-Lr*pt)-sr*(Qe*dr-yt*pt)+gt*(Qe*Lr-yt*Br)),w[2]=je*(Et*dr-Qt*pt)-jt*(Qe*dr-yt*pt)+gt*(Qe*Qt-yt*Et),w[3]=-(je*(Et*Lr-Qt*Br)-jt*(Qe*Lr-yt*Br)+sr*(Qe*Qt-yt*Et)),w[4]=-(St*(Br*dr-Lr*pt)-ie*(Et*dr-Qt*pt)+rt*(Et*Lr-Qt*Br)),w[5]=Ee*(Br*dr-Lr*pt)-ie*(Qe*dr-yt*pt)+rt*(Qe*Lr-yt*Br),w[6]=-(Ee*(Et*dr-Qt*pt)-St*(Qe*dr-yt*pt)+rt*(Qe*Qt-yt*Et)),w[7]=Ee*(Et*Lr-Qt*Br)-St*(Qe*Lr-yt*Br)+ie*(Qe*Qt-yt*Et),w[8]=St*(sr*dr-Lr*gt)-ie*(jt*dr-Qt*gt)+rt*(jt*Lr-Qt*sr),w[9]=-(Ee*(sr*dr-Lr*gt)-ie*(je*dr-yt*gt)+rt*(je*Lr-yt*sr)),w[10]=Ee*(jt*dr-Qt*gt)-St*(je*dr-yt*gt)+rt*(je*Qt-yt*jt),w[11]=-(Ee*(jt*Lr-Qt*sr)-St*(je*Lr-yt*sr)+ie*(je*Qt-yt*jt)),w[12]=-(St*(sr*pt-Br*gt)-ie*(jt*pt-Et*gt)+rt*(jt*Br-Et*sr)),w[13]=Ee*(sr*pt-Br*gt)-ie*(je*pt-Qe*gt)+rt*(je*Br-Qe*sr),w[14]=-(Ee*(jt*pt-Et*gt)-St*(je*pt-Qe*gt)+rt*(je*Et-Qe*jt)),w[15]=Ee*(jt*Br-Et*sr)-St*(je*Br-Qe*sr)+ie*(je*Et-Qe*jt),w}function Ye(w){var Z=w[0],Ee=w[1],je=w[2],Qe=w[3],yt=w[4],St=w[5],jt=w[6],Et=w[7],Qt=w[8],ie=w[9],sr=w[10],Br=w[11],Lr=w[12],rt=w[13],gt=w[14],pt=w[15],dr=Z*St-Ee*yt,Vr=Z*jt-je*yt,Ur=Z*Et-Qe*yt,nn=Ee*jt-je*St,Jr=Ee*Et-Qe*St,Cr=je*Et-Qe*jt,kn=Qt*rt-ie*Lr,Zn=Qt*gt-sr*Lr,Si=Qt*pt-Br*Lr,zi=ie*gt-sr*rt,Ji=ie*pt-Br*rt,Di=sr*pt-Br*gt;return dr*Di-Vr*Ji+Ur*zi+nn*Si-Jr*Zn+Cr*kn}function Je(w,Z,Ee){var je=Z[0],Qe=Z[1],yt=Z[2],St=Z[3],jt=Z[4],Et=Z[5],Qt=Z[6],ie=Z[7],sr=Z[8],Br=Z[9],Lr=Z[10],rt=Z[11],gt=Z[12],pt=Z[13],dr=Z[14],Vr=Z[15],Ur=Ee[0],nn=Ee[1],Jr=Ee[2],Cr=Ee[3];return w[0]=Ur*je+nn*jt+Jr*sr+Cr*gt,w[1]=Ur*Qe+nn*Et+Jr*Br+Cr*pt,w[2]=Ur*yt+nn*Qt+Jr*Lr+Cr*dr,w[3]=Ur*St+nn*ie+Jr*rt+Cr*Vr,Ur=Ee[4],nn=Ee[5],Jr=Ee[6],Cr=Ee[7],w[4]=Ur*je+nn*jt+Jr*sr+Cr*gt,w[5]=Ur*Qe+nn*Et+Jr*Br+Cr*pt,w[6]=Ur*yt+nn*Qt+Jr*Lr+Cr*dr,w[7]=Ur*St+nn*ie+Jr*rt+Cr*Vr,Ur=Ee[8],nn=Ee[9],Jr=Ee[10],Cr=Ee[11],w[8]=Ur*je+nn*jt+Jr*sr+Cr*gt,w[9]=Ur*Qe+nn*Et+Jr*Br+Cr*pt,w[10]=Ur*yt+nn*Qt+Jr*Lr+Cr*dr,w[11]=Ur*St+nn*ie+Jr*rt+Cr*Vr,Ur=Ee[12],nn=Ee[13],Jr=Ee[14],Cr=Ee[15],w[12]=Ur*je+nn*jt+Jr*sr+Cr*gt,w[13]=Ur*Qe+nn*Et+Jr*Br+Cr*pt,w[14]=Ur*yt+nn*Qt+Jr*Lr+Cr*dr,w[15]=Ur*St+nn*ie+Jr*rt+Cr*Vr,w}function et(w,Z,Ee){var je=Ee[0],Qe=Ee[1],yt=Ee[2],St,jt,Et,Qt,ie,sr,Br,Lr,rt,gt,pt,dr;return Z===w?(w[12]=Z[0]*je+Z[4]*Qe+Z[8]*yt+Z[12],w[13]=Z[1]*je+Z[5]*Qe+Z[9]*yt+Z[13],w[14]=Z[2]*je+Z[6]*Qe+Z[10]*yt+Z[14],w[15]=Z[3]*je+Z[7]*Qe+Z[11]*yt+Z[15]):(St=Z[0],jt=Z[1],Et=Z[2],Qt=Z[3],ie=Z[4],sr=Z[5],Br=Z[6],Lr=Z[7],rt=Z[8],gt=Z[9],pt=Z[10],dr=Z[11],w[0]=St,w[1]=jt,w[2]=Et,w[3]=Qt,w[4]=ie,w[5]=sr,w[6]=Br,w[7]=Lr,w[8]=rt,w[9]=gt,w[10]=pt,w[11]=dr,w[12]=St*je+ie*Qe+rt*yt+Z[12],w[13]=jt*je+sr*Qe+gt*yt+Z[13],w[14]=Et*je+Br*Qe+pt*yt+Z[14],w[15]=Qt*je+Lr*Qe+dr*yt+Z[15]),w}function Yt(w,Z,Ee){var je=Ee[0],Qe=Ee[1],yt=Ee[2];return w[0]=Z[0]*je,w[1]=Z[1]*je,w[2]=Z[2]*je,w[3]=Z[3]*je,w[4]=Z[4]*Qe,w[5]=Z[5]*Qe,w[6]=Z[6]*Qe,w[7]=Z[7]*Qe,w[8]=Z[8]*yt,w[9]=Z[9]*yt,w[10]=Z[10]*yt,w[11]=Z[11]*yt,w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15],w}function Gt(w,Z,Ee,je){var Qe=je[0],yt=je[1],St=je[2],jt=Math.hypot(Qe,yt,St),Et,Qt,ie,sr,Br,Lr,rt,gt,pt,dr,Vr,Ur,nn,Jr,Cr,kn,Zn,Si,zi,Ji,Di,Oi,X,ce;return jt<le.Ib?null:(jt=1/jt,Qe*=jt,yt*=jt,St*=jt,Et=Math.sin(Ee),Qt=Math.cos(Ee),ie=1-Qt,sr=Z[0],Br=Z[1],Lr=Z[2],rt=Z[3],gt=Z[4],pt=Z[5],dr=Z[6],Vr=Z[7],Ur=Z[8],nn=Z[9],Jr=Z[10],Cr=Z[11],kn=Qe*Qe*ie+Qt,Zn=yt*Qe*ie+St*Et,Si=St*Qe*ie-yt*Et,zi=Qe*yt*ie-St*Et,Ji=yt*yt*ie+Qt,Di=St*yt*ie+Qe*Et,Oi=Qe*St*ie+yt*Et,X=yt*St*ie-Qe*Et,ce=St*St*ie+Qt,w[0]=sr*kn+gt*Zn+Ur*Si,w[1]=Br*kn+pt*Zn+nn*Si,w[2]=Lr*kn+dr*Zn+Jr*Si,w[3]=rt*kn+Vr*Zn+Cr*Si,w[4]=sr*zi+gt*Ji+Ur*Di,w[5]=Br*zi+pt*Ji+nn*Di,w[6]=Lr*zi+dr*Ji+Jr*Di,w[7]=rt*zi+Vr*Ji+Cr*Di,w[8]=sr*Oi+gt*X+Ur*ce,w[9]=Br*Oi+pt*X+nn*ce,w[10]=Lr*Oi+dr*X+Jr*ce,w[11]=rt*Oi+Vr*X+Cr*ce,Z!==w&&(w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15]),w)}function tr(w,Z,Ee){var je=Math.sin(Ee),Qe=Math.cos(Ee),yt=Z[4],St=Z[5],jt=Z[6],Et=Z[7],Qt=Z[8],ie=Z[9],sr=Z[10],Br=Z[11];return Z!==w&&(w[0]=Z[0],w[1]=Z[1],w[2]=Z[2],w[3]=Z[3],w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15]),w[4]=yt*Qe+Qt*je,w[5]=St*Qe+ie*je,w[6]=jt*Qe+sr*je,w[7]=Et*Qe+Br*je,w[8]=Qt*Qe-yt*je,w[9]=ie*Qe-St*je,w[10]=sr*Qe-jt*je,w[11]=Br*Qe-Et*je,w}function zt(w,Z,Ee){var je=Math.sin(Ee),Qe=Math.cos(Ee),yt=Z[0],St=Z[1],jt=Z[2],Et=Z[3],Qt=Z[8],ie=Z[9],sr=Z[10],Br=Z[11];return Z!==w&&(w[4]=Z[4],w[5]=Z[5],w[6]=Z[6],w[7]=Z[7],w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15]),w[0]=yt*Qe-Qt*je,w[1]=St*Qe-ie*je,w[2]=jt*Qe-sr*je,w[3]=Et*Qe-Br*je,w[8]=yt*je+Qt*Qe,w[9]=St*je+ie*Qe,w[10]=jt*je+sr*Qe,w[11]=Et*je+Br*Qe,w}function Pt(w,Z,Ee){var je=Math.sin(Ee),Qe=Math.cos(Ee),yt=Z[0],St=Z[1],jt=Z[2],Et=Z[3],Qt=Z[4],ie=Z[5],sr=Z[6],Br=Z[7];return Z!==w&&(w[8]=Z[8],w[9]=Z[9],w[10]=Z[10],w[11]=Z[11],w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15]),w[0]=yt*Qe+Qt*je,w[1]=St*Qe+ie*je,w[2]=jt*Qe+sr*je,w[3]=Et*Qe+Br*je,w[4]=Qt*Qe-yt*je,w[5]=ie*Qe-St*je,w[6]=sr*Qe-jt*je,w[7]=Br*Qe-Et*je,w}function xt(w,Z){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=Z[0],w[13]=Z[1],w[14]=Z[2],w[15]=1,w}function yr(w,Z){return w[0]=Z[0],w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Z[1],w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=Z[2],w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function ee(w,Z,Ee){var je=Ee[0],Qe=Ee[1],yt=Ee[2],St=Math.hypot(je,Qe,yt),jt,Et,Qt;return St<le.Ib?null:(St=1/St,je*=St,Qe*=St,yt*=St,jt=Math.sin(Z),Et=Math.cos(Z),Qt=1-Et,w[0]=je*je*Qt+Et,w[1]=Qe*je*Qt+yt*jt,w[2]=yt*je*Qt-Qe*jt,w[3]=0,w[4]=je*Qe*Qt-yt*jt,w[5]=Qe*Qe*Qt+Et,w[6]=yt*Qe*Qt+je*jt,w[7]=0,w[8]=je*yt*Qt+Qe*jt,w[9]=Qe*yt*Qt-je*jt,w[10]=yt*yt*Qt+Et,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w)}function vr(w,Z){var Ee=Math.sin(Z),je=Math.cos(Z);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=je,w[6]=Ee,w[7]=0,w[8]=0,w[9]=-Ee,w[10]=je,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ct(w,Z){var Ee=Math.sin(Z),je=Math.cos(Z);return w[0]=je,w[1]=0,w[2]=-Ee,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=Ee,w[9]=0,w[10]=je,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ke(w,Z){var Ee=Math.sin(Z),je=Math.cos(Z);return w[0]=je,w[1]=Ee,w[2]=0,w[3]=0,w[4]=-Ee,w[5]=je,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Rt(w,Z,Ee){var je=Z[0],Qe=Z[1],yt=Z[2],St=Z[3],jt=je+je,Et=Qe+Qe,Qt=yt+yt,ie=je*jt,sr=je*Et,Br=je*Qt,Lr=Qe*Et,rt=Qe*Qt,gt=yt*Qt,pt=St*jt,dr=St*Et,Vr=St*Qt;return w[0]=1-(Lr+gt),w[1]=sr+Vr,w[2]=Br-dr,w[3]=0,w[4]=sr-Vr,w[5]=1-(ie+gt),w[6]=rt+pt,w[7]=0,w[8]=Br+dr,w[9]=rt-pt,w[10]=1-(ie+Lr),w[11]=0,w[12]=Ee[0],w[13]=Ee[1],w[14]=Ee[2],w[15]=1,w}function Xe(w,Z){var Ee=new le.WT(3),je=-Z[0],Qe=-Z[1],yt=-Z[2],St=Z[3],jt=Z[4],Et=Z[5],Qt=Z[6],ie=Z[7],sr=je*je+Qe*Qe+yt*yt+St*St;return sr>0?(Ee[0]=(jt*St+ie*je+Et*yt-Qt*Qe)*2/sr,Ee[1]=(Et*St+ie*Qe+Qt*je-jt*yt)*2/sr,Ee[2]=(Qt*St+ie*yt+jt*Qe-Et*je)*2/sr):(Ee[0]=(jt*St+ie*je+Et*yt-Qt*Qe)*2,Ee[1]=(Et*St+ie*Qe+Qt*je-jt*yt)*2,Ee[2]=(Qt*St+ie*yt+jt*Qe-Et*je)*2),Rt(w,Z,Ee),w}function Ut(w,Z){return w[0]=Z[12],w[1]=Z[13],w[2]=Z[14],w}function _r(w,Z){var Ee=Z[0],je=Z[1],Qe=Z[2],yt=Z[4],St=Z[5],jt=Z[6],Et=Z[8],Qt=Z[9],ie=Z[10];return w[0]=Math.hypot(Ee,je,Qe),w[1]=Math.hypot(yt,St,jt),w[2]=Math.hypot(Et,Qt,ie),w}function or(w,Z){var Ee=new le.WT(3);_r(Ee,Z);var je=1/Ee[0],Qe=1/Ee[1],yt=1/Ee[2],St=Z[0]*je,jt=Z[1]*Qe,Et=Z[2]*yt,Qt=Z[4]*je,ie=Z[5]*Qe,sr=Z[6]*yt,Br=Z[8]*je,Lr=Z[9]*Qe,rt=Z[10]*yt,gt=St+ie+rt,pt=0;return gt>0?(pt=Math.sqrt(gt+1)*2,w[3]=.25*pt,w[0]=(sr-Lr)/pt,w[1]=(Br-Et)/pt,w[2]=(jt-Qt)/pt):St>ie&&St>rt?(pt=Math.sqrt(1+St-ie-rt)*2,w[3]=(sr-Lr)/pt,w[0]=.25*pt,w[1]=(jt+Qt)/pt,w[2]=(Br+Et)/pt):ie>rt?(pt=Math.sqrt(1+ie-St-rt)*2,w[3]=(Br-Et)/pt,w[0]=(jt+Qt)/pt,w[1]=.25*pt,w[2]=(sr+Lr)/pt):(pt=Math.sqrt(1+rt-St-ie)*2,w[3]=(jt-Qt)/pt,w[0]=(Br+Et)/pt,w[1]=(sr+Lr)/pt,w[2]=.25*pt),w}function zr(w,Z,Ee,je){var Qe=Z[0],yt=Z[1],St=Z[2],jt=Z[3],Et=Qe+Qe,Qt=yt+yt,ie=St+St,sr=Qe*Et,Br=Qe*Qt,Lr=Qe*ie,rt=yt*Qt,gt=yt*ie,pt=St*ie,dr=jt*Et,Vr=jt*Qt,Ur=jt*ie,nn=je[0],Jr=je[1],Cr=je[2];return w[0]=(1-(rt+pt))*nn,w[1]=(Br+Ur)*nn,w[2]=(Lr-Vr)*nn,w[3]=0,w[4]=(Br-Ur)*Jr,w[5]=(1-(sr+pt))*Jr,w[6]=(gt+dr)*Jr,w[7]=0,w[8]=(Lr+Vr)*Cr,w[9]=(gt-dr)*Cr,w[10]=(1-(sr+rt))*Cr,w[11]=0,w[12]=Ee[0],w[13]=Ee[1],w[14]=Ee[2],w[15]=1,w}function he(w,Z,Ee,je,Qe){var yt=Z[0],St=Z[1],jt=Z[2],Et=Z[3],Qt=yt+yt,ie=St+St,sr=jt+jt,Br=yt*Qt,Lr=yt*ie,rt=yt*sr,gt=St*ie,pt=St*sr,dr=jt*sr,Vr=Et*Qt,Ur=Et*ie,nn=Et*sr,Jr=je[0],Cr=je[1],kn=je[2],Zn=Qe[0],Si=Qe[1],zi=Qe[2],Ji=(1-(gt+dr))*Jr,Di=(Lr+nn)*Jr,Oi=(rt-Ur)*Jr,X=(Lr-nn)*Cr,ce=(1-(Br+dr))*Cr,me=(pt+Vr)*Cr,z=(rt+Ur)*kn,oe=(pt-Vr)*kn,ve=(1-(Br+gt))*kn;return w[0]=Ji,w[1]=Di,w[2]=Oi,w[3]=0,w[4]=X,w[5]=ce,w[6]=me,w[7]=0,w[8]=z,w[9]=oe,w[10]=ve,w[11]=0,w[12]=Ee[0]+Zn-(Ji*Zn+X*Si+z*zi),w[13]=Ee[1]+Si-(Di*Zn+ce*Si+oe*zi),w[14]=Ee[2]+zi-(Oi*Zn+me*Si+ve*zi),w[15]=1,w}function Re(w,Z){var Ee=Z[0],je=Z[1],Qe=Z[2],yt=Z[3],St=Ee+Ee,jt=je+je,Et=Qe+Qe,Qt=Ee*St,ie=je*St,sr=je*jt,Br=Qe*St,Lr=Qe*jt,rt=Qe*Et,gt=yt*St,pt=yt*jt,dr=yt*Et;return w[0]=1-sr-rt,w[1]=ie+dr,w[2]=Br-pt,w[3]=0,w[4]=ie-dr,w[5]=1-Qt-rt,w[6]=Lr+gt,w[7]=0,w[8]=Br+pt,w[9]=Lr-gt,w[10]=1-Qt-sr,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function ye(w,Z,Ee,je,Qe,yt,St){var jt=1/(Ee-Z),Et=1/(Qe-je),Qt=1/(yt-St);return w[0]=yt*2*jt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=yt*2*Et,w[6]=0,w[7]=0,w[8]=(Ee+Z)*jt,w[9]=(Qe+je)*Et,w[10]=(St+yt)*Qt,w[11]=-1,w[12]=0,w[13]=0,w[14]=St*yt*2*Qt,w[15]=0,w}function _t(w,Z,Ee,je,Qe){var yt=1/Math.tan(Z/2),St;return w[0]=yt/Ee,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=yt,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,Qe!=null&&Qe!==Infinity?(St=1/(je-Qe),w[10]=(Qe+je)*St,w[14]=2*Qe*je*St):(w[10]=-1,w[14]=-2*je),w}function ft(w,Z,Ee,je){var Qe=Math.tan(Z.upDegrees*Math.PI/180),yt=Math.tan(Z.downDegrees*Math.PI/180),St=Math.tan(Z.leftDegrees*Math.PI/180),jt=Math.tan(Z.rightDegrees*Math.PI/180),Et=2/(St+jt),Qt=2/(Qe+yt);return w[0]=Et,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Qt,w[6]=0,w[7]=0,w[8]=-((St-jt)*Et*.5),w[9]=(Qe-yt)*Qt*.5,w[10]=je/(Ee-je),w[11]=-1,w[12]=0,w[13]=0,w[14]=je*Ee/(Ee-je),w[15]=0,w}function Nt(w,Z,Ee,je,Qe,yt,St){var jt=1/(Z-Ee),Et=1/(je-Qe),Qt=1/(yt-St);return w[0]=-2*jt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*Et,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*Qt,w[11]=0,w[12]=(Z+Ee)*jt,w[13]=(Qe+je)*Et,w[14]=(St+yt)*Qt,w[15]=1,w}function Ft(w,Z,Ee,je){var Qe,yt,St,jt,Et,Qt,ie,sr,Br,Lr,rt=Z[0],gt=Z[1],pt=Z[2],dr=je[0],Vr=je[1],Ur=je[2],nn=Ee[0],Jr=Ee[1],Cr=Ee[2];return Math.abs(rt-nn)<le.Ib&&Math.abs(gt-Jr)<le.Ib&&Math.abs(pt-Cr)<le.Ib?W(w):(ie=rt-nn,sr=gt-Jr,Br=pt-Cr,Lr=1/Math.hypot(ie,sr,Br),ie*=Lr,sr*=Lr,Br*=Lr,Qe=Vr*Br-Ur*sr,yt=Ur*ie-dr*Br,St=dr*sr-Vr*ie,Lr=Math.hypot(Qe,yt,St),Lr?(Lr=1/Lr,Qe*=Lr,yt*=Lr,St*=Lr):(Qe=0,yt=0,St=0),jt=sr*St-Br*yt,Et=Br*Qe-ie*St,Qt=ie*yt-sr*Qe,Lr=Math.hypot(jt,Et,Qt),Lr?(Lr=1/Lr,jt*=Lr,Et*=Lr,Qt*=Lr):(jt=0,Et=0,Qt=0),w[0]=Qe,w[1]=jt,w[2]=ie,w[3]=0,w[4]=yt,w[5]=Et,w[6]=sr,w[7]=0,w[8]=St,w[9]=Qt,w[10]=Br,w[11]=0,w[12]=-(Qe*rt+yt*gt+St*pt),w[13]=-(jt*rt+Et*gt+Qt*pt),w[14]=-(ie*rt+sr*gt+Br*pt),w[15]=1,w)}function kr(w,Z,Ee,je){var Qe=Z[0],yt=Z[1],St=Z[2],jt=je[0],Et=je[1],Qt=je[2],ie=Qe-Ee[0],sr=yt-Ee[1],Br=St-Ee[2],Lr=ie*ie+sr*sr+Br*Br;Lr>0&&(Lr=1/Math.sqrt(Lr),ie*=Lr,sr*=Lr,Br*=Lr);var rt=Et*Br-Qt*sr,gt=Qt*ie-jt*Br,pt=jt*sr-Et*ie;return Lr=rt*rt+gt*gt+pt*pt,Lr>0&&(Lr=1/Math.sqrt(Lr),rt*=Lr,gt*=Lr,pt*=Lr),w[0]=rt,w[1]=gt,w[2]=pt,w[3]=0,w[4]=sr*pt-Br*gt,w[5]=Br*rt-ie*pt,w[6]=ie*gt-sr*rt,w[7]=0,w[8]=ie,w[9]=sr,w[10]=Br,w[11]=0,w[12]=Qe,w[13]=yt,w[14]=St,w[15]=1,w}function cn(w){return"mat4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+", "+w[4]+", "+w[5]+", "+w[6]+", "+w[7]+", "+w[8]+", "+w[9]+", "+w[10]+", "+w[11]+", "+w[12]+", "+w[13]+", "+w[14]+", "+w[15]+")"}function yn(w){return Math.hypot(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])}function Vi(w,Z,Ee){return w[0]=Z[0]+Ee[0],w[1]=Z[1]+Ee[1],w[2]=Z[2]+Ee[2],w[3]=Z[3]+Ee[3],w[4]=Z[4]+Ee[4],w[5]=Z[5]+Ee[5],w[6]=Z[6]+Ee[6],w[7]=Z[7]+Ee[7],w[8]=Z[8]+Ee[8],w[9]=Z[9]+Ee[9],w[10]=Z[10]+Ee[10],w[11]=Z[11]+Ee[11],w[12]=Z[12]+Ee[12],w[13]=Z[13]+Ee[13],w[14]=Z[14]+Ee[14],w[15]=Z[15]+Ee[15],w}function ir(w,Z,Ee){return w[0]=Z[0]-Ee[0],w[1]=Z[1]-Ee[1],w[2]=Z[2]-Ee[2],w[3]=Z[3]-Ee[3],w[4]=Z[4]-Ee[4],w[5]=Z[5]-Ee[5],w[6]=Z[6]-Ee[6],w[7]=Z[7]-Ee[7],w[8]=Z[8]-Ee[8],w[9]=Z[9]-Ee[9],w[10]=Z[10]-Ee[10],w[11]=Z[11]-Ee[11],w[12]=Z[12]-Ee[12],w[13]=Z[13]-Ee[13],w[14]=Z[14]-Ee[14],w[15]=Z[15]-Ee[15],w}function de(w,Z,Ee){return w[0]=Z[0]*Ee,w[1]=Z[1]*Ee,w[2]=Z[2]*Ee,w[3]=Z[3]*Ee,w[4]=Z[4]*Ee,w[5]=Z[5]*Ee,w[6]=Z[6]*Ee,w[7]=Z[7]*Ee,w[8]=Z[8]*Ee,w[9]=Z[9]*Ee,w[10]=Z[10]*Ee,w[11]=Z[11]*Ee,w[12]=Z[12]*Ee,w[13]=Z[13]*Ee,w[14]=Z[14]*Ee,w[15]=Z[15]*Ee,w}function Te(w,Z,Ee,je){return w[0]=Z[0]+Ee[0]*je,w[1]=Z[1]+Ee[1]*je,w[2]=Z[2]+Ee[2]*je,w[3]=Z[3]+Ee[3]*je,w[4]=Z[4]+Ee[4]*je,w[5]=Z[5]+Ee[5]*je,w[6]=Z[6]+Ee[6]*je,w[7]=Z[7]+Ee[7]*je,w[8]=Z[8]+Ee[8]*je,w[9]=Z[9]+Ee[9]*je,w[10]=Z[10]+Ee[10]*je,w[11]=Z[11]+Ee[11]*je,w[12]=Z[12]+Ee[12]*je,w[13]=Z[13]+Ee[13]*je,w[14]=Z[14]+Ee[14]*je,w[15]=Z[15]+Ee[15]*je,w}function Ue(w,Z){return w[0]===Z[0]&&w[1]===Z[1]&&w[2]===Z[2]&&w[3]===Z[3]&&w[4]===Z[4]&&w[5]===Z[5]&&w[6]===Z[6]&&w[7]===Z[7]&&w[8]===Z[8]&&w[9]===Z[9]&&w[10]===Z[10]&&w[11]===Z[11]&&w[12]===Z[12]&&w[13]===Z[13]&&w[14]===Z[14]&&w[15]===Z[15]}function Le(w,Z){var Ee=w[0],je=w[1],Qe=w[2],yt=w[3],St=w[4],jt=w[5],Et=w[6],Qt=w[7],ie=w[8],sr=w[9],Br=w[10],Lr=w[11],rt=w[12],gt=w[13],pt=w[14],dr=w[15],Vr=Z[0],Ur=Z[1],nn=Z[2],Jr=Z[3],Cr=Z[4],kn=Z[5],Zn=Z[6],Si=Z[7],zi=Z[8],Ji=Z[9],Di=Z[10],Oi=Z[11],X=Z[12],ce=Z[13],me=Z[14],z=Z[15];return Math.abs(Ee-Vr)<=le.Ib*Math.max(1,Math.abs(Ee),Math.abs(Vr))&&Math.abs(je-Ur)<=le.Ib*Math.max(1,Math.abs(je),Math.abs(Ur))&&Math.abs(Qe-nn)<=le.Ib*Math.max(1,Math.abs(Qe),Math.abs(nn))&&Math.abs(yt-Jr)<=le.Ib*Math.max(1,Math.abs(yt),Math.abs(Jr))&&Math.abs(St-Cr)<=le.Ib*Math.max(1,Math.abs(St),Math.abs(Cr))&&Math.abs(jt-kn)<=le.Ib*Math.max(1,Math.abs(jt),Math.abs(kn))&&Math.abs(Et-Zn)<=le.Ib*Math.max(1,Math.abs(Et),Math.abs(Zn))&&Math.abs(Qt-Si)<=le.Ib*Math.max(1,Math.abs(Qt),Math.abs(Si))&&Math.abs(ie-zi)<=le.Ib*Math.max(1,Math.abs(ie),Math.abs(zi))&&Math.abs(sr-Ji)<=le.Ib*Math.max(1,Math.abs(sr),Math.abs(Ji))&&Math.abs(Br-Di)<=le.Ib*Math.max(1,Math.abs(Br),Math.abs(Di))&&Math.abs(Lr-Oi)<=le.Ib*Math.max(1,Math.abs(Lr),Math.abs(Oi))&&Math.abs(rt-X)<=le.Ib*Math.max(1,Math.abs(rt),Math.abs(X))&&Math.abs(gt-ce)<=le.Ib*Math.max(1,Math.abs(gt),Math.abs(ce))&&Math.abs(pt-me)<=le.Ib*Math.max(1,Math.abs(pt),Math.abs(me))&&Math.abs(dr-z)<=le.Ib*Math.max(1,Math.abs(dr),Math.abs(z))}var kt=Je,er=ir},98333:function(Or,U,E){"use strict";E.d(U,{Ue:function(){return C},al:function(){return A},bA:function(){return tr},fF:function(){return or}});var le=E(49685);function C(){var de=new le.WT(4);return le.WT!=Float32Array&&(de[0]=0,de[1]=0,de[2]=0,de[3]=0),de}function p(de){var Te=new glMatrix.ARRAY_TYPE(4);return Te[0]=de[0],Te[1]=de[1],Te[2]=de[2],Te[3]=de[3],Te}function A(de,Te,Ue,Le){var kt=new le.WT(4);return kt[0]=de,kt[1]=Te,kt[2]=Ue,kt[3]=Le,kt}function Q(de,Te){return de[0]=Te[0],de[1]=Te[1],de[2]=Te[2],de[3]=Te[3],de}function Y(de,Te,Ue,Le,kt){return de[0]=Te,de[1]=Ue,de[2]=Le,de[3]=kt,de}function W(de,Te,Ue){return de[0]=Te[0]+Ue[0],de[1]=Te[1]+Ue[1],de[2]=Te[2]+Ue[2],de[3]=Te[3]+Ue[3],de}function L(de,Te,Ue){return de[0]=Te[0]-Ue[0],de[1]=Te[1]-Ue[1],de[2]=Te[2]-Ue[2],de[3]=Te[3]-Ue[3],de}function N(de,Te,Ue){return de[0]=Te[0]*Ue[0],de[1]=Te[1]*Ue[1],de[2]=Te[2]*Ue[2],de[3]=Te[3]*Ue[3],de}function Be(de,Te,Ue){return de[0]=Te[0]/Ue[0],de[1]=Te[1]/Ue[1],de[2]=Te[2]/Ue[2],de[3]=Te[3]/Ue[3],de}function Ye(de,Te){return de[0]=Math.ceil(Te[0]),de[1]=Math.ceil(Te[1]),de[2]=Math.ceil(Te[2]),de[3]=Math.ceil(Te[3]),de}function Je(de,Te){return de[0]=Math.floor(Te[0]),de[1]=Math.floor(Te[1]),de[2]=Math.floor(Te[2]),de[3]=Math.floor(Te[3]),de}function et(de,Te,Ue){return de[0]=Math.min(Te[0],Ue[0]),de[1]=Math.min(Te[1],Ue[1]),de[2]=Math.min(Te[2],Ue[2]),de[3]=Math.min(Te[3],Ue[3]),de}function Yt(de,Te,Ue){return de[0]=Math.max(Te[0],Ue[0]),de[1]=Math.max(Te[1],Ue[1]),de[2]=Math.max(Te[2],Ue[2]),de[3]=Math.max(Te[3],Ue[3]),de}function Gt(de,Te){return de[0]=Math.round(Te[0]),de[1]=Math.round(Te[1]),de[2]=Math.round(Te[2]),de[3]=Math.round(Te[3]),de}function tr(de,Te,Ue){return de[0]=Te[0]*Ue,de[1]=Te[1]*Ue,de[2]=Te[2]*Ue,de[3]=Te[3]*Ue,de}function zt(de,Te,Ue,Le){return de[0]=Te[0]+Ue[0]*Le,de[1]=Te[1]+Ue[1]*Le,de[2]=Te[2]+Ue[2]*Le,de[3]=Te[3]+Ue[3]*Le,de}function Pt(de,Te){var Ue=Te[0]-de[0],Le=Te[1]-de[1],kt=Te[2]-de[2],er=Te[3]-de[3];return Math.hypot(Ue,Le,kt,er)}function xt(de,Te){var Ue=Te[0]-de[0],Le=Te[1]-de[1],kt=Te[2]-de[2],er=Te[3]-de[3];return Ue*Ue+Le*Le+kt*kt+er*er}function yr(de){var Te=de[0],Ue=de[1],Le=de[2],kt=de[3];return Math.hypot(Te,Ue,Le,kt)}function ee(de){var Te=de[0],Ue=de[1],Le=de[2],kt=de[3];return Te*Te+Ue*Ue+Le*Le+kt*kt}function vr(de,Te){return de[0]=-Te[0],de[1]=-Te[1],de[2]=-Te[2],de[3]=-Te[3],de}function Ct(de,Te){return de[0]=1/Te[0],de[1]=1/Te[1],de[2]=1/Te[2],de[3]=1/Te[3],de}function Ke(de,Te){var Ue=Te[0],Le=Te[1],kt=Te[2],er=Te[3],w=Ue*Ue+Le*Le+kt*kt+er*er;return w>0&&(w=1/Math.sqrt(w)),de[0]=Ue*w,de[1]=Le*w,de[2]=kt*w,de[3]=er*w,de}function Rt(de,Te){return de[0]*Te[0]+de[1]*Te[1]+de[2]*Te[2]+de[3]*Te[3]}function Xe(de,Te,Ue,Le){var kt=Ue[0]*Le[1]-Ue[1]*Le[0],er=Ue[0]*Le[2]-Ue[2]*Le[0],w=Ue[0]*Le[3]-Ue[3]*Le[0],Z=Ue[1]*Le[2]-Ue[2]*Le[1],Ee=Ue[1]*Le[3]-Ue[3]*Le[1],je=Ue[2]*Le[3]-Ue[3]*Le[2],Qe=Te[0],yt=Te[1],St=Te[2],jt=Te[3];return de[0]=yt*je-St*Ee+jt*Z,de[1]=-(Qe*je)+St*w-jt*er,de[2]=Qe*Ee-yt*w+jt*kt,de[3]=-(Qe*Z)+yt*er-St*kt,de}function Ut(de,Te,Ue,Le){var kt=Te[0],er=Te[1],w=Te[2],Z=Te[3];return de[0]=kt+Le*(Ue[0]-kt),de[1]=er+Le*(Ue[1]-er),de[2]=w+Le*(Ue[2]-w),de[3]=Z+Le*(Ue[3]-Z),de}function _r(de,Te){Te=Te||1;var Ue,Le,kt,er,w,Z;do Ue=glMatrix.RANDOM()*2-1,Le=glMatrix.RANDOM()*2-1,w=Ue*Ue+Le*Le;while(w>=1);do kt=glMatrix.RANDOM()*2-1,er=glMatrix.RANDOM()*2-1,Z=kt*kt+er*er;while(Z>=1);var Ee=Math.sqrt((1-w)/Z);return de[0]=Te*Ue,de[1]=Te*Le,de[2]=Te*kt*Ee,de[3]=Te*er*Ee,de}function or(de,Te,Ue){var Le=Te[0],kt=Te[1],er=Te[2],w=Te[3];return de[0]=Ue[0]*Le+Ue[4]*kt+Ue[8]*er+Ue[12]*w,de[1]=Ue[1]*Le+Ue[5]*kt+Ue[9]*er+Ue[13]*w,de[2]=Ue[2]*Le+Ue[6]*kt+Ue[10]*er+Ue[14]*w,de[3]=Ue[3]*Le+Ue[7]*kt+Ue[11]*er+Ue[15]*w,de}function zr(de,Te,Ue){var Le=Te[0],kt=Te[1],er=Te[2],w=Ue[0],Z=Ue[1],Ee=Ue[2],je=Ue[3],Qe=je*Le+Z*er-Ee*kt,yt=je*kt+Ee*Le-w*er,St=je*er+w*kt-Z*Le,jt=-w*Le-Z*kt-Ee*er;return de[0]=Qe*je+jt*-w+yt*-Ee-St*-Z,de[1]=yt*je+jt*-Z+St*-w-Qe*-Ee,de[2]=St*je+jt*-Ee+Qe*-Z-yt*-w,de[3]=Te[3],de}function he(de){return de[0]=0,de[1]=0,de[2]=0,de[3]=0,de}function Re(de){return"vec4("+de[0]+", "+de[1]+", "+de[2]+", "+de[3]+")"}function ye(de,Te){return de[0]===Te[0]&&de[1]===Te[1]&&de[2]===Te[2]&&de[3]===Te[3]}function _t(de,Te){var Ue=de[0],Le=de[1],kt=de[2],er=de[3],w=Te[0],Z=Te[1],Ee=Te[2],je=Te[3];return Math.abs(Ue-w)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ue),Math.abs(w))&&Math.abs(Le-Z)<=glMatrix.EPSILON*Math.max(1,Math.abs(Le),Math.abs(Z))&&Math.abs(kt-Ee)<=glMatrix.EPSILON*Math.max(1,Math.abs(kt),Math.abs(Ee))&&Math.abs(er-je)<=glMatrix.EPSILON*Math.max(1,Math.abs(er),Math.abs(je))}var ft=null,Nt=null,Ft=null,kr=null,cn=null,yn=null,Vi=null,ir=function(){var de=C();return function(Te,Ue,Le,kt,er,w){var Z,Ee;for(Ue||(Ue=4),Le||(Le=0),kt?Ee=Math.min(kt*Ue+Le,Te.length):Ee=Te.length,Z=Le;Z<Ee;Z+=Ue)de[0]=Te[Z],de[1]=Te[Z+1],de[2]=Te[Z+2],de[3]=Te[Z+3],er(de,de,w),Te[Z]=de[0],Te[Z+1]=de[1],Te[Z+2]=de[2],Te[Z+3]=de[3];return Te}}()},50840:function(Or,U,E){var le;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(C,p,A,Q){"use strict";var Y=["","webkit","Moz","MS","ms","o"],W=p.createElement("div"),L="function",N=Math.round,Be=Math.abs,Ye=Date.now;function Je(xe,ke,ut){return setTimeout(yr(xe,ut),ke)}function et(xe,ke,ut){return Array.isArray(xe)?(Yt(xe,ut[ke],ut),!0):!1}function Yt(xe,ke,ut){var Xt;if(!!xe)if(xe.forEach)xe.forEach(ke,ut);else if(xe.length!==Q)for(Xt=0;Xt<xe.length;)ke.call(ut,xe[Xt],Xt,xe),Xt++;else for(Xt in xe)xe.hasOwnProperty(Xt)&&ke.call(ut,xe[Xt],Xt,xe)}function Gt(xe,ke,ut){var Xt="DEPRECATED METHOD: "+ke+`
`+ut+` AT 
`;return function(){var Xr=new Error("get-stack-trace"),Kn=Xr&&Xr.stack?Xr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",gi=C.console&&(C.console.warn||C.console.log);return gi&&gi.call(C.console,Xt,Kn),xe.apply(this,arguments)}}var tr;typeof Object.assign!="function"?tr=function(ke){if(ke===Q||ke===null)throw new TypeError("Cannot convert undefined or null to object");for(var ut=Object(ke),Xt=1;Xt<arguments.length;Xt++){var Xr=arguments[Xt];if(Xr!==Q&&Xr!==null)for(var Kn in Xr)Xr.hasOwnProperty(Kn)&&(ut[Kn]=Xr[Kn])}return ut}:tr=Object.assign;var zt=Gt(function(ke,ut,Xt){for(var Xr=Object.keys(ut),Kn=0;Kn<Xr.length;)(!Xt||Xt&&ke[Xr[Kn]]===Q)&&(ke[Xr[Kn]]=ut[Xr[Kn]]),Kn++;return ke},"extend","Use `assign`."),Pt=Gt(function(ke,ut){return zt(ke,ut,!0)},"merge","Use `assign`.");function xt(xe,ke,ut){var Xt=ke.prototype,Xr;Xr=xe.prototype=Object.create(Xt),Xr.constructor=xe,Xr._super=Xt,ut&&tr(Xr,ut)}function yr(xe,ke){return function(){return xe.apply(ke,arguments)}}function ee(xe,ke){return typeof xe==L?xe.apply(ke&&ke[0]||Q,ke):xe}function vr(xe,ke){return xe===Q?ke:xe}function Ct(xe,ke,ut){Yt(Ut(ke),function(Xt){xe.addEventListener(Xt,ut,!1)})}function Ke(xe,ke,ut){Yt(Ut(ke),function(Xt){xe.removeEventListener(Xt,ut,!1)})}function Rt(xe,ke){for(;xe;){if(xe==ke)return!0;xe=xe.parentNode}return!1}function Xe(xe,ke){return xe.indexOf(ke)>-1}function Ut(xe){return xe.trim().split(/\s+/g)}function _r(xe,ke,ut){if(xe.indexOf&&!ut)return xe.indexOf(ke);for(var Xt=0;Xt<xe.length;){if(ut&&xe[Xt][ut]==ke||!ut&&xe[Xt]===ke)return Xt;Xt++}return-1}function or(xe){return Array.prototype.slice.call(xe,0)}function zr(xe,ke,ut){for(var Xt=[],Xr=[],Kn=0;Kn<xe.length;){var gi=ke?xe[Kn][ke]:xe[Kn];_r(Xr,gi)<0&&Xt.push(xe[Kn]),Xr[Kn]=gi,Kn++}return ut&&(ke?Xt=Xt.sort(function(Ka,co){return Ka[ke]>co[ke]}):Xt=Xt.sort()),Xt}function he(xe,ke){for(var ut,Xt,Xr=ke[0].toUpperCase()+ke.slice(1),Kn=0;Kn<Y.length;){if(ut=Y[Kn],Xt=ut?ut+Xr:ke,Xt in xe)return Xt;Kn++}return Q}var Re=1;function ye(){return Re++}function _t(xe){var ke=xe.ownerDocument||xe;return ke.defaultView||ke.parentWindow||C}var ft=/mobile|tablet|ip(ad|hone|od)|android/i,Nt="ontouchstart"in C,Ft=he(C,"PointerEvent")!==Q,kr=Nt&&ft.test(navigator.userAgent),cn="touch",yn="pen",Vi="mouse",ir="kinect",de=25,Te=1,Ue=2,Le=4,kt=8,er=1,w=2,Z=4,Ee=8,je=16,Qe=w|Z,yt=Ee|je,St=Qe|yt,jt=["x","y"],Et=["clientX","clientY"];function Qt(xe,ke){var ut=this;this.manager=xe,this.callback=ke,this.element=xe.element,this.target=xe.options.inputTarget,this.domHandler=function(Xt){ee(xe.options.enable,[xe])&&ut.handler(Xt)},this.init()}Qt.prototype={handler:function(){},init:function(){this.evEl&&Ct(this.element,this.evEl,this.domHandler),this.evTarget&&Ct(this.target,this.evTarget,this.domHandler),this.evWin&&Ct(_t(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ke(this.element,this.evEl,this.domHandler),this.evTarget&&Ke(this.target,this.evTarget,this.domHandler),this.evWin&&Ke(_t(this.element),this.evWin,this.domHandler)}};function ie(xe){var ke,ut=xe.options.inputClass;return ut?ke=ut:Ft?ke=ce:kr?ke=ct:Nt?ke=Rr:ke=zi,new ke(xe,sr)}function sr(xe,ke,ut){var Xt=ut.pointers.length,Xr=ut.changedPointers.length,Kn=ke&Te&&Xt-Xr==0,gi=ke&(Le|kt)&&Xt-Xr==0;ut.isFirst=!!Kn,ut.isFinal=!!gi,Kn&&(xe.session={}),ut.eventType=ke,Br(xe,ut),xe.emit("hammer.input",ut),xe.recognize(ut),xe.session.prevInput=ut}function Br(xe,ke){var ut=xe.session,Xt=ke.pointers,Xr=Xt.length;ut.firstInput||(ut.firstInput=gt(ke)),Xr>1&&!ut.firstMultiple?ut.firstMultiple=gt(ke):Xr===1&&(ut.firstMultiple=!1);var Kn=ut.firstInput,gi=ut.firstMultiple,io=gi?gi.center:Kn.center,Ka=ke.center=pt(Xt);ke.timeStamp=Ye(),ke.deltaTime=ke.timeStamp-Kn.timeStamp,ke.angle=nn(io,Ka),ke.distance=Ur(io,Ka),Lr(ut,ke),ke.offsetDirection=Vr(ke.deltaX,ke.deltaY);var co=dr(ke.deltaTime,ke.deltaX,ke.deltaY);ke.overallVelocityX=co.x,ke.overallVelocityY=co.y,ke.overallVelocity=Be(co.x)>Be(co.y)?co.x:co.y,ke.scale=gi?Cr(gi.pointers,Xt):1,ke.rotation=gi?Jr(gi.pointers,Xt):0,ke.maxPointers=ut.prevInput?ke.pointers.length>ut.prevInput.maxPointers?ke.pointers.length:ut.prevInput.maxPointers:ke.pointers.length,rt(ut,ke);var Xo=xe.element;Rt(ke.srcEvent.target,Xo)&&(Xo=ke.srcEvent.target),ke.target=Xo}function Lr(xe,ke){var ut=ke.center,Xt=xe.offsetDelta||{},Xr=xe.prevDelta||{},Kn=xe.prevInput||{};(ke.eventType===Te||Kn.eventType===Le)&&(Xr=xe.prevDelta={x:Kn.deltaX||0,y:Kn.deltaY||0},Xt=xe.offsetDelta={x:ut.x,y:ut.y}),ke.deltaX=Xr.x+(ut.x-Xt.x),ke.deltaY=Xr.y+(ut.y-Xt.y)}function rt(xe,ke){var ut=xe.lastInterval||ke,Xt=ke.timeStamp-ut.timeStamp,Xr,Kn,gi,io;if(ke.eventType!=kt&&(Xt>de||ut.velocity===Q)){var Ka=ke.deltaX-ut.deltaX,co=ke.deltaY-ut.deltaY,Xo=dr(Xt,Ka,co);Kn=Xo.x,gi=Xo.y,Xr=Be(Xo.x)>Be(Xo.y)?Xo.x:Xo.y,io=Vr(Ka,co),xe.lastInterval=ke}else Xr=ut.velocity,Kn=ut.velocityX,gi=ut.velocityY,io=ut.direction;ke.velocity=Xr,ke.velocityX=Kn,ke.velocityY=gi,ke.direction=io}function gt(xe){for(var ke=[],ut=0;ut<xe.pointers.length;)ke[ut]={clientX:N(xe.pointers[ut].clientX),clientY:N(xe.pointers[ut].clientY)},ut++;return{timeStamp:Ye(),pointers:ke,center:pt(ke),deltaX:xe.deltaX,deltaY:xe.deltaY}}function pt(xe){var ke=xe.length;if(ke===1)return{x:N(xe[0].clientX),y:N(xe[0].clientY)};for(var ut=0,Xt=0,Xr=0;Xr<ke;)ut+=xe[Xr].clientX,Xt+=xe[Xr].clientY,Xr++;return{x:N(ut/ke),y:N(Xt/ke)}}function dr(xe,ke,ut){return{x:ke/xe||0,y:ut/xe||0}}function Vr(xe,ke){return xe===ke?er:Be(xe)>=Be(ke)?xe<0?w:Z:ke<0?Ee:je}function Ur(xe,ke,ut){ut||(ut=jt);var Xt=ke[ut[0]]-xe[ut[0]],Xr=ke[ut[1]]-xe[ut[1]];return Math.sqrt(Xt*Xt+Xr*Xr)}function nn(xe,ke,ut){ut||(ut=jt);var Xt=ke[ut[0]]-xe[ut[0]],Xr=ke[ut[1]]-xe[ut[1]];return Math.atan2(Xr,Xt)*180/Math.PI}function Jr(xe,ke){return nn(ke[1],ke[0],Et)+nn(xe[1],xe[0],Et)}function Cr(xe,ke){return Ur(ke[0],ke[1],Et)/Ur(xe[0],xe[1],Et)}var kn={mousedown:Te,mousemove:Ue,mouseup:Le},Zn="mousedown",Si="mousemove mouseup";function zi(){this.evEl=Zn,this.evWin=Si,this.pressed=!1,Qt.apply(this,arguments)}xt(zi,Qt,{handler:function(ke){var ut=kn[ke.type];ut&Te&&ke.button===0&&(this.pressed=!0),ut&Ue&&ke.which!==1&&(ut=Le),!!this.pressed&&(ut&Le&&(this.pressed=!1),this.callback(this.manager,ut,{pointers:[ke],changedPointers:[ke],pointerType:Vi,srcEvent:ke}))}});var Ji={pointerdown:Te,pointermove:Ue,pointerup:Le,pointercancel:kt,pointerout:kt},Di={2:cn,3:yn,4:Vi,5:ir},Oi="pointerdown",X="pointermove pointerup pointercancel";C.MSPointerEvent&&!C.PointerEvent&&(Oi="MSPointerDown",X="MSPointerMove MSPointerUp MSPointerCancel");function ce(){this.evEl=Oi,this.evWin=X,Qt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}xt(ce,Qt,{handler:function(ke){var ut=this.store,Xt=!1,Xr=ke.type.toLowerCase().replace("ms",""),Kn=Ji[Xr],gi=Di[ke.pointerType]||ke.pointerType,io=gi==cn,Ka=_r(ut,ke.pointerId,"pointerId");Kn&Te&&(ke.button===0||io)?Ka<0&&(ut.push(ke),Ka=ut.length-1):Kn&(Le|kt)&&(Xt=!0),!(Ka<0)&&(ut[Ka]=ke,this.callback(this.manager,Kn,{pointers:ut,changedPointers:[ke],pointerType:gi,srcEvent:ke}),Xt&&ut.splice(Ka,1))}});var me={touchstart:Te,touchmove:Ue,touchend:Le,touchcancel:kt},z="touchstart",oe="touchstart touchmove touchend touchcancel";function ve(){this.evTarget=z,this.evWin=oe,this.started=!1,Qt.apply(this,arguments)}xt(ve,Qt,{handler:function(ke){var ut=me[ke.type];if(ut===Te&&(this.started=!0),!!this.started){var Xt=Ae.call(this,ke,ut);ut&(Le|kt)&&Xt[0].length-Xt[1].length==0&&(this.started=!1),this.callback(this.manager,ut,{pointers:Xt[0],changedPointers:Xt[1],pointerType:cn,srcEvent:ke})}}});function Ae(xe,ke){var ut=or(xe.touches),Xt=or(xe.changedTouches);return ke&(Le|kt)&&(ut=zr(ut.concat(Xt),"identifier",!0)),[ut,Xt]}var se={touchstart:Te,touchmove:Ue,touchend:Le,touchcancel:kt},Ce="touchstart touchmove touchend touchcancel";function ct(){this.evTarget=Ce,this.targetIds={},Qt.apply(this,arguments)}xt(ct,Qt,{handler:function(ke){var ut=se[ke.type],Xt=xr.call(this,ke,ut);!Xt||this.callback(this.manager,ut,{pointers:Xt[0],changedPointers:Xt[1],pointerType:cn,srcEvent:ke})}});function xr(xe,ke){var ut=or(xe.touches),Xt=this.targetIds;if(ke&(Te|Ue)&&ut.length===1)return Xt[ut[0].identifier]=!0,[ut,ut];var Xr,Kn,gi=or(xe.changedTouches),io=[],Ka=this.target;if(Kn=ut.filter(function(co){return Rt(co.target,Ka)}),ke===Te)for(Xr=0;Xr<Kn.length;)Xt[Kn[Xr].identifier]=!0,Xr++;for(Xr=0;Xr<gi.length;)Xt[gi[Xr].identifier]&&io.push(gi[Xr]),ke&(Le|kt)&&delete Xt[gi[Xr].identifier],Xr++;if(!!io.length)return[zr(Kn.concat(io),"identifier",!0),io]}var Ht=2500,Jt=25;function Rr(){Qt.apply(this,arguments);var xe=yr(this.handler,this);this.touch=new ct(this.manager,xe),this.mouse=new zi(this.manager,xe),this.primaryTouch=null,this.lastTouches=[]}xt(Rr,Qt,{handler:function(ke,ut,Xt){var Xr=Xt.pointerType==cn,Kn=Xt.pointerType==Vi;if(!(Kn&&Xt.sourceCapabilities&&Xt.sourceCapabilities.firesTouchEvents)){if(Xr)Mn.call(this,ut,Xt);else if(Kn&&$t.call(this,Xt))return;this.callback(ke,ut,Xt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Mn(xe,ke){xe&Te?(this.primaryTouch=ke.changedPointers[0].identifier,Pn.call(this,ke)):xe&(Le|kt)&&Pn.call(this,ke)}function Pn(xe){var ke=xe.changedPointers[0];if(ke.identifier===this.primaryTouch){var ut={x:ke.clientX,y:ke.clientY};this.lastTouches.push(ut);var Xt=this.lastTouches,Xr=function(){var Kn=Xt.indexOf(ut);Kn>-1&&Xt.splice(Kn,1)};setTimeout(Xr,Ht)}}function $t(xe){for(var ke=xe.srcEvent.clientX,ut=xe.srcEvent.clientY,Xt=0;Xt<this.lastTouches.length;Xt++){var Xr=this.lastTouches[Xt],Kn=Math.abs(ke-Xr.x),gi=Math.abs(ut-Xr.y);if(Kn<=Jt&&gi<=Jt)return!0}return!1}var En=he(W.style,"touchAction"),on=En!==Q,ln="compute",Ai="auto",bn="manipulation",Li="none",Yi="pan-x",si="pan-y",Ki=ca();function Ni(xe,ke){this.manager=xe,this.set(ke)}Ni.prototype={set:function(xe){xe==ln&&(xe=this.compute()),on&&this.manager.element.style&&Ki[xe]&&(this.manager.element.style[En]=xe),this.actions=xe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var xe=[];return Yt(this.manager.recognizers,function(ke){ee(ke.options.enable,[ke])&&(xe=xe.concat(ke.getTouchAction()))}),Ti(xe.join(" "))},preventDefaults:function(xe){var ke=xe.srcEvent,ut=xe.offsetDirection;if(this.manager.session.prevented){ke.preventDefault();return}var Xt=this.actions,Xr=Xe(Xt,Li)&&!Ki[Li],Kn=Xe(Xt,si)&&!Ki[si],gi=Xe(Xt,Yi)&&!Ki[Yi];if(Xr){var io=xe.pointers.length===1,Ka=xe.distance<2,co=xe.deltaTime<250;if(io&&Ka&&co)return}if(!(gi&&Kn)&&(Xr||Kn&&ut&Qe||gi&&ut&yt))return this.preventSrc(ke)},preventSrc:function(xe){this.manager.session.prevented=!0,xe.preventDefault()}};function Ti(xe){if(Xe(xe,Li))return Li;var ke=Xe(xe,Yi),ut=Xe(xe,si);return ke&&ut?Li:ke||ut?ke?Yi:si:Xe(xe,bn)?bn:Ai}function ca(){if(!on)return!1;var xe={},ke=C.CSS&&C.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ut){xe[ut]=ke?C.CSS.supports("touch-action",ut):!0}),xe}var Sa=1,oi=2,ri=4,Gi=8,pa=Gi,Ho=16,ya=32;function yi(xe){this.options=tr({},this.defaults,xe||{}),this.id=ye(),this.manager=null,this.options.enable=vr(this.options.enable,!0),this.state=Sa,this.simultaneous={},this.requireFail=[]}yi.prototype={defaults:{},set:function(xe){return tr(this.options,xe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(xe){if(et(xe,"recognizeWith",this))return this;var ke=this.simultaneous;return xe=Ea(xe,this),ke[xe.id]||(ke[xe.id]=xe,xe.recognizeWith(this)),this},dropRecognizeWith:function(xe){return et(xe,"dropRecognizeWith",this)?this:(xe=Ea(xe,this),delete this.simultaneous[xe.id],this)},requireFailure:function(xe){if(et(xe,"requireFailure",this))return this;var ke=this.requireFail;return xe=Ea(xe,this),_r(ke,xe)===-1&&(ke.push(xe),xe.requireFailure(this)),this},dropRequireFailure:function(xe){if(et(xe,"dropRequireFailure",this))return this;xe=Ea(xe,this);var ke=_r(this.requireFail,xe);return ke>-1&&this.requireFail.splice(ke,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(xe){return!!this.simultaneous[xe.id]},emit:function(xe){var ke=this,ut=this.state;function Xt(Xr){ke.manager.emit(Xr,xe)}ut<Gi&&Xt(ke.options.event+ga(ut)),Xt(ke.options.event),xe.additionalEvent&&Xt(xe.additionalEvent),ut>=Gi&&Xt(ke.options.event+ga(ut))},tryEmit:function(xe){if(this.canEmit())return this.emit(xe);this.state=ya},canEmit:function(){for(var xe=0;xe<this.requireFail.length;){if(!(this.requireFail[xe].state&(ya|Sa)))return!1;xe++}return!0},recognize:function(xe){var ke=tr({},xe);if(!ee(this.options.enable,[this,ke])){this.reset(),this.state=ya;return}this.state&(pa|Ho|ya)&&(this.state=Sa),this.state=this.process(ke),this.state&(oi|ri|Gi|Ho)&&this.tryEmit(ke)},process:function(xe){},getTouchAction:function(){},reset:function(){}};function ga(xe){return xe&Ho?"cancel":xe&Gi?"end":xe&ri?"move":xe&oi?"start":""}function Ws(xe){return xe==je?"down":xe==Ee?"up":xe==w?"left":xe==Z?"right":""}function Ea(xe,ke){var ut=ke.manager;return ut?ut.get(xe):xe}function Ao(){yi.apply(this,arguments)}xt(Ao,yi,{defaults:{pointers:1},attrTest:function(xe){var ke=this.options.pointers;return ke===0||xe.pointers.length===ke},process:function(xe){var ke=this.state,ut=xe.eventType,Xt=ke&(oi|ri),Xr=this.attrTest(xe);return Xt&&(ut&kt||!Xr)?ke|Ho:Xt||Xr?ut&Le?ke|Gi:ke&oi?ke|ri:oi:ya}});function Xa(){Ao.apply(this,arguments),this.pX=null,this.pY=null}xt(Xa,Ao,{defaults:{event:"pan",threshold:10,pointers:1,direction:St},getTouchAction:function(){var xe=this.options.direction,ke=[];return xe&Qe&&ke.push(si),xe&yt&&ke.push(Yi),ke},directionTest:function(xe){var ke=this.options,ut=!0,Xt=xe.distance,Xr=xe.direction,Kn=xe.deltaX,gi=xe.deltaY;return Xr&ke.direction||(ke.direction&Qe?(Xr=Kn===0?er:Kn<0?w:Z,ut=Kn!=this.pX,Xt=Math.abs(xe.deltaX)):(Xr=gi===0?er:gi<0?Ee:je,ut=gi!=this.pY,Xt=Math.abs(xe.deltaY))),xe.direction=Xr,ut&&Xt>ke.threshold&&Xr&ke.direction},attrTest:function(xe){return Ao.prototype.attrTest.call(this,xe)&&(this.state&oi||!(this.state&oi)&&this.directionTest(xe))},emit:function(xe){this.pX=xe.deltaX,this.pY=xe.deltaY;var ke=Ws(xe.direction);ke&&(xe.additionalEvent=this.options.event+ke),this._super.emit.call(this,xe)}});function Ya(){Ao.apply(this,arguments)}xt(Ya,Ao,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Li]},attrTest:function(xe){return this._super.attrTest.call(this,xe)&&(Math.abs(xe.scale-1)>this.options.threshold||this.state&oi)},emit:function(xe){if(xe.scale!==1){var ke=xe.scale<1?"in":"out";xe.additionalEvent=this.options.event+ke}this._super.emit.call(this,xe)}});function Wo(){yi.apply(this,arguments),this._timer=null,this._input=null}xt(Wo,yi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ai]},process:function(xe){var ke=this.options,ut=xe.pointers.length===ke.pointers,Xt=xe.distance<ke.threshold,Xr=xe.deltaTime>ke.time;if(this._input=xe,!Xt||!ut||xe.eventType&(Le|kt)&&!Xr)this.reset();else if(xe.eventType&Te)this.reset(),this._timer=Je(function(){this.state=pa,this.tryEmit()},ke.time,this);else if(xe.eventType&Le)return pa;return ya},reset:function(){clearTimeout(this._timer)},emit:function(xe){this.state===pa&&(xe&&xe.eventType&Le?this.manager.emit(this.options.event+"up",xe):(this._input.timeStamp=Ye(),this.manager.emit(this.options.event,this._input)))}});function Ui(){Ao.apply(this,arguments)}xt(Ui,Ao,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Li]},attrTest:function(xe){return this._super.attrTest.call(this,xe)&&(Math.abs(xe.rotation)>this.options.threshold||this.state&oi)}});function To(){Ao.apply(this,arguments)}xt(To,Ao,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Qe|yt,pointers:1},getTouchAction:function(){return Xa.prototype.getTouchAction.call(this)},attrTest:function(xe){var ke=this.options.direction,ut;return ke&(Qe|yt)?ut=xe.overallVelocity:ke&Qe?ut=xe.overallVelocityX:ke&yt&&(ut=xe.overallVelocityY),this._super.attrTest.call(this,xe)&&ke&xe.offsetDirection&&xe.distance>this.options.threshold&&xe.maxPointers==this.options.pointers&&Be(ut)>this.options.velocity&&xe.eventType&Le},emit:function(xe){var ke=Ws(xe.offsetDirection);ke&&this.manager.emit(this.options.event+ke,xe),this.manager.emit(this.options.event,xe)}});function Lo(){yi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}xt(Lo,yi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[bn]},process:function(xe){var ke=this.options,ut=xe.pointers.length===ke.pointers,Xt=xe.distance<ke.threshold,Xr=xe.deltaTime<ke.time;if(this.reset(),xe.eventType&Te&&this.count===0)return this.failTimeout();if(Xt&&Xr&&ut){if(xe.eventType!=Le)return this.failTimeout();var Kn=this.pTime?xe.timeStamp-this.pTime<ke.interval:!0,gi=!this.pCenter||Ur(this.pCenter,xe.center)<ke.posThreshold;this.pTime=xe.timeStamp,this.pCenter=xe.center,!gi||!Kn?this.count=1:this.count+=1,this._input=xe;var io=this.count%ke.taps;if(io===0)return this.hasRequireFailures()?(this._timer=Je(function(){this.state=pa,this.tryEmit()},ke.interval,this),oi):pa}return ya},failTimeout:function(){return this._timer=Je(function(){this.state=ya},this.options.interval,this),ya},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==pa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function lo(xe,ke){return ke=ke||{},ke.recognizers=vr(ke.recognizers,lo.defaults.preset),new Ra(xe,ke)}lo.VERSION="2.0.7",lo.defaults={domEvents:!1,touchAction:ln,enable:!0,inputTarget:null,inputClass:null,preset:[[Ui,{enable:!1}],[Ya,{enable:!1},["rotate"]],[To,{direction:Qe}],[Xa,{direction:Qe},["swipe"]],[Lo],[Lo,{event:"doubletap",taps:2},["tap"]],[Wo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ro=1,Hi=2;function Ra(xe,ke){this.options=tr({},lo.defaults,ke||{}),this.options.inputTarget=this.options.inputTarget||xe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=xe,this.input=ie(this),this.touchAction=new Ni(this,this.options.touchAction),Fa(this,!0),Yt(this.options.recognizers,function(ut){var Xt=this.add(new ut[0](ut[1]));ut[2]&&Xt.recognizeWith(ut[2]),ut[3]&&Xt.requireFailure(ut[3])},this)}Ra.prototype={set:function(xe){return tr(this.options,xe),xe.touchAction&&this.touchAction.update(),xe.inputTarget&&(this.input.destroy(),this.input.target=xe.inputTarget,this.input.init()),this},stop:function(xe){this.session.stopped=xe?Hi:Ro},recognize:function(xe){var ke=this.session;if(!ke.stopped){this.touchAction.preventDefaults(xe);var ut,Xt=this.recognizers,Xr=ke.curRecognizer;(!Xr||Xr&&Xr.state&pa)&&(Xr=ke.curRecognizer=null);for(var Kn=0;Kn<Xt.length;)ut=Xt[Kn],ke.stopped!==Hi&&(!Xr||ut==Xr||ut.canRecognizeWith(Xr))?ut.recognize(xe):ut.reset(),!Xr&&ut.state&(oi|ri|Gi)&&(Xr=ke.curRecognizer=ut),Kn++}},get:function(xe){if(xe instanceof yi)return xe;for(var ke=this.recognizers,ut=0;ut<ke.length;ut++)if(ke[ut].options.event==xe)return ke[ut];return null},add:function(xe){if(et(xe,"add",this))return this;var ke=this.get(xe.options.event);return ke&&this.remove(ke),this.recognizers.push(xe),xe.manager=this,this.touchAction.update(),xe},remove:function(xe){if(et(xe,"remove",this))return this;if(xe=this.get(xe),xe){var ke=this.recognizers,ut=_r(ke,xe);ut!==-1&&(ke.splice(ut,1),this.touchAction.update())}return this},on:function(xe,ke){if(xe!==Q&&ke!==Q){var ut=this.handlers;return Yt(Ut(xe),function(Xt){ut[Xt]=ut[Xt]||[],ut[Xt].push(ke)}),this}},off:function(xe,ke){if(xe!==Q){var ut=this.handlers;return Yt(Ut(xe),function(Xt){ke?ut[Xt]&&ut[Xt].splice(_r(ut[Xt],ke),1):delete ut[Xt]}),this}},emit:function(xe,ke){this.options.domEvents&&ms(xe,ke);var ut=this.handlers[xe]&&this.handlers[xe].slice();if(!(!ut||!ut.length)){ke.type=xe,ke.preventDefault=function(){ke.srcEvent.preventDefault()};for(var Xt=0;Xt<ut.length;)ut[Xt](ke),Xt++}},destroy:function(){this.element&&Fa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Fa(xe,ke){var ut=xe.element;if(!!ut.style){var Xt;Yt(xe.options.cssProps,function(Xr,Kn){Xt=he(ut.style,Kn),ke?(xe.oldCssProps[Xt]=ut.style[Xt],ut.style[Xt]=Xr):ut.style[Xt]=xe.oldCssProps[Xt]||""}),ke||(xe.oldCssProps={})}}function ms(xe,ke){var ut=p.createEvent("Event");ut.initEvent(xe,!0,!0),ut.gesture=ke,ke.target.dispatchEvent(ut)}tr(lo,{INPUT_START:Te,INPUT_MOVE:Ue,INPUT_END:Le,INPUT_CANCEL:kt,STATE_POSSIBLE:Sa,STATE_BEGAN:oi,STATE_CHANGED:ri,STATE_ENDED:Gi,STATE_RECOGNIZED:pa,STATE_CANCELLED:Ho,STATE_FAILED:ya,DIRECTION_NONE:er,DIRECTION_LEFT:w,DIRECTION_RIGHT:Z,DIRECTION_UP:Ee,DIRECTION_DOWN:je,DIRECTION_HORIZONTAL:Qe,DIRECTION_VERTICAL:yt,DIRECTION_ALL:St,Manager:Ra,Input:Qt,TouchAction:Ni,TouchInput:ct,MouseInput:zi,PointerEventInput:ce,TouchMouseInput:Rr,SingleTouchInput:ve,Recognizer:yi,AttrRecognizer:Ao,Tap:Lo,Pan:Xa,Swipe:To,Pinch:Ya,Rotate:Ui,Press:Wo,on:Ct,off:Ke,each:Yt,merge:Pt,extend:zt,assign:tr,inherit:xt,bindFn:yr,prefixed:he});var _a=typeof C!="undefined"?C:typeof self!="undefined"?self:{};_a.Hammer=lo,le=function(){return lo}.call(U,E,U,Or),le!==Q&&(Or.exports=le)})(window,document,"Hammer")},7375:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0});var E=Symbol.for("INJECTION");function le(Y,W,L,N){function Be(){return N&&!Reflect.hasMetadata(E,this,W)&&Reflect.defineMetadata(E,L(),this,W),Reflect.hasMetadata(E,this,W)?Reflect.getMetadata(E,this,W):L()}function Ye(Je){Reflect.defineMetadata(E,Je,this,W)}Object.defineProperty(Y,W,{configurable:!0,enumerable:!0,get:Be,set:Ye})}function C(Y,W){return function(L){return function(N,Be){var Ye=function(){return Y.get(L)};le(N,Be,Ye,W)}}}U.makePropertyInjectDecorator=C;function p(Y,W){return function(L,N){return function(Be,Ye){var Je=function(){return Y.getNamed(L,N)};le(Be,Ye,Je,W)}}}U.makePropertyInjectNamedDecorator=p;function A(Y,W){return function(L,N,Be){return function(Ye,Je){var et=function(){return Y.getTagged(L,N,Be)};le(Ye,Je,et,W)}}}U.makePropertyInjectTaggedDecorator=A;function Q(Y,W){return function(L){return function(N,Be){var Ye=function(){return Y.getAll(L)};le(N,Be,Ye,W)}}}U.makePropertyMultiInjectDecorator=Q},84879:function(Or,U,E){"use strict";var le;le={value:!0};var C=E(7375);function p(A,Q){Q===void 0&&(Q=!0);var Y=C.makePropertyInjectDecorator(A,Q),W=C.makePropertyInjectNamedDecorator(A,Q),L=C.makePropertyInjectTaggedDecorator(A,Q),N=C.makePropertyMultiInjectDecorator(A,Q);return{lazyInject:Y,lazyInjectNamed:W,lazyInjectTagged:L,lazyMultiInject:N}}U.Z=p},99934:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.tagProperty=U.tagParameter=U.decorate=void 0;var le=E(16674),C=E(6867);function p(N,Be,Ye,Je){var et=C.TAGGED;Q(et,N,Be,Je,Ye)}U.tagParameter=p;function A(N,Be,Ye){var Je=C.TAGGED_PROP;Q(Je,N.constructor,Be,Ye)}U.tagProperty=A;function Q(N,Be,Ye,Je,et){var Yt={},Gt=typeof et=="number",tr=et!==void 0&&Gt?et.toString():Ye;if(Gt&&Ye!==void 0)throw new Error(le.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(N,Be)&&(Yt=Reflect.getMetadata(N,Be));var zt=Yt[tr];if(!Array.isArray(zt))zt=[];else for(var Pt=0,xt=zt;Pt<xt.length;Pt++){var yr=xt[Pt];if(yr.key===Je.key)throw new Error(le.DUPLICATED_METADATA+" "+yr.key.toString())}zt.push(Je),Yt[tr]=zt,Reflect.defineMetadata(N,Yt,Be)}function Y(N,Be){Reflect.decorate(N,Be)}function W(N,Be){return function(Ye,Je){Be(Ye,Je,N)}}function L(N,Be,Ye){typeof Ye=="number"?Y([W(Ye,N)],Be):typeof Ye=="string"?Reflect.decorate([N],Be,Ye):Y([N],Be)}U.decorate=L},5744:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.inject=U.LazyServiceIdentifer=void 0;var le=E(16674),C=E(6867),p=E(47738),A=E(99934),Q=function(){function W(L){this._cb=L}return W.prototype.unwrap=function(){return this._cb()},W}();U.LazyServiceIdentifer=Q;function Y(W){return function(L,N,Be){if(W===void 0)throw new Error(le.UNDEFINED_INJECT_ANNOTATION(L.name));var Ye=new p.Metadata(C.INJECT_TAG,W);typeof Be=="number"?A.tagParameter(L,N,Be,Ye):A.tagProperty(L,N,Ye)}}U.inject=Y},64315:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.injectable=void 0;var le=E(16674),C=E(6867);function p(){return function(A){if(Reflect.hasOwnMetadata(C.PARAM_TYPES,A))throw new Error(le.DUPLICATED_INJECTABLE_DECORATOR);var Q=Reflect.getMetadata(C.DESIGN_PARAM_TYPES,A)||[];return Reflect.defineMetadata(C.PARAM_TYPES,Q,A),A}}U.injectable=p},71693:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.multiInject=void 0;var le=E(6867),C=E(47738),p=E(99934);function A(Q){return function(Y,W,L){var N=new C.Metadata(le.MULTI_INJECT_TAG,Q);typeof L=="number"?p.tagParameter(Y,W,L,N):p.tagProperty(Y,W,N)}}U.multiInject=A},38085:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.named=void 0;var le=E(6867),C=E(47738),p=E(99934);function A(Q){return function(Y,W,L){var N=new C.Metadata(le.NAMED_TAG,Q);typeof L=="number"?p.tagParameter(Y,W,L,N):p.tagProperty(Y,W,N)}}U.named=A},6515:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.optional=void 0;var le=E(6867),C=E(47738),p=E(99934);function A(){return function(Q,Y,W){var L=new C.Metadata(le.OPTIONAL_TAG,!0);typeof W=="number"?p.tagParameter(Q,Y,W,L):p.tagProperty(Q,Y,L)}}U.optional=A},7014:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.postConstruct=void 0;var le=E(16674),C=E(6867),p=E(47738);function A(){return function(Q,Y,W){var L=new p.Metadata(C.POST_CONSTRUCT,Y);if(Reflect.hasOwnMetadata(C.POST_CONSTRUCT,Q.constructor))throw new Error(le.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(C.POST_CONSTRUCT,L,Q.constructor)}}U.postConstruct=A},32052:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.tagged=void 0;var le=E(47738),C=E(99934);function p(A,Q){return function(Y,W,L){var N=new le.Metadata(A,Q);typeof L=="number"?C.tagParameter(Y,W,L,N):C.tagProperty(Y,W,N)}}U.tagged=p},55638:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.targetName=void 0;var le=E(6867),C=E(47738),p=E(99934);function A(Q){return function(Y,W,L){var N=new C.Metadata(le.NAME_TAG,Q);p.tagParameter(Y,W,L,N)}}U.targetName=A},86757:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.unmanaged=void 0;var le=E(6867),C=E(47738),p=E(99934);function A(){return function(Q,Y,W){var L=new C.Metadata(le.UNMANAGED_TAG,!0);p.tagParameter(Q,Y,W,L)}}U.unmanaged=A},44290:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Binding=void 0;var le=E(28421),C=E(37791),p=function(){function A(Q,Y){this.id=C.id(),this.activated=!1,this.serviceIdentifier=Q,this.scope=Y,this.type=le.BindingTypeEnum.Invalid,this.constraint=function(W){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return A.prototype.clone=function(){var Q=new A(this.serviceIdentifier,this.scope);return Q.activated=Q.scope===le.BindingScopeEnum.Singleton?this.activated:!1,Q.implementationType=this.implementationType,Q.dynamicValue=this.dynamicValue,Q.scope=this.scope,Q.type=this.type,Q.factory=this.factory,Q.provider=this.provider,Q.constraint=this.constraint,Q.onActivation=this.onActivation,Q.cache=this.cache,Q},A}();U.Binding=p},23184:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingCount=void 0;var E={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};U.BindingCount=E},16674:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.STACK_OVERFLOW=U.CIRCULAR_DEPENDENCY_IN_FACTORY=U.POST_CONSTRUCT_ERROR=U.MULTIPLE_POST_CONSTRUCT_METHODS=U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=U.ARGUMENTS_LENGTH_MISMATCH=U.INVALID_DECORATOR_OPERATION=U.INVALID_TO_SELF_VALUE=U.INVALID_FUNCTION_BINDING=U.INVALID_MIDDLEWARE_RETURN=U.NO_MORE_SNAPSHOTS_AVAILABLE=U.INVALID_BINDING_TYPE=U.NOT_IMPLEMENTED=U.CIRCULAR_DEPENDENCY=U.UNDEFINED_INJECT_ANNOTATION=U.MISSING_INJECT_ANNOTATION=U.MISSING_INJECTABLE_ANNOTATION=U.NOT_REGISTERED=U.CANNOT_UNBIND=U.AMBIGUOUS_MATCH=U.KEY_NOT_FOUND=U.NULL_ARGUMENT=U.DUPLICATED_METADATA=U.DUPLICATED_INJECTABLE_DECORATOR=void 0,U.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",U.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",U.NULL_ARGUMENT="NULL argument",U.KEY_NOT_FOUND="Key Not Found",U.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",U.CANNOT_UNBIND="Could not unbind serviceIdentifier:",U.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",U.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",U.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var E=function(A){return"@inject called with undefined this could mean that the class "+A+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};U.UNDEFINED_INJECT_ANNOTATION=E,U.CIRCULAR_DEPENDENCY="Circular dependency found:",U.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",U.INVALID_BINDING_TYPE="Invalid binding type:",U.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",U.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",U.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",U.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",U.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var le=function(){for(var A=[],Q=0;Q<arguments.length;Q++)A[Q]=arguments[Q];return"The number of constructor arguments in the derived class "+(A[0]+" must be >= than the number of constructor arguments of its base class.")};U.ARGUMENTS_LENGTH_MISMATCH=le,U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",U.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var C=function(){for(var A=[],Q=0;Q<arguments.length;Q++)A[Q]=arguments[Q];return"@postConstruct error in class "+A[0]+": "+A[1]};U.POST_CONSTRUCT_ERROR=C;var p=function(){for(var A=[],Q=0;Q<arguments.length;Q++)A[Q]=arguments[Q];return"It looks like there is a circular dependency "+("in one of the '"+A[0]+"' bindings. Please investigate bindings with")+("service identifier '"+A[1]+"'.")};U.CIRCULAR_DEPENDENCY_IN_FACTORY=p,U.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.TargetTypeEnum=U.BindingTypeEnum=U.BindingScopeEnum=void 0;var E={Request:"Request",Singleton:"Singleton",Transient:"Transient"};U.BindingScopeEnum=E;var le={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};U.BindingTypeEnum=le;var C={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};U.TargetTypeEnum=C},6867:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.NON_CUSTOM_TAG_KEYS=U.POST_CONSTRUCT=U.DESIGN_PARAM_TYPES=U.PARAM_TYPES=U.TAGGED_PROP=U.TAGGED=U.MULTI_INJECT_TAG=U.INJECT_TAG=U.OPTIONAL_TAG=U.UNMANAGED_TAG=U.NAME_TAG=U.NAMED_TAG=void 0,U.NAMED_TAG="named",U.NAME_TAG="name",U.UNMANAGED_TAG="unmanaged",U.OPTIONAL_TAG="optional",U.INJECT_TAG="inject",U.MULTI_INJECT_TAG="multi_inject",U.TAGGED="inversify:tagged",U.TAGGED_PROP="inversify:tagged_props",U.PARAM_TYPES="inversify:paramtypes",U.DESIGN_PARAM_TYPES="design:paramtypes",U.POST_CONSTRUCT="post_construct";function E(){return[U.INJECT_TAG,U.MULTI_INJECT_TAG,U.NAME_TAG,U.UNMANAGED_TAG,U.NAMED_TAG,U.OPTIONAL_TAG]}U.NON_CUSTOM_TAG_KEYS=E()},51389:function(Or,U,E){"use strict";var le=this&&this.__awaiter||function(zt,Pt,xt,yr){function ee(vr){return vr instanceof xt?vr:new xt(function(Ct){Ct(vr)})}return new(xt||(xt=Promise))(function(vr,Ct){function Ke(Ut){try{Xe(yr.next(Ut))}catch(_r){Ct(_r)}}function Rt(Ut){try{Xe(yr.throw(Ut))}catch(_r){Ct(_r)}}function Xe(Ut){Ut.done?vr(Ut.value):ee(Ut.value).then(Ke,Rt)}Xe((yr=yr.apply(zt,Pt||[])).next())})},C=this&&this.__generator||function(zt,Pt){var xt={label:0,sent:function(){if(vr[0]&1)throw vr[1];return vr[1]},trys:[],ops:[]},yr,ee,vr,Ct;return Ct={next:Ke(0),throw:Ke(1),return:Ke(2)},typeof Symbol=="function"&&(Ct[Symbol.iterator]=function(){return this}),Ct;function Ke(Xe){return function(Ut){return Rt([Xe,Ut])}}function Rt(Xe){if(yr)throw new TypeError("Generator is already executing.");for(;xt;)try{if(yr=1,ee&&(vr=Xe[0]&2?ee.return:Xe[0]?ee.throw||((vr=ee.return)&&vr.call(ee),0):ee.next)&&!(vr=vr.call(ee,Xe[1])).done)return vr;switch(ee=0,vr&&(Xe=[Xe[0]&2,vr.value]),Xe[0]){case 0:case 1:vr=Xe;break;case 4:return xt.label++,{value:Xe[1],done:!1};case 5:xt.label++,ee=Xe[1],Xe=[0];continue;case 7:Xe=xt.ops.pop(),xt.trys.pop();continue;default:if(vr=xt.trys,!(vr=vr.length>0&&vr[vr.length-1])&&(Xe[0]===6||Xe[0]===2)){xt=0;continue}if(Xe[0]===3&&(!vr||Xe[1]>vr[0]&&Xe[1]<vr[3])){xt.label=Xe[1];break}if(Xe[0]===6&&xt.label<vr[1]){xt.label=vr[1],vr=Xe;break}if(vr&&xt.label<vr[2]){xt.label=vr[2],xt.ops.push(Xe);break}vr[2]&&xt.ops.pop(),xt.trys.pop();continue}Xe=Pt.call(zt,xt)}catch(Ut){Xe=[6,Ut],ee=0}finally{yr=vr=0}if(Xe[0]&5)throw Xe[1];return{value:Xe[0]?Xe[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(zt,Pt){for(var xt=0,yr=Pt.length,ee=zt.length;xt<yr;xt++,ee++)zt[ee]=Pt[xt];return zt};Object.defineProperty(U,"__esModule",{value:!0}),U.Container=void 0;var A=E(44290),Q=E(16674),Y=E(28421),W=E(6867),L=E(51377),N=E(86311),Be=E(31927),Ye=E(15451),Je=E(37791),et=E(55800),Yt=E(85700),Gt=E(80175),tr=function(){function zt(Pt){this._appliedMiddleware=[];var xt=Pt||{};if(typeof xt!="object")throw new Error(""+Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(xt.defaultScope===void 0)xt.defaultScope=Y.BindingScopeEnum.Transient;else if(xt.defaultScope!==Y.BindingScopeEnum.Singleton&&xt.defaultScope!==Y.BindingScopeEnum.Transient&&xt.defaultScope!==Y.BindingScopeEnum.Request)throw new Error(""+Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(xt.autoBindInjectable===void 0)xt.autoBindInjectable=!1;else if(typeof xt.autoBindInjectable!="boolean")throw new Error(""+Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(xt.skipBaseClassChecks===void 0)xt.skipBaseClassChecks=!1;else if(typeof xt.skipBaseClassChecks!="boolean")throw new Error(""+Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:xt.autoBindInjectable,defaultScope:xt.defaultScope,skipBaseClassChecks:xt.skipBaseClassChecks},this.id=Je.id(),this._bindingDictionary=new Gt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new L.MetadataReader}return zt.merge=function(Pt,xt){for(var yr=[],ee=2;ee<arguments.length;ee++)yr[ee-2]=arguments[ee];var vr=new zt,Ct=p([Pt,xt],yr).map(function(Xe){return N.getBindingDictionary(Xe)}),Ke=N.getBindingDictionary(vr);function Rt(Xe,Ut){Xe.traverse(function(_r,or){or.forEach(function(zr){Ut.add(zr.serviceIdentifier,zr.clone())})})}return Ct.forEach(function(Xe){Rt(Xe,Ke)}),vr},zt.prototype.load=function(){for(var Pt=[],xt=0;xt<arguments.length;xt++)Pt[xt]=arguments[xt];for(var yr=this._getContainerModuleHelpersFactory(),ee=0,vr=Pt;ee<vr.length;ee++){var Ct=vr[ee],Ke=yr(Ct.id);Ct.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)}},zt.prototype.loadAsync=function(){for(var Pt=[],xt=0;xt<arguments.length;xt++)Pt[xt]=arguments[xt];return le(this,void 0,void 0,function(){var yr,ee,vr,Ct,Ke;return C(this,function(Rt){switch(Rt.label){case 0:yr=this._getContainerModuleHelpersFactory(),ee=0,vr=Pt,Rt.label=1;case 1:return ee<vr.length?(Ct=vr[ee],Ke=yr(Ct.id),[4,Ct.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)]):[3,4];case 2:Rt.sent(),Rt.label=3;case 3:return ee++,[3,1];case 4:return[2]}})})},zt.prototype.unload=function(){for(var Pt=this,xt=[],yr=0;yr<arguments.length;yr++)xt[yr]=arguments[yr];var ee=function(vr){return function(Ct){return Ct.moduleId===vr}};xt.forEach(function(vr){var Ct=ee(vr.id);Pt._bindingDictionary.removeByCondition(Ct)})},zt.prototype.bind=function(Pt){var xt=this.options.defaultScope||Y.BindingScopeEnum.Transient,yr=new A.Binding(Pt,xt);return this._bindingDictionary.add(Pt,yr),new Ye.BindingToSyntax(yr)},zt.prototype.rebind=function(Pt){return this.unbind(Pt),this.bind(Pt)},zt.prototype.unbind=function(Pt){try{this._bindingDictionary.remove(Pt)}catch(xt){throw new Error(Q.CANNOT_UNBIND+" "+et.getServiceIdentifierAsString(Pt))}},zt.prototype.unbindAll=function(){this._bindingDictionary=new Gt.Lookup},zt.prototype.isBound=function(Pt){var xt=this._bindingDictionary.hasKey(Pt);return!xt&&this.parent&&(xt=this.parent.isBound(Pt)),xt},zt.prototype.isBoundNamed=function(Pt,xt){return this.isBoundTagged(Pt,W.NAMED_TAG,xt)},zt.prototype.isBoundTagged=function(Pt,xt,yr){var ee=!1;if(this._bindingDictionary.hasKey(Pt)){var vr=this._bindingDictionary.get(Pt),Ct=N.createMockRequest(this,Pt,xt,yr);ee=vr.some(function(Ke){return Ke.constraint(Ct)})}return!ee&&this.parent&&(ee=this.parent.isBoundTagged(Pt,xt,yr)),ee},zt.prototype.snapshot=function(){this._snapshots.push(Yt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},zt.prototype.restore=function(){var Pt=this._snapshots.pop();if(Pt===void 0)throw new Error(Q.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Pt.bindings,this._middleware=Pt.middleware},zt.prototype.createChild=function(Pt){var xt=new zt(Pt||this.options);return xt.parent=this,xt},zt.prototype.applyMiddleware=function(){for(var Pt=[],xt=0;xt<arguments.length;xt++)Pt[xt]=arguments[xt];this._appliedMiddleware=this._appliedMiddleware.concat(Pt);var yr=this._middleware?this._middleware:this._planAndResolve();this._middleware=Pt.reduce(function(ee,vr){return vr(ee)},yr)},zt.prototype.applyCustomMetadataReader=function(Pt){this._metadataReader=Pt},zt.prototype.get=function(Pt){return this._get(!1,!1,Y.TargetTypeEnum.Variable,Pt)},zt.prototype.getTagged=function(Pt,xt,yr){return this._get(!1,!1,Y.TargetTypeEnum.Variable,Pt,xt,yr)},zt.prototype.getNamed=function(Pt,xt){return this.getTagged(Pt,W.NAMED_TAG,xt)},zt.prototype.getAll=function(Pt){return this._get(!0,!0,Y.TargetTypeEnum.Variable,Pt)},zt.prototype.getAllTagged=function(Pt,xt,yr){return this._get(!1,!0,Y.TargetTypeEnum.Variable,Pt,xt,yr)},zt.prototype.getAllNamed=function(Pt,xt){return this.getAllTagged(Pt,W.NAMED_TAG,xt)},zt.prototype.resolve=function(Pt){var xt=this.createChild();return xt.bind(Pt).toSelf(),this._appliedMiddleware.forEach(function(yr){xt.applyMiddleware(yr)}),xt.get(Pt)},zt.prototype._getContainerModuleHelpersFactory=function(){var Pt=this,xt=function(Ke,Rt){Ke._binding.moduleId=Rt},yr=function(Ke){return function(Rt){var Xe=Pt.bind.bind(Pt),Ut=Xe(Rt);return xt(Ut,Ke),Ut}},ee=function(Ke){return function(Rt){var Xe=Pt.unbind.bind(Pt);Xe(Rt)}},vr=function(Ke){return function(Rt){var Xe=Pt.isBound.bind(Pt);return Xe(Rt)}},Ct=function(Ke){return function(Rt){var Xe=Pt.rebind.bind(Pt),Ut=Xe(Rt);return xt(Ut,Ke),Ut}};return function(Ke){return{bindFunction:yr(Ke),isboundFunction:vr(Ke),rebindFunction:Ct(Ke),unbindFunction:ee(Ke)}}},zt.prototype._get=function(Pt,xt,yr,ee,vr,Ct){var Ke=null,Rt={avoidConstraints:Pt,contextInterceptor:function(Xe){return Xe},isMultiInject:xt,key:vr,serviceIdentifier:ee,targetType:yr,value:Ct};if(this._middleware){if(Ke=this._middleware(Rt),Ke==null)throw new Error(Q.INVALID_MIDDLEWARE_RETURN)}else Ke=this._planAndResolve()(Rt);return Ke},zt.prototype._planAndResolve=function(){var Pt=this;return function(xt){var yr=N.plan(Pt._metadataReader,Pt,xt.isMultiInject,xt.targetType,xt.serviceIdentifier,xt.key,xt.value,xt.avoidConstraints);yr=xt.contextInterceptor(yr);var ee=Be.resolve(yr);return ee}},zt}();U.Container=tr},33244:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.AsyncContainerModule=U.ContainerModule=void 0;var le=E(37791),C=function(){function A(Q){this.id=le.id(),this.registry=Q}return A}();U.ContainerModule=C;var p=function(){function A(Q){this.id=le.id(),this.registry=Q}return A}();U.AsyncContainerModule=p},85700:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.ContainerSnapshot=void 0;var E=function(){function le(){}return le.of=function(C,p){var A=new le;return A.bindings=C,A.middleware=p,A},le}();U.ContainerSnapshot=E},80175:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Lookup=void 0;var le=E(16674),C=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(A,Q){if(A==null)throw new Error(le.NULL_ARGUMENT);if(Q==null)throw new Error(le.NULL_ARGUMENT);var Y=this._map.get(A);Y!==void 0?(Y.push(Q),this._map.set(A,Y)):this._map.set(A,[Q])},p.prototype.get=function(A){if(A==null)throw new Error(le.NULL_ARGUMENT);var Q=this._map.get(A);if(Q!==void 0)return Q;throw new Error(le.KEY_NOT_FOUND)},p.prototype.remove=function(A){if(A==null)throw new Error(le.NULL_ARGUMENT);if(!this._map.delete(A))throw new Error(le.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(A){var Q=this;this._map.forEach(function(Y,W){var L=Y.filter(function(N){return!A(N)});L.length>0?Q._map.set(W,L):Q._map.delete(W)})},p.prototype.hasKey=function(A){if(A==null)throw new Error(le.NULL_ARGUMENT);return this._map.has(A)},p.prototype.clone=function(){var A=new p;return this._map.forEach(function(Q,Y){Q.forEach(function(W){return A.add(Y,W.clone())})}),A},p.prototype.traverse=function(A){this._map.forEach(function(Q,Y){A(Y,Q)})},p}();U.Lookup=C},86700:function(Or,U,E){"use strict";var le;le={value:!0},le=le=le=le=le=le=U.GW=le=le=U.zY=le=le=le=le=le=U.f3=le=le=U.b2=le=le=le=le=le=U.W2=le=void 0;var C=E(6867);le=C;var p=E(51389);Object.defineProperty(U,"W2",{enumerable:!0,get:function(){return p.Container}});var A=E(28421);le={enumerable:!0,get:function(){return A.BindingScopeEnum}},le={enumerable:!0,get:function(){return A.BindingTypeEnum}},le={enumerable:!0,get:function(){return A.TargetTypeEnum}};var Q=E(33244);le={enumerable:!0,get:function(){return Q.AsyncContainerModule}},le={enumerable:!0,get:function(){return Q.ContainerModule}};var Y=E(64315);Object.defineProperty(U,"b2",{enumerable:!0,get:function(){return Y.injectable}});var W=E(32052);le={enumerable:!0,get:function(){return W.tagged}};var L=E(38085);le={enumerable:!0,get:function(){return L.named}};var N=E(5744);Object.defineProperty(U,"f3",{enumerable:!0,get:function(){return N.inject}}),le={enumerable:!0,get:function(){return N.LazyServiceIdentifer}};var Be=E(6515);le={enumerable:!0,get:function(){return Be.optional}};var Ye=E(86757);le={enumerable:!0,get:function(){return Ye.unmanaged}};var Je=E(71693);le={enumerable:!0,get:function(){return Je.multiInject}};var et=E(55638);le={enumerable:!0,get:function(){return et.targetName}};var Yt=E(7014);Object.defineProperty(U,"zY",{enumerable:!0,get:function(){return Yt.postConstruct}});var Gt=E(51377);le={enumerable:!0,get:function(){return Gt.MetadataReader}};var tr=E(37791);le={enumerable:!0,get:function(){return tr.id}};var zt=E(99934);Object.defineProperty(U,"GW",{enumerable:!0,get:function(){return zt.decorate}});var Pt=E(80758);le={enumerable:!0,get:function(){return Pt.traverseAncerstors}},le={enumerable:!0,get:function(){return Pt.taggedConstraint}},le={enumerable:!0,get:function(){return Pt.namedConstraint}},le={enumerable:!0,get:function(){return Pt.typeConstraint}};var xt=E(55800);le={enumerable:!0,get:function(){return xt.getServiceIdentifierAsString}};var yr=E(70600);le={enumerable:!0,get:function(){return yr.multiBindToService}}},95228:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Context=void 0;var le=E(37791),C=function(){function p(A){this.id=le.id(),this.container=A}return p.prototype.addPlan=function(A){this.plan=A},p.prototype.setCurrentRequest=function(A){this.currentRequest=A},p}();U.Context=C},47738:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Metadata=void 0;var le=E(6867),C=function(){function p(A,Q){this.key=A,this.value=Q}return p.prototype.toString=function(){return this.key===le.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();U.Metadata=C},51377:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.MetadataReader=void 0;var le=E(6867),C=function(){function p(){}return p.prototype.getConstructorMetadata=function(A){var Q=Reflect.getMetadata(le.PARAM_TYPES,A),Y=Reflect.getMetadata(le.TAGGED,A);return{compilerGeneratedMetadata:Q,userGeneratedMetadata:Y||{}}},p.prototype.getPropertiesMetadata=function(A){var Q=Reflect.getMetadata(le.TAGGED_PROP,A)||[];return Q},p}();U.MetadataReader=C},55314:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Plan=void 0;var E=function(){function le(C,p){this.parentContext=C,this.rootRequest=p}return le}();U.Plan=E},86311:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.getBindingDictionary=U.createMockRequest=U.plan=void 0;var le=E(23184),C=E(16674),p=E(28421),A=E(6867),Q=E(85265),Y=E(55800),W=E(95228),L=E(47738),N=E(55314),Be=E(6e3),Ye=E(6748),Je=E(18924);function et(ee){return ee._bindingDictionary}U.getBindingDictionary=et;function Yt(ee,vr,Ct,Ke,Rt,Xe){var Ut=ee?A.MULTI_INJECT_TAG:A.INJECT_TAG,_r=new L.Metadata(Ut,Ct),or=new Je.Target(vr,Ke,Ct,_r);if(Rt!==void 0){var zr=new L.Metadata(Rt,Xe);or.metadata.push(zr)}return or}function Gt(ee,vr,Ct,Ke,Rt){var Xe=Pt(Ct.container,Rt.serviceIdentifier),Ut=[];return Xe.length===le.BindingCount.NoBindingsAvailable&&Ct.container.options.autoBindInjectable&&typeof Rt.serviceIdentifier=="function"&&ee.getConstructorMetadata(Rt.serviceIdentifier).compilerGeneratedMetadata&&(Ct.container.bind(Rt.serviceIdentifier).toSelf(),Xe=Pt(Ct.container,Rt.serviceIdentifier)),vr?Ut=Xe:Ut=Xe.filter(function(_r){var or=new Ye.Request(_r.serviceIdentifier,Ct,Ke,_r,Rt);return _r.constraint(or)}),tr(Rt.serviceIdentifier,Ut,Rt,Ct.container),Ut}function tr(ee,vr,Ct,Ke){switch(vr.length){case le.BindingCount.NoBindingsAvailable:if(Ct.isOptional())return vr;var Rt=Y.getServiceIdentifierAsString(ee),Xe=C.NOT_REGISTERED;throw Xe+=Y.listMetadataForTarget(Rt,Ct),Xe+=Y.listRegisteredBindingsForServiceIdentifier(Ke,Rt,Pt),new Error(Xe);case le.BindingCount.OnlyOneBindingAvailable:if(!Ct.isArray())return vr;case le.BindingCount.MultipleBindingsAvailable:default:if(Ct.isArray())return vr;var Rt=Y.getServiceIdentifierAsString(ee),Xe=C.AMBIGUOUS_MATCH+" "+Rt;throw Xe+=Y.listRegisteredBindingsForServiceIdentifier(Ke,Rt,Pt),new Error(Xe)}}function zt(ee,vr,Ct,Ke,Rt,Xe){var Ut,_r;if(Rt===null){Ut=Gt(ee,vr,Ke,null,Xe),_r=new Ye.Request(Ct,Ke,null,Ut,Xe);var or=new N.Plan(Ke,_r);Ke.addPlan(or)}else Ut=Gt(ee,vr,Ke,Rt,Xe),_r=Rt.addChildRequest(Xe.serviceIdentifier,Ut,Xe);Ut.forEach(function(zr){var he=null;if(Xe.isArray())he=_r.addChildRequest(zr.serviceIdentifier,zr,Xe);else{if(zr.cache)return;he=_r}if(zr.type===p.BindingTypeEnum.Instance&&zr.implementationType!==null){var Re=Be.getDependencies(ee,zr.implementationType);if(!Ke.container.options.skipBaseClassChecks){var ye=Be.getBaseClassDependencyCount(ee,zr.implementationType);if(Re.length<ye){var _t=C.ARGUMENTS_LENGTH_MISMATCH(Be.getFunctionName(zr.implementationType));throw new Error(_t)}}Re.forEach(function(ft){zt(ee,!1,ft.serviceIdentifier,Ke,he,ft)})}})}function Pt(ee,vr){var Ct=[],Ke=et(ee);return Ke.hasKey(vr)?Ct=Ke.get(vr):ee.parent!==null&&(Ct=Pt(ee.parent,vr)),Ct}function xt(ee,vr,Ct,Ke,Rt,Xe,Ut,_r){_r===void 0&&(_r=!1);var or=new W.Context(vr),zr=Yt(Ct,Ke,Rt,"",Xe,Ut);try{return zt(ee,_r,Rt,or,null,zr),or}catch(he){throw Q.isStackOverflowExeption(he)&&or.plan&&Y.circularDependencyToException(or.plan.rootRequest),he}}U.plan=xt;function yr(ee,vr,Ct,Ke){var Rt=new Je.Target(p.TargetTypeEnum.Variable,"",vr,new L.Metadata(Ct,Ke)),Xe=new W.Context(ee),Ut=new Ye.Request(vr,Xe,null,[],Rt);return Ut}U.createMockRequest=yr},88460:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.QueryableString=void 0;var E=function(){function le(C){this.str=C}return le.prototype.startsWith=function(C){return this.str.indexOf(C)===0},le.prototype.endsWith=function(C){var p="",A=C.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},A)},le.prototype.contains=function(C){return this.str.indexOf(C)!==-1},le.prototype.equals=function(C){return this.str===C},le.prototype.value=function(){return this.str},le}();U.QueryableString=E},6e3:function(Or,U,E){"use strict";var le=this&&this.__spreadArray||function(Gt,tr){for(var zt=0,Pt=tr.length,xt=Gt.length;zt<Pt;zt++,xt++)Gt[xt]=tr[zt];return Gt};Object.defineProperty(U,"__esModule",{value:!0}),U.getFunctionName=U.getBaseClassDependencyCount=U.getDependencies=void 0;var C=E(5744),p=E(16674),A=E(28421),Q=E(6867),Y=E(55800);Object.defineProperty(U,"getFunctionName",{enumerable:!0,get:function(){return Y.getFunctionName}});var W=E(18924);function L(Gt,tr){var zt=Y.getFunctionName(tr),Pt=N(Gt,zt,tr,!1);return Pt}U.getDependencies=L;function N(Gt,tr,zt,Pt){var xt=Gt.getConstructorMetadata(zt),yr=xt.compilerGeneratedMetadata;if(yr===void 0){var ee=p.MISSING_INJECTABLE_ANNOTATION+" "+tr+".";throw new Error(ee)}var vr=xt.userGeneratedMetadata,Ct=Object.keys(vr),Ke=zt.length===0&&Ct.length>0,Rt=Ct.length>zt.length,Xe=Ke||Rt?Ct.length:zt.length,Ut=Ye(Pt,tr,yr,vr,Xe),_r=Je(Gt,zt),or=le(le([],Ut),_r);return or}function Be(Gt,tr,zt,Pt,xt){var yr=xt[Gt.toString()]||[],ee=Yt(yr),vr=ee.unmanaged!==!0,Ct=Pt[Gt],Ke=ee.inject||ee.multiInject;if(Ct=Ke||Ct,Ct instanceof C.LazyServiceIdentifer&&(Ct=Ct.unwrap()),vr){var Rt=Ct===Object,Xe=Ct===Function,Ut=Ct===void 0,_r=Rt||Xe||Ut;if(!tr&&_r){var or=p.MISSING_INJECT_ANNOTATION+" argument "+Gt+" in class "+zt+".";throw new Error(or)}var zr=new W.Target(A.TargetTypeEnum.ConstructorArgument,ee.targetName,Ct);return zr.metadata=yr,zr}return null}function Ye(Gt,tr,zt,Pt,xt){for(var yr=[],ee=0;ee<xt;ee++){var vr=ee,Ct=Be(vr,Gt,tr,zt,Pt);Ct!==null&&yr.push(Ct)}return yr}function Je(Gt,tr){for(var zt=Gt.getPropertiesMetadata(tr),Pt=[],xt=Object.keys(zt),yr=0,ee=xt;yr<ee.length;yr++){var vr=ee[yr],Ct=zt[vr],Ke=Yt(zt[vr]),Rt=Ke.targetName||vr,Xe=Ke.inject||Ke.multiInject,Ut=new W.Target(A.TargetTypeEnum.ClassProperty,Rt,Xe);Ut.metadata=Ct,Pt.push(Ut)}var _r=Object.getPrototypeOf(tr.prototype).constructor;if(_r!==Object){var or=Je(Gt,_r);Pt=le(le([],Pt),or)}return Pt}function et(Gt,tr){var zt=Object.getPrototypeOf(tr.prototype).constructor;if(zt!==Object){var Pt=Y.getFunctionName(zt),xt=N(Gt,Pt,zt,!0),yr=xt.map(function(Ct){return Ct.metadata.filter(function(Ke){return Ke.key===Q.UNMANAGED_TAG})}),ee=[].concat.apply([],yr).length,vr=xt.length-ee;return vr>0?vr:et(Gt,zt)}else return 0}U.getBaseClassDependencyCount=et;function Yt(Gt){var tr={};return Gt.forEach(function(zt){tr[zt.key.toString()]=zt.value}),{inject:tr[Q.INJECT_TAG],multiInject:tr[Q.MULTI_INJECT_TAG],targetName:tr[Q.NAME_TAG],unmanaged:tr[Q.UNMANAGED_TAG]}}},6748:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Request=void 0;var le=E(37791),C=function(){function p(A,Q,Y,W,L){this.id=le.id(),this.serviceIdentifier=A,this.parentContext=Q,this.parentRequest=Y,this.target=L,this.childRequests=[],this.bindings=Array.isArray(W)?W:[W],this.requestScope=Y===null?new Map:null}return p.prototype.addChildRequest=function(A,Q,Y){var W=new p(A,this.parentContext,this,Q,Y);return this.childRequests.push(W),W},p}();U.Request=C},18924:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Target=void 0;var le=E(6867),C=E(37791),p=E(47738),A=E(88460),Q=function(){function Y(W,L,N,Be){this.id=C.id(),this.type=W,this.serviceIdentifier=N,this.name=new A.QueryableString(L||""),this.metadata=new Array;var Ye=null;typeof Be=="string"?Ye=new p.Metadata(le.NAMED_TAG,Be):Be instanceof p.Metadata&&(Ye=Be),Ye!==null&&this.metadata.push(Ye)}return Y.prototype.hasTag=function(W){for(var L=0,N=this.metadata;L<N.length;L++){var Be=N[L];if(Be.key===W)return!0}return!1},Y.prototype.isArray=function(){return this.hasTag(le.MULTI_INJECT_TAG)},Y.prototype.matchesArray=function(W){return this.matchesTag(le.MULTI_INJECT_TAG)(W)},Y.prototype.isNamed=function(){return this.hasTag(le.NAMED_TAG)},Y.prototype.isTagged=function(){return this.metadata.some(function(W){return le.NON_CUSTOM_TAG_KEYS.every(function(L){return W.key!==L})})},Y.prototype.isOptional=function(){return this.matchesTag(le.OPTIONAL_TAG)(!0)},Y.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(W){return W.key===le.NAMED_TAG})[0]:null},Y.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(W){return le.NON_CUSTOM_TAG_KEYS.every(function(L){return W.key!==L})}):null},Y.prototype.matchesNamedTag=function(W){return this.matchesTag(le.NAMED_TAG)(W)},Y.prototype.matchesTag=function(W){var L=this;return function(N){for(var Be=0,Ye=L.metadata;Be<Ye.length;Be++){var Je=Ye[Be];if(Je.key===W&&Je.value===N)return!0}return!1}},Y}();U.Target=Q},52279:function(Or,U,E){"use strict";var le=this&&this.__spreadArray||function(N,Be){for(var Ye=0,Je=Be.length,et=N.length;Ye<Je;Ye++,et++)N[et]=Be[Ye];return N};Object.defineProperty(U,"__esModule",{value:!0}),U.resolveInstance=void 0;var C=E(16674),p=E(28421),A=E(6867);function Q(N,Be,Ye){var Je=Be.filter(function(Yt){return Yt.target!==null&&Yt.target.type===p.TargetTypeEnum.ClassProperty}),et=Je.map(Ye);return Je.forEach(function(Yt,Gt){var tr="";tr=Yt.target.name.value();var zt=et[Gt];N[tr]=zt}),N}function Y(N,Be){return new(N.bind.apply(N,le([void 0],Be)))}function W(N,Be){if(Reflect.hasMetadata(A.POST_CONSTRUCT,N)){var Ye=Reflect.getMetadata(A.POST_CONSTRUCT,N);try{Be[Ye.value]()}catch(Je){throw new Error(C.POST_CONSTRUCT_ERROR(N.name,Je.message))}}}function L(N,Be,Ye){var Je=null;if(Be.length>0){var et=Be.filter(function(Gt){return Gt.target!==null&&Gt.target.type===p.TargetTypeEnum.ConstructorArgument}),Yt=et.map(Ye);Je=Y(N,Yt),Je=Q(Je,Be,Ye)}else Je=new N;return W(N,Je),Je}U.resolveInstance=L},31927:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.resolve=void 0;var le=E(16674),C=E(28421),p=E(85265),A=E(55800),Q=E(52279),Y=function(N,Be,Ye){try{return Ye()}catch(Je){throw p.isStackOverflowExeption(Je)?new Error(le.CIRCULAR_DEPENDENCY_IN_FACTORY(N,Be.toString())):Je}},W=function(N){return function(Be){Be.parentContext.setCurrentRequest(Be);var Ye=Be.bindings,Je=Be.childRequests,et=Be.target&&Be.target.isArray(),Yt=!Be.parentRequest||!Be.parentRequest.target||!Be.target||!Be.parentRequest.target.matchesArray(Be.target.serviceIdentifier);if(et&&Yt)return Je.map(function(yr){var ee=W(N);return ee(yr)});var Gt=null;if(Be.target.isOptional()&&Ye.length===0)return;var tr=Ye[0],zt=tr.scope===C.BindingScopeEnum.Singleton,Pt=tr.scope===C.BindingScopeEnum.Request;if(zt&&tr.activated)return tr.cache;if(Pt&&N!==null&&N.has(tr.id))return N.get(tr.id);if(tr.type===C.BindingTypeEnum.ConstantValue)Gt=tr.cache,tr.activated=!0;else if(tr.type===C.BindingTypeEnum.Function)Gt=tr.cache,tr.activated=!0;else if(tr.type===C.BindingTypeEnum.Constructor)Gt=tr.implementationType;else if(tr.type===C.BindingTypeEnum.DynamicValue&&tr.dynamicValue!==null)Gt=Y("toDynamicValue",tr.serviceIdentifier,function(){return tr.dynamicValue(Be.parentContext)});else if(tr.type===C.BindingTypeEnum.Factory&&tr.factory!==null)Gt=Y("toFactory",tr.serviceIdentifier,function(){return tr.factory(Be.parentContext)});else if(tr.type===C.BindingTypeEnum.Provider&&tr.provider!==null)Gt=Y("toProvider",tr.serviceIdentifier,function(){return tr.provider(Be.parentContext)});else if(tr.type===C.BindingTypeEnum.Instance&&tr.implementationType!==null)Gt=Q.resolveInstance(tr.implementationType,Je,W(N));else{var xt=A.getServiceIdentifierAsString(Be.serviceIdentifier);throw new Error(le.INVALID_BINDING_TYPE+" "+xt)}return typeof tr.onActivation=="function"&&(Gt=tr.onActivation(Be.parentContext,Gt)),zt&&(tr.cache=Gt,tr.activated=!0),Pt&&N!==null&&!N.has(tr.id)&&N.set(tr.id,Gt),Gt}};function L(N){var Be=W(N.plan.rootRequest.requestScope);return Be(N.plan.rootRequest)}U.resolve=L},83366:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingInSyntax=void 0;var le=E(28421),C=E(71325),p=function(){function A(Q){this._binding=Q}return A.prototype.inRequestScope=function(){return this._binding.scope=le.BindingScopeEnum.Request,new C.BindingWhenOnSyntax(this._binding)},A.prototype.inSingletonScope=function(){return this._binding.scope=le.BindingScopeEnum.Singleton,new C.BindingWhenOnSyntax(this._binding)},A.prototype.inTransientScope=function(){return this._binding.scope=le.BindingScopeEnum.Transient,new C.BindingWhenOnSyntax(this._binding)},A}();U.BindingInSyntax=p},74889:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingInWhenOnSyntax=void 0;var le=E(83366),C=E(51811),p=E(98370),A=function(){function Q(Y){this._binding=Y,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new C.BindingOnSyntax(this._binding),this._bindingInSyntax=new le.BindingInSyntax(Y)}return Q.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Q.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Q.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Q.prototype.when=function(Y){return this._bindingWhenSyntax.when(Y)},Q.prototype.whenTargetNamed=function(Y){return this._bindingWhenSyntax.whenTargetNamed(Y)},Q.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Q.prototype.whenTargetTagged=function(Y,W){return this._bindingWhenSyntax.whenTargetTagged(Y,W)},Q.prototype.whenInjectedInto=function(Y){return this._bindingWhenSyntax.whenInjectedInto(Y)},Q.prototype.whenParentNamed=function(Y){return this._bindingWhenSyntax.whenParentNamed(Y)},Q.prototype.whenParentTagged=function(Y,W){return this._bindingWhenSyntax.whenParentTagged(Y,W)},Q.prototype.whenAnyAncestorIs=function(Y){return this._bindingWhenSyntax.whenAnyAncestorIs(Y)},Q.prototype.whenNoAncestorIs=function(Y){return this._bindingWhenSyntax.whenNoAncestorIs(Y)},Q.prototype.whenAnyAncestorNamed=function(Y){return this._bindingWhenSyntax.whenAnyAncestorNamed(Y)},Q.prototype.whenAnyAncestorTagged=function(Y,W){return this._bindingWhenSyntax.whenAnyAncestorTagged(Y,W)},Q.prototype.whenNoAncestorNamed=function(Y){return this._bindingWhenSyntax.whenNoAncestorNamed(Y)},Q.prototype.whenNoAncestorTagged=function(Y,W){return this._bindingWhenSyntax.whenNoAncestorTagged(Y,W)},Q.prototype.whenAnyAncestorMatches=function(Y){return this._bindingWhenSyntax.whenAnyAncestorMatches(Y)},Q.prototype.whenNoAncestorMatches=function(Y){return this._bindingWhenSyntax.whenNoAncestorMatches(Y)},Q.prototype.onActivation=function(Y){return this._bindingOnSyntax.onActivation(Y)},Q}();U.BindingInWhenOnSyntax=A},51811:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingOnSyntax=void 0;var le=E(98370),C=function(){function p(A){this._binding=A}return p.prototype.onActivation=function(A){return this._binding.onActivation=A,new le.BindingWhenSyntax(this._binding)},p}();U.BindingOnSyntax=C},15451:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingToSyntax=void 0;var le=E(16674),C=E(28421),p=E(74889),A=E(71325),Q=function(){function Y(W){this._binding=W}return Y.prototype.to=function(W){return this._binding.type=C.BindingTypeEnum.Instance,this._binding.implementationType=W,new p.BindingInWhenOnSyntax(this._binding)},Y.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+le.INVALID_TO_SELF_VALUE);var W=this._binding.serviceIdentifier;return this.to(W)},Y.prototype.toConstantValue=function(W){return this._binding.type=C.BindingTypeEnum.ConstantValue,this._binding.cache=W,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=C.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},Y.prototype.toDynamicValue=function(W){return this._binding.type=C.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=W,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},Y.prototype.toConstructor=function(W){return this._binding.type=C.BindingTypeEnum.Constructor,this._binding.implementationType=W,this._binding.scope=C.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},Y.prototype.toFactory=function(W){return this._binding.type=C.BindingTypeEnum.Factory,this._binding.factory=W,this._binding.scope=C.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},Y.prototype.toFunction=function(W){if(typeof W!="function")throw new Error(le.INVALID_FUNCTION_BINDING);var L=this.toConstantValue(W);return this._binding.type=C.BindingTypeEnum.Function,this._binding.scope=C.BindingScopeEnum.Singleton,L},Y.prototype.toAutoFactory=function(W){return this._binding.type=C.BindingTypeEnum.Factory,this._binding.factory=function(L){var N=function(){return L.container.get(W)};return N},this._binding.scope=C.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},Y.prototype.toProvider=function(W){return this._binding.type=C.BindingTypeEnum.Provider,this._binding.provider=W,this._binding.scope=C.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},Y.prototype.toService=function(W){this.toDynamicValue(function(L){return L.container.get(W)})},Y}();U.BindingToSyntax=Q},71325:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingWhenOnSyntax=void 0;var le=E(51811),C=E(98370),p=function(){function A(Q){this._binding=Q,this._bindingWhenSyntax=new C.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new le.BindingOnSyntax(this._binding)}return A.prototype.when=function(Q){return this._bindingWhenSyntax.when(Q)},A.prototype.whenTargetNamed=function(Q){return this._bindingWhenSyntax.whenTargetNamed(Q)},A.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},A.prototype.whenTargetTagged=function(Q,Y){return this._bindingWhenSyntax.whenTargetTagged(Q,Y)},A.prototype.whenInjectedInto=function(Q){return this._bindingWhenSyntax.whenInjectedInto(Q)},A.prototype.whenParentNamed=function(Q){return this._bindingWhenSyntax.whenParentNamed(Q)},A.prototype.whenParentTagged=function(Q,Y){return this._bindingWhenSyntax.whenParentTagged(Q,Y)},A.prototype.whenAnyAncestorIs=function(Q){return this._bindingWhenSyntax.whenAnyAncestorIs(Q)},A.prototype.whenNoAncestorIs=function(Q){return this._bindingWhenSyntax.whenNoAncestorIs(Q)},A.prototype.whenAnyAncestorNamed=function(Q){return this._bindingWhenSyntax.whenAnyAncestorNamed(Q)},A.prototype.whenAnyAncestorTagged=function(Q,Y){return this._bindingWhenSyntax.whenAnyAncestorTagged(Q,Y)},A.prototype.whenNoAncestorNamed=function(Q){return this._bindingWhenSyntax.whenNoAncestorNamed(Q)},A.prototype.whenNoAncestorTagged=function(Q,Y){return this._bindingWhenSyntax.whenNoAncestorTagged(Q,Y)},A.prototype.whenAnyAncestorMatches=function(Q){return this._bindingWhenSyntax.whenAnyAncestorMatches(Q)},A.prototype.whenNoAncestorMatches=function(Q){return this._bindingWhenSyntax.whenNoAncestorMatches(Q)},A.prototype.onActivation=function(Q){return this._bindingOnSyntax.onActivation(Q)},A}();U.BindingWhenOnSyntax=p},98370:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingWhenSyntax=void 0;var le=E(51811),C=E(80758),p=function(){function A(Q){this._binding=Q}return A.prototype.when=function(Q){return this._binding.constraint=Q,new le.BindingOnSyntax(this._binding)},A.prototype.whenTargetNamed=function(Q){return this._binding.constraint=C.namedConstraint(Q),new le.BindingOnSyntax(this._binding)},A.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Q){var Y=Q.target!==null&&!Q.target.isNamed()&&!Q.target.isTagged();return Y},new le.BindingOnSyntax(this._binding)},A.prototype.whenTargetTagged=function(Q,Y){return this._binding.constraint=C.taggedConstraint(Q)(Y),new le.BindingOnSyntax(this._binding)},A.prototype.whenInjectedInto=function(Q){return this._binding.constraint=function(Y){return C.typeConstraint(Q)(Y.parentRequest)},new le.BindingOnSyntax(this._binding)},A.prototype.whenParentNamed=function(Q){return this._binding.constraint=function(Y){return C.namedConstraint(Q)(Y.parentRequest)},new le.BindingOnSyntax(this._binding)},A.prototype.whenParentTagged=function(Q,Y){return this._binding.constraint=function(W){return C.taggedConstraint(Q)(Y)(W.parentRequest)},new le.BindingOnSyntax(this._binding)},A.prototype.whenAnyAncestorIs=function(Q){return this._binding.constraint=function(Y){return C.traverseAncerstors(Y,C.typeConstraint(Q))},new le.BindingOnSyntax(this._binding)},A.prototype.whenNoAncestorIs=function(Q){return this._binding.constraint=function(Y){return!C.traverseAncerstors(Y,C.typeConstraint(Q))},new le.BindingOnSyntax(this._binding)},A.prototype.whenAnyAncestorNamed=function(Q){return this._binding.constraint=function(Y){return C.traverseAncerstors(Y,C.namedConstraint(Q))},new le.BindingOnSyntax(this._binding)},A.prototype.whenNoAncestorNamed=function(Q){return this._binding.constraint=function(Y){return!C.traverseAncerstors(Y,C.namedConstraint(Q))},new le.BindingOnSyntax(this._binding)},A.prototype.whenAnyAncestorTagged=function(Q,Y){return this._binding.constraint=function(W){return C.traverseAncerstors(W,C.taggedConstraint(Q)(Y))},new le.BindingOnSyntax(this._binding)},A.prototype.whenNoAncestorTagged=function(Q,Y){return this._binding.constraint=function(W){return!C.traverseAncerstors(W,C.taggedConstraint(Q)(Y))},new le.BindingOnSyntax(this._binding)},A.prototype.whenAnyAncestorMatches=function(Q){return this._binding.constraint=function(Y){return C.traverseAncerstors(Y,Q)},new le.BindingOnSyntax(this._binding)},A.prototype.whenNoAncestorMatches=function(Q){return this._binding.constraint=function(Y){return!C.traverseAncerstors(Y,Q)},new le.BindingOnSyntax(this._binding)},A}();U.BindingWhenSyntax=p},80758:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.typeConstraint=U.namedConstraint=U.taggedConstraint=U.traverseAncerstors=void 0;var le=E(6867),C=E(47738),p=function(W,L){var N=W.parentRequest;return N!==null?L(N)?!0:p(N,L):!1};U.traverseAncerstors=p;var A=function(W){return function(L){var N=function(Be){return Be!==null&&Be.target!==null&&Be.target.matchesTag(W)(L)};return N.metaData=new C.Metadata(W,L),N}};U.taggedConstraint=A;var Q=A(le.NAMED_TAG);U.namedConstraint=Q;var Y=function(W){return function(L){var N=null;if(L!==null)if(N=L.bindings[0],typeof W=="string"){var Be=N.serviceIdentifier;return Be===W}else{var Ye=L.bindings[0].implementationType;return W===Ye}return!1}};U.typeConstraint=Y},70600:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.multiBindToService=void 0;var E=function(le){return function(C){return function(){for(var p=[],A=0;A<arguments.length;A++)p[A]=arguments[A];return p.forEach(function(Q){return le.bind(Q).toService(C)})}}};U.multiBindToService=E},85265:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.isStackOverflowExeption=void 0;var le=E(16674);function C(p){return p instanceof RangeError||p.message===le.STACK_OVERFLOW}U.isStackOverflowExeption=C},37791:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.id=void 0;var E=0;function le(){return E++}U.id=le},55800:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.circularDependencyToException=U.listMetadataForTarget=U.listRegisteredBindingsForServiceIdentifier=U.getServiceIdentifierAsString=U.getFunctionName=void 0;var le=E(16674);function C(N){if(typeof N=="function"){var Be=N;return Be.name}else{if(typeof N=="symbol")return N.toString();var Be=N;return Be}}U.getServiceIdentifierAsString=C;function p(N,Be,Ye){var Je="",et=Ye(N,Be);return et.length!==0&&(Je=`
Registered bindings:`,et.forEach(function(Yt){var Gt="Object";Yt.implementationType!==null&&(Gt=L(Yt.implementationType)),Je=Je+`
 `+Gt,Yt.constraint.metaData&&(Je=Je+" - "+Yt.constraint.metaData)})),Je}U.listRegisteredBindingsForServiceIdentifier=p;function A(N,Be){return N.parentRequest===null?!1:N.parentRequest.serviceIdentifier===Be?!0:A(N.parentRequest,Be)}function Q(N){function Be(Je,et){et===void 0&&(et=[]);var Yt=C(Je.serviceIdentifier);return et.push(Yt),Je.parentRequest!==null?Be(Je.parentRequest,et):et}var Ye=Be(N);return Ye.reverse().join(" --> ")}function Y(N){N.childRequests.forEach(function(Be){if(A(Be,Be.serviceIdentifier)){var Ye=Q(Be);throw new Error(le.CIRCULAR_DEPENDENCY+" "+Ye)}else Y(Be)})}U.circularDependencyToException=Y;function W(N,Be){if(Be.isTagged()||Be.isNamed()){var Ye="",Je=Be.getNamedTag(),et=Be.getCustomTags();return Je!==null&&(Ye+=Je.toString()+`
`),et!==null&&et.forEach(function(Yt){Ye+=Yt.toString()+`
`})," "+N+`
 `+N+" - "+Ye}else return" "+N}U.listMetadataForTarget=W;function L(N){if(N.name)return N.name;var Be=N.toString(),Ye=Be.match(/^function\s*([^\s(]+)/);return Ye?Ye[1]:"Anonymous function: "+Be}U.getFunctionName=L},18857:function(Or,U,E){"use strict";E.r(U),E.d(U,{Function:function(){return Ba},Interpreter:function(){return Po},default:function(){return ju},evaluate:function(){return yu},vm:function(){return le}});var le={};E.r(le),E.d(le,{Script:function(){return tl},compileFunction:function(){return bl},createContext:function(){return mu},runInContext:function(){return Zu},runInNewContext:function(){return Vl}});var C={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},p="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",A={5:p,"5module":p+" export import",6:p+" const class extends export import super"},Q=/^in(stanceof)?$/,Y="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",W="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",L=new RegExp("["+Y+"]"),N=new RegExp("["+Y+W+"]");Y=W=null;var Be=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ye=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Je(m,S){for(var j=65536,O=0;O<S.length;O+=2){if(j+=S[O],j>m)return!1;if(j+=S[O+1],j>=m)return!0}}function et(m,S){return m<65?m===36:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&L.test(String.fromCharCode(m)):S===!1?!1:Je(m,Be)}function Yt(m,S){return m<48?m===36:m<58?!0:m<65?!1:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&N.test(String.fromCharCode(m)):S===!1?!1:Je(m,Be)||Je(m,Ye)}var Gt=function(S,j){j===void 0&&(j={}),this.label=S,this.keyword=j.keyword,this.beforeExpr=!!j.beforeExpr,this.startsExpr=!!j.startsExpr,this.isLoop=!!j.isLoop,this.isAssign=!!j.isAssign,this.prefix=!!j.prefix,this.postfix=!!j.postfix,this.binop=j.binop||null,this.updateContext=null};function tr(m,S){return new Gt(m,{beforeExpr:!0,binop:S})}var zt={beforeExpr:!0},Pt={startsExpr:!0},xt={};function yr(m,S){return S===void 0&&(S={}),S.keyword=m,xt[m]=new Gt(m,S)}var ee={num:new Gt("num",Pt),regexp:new Gt("regexp",Pt),string:new Gt("string",Pt),name:new Gt("name",Pt),eof:new Gt("eof"),bracketL:new Gt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Gt("]"),braceL:new Gt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Gt("}"),parenL:new Gt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Gt(")"),comma:new Gt(",",zt),semi:new Gt(";",zt),colon:new Gt(":",zt),dot:new Gt("."),question:new Gt("?",zt),questionDot:new Gt("?."),arrow:new Gt("=>",zt),template:new Gt("template"),invalidTemplate:new Gt("invalidTemplate"),ellipsis:new Gt("...",zt),backQuote:new Gt("`",Pt),dollarBraceL:new Gt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Gt("=",{beforeExpr:!0,isAssign:!0}),assign:new Gt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Gt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Gt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:tr("||",1),logicalAND:tr("&&",2),bitwiseOR:tr("|",3),bitwiseXOR:tr("^",4),bitwiseAND:tr("&",5),equality:tr("==/!=/===/!==",6),relational:tr("</>/<=/>=",7),bitShift:tr("<</>>/>>>",8),plusMin:new Gt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:tr("%",10),star:tr("*",10),slash:tr("/",10),starstar:new Gt("**",{beforeExpr:!0}),coalesce:tr("??",1),_break:yr("break"),_case:yr("case",zt),_catch:yr("catch"),_continue:yr("continue"),_debugger:yr("debugger"),_default:yr("default",zt),_do:yr("do",{isLoop:!0,beforeExpr:!0}),_else:yr("else",zt),_finally:yr("finally"),_for:yr("for",{isLoop:!0}),_function:yr("function",Pt),_if:yr("if"),_return:yr("return",zt),_switch:yr("switch"),_throw:yr("throw",zt),_try:yr("try"),_var:yr("var"),_const:yr("const"),_while:yr("while",{isLoop:!0}),_with:yr("with"),_new:yr("new",{beforeExpr:!0,startsExpr:!0}),_this:yr("this",Pt),_super:yr("super",Pt),_class:yr("class",Pt),_extends:yr("extends",zt),_export:yr("export"),_import:yr("import",Pt),_null:yr("null",Pt),_true:yr("true",Pt),_false:yr("false",Pt),_in:yr("in",{beforeExpr:!0,binop:7}),_instanceof:yr("instanceof",{beforeExpr:!0,binop:7}),_typeof:yr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:yr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:yr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},vr=/\r\n?|\n|\u2028|\u2029/,Ct=new RegExp(vr.source,"g");function Ke(m,S){return m===10||m===13||!S&&(m===8232||m===8233)}var Rt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Xe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Ut=Object.prototype,_r=Ut.hasOwnProperty,or=Ut.toString;function zr(m,S){return _r.call(m,S)}var he=Array.isArray||function(m){return or.call(m)==="[object Array]"};function Re(m){return new RegExp("^(?:"+m.replace(/ /g,"|")+")$")}var ye=function(S,j){this.line=S,this.column=j};ye.prototype.offset=function(S){return new ye(this.line,this.column+S)};var _t=function(S,j,O){this.start=j,this.end=O,S.sourceFile!==null&&(this.source=S.sourceFile)};function ft(m,S){for(var j=1,O=0;;){Ct.lastIndex=O;var ue=Ct.exec(m);if(ue&&ue.index<S)++j,O=ue.index+ue[0].length;else return new ye(j,S-O)}}var Nt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ft(m){var S={};for(var j in Nt)S[j]=m&&zr(m,j)?m[j]:Nt[j];if(S.ecmaVersion>=2015&&(S.ecmaVersion-=2009),S.allowReserved==null&&(S.allowReserved=S.ecmaVersion<5),he(S.onToken)){var O=S.onToken;S.onToken=function(ue){return O.push(ue)}}return he(S.onComment)&&(S.onComment=kr(S,S.onComment)),S}function kr(m,S){return function(j,O,ue,Ie,st,Lt){var It={type:j?"Block":"Line",value:O,start:ue,end:Ie};m.locations&&(It.loc=new _t(this,st,Lt)),m.ranges&&(It.range=[ue,Ie]),S.push(It)}}var cn=1,yn=2,Vi=cn|yn,ir=4,de=8,Te=16,Ue=32,Le=64,kt=128;function er(m,S){return yn|(m?ir:0)|(S?de:0)}var w=0,Z=1,Ee=2,je=3,Qe=4,yt=5,St=function(S,j,O){this.options=S=Ft(S),this.sourceFile=S.sourceFile,this.keywords=Re(A[S.ecmaVersion>=6?6:S.sourceType==="module"?"5module":5]);var ue="";if(S.allowReserved!==!0){for(var Ie=S.ecmaVersion;!(ue=C[Ie]);Ie--);S.sourceType==="module"&&(ue+=" await")}this.reservedWords=Re(ue);var st=(ue?ue+" ":"")+C.strict;this.reservedWordsStrict=Re(st),this.reservedWordsStrictBind=Re(st+" "+C.strictBind),this.input=String(j),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(vr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=ee.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=S.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&S.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(cn),this.regexpState=null},jt={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};St.prototype.parse=function(){var S=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(S)},jt.inFunction.get=function(){return(this.currentVarScope().flags&yn)>0},jt.inGenerator.get=function(){return(this.currentVarScope().flags&de)>0},jt.inAsync.get=function(){return(this.currentVarScope().flags&ir)>0},jt.allowSuper.get=function(){return(this.currentThisScope().flags&Le)>0},jt.allowDirectSuper.get=function(){return(this.currentThisScope().flags&kt)>0},jt.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},St.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&yn)>0},St.extend=function(){for(var S=[],j=arguments.length;j--;)S[j]=arguments[j];for(var O=this,ue=0;ue<S.length;ue++)O=S[ue](O);return O},St.parse=function(S,j){return new this(j,S).parse()},St.parseExpressionAt=function(S,j,O){var ue=new this(O,S,j);return ue.nextToken(),ue.parseExpression()},St.tokenizer=function(S,j){return new this(j,S)},Object.defineProperties(St.prototype,jt);var Et=St.prototype,Qt=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Et.strictDirective=function(m){for(;;){Xe.lastIndex=m,m+=Xe.exec(this.input)[0].length;var S=Qt.exec(this.input.slice(m));if(!S)return!1;if((S[1]||S[2])==="use strict"){Xe.lastIndex=m+S[0].length;var j=Xe.exec(this.input),O=j.index+j[0].length,ue=this.input.charAt(O);return ue===";"||ue==="}"||vr.test(j[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(ue)||ue==="!"&&this.input.charAt(O+1)==="=")}m+=S[0].length,Xe.lastIndex=m,m+=Xe.exec(this.input)[0].length,this.input[m]===";"&&m++}},Et.eat=function(m){return this.type===m?(this.next(),!0):!1},Et.isContextual=function(m){return this.type===ee.name&&this.value===m&&!this.containsEsc},Et.eatContextual=function(m){return this.isContextual(m)?(this.next(),!0):!1},Et.expectContextual=function(m){this.eatContextual(m)||this.unexpected()},Et.canInsertSemicolon=function(){return this.type===ee.eof||this.type===ee.braceR||vr.test(this.input.slice(this.lastTokEnd,this.start))},Et.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Et.semicolon=function(){!this.eat(ee.semi)&&!this.insertSemicolon()&&this.unexpected()},Et.afterTrailingComma=function(m,S){if(this.type===m)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),S||this.next(),!0},Et.expect=function(m){this.eat(m)||this.unexpected()},Et.unexpected=function(m){this.raise(m!=null?m:this.start,"Unexpected token")};function ie(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Et.checkPatternErrors=function(m,S){if(!!m){m.trailingComma>-1&&this.raiseRecoverable(m.trailingComma,"Comma is not permitted after the rest element");var j=S?m.parenthesizedAssign:m.parenthesizedBind;j>-1&&this.raiseRecoverable(j,"Parenthesized pattern")}},Et.checkExpressionErrors=function(m,S){if(!m)return!1;var j=m.shorthandAssign,O=m.doubleProto;if(!S)return j>=0||O>=0;j>=0&&this.raise(j,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Et.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Et.isSimpleAssignTarget=function(m){return m.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(m.expression):m.type==="Identifier"||m.type==="MemberExpression"};var sr=St.prototype;sr.parseTopLevel=function(m){var S={};for(m.body||(m.body=[]);this.type!==ee.eof;){var j=this.parseStatement(null,!0,S);m.body.push(j)}if(this.inModule)for(var O=0,ue=Object.keys(this.undefinedExports);O<ue.length;O+=1){var Ie=ue[O];this.raiseRecoverable(this.undefinedExports[Ie].start,"Export '"+Ie+"' is not defined")}return this.adaptDirectivePrologue(m.body),this.next(),m.sourceType=this.options.sourceType,this.finishNode(m,"Program")};var Br={kind:"loop"},Lr={kind:"switch"};sr.isLet=function(m){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Xe.lastIndex=this.pos;var S=Xe.exec(this.input),j=this.pos+S[0].length,O=this.input.charCodeAt(j);if(O===91)return!0;if(m)return!1;if(O===123)return!0;if(et(O,!0)){for(var ue=j+1;Yt(this.input.charCodeAt(ue),!0);)++ue;var Ie=this.input.slice(j,ue);if(!Q.test(Ie))return!0}return!1},sr.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Xe.lastIndex=this.pos;var m=Xe.exec(this.input),S=this.pos+m[0].length;return!vr.test(this.input.slice(this.pos,S))&&this.input.slice(S,S+8)==="function"&&(S+8===this.input.length||!Yt(this.input.charAt(S+8)))},sr.parseStatement=function(m,S,j){var O=this.type,ue=this.startNode(),Ie;switch(this.isLet(m)&&(O=ee._var,Ie="let"),O){case ee._break:case ee._continue:return this.parseBreakContinueStatement(ue,O.keyword);case ee._debugger:return this.parseDebuggerStatement(ue);case ee._do:return this.parseDoStatement(ue);case ee._for:return this.parseForStatement(ue);case ee._function:return m&&(this.strict||m!=="if"&&m!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(ue,!1,!m);case ee._class:return m&&this.unexpected(),this.parseClass(ue,!0);case ee._if:return this.parseIfStatement(ue);case ee._return:return this.parseReturnStatement(ue);case ee._switch:return this.parseSwitchStatement(ue);case ee._throw:return this.parseThrowStatement(ue);case ee._try:return this.parseTryStatement(ue);case ee._const:case ee._var:return Ie=Ie||this.value,m&&Ie!=="var"&&this.unexpected(),this.parseVarStatement(ue,Ie);case ee._while:return this.parseWhileStatement(ue);case ee._with:return this.parseWithStatement(ue);case ee.braceL:return this.parseBlock(!0,ue);case ee.semi:return this.parseEmptyStatement(ue);case ee._export:case ee._import:if(this.options.ecmaVersion>10&&O===ee._import){Xe.lastIndex=this.pos;var st=Xe.exec(this.input),Lt=this.pos+st[0].length,It=this.input.charCodeAt(Lt);if(It===40||It===46)return this.parseExpressionStatement(ue,this.parseExpression())}return this.options.allowImportExportEverywhere||(S||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===ee._import?this.parseImport(ue):this.parseExport(ue,j);default:if(this.isAsyncFunction())return m&&this.unexpected(),this.next(),this.parseFunctionStatement(ue,!0,!m);var wr=this.value,jr=this.parseExpression();return O===ee.name&&jr.type==="Identifier"&&this.eat(ee.colon)?this.parseLabeledStatement(ue,wr,jr,m):this.parseExpressionStatement(ue,jr)}},sr.parseBreakContinueStatement=function(m,S){var j=S==="break";this.next(),this.eat(ee.semi)||this.insertSemicolon()?m.label=null:this.type!==ee.name?this.unexpected():(m.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var ue=this.labels[O];if((m.label==null||ue.name===m.label.name)&&(ue.kind!=null&&(j||ue.kind==="loop")||m.label&&j))break}return O===this.labels.length&&this.raise(m.start,"Unsyntactic "+S),this.finishNode(m,j?"BreakStatement":"ContinueStatement")},sr.parseDebuggerStatement=function(m){return this.next(),this.semicolon(),this.finishNode(m,"DebuggerStatement")},sr.parseDoStatement=function(m){return this.next(),this.labels.push(Br),m.body=this.parseStatement("do"),this.labels.pop(),this.expect(ee._while),m.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(ee.semi):this.semicolon(),this.finishNode(m,"DoWhileStatement")},sr.parseForStatement=function(m){this.next();var S=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Br),this.enterScope(0),this.expect(ee.parenL),this.type===ee.semi)return S>-1&&this.unexpected(S),this.parseFor(m,null);var j=this.isLet();if(this.type===ee._var||this.type===ee._const||j){var O=this.startNode(),ue=j?"let":this.value;return this.next(),this.parseVar(O,!0,ue),this.finishNode(O,"VariableDeclaration"),(this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===ee._in?S>-1&&this.unexpected(S):m.await=S>-1),this.parseForIn(m,O)):(S>-1&&this.unexpected(S),this.parseFor(m,O))}var Ie=new ie,st=this.parseExpression(!0,Ie);return this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===ee._in?S>-1&&this.unexpected(S):m.await=S>-1),this.toAssignable(st,!1,Ie),this.checkLVal(st),this.parseForIn(m,st)):(this.checkExpressionErrors(Ie,!0),S>-1&&this.unexpected(S),this.parseFor(m,st))},sr.parseFunctionStatement=function(m,S,j){return this.next(),this.parseFunction(m,gt|(j?0:pt),!1,S)},sr.parseIfStatement=function(m){return this.next(),m.test=this.parseParenExpression(),m.consequent=this.parseStatement("if"),m.alternate=this.eat(ee._else)?this.parseStatement("if"):null,this.finishNode(m,"IfStatement")},sr.parseReturnStatement=function(m){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(ee.semi)||this.insertSemicolon()?m.argument=null:(m.argument=this.parseExpression(),this.semicolon()),this.finishNode(m,"ReturnStatement")},sr.parseSwitchStatement=function(m){this.next(),m.discriminant=this.parseParenExpression(),m.cases=[],this.expect(ee.braceL),this.labels.push(Lr),this.enterScope(0);for(var S,j=!1;this.type!==ee.braceR;)if(this.type===ee._case||this.type===ee._default){var O=this.type===ee._case;S&&this.finishNode(S,"SwitchCase"),m.cases.push(S=this.startNode()),S.consequent=[],this.next(),O?S.test=this.parseExpression():(j&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),j=!0,S.test=null),this.expect(ee.colon)}else S||this.unexpected(),S.consequent.push(this.parseStatement(null));return this.exitScope(),S&&this.finishNode(S,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(m,"SwitchStatement")},sr.parseThrowStatement=function(m){return this.next(),vr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),m.argument=this.parseExpression(),this.semicolon(),this.finishNode(m,"ThrowStatement")};var rt=[];sr.parseTryStatement=function(m){if(this.next(),m.block=this.parseBlock(),m.handler=null,this.type===ee._catch){var S=this.startNode();if(this.next(),this.eat(ee.parenL)){S.param=this.parseBindingAtom();var j=S.param.type==="Identifier";this.enterScope(j?Ue:0),this.checkLVal(S.param,j?Qe:Ee),this.expect(ee.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),S.param=null,this.enterScope(0);S.body=this.parseBlock(!1),this.exitScope(),m.handler=this.finishNode(S,"CatchClause")}return m.finalizer=this.eat(ee._finally)?this.parseBlock():null,!m.handler&&!m.finalizer&&this.raise(m.start,"Missing catch or finally clause"),this.finishNode(m,"TryStatement")},sr.parseVarStatement=function(m,S){return this.next(),this.parseVar(m,!1,S),this.semicolon(),this.finishNode(m,"VariableDeclaration")},sr.parseWhileStatement=function(m){return this.next(),m.test=this.parseParenExpression(),this.labels.push(Br),m.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(m,"WhileStatement")},sr.parseWithStatement=function(m){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),m.object=this.parseParenExpression(),m.body=this.parseStatement("with"),this.finishNode(m,"WithStatement")},sr.parseEmptyStatement=function(m){return this.next(),this.finishNode(m,"EmptyStatement")},sr.parseLabeledStatement=function(m,S,j,O){for(var ue=0,Ie=this.labels;ue<Ie.length;ue+=1){var st=Ie[ue];st.name===S&&this.raise(j.start,"Label '"+S+"' is already declared")}for(var Lt=this.type.isLoop?"loop":this.type===ee._switch?"switch":null,It=this.labels.length-1;It>=0;It--){var wr=this.labels[It];if(wr.statementStart===m.start)wr.statementStart=this.start,wr.kind=Lt;else break}return this.labels.push({name:S,kind:Lt,statementStart:this.start}),m.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),m.label=j,this.finishNode(m,"LabeledStatement")},sr.parseExpressionStatement=function(m,S){return m.expression=S,this.semicolon(),this.finishNode(m,"ExpressionStatement")},sr.parseBlock=function(m,S,j){for(m===void 0&&(m=!0),S===void 0&&(S=this.startNode()),S.body=[],this.expect(ee.braceL),m&&this.enterScope(0);this.type!==ee.braceR;){var O=this.parseStatement(null);S.body.push(O)}return j&&(this.strict=!1),this.next(),m&&this.exitScope(),this.finishNode(S,"BlockStatement")},sr.parseFor=function(m,S){return m.init=S,this.expect(ee.semi),m.test=this.type===ee.semi?null:this.parseExpression(),this.expect(ee.semi),m.update=this.type===ee.parenR?null:this.parseExpression(),this.expect(ee.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,"ForStatement")},sr.parseForIn=function(m,S){var j=this.type===ee._in;return this.next(),S.type==="VariableDeclaration"&&S.declarations[0].init!=null&&(!j||this.options.ecmaVersion<8||this.strict||S.kind!=="var"||S.declarations[0].id.type!=="Identifier")?this.raise(S.start,(j?"for-in":"for-of")+" loop variable declaration may not have an initializer"):S.type==="AssignmentPattern"&&this.raise(S.start,"Invalid left-hand side in for-loop"),m.left=S,m.right=j?this.parseExpression():this.parseMaybeAssign(),this.expect(ee.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,j?"ForInStatement":"ForOfStatement")},sr.parseVar=function(m,S,j){for(m.declarations=[],m.kind=j;;){var O=this.startNode();if(this.parseVarId(O,j),this.eat(ee.eq)?O.init=this.parseMaybeAssign(S):j==="const"&&!(this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(S&&(this.type===ee._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,m.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(ee.comma))break}return m},sr.parseVarId=function(m,S){m.id=this.parseBindingAtom(),this.checkLVal(m.id,S==="var"?Z:Ee,!1)};var gt=1,pt=2,dr=4;sr.parseFunction=function(m,S,j,O){this.initFunction(m),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===ee.star&&S&pt&&this.unexpected(),m.generator=this.eat(ee.star)),this.options.ecmaVersion>=8&&(m.async=!!O),S&gt&&(m.id=S&dr&&this.type!==ee.name?null:this.parseIdent(),m.id&&!(S&pt)&&this.checkLVal(m.id,this.strict||m.generator||m.async?this.treatFunctionsAsVar?Z:Ee:je));var ue=this.yieldPos,Ie=this.awaitPos,st=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(er(m.async,m.generator)),S&gt||(m.id=this.type===ee.name?this.parseIdent():null),this.parseFunctionParams(m),this.parseFunctionBody(m,j,!1),this.yieldPos=ue,this.awaitPos=Ie,this.awaitIdentPos=st,this.finishNode(m,S&gt?"FunctionDeclaration":"FunctionExpression")},sr.parseFunctionParams=function(m){this.expect(ee.parenL),m.params=this.parseBindingList(ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},sr.parseClass=function(m,S){this.next();var j=this.strict;this.strict=!0,this.parseClassId(m,S),this.parseClassSuper(m);var O=this.startNode(),ue=!1;for(O.body=[],this.expect(ee.braceL);this.type!==ee.braceR;){var Ie=this.parseClassElement(m.superClass!==null);Ie&&(O.body.push(Ie),Ie.type==="MethodDefinition"&&Ie.kind==="constructor"&&(ue&&this.raise(Ie.start,"Duplicate constructor in the same class"),ue=!0))}return this.strict=j,this.next(),m.body=this.finishNode(O,"ClassBody"),this.finishNode(m,S?"ClassDeclaration":"ClassExpression")},sr.parseClassElement=function(m){var S=this;if(this.eat(ee.semi))return null;var j=this.startNode(),O=function(It,wr){wr===void 0&&(wr=!1);var jr=S.start,Qn=S.startLoc;return S.eatContextual(It)?S.type!==ee.parenL&&(!wr||!S.canInsertSemicolon())?!0:(j.key&&S.unexpected(),j.computed=!1,j.key=S.startNodeAt(jr,Qn),j.key.name=It,S.finishNode(j.key,"Identifier"),!1):!1};j.kind="method",j.static=O("static");var ue=this.eat(ee.star),Ie=!1;ue||(this.options.ecmaVersion>=8&&O("async",!0)?(Ie=!0,ue=this.options.ecmaVersion>=9&&this.eat(ee.star)):O("get")?j.kind="get":O("set")&&(j.kind="set")),j.key||this.parsePropertyName(j);var st=j.key,Lt=!1;return!j.computed&&!j.static&&(st.type==="Identifier"&&st.name==="constructor"||st.type==="Literal"&&st.value==="constructor")?(j.kind!=="method"&&this.raise(st.start,"Constructor can't have get/set modifier"),ue&&this.raise(st.start,"Constructor can't be a generator"),Ie&&this.raise(st.start,"Constructor can't be an async method"),j.kind="constructor",Lt=m):j.static&&st.type==="Identifier"&&st.name==="prototype"&&this.raise(st.start,"Classes may not have a static property named prototype"),this.parseClassMethod(j,ue,Ie,Lt),j.kind==="get"&&j.value.params.length!==0&&this.raiseRecoverable(j.value.start,"getter should have no params"),j.kind==="set"&&j.value.params.length!==1&&this.raiseRecoverable(j.value.start,"setter should have exactly one param"),j.kind==="set"&&j.value.params[0].type==="RestElement"&&this.raiseRecoverable(j.value.params[0].start,"Setter cannot use rest params"),j},sr.parseClassMethod=function(m,S,j,O){return m.value=this.parseMethod(S,j,O),this.finishNode(m,"MethodDefinition")},sr.parseClassId=function(m,S){this.type===ee.name?(m.id=this.parseIdent(),S&&this.checkLVal(m.id,Ee,!1)):(S===!0&&this.unexpected(),m.id=null)},sr.parseClassSuper=function(m){m.superClass=this.eat(ee._extends)?this.parseExprSubscripts():null},sr.parseExport=function(m,S){if(this.next(),this.eat(ee.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(m.exported=this.parseIdent(!0),this.checkExport(S,m.exported.name,this.lastTokStart)):m.exported=null),this.expectContextual("from"),this.type!==ee.string&&this.unexpected(),m.source=this.parseExprAtom(),this.semicolon(),this.finishNode(m,"ExportAllDeclaration");if(this.eat(ee._default)){this.checkExport(S,"default",this.lastTokStart);var j;if(this.type===ee._function||(j=this.isAsyncFunction())){var O=this.startNode();this.next(),j&&this.next(),m.declaration=this.parseFunction(O,gt|dr,!1,j)}else if(this.type===ee._class){var ue=this.startNode();m.declaration=this.parseClass(ue,"nullableID")}else m.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(m,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())m.declaration=this.parseStatement(null),m.declaration.type==="VariableDeclaration"?this.checkVariableExport(S,m.declaration.declarations):this.checkExport(S,m.declaration.id.name,m.declaration.id.start),m.specifiers=[],m.source=null;else{if(m.declaration=null,m.specifiers=this.parseExportSpecifiers(S),this.eatContextual("from"))this.type!==ee.string&&this.unexpected(),m.source=this.parseExprAtom();else{for(var Ie=0,st=m.specifiers;Ie<st.length;Ie+=1){var Lt=st[Ie];this.checkUnreserved(Lt.local),this.checkLocalExport(Lt.local)}m.source=null}this.semicolon()}return this.finishNode(m,"ExportNamedDeclaration")},sr.checkExport=function(m,S,j){!m||(zr(m,S)&&this.raiseRecoverable(j,"Duplicate export '"+S+"'"),m[S]=!0)},sr.checkPatternExport=function(m,S){var j=S.type;if(j==="Identifier")this.checkExport(m,S.name,S.start);else if(j==="ObjectPattern")for(var O=0,ue=S.properties;O<ue.length;O+=1){var Ie=ue[O];this.checkPatternExport(m,Ie)}else if(j==="ArrayPattern")for(var st=0,Lt=S.elements;st<Lt.length;st+=1){var It=Lt[st];It&&this.checkPatternExport(m,It)}else j==="Property"?this.checkPatternExport(m,S.value):j==="AssignmentPattern"?this.checkPatternExport(m,S.left):j==="RestElement"?this.checkPatternExport(m,S.argument):j==="ParenthesizedExpression"&&this.checkPatternExport(m,S.expression)},sr.checkVariableExport=function(m,S){if(!!m)for(var j=0,O=S;j<O.length;j+=1){var ue=O[j];this.checkPatternExport(m,ue.id)}},sr.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},sr.parseExportSpecifiers=function(m){var S=[],j=!0;for(this.expect(ee.braceL);!this.eat(ee.braceR);){if(j)j=!1;else if(this.expect(ee.comma),this.afterTrailingComma(ee.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(m,O.exported.name,O.exported.start),S.push(this.finishNode(O,"ExportSpecifier"))}return S},sr.parseImport=function(m){return this.next(),this.type===ee.string?(m.specifiers=rt,m.source=this.parseExprAtom()):(m.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),m.source=this.type===ee.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(m,"ImportDeclaration")},sr.parseImportSpecifiers=function(){var m=[],S=!0;if(this.type===ee.name){var j=this.startNode();if(j.local=this.parseIdent(),this.checkLVal(j.local,Ee),m.push(this.finishNode(j,"ImportDefaultSpecifier")),!this.eat(ee.comma))return m}if(this.type===ee.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,Ee),m.push(this.finishNode(O,"ImportNamespaceSpecifier")),m}for(this.expect(ee.braceL);!this.eat(ee.braceR);){if(S)S=!1;else if(this.expect(ee.comma),this.afterTrailingComma(ee.braceR))break;var ue=this.startNode();ue.imported=this.parseIdent(!0),this.eatContextual("as")?ue.local=this.parseIdent():(this.checkUnreserved(ue.imported),ue.local=ue.imported),this.checkLVal(ue.local,Ee),m.push(this.finishNode(ue,"ImportSpecifier"))}return m},sr.adaptDirectivePrologue=function(m){for(var S=0;S<m.length&&this.isDirectiveCandidate(m[S]);++S)m[S].directive=m[S].expression.raw.slice(1,-1)},sr.isDirectiveCandidate=function(m){return m.type==="ExpressionStatement"&&m.expression.type==="Literal"&&typeof m.expression.value=="string"&&(this.input[m.start]==='"'||this.input[m.start]==="'")};var Vr=St.prototype;Vr.toAssignable=function(m,S,j){if(this.options.ecmaVersion>=6&&m)switch(m.type){case"Identifier":this.inAsync&&m.name==="await"&&this.raise(m.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":m.type="ObjectPattern",j&&this.checkPatternErrors(j,!0);for(var O=0,ue=m.properties;O<ue.length;O+=1){var Ie=ue[O];this.toAssignable(Ie,S),Ie.type==="RestElement"&&(Ie.argument.type==="ArrayPattern"||Ie.argument.type==="ObjectPattern")&&this.raise(Ie.argument.start,"Unexpected token")}break;case"Property":m.kind!=="init"&&this.raise(m.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(m.value,S);break;case"ArrayExpression":m.type="ArrayPattern",j&&this.checkPatternErrors(j,!0),this.toAssignableList(m.elements,S);break;case"SpreadElement":m.type="RestElement",this.toAssignable(m.argument,S),m.argument.type==="AssignmentPattern"&&this.raise(m.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":m.operator!=="="&&this.raise(m.left.end,"Only '=' operator can be used for specifying default value."),m.type="AssignmentPattern",delete m.operator,this.toAssignable(m.left,S);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(m.expression,S,j);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!S)break;default:this.raise(m.start,"Assigning to rvalue")}else j&&this.checkPatternErrors(j,!0);return m},Vr.toAssignableList=function(m,S){for(var j=m.length,O=0;O<j;O++){var ue=m[O];ue&&this.toAssignable(ue,S)}if(j){var Ie=m[j-1];this.options.ecmaVersion===6&&S&&Ie&&Ie.type==="RestElement"&&Ie.argument.type!=="Identifier"&&this.unexpected(Ie.argument.start)}return m},Vr.parseSpread=function(m){var S=this.startNode();return this.next(),S.argument=this.parseMaybeAssign(!1,m),this.finishNode(S,"SpreadElement")},Vr.parseRestBinding=function(){var m=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==ee.name&&this.unexpected(),m.argument=this.parseBindingAtom(),this.finishNode(m,"RestElement")},Vr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case ee.bracketL:var m=this.startNode();return this.next(),m.elements=this.parseBindingList(ee.bracketR,!0,!0),this.finishNode(m,"ArrayPattern");case ee.braceL:return this.parseObj(!0)}return this.parseIdent()},Vr.parseBindingList=function(m,S,j){for(var O=[],ue=!0;!this.eat(m);)if(ue?ue=!1:this.expect(ee.comma),S&&this.type===ee.comma)O.push(null);else{if(j&&this.afterTrailingComma(m))break;if(this.type===ee.ellipsis){var Ie=this.parseRestBinding();this.parseBindingListItem(Ie),O.push(Ie),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(m);break}else{var st=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(st),O.push(st)}}return O},Vr.parseBindingListItem=function(m){return m},Vr.parseMaybeDefault=function(m,S,j){if(j=j||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(ee.eq))return j;var O=this.startNodeAt(m,S);return O.left=j,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},Vr.checkLVal=function(m,S,j){switch(S===void 0&&(S=w),m.type){case"Identifier":S===Ee&&m.name==="let"&&this.raiseRecoverable(m.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(m.name)&&this.raiseRecoverable(m.start,(S?"Binding ":"Assigning to ")+m.name+" in strict mode"),j&&(zr(j,m.name)&&this.raiseRecoverable(m.start,"Argument name clash"),j[m.name]=!0),S!==w&&S!==yt&&this.declareName(m.name,S,m.start);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":S&&this.raiseRecoverable(m.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,ue=m.properties;O<ue.length;O+=1){var Ie=ue[O];this.checkLVal(Ie,S,j)}break;case"Property":this.checkLVal(m.value,S,j);break;case"ArrayPattern":for(var st=0,Lt=m.elements;st<Lt.length;st+=1){var It=Lt[st];It&&this.checkLVal(It,S,j)}break;case"AssignmentPattern":this.checkLVal(m.left,S,j);break;case"RestElement":this.checkLVal(m.argument,S,j);break;case"ParenthesizedExpression":this.checkLVal(m.expression,S,j);break;default:this.raise(m.start,(S?"Binding":"Assigning to")+" rvalue")}};var Ur=St.prototype;Ur.checkPropClash=function(m,S,j){if(!(this.options.ecmaVersion>=9&&m.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(m.computed||m.method||m.shorthand))){var O=m.key,ue;switch(O.type){case"Identifier":ue=O.name;break;case"Literal":ue=String(O.value);break;default:return}var Ie=m.kind;if(this.options.ecmaVersion>=6){ue==="__proto__"&&Ie==="init"&&(S.proto&&(j?j.doubleProto<0&&(j.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),S.proto=!0);return}ue="$"+ue;var st=S[ue];if(st){var Lt;Ie==="init"?Lt=this.strict&&st.init||st.get||st.set:Lt=st.init||st[Ie],Lt&&this.raiseRecoverable(O.start,"Redefinition of property")}else st=S[ue]={init:!1,get:!1,set:!1};st[Ie]=!0}},Ur.parseExpression=function(m,S){var j=this.start,O=this.startLoc,ue=this.parseMaybeAssign(m,S);if(this.type===ee.comma){var Ie=this.startNodeAt(j,O);for(Ie.expressions=[ue];this.eat(ee.comma);)Ie.expressions.push(this.parseMaybeAssign(m,S));return this.finishNode(Ie,"SequenceExpression")}return ue},Ur.parseMaybeAssign=function(m,S,j){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(m);this.exprAllowed=!1}var O=!1,ue=-1,Ie=-1;S?(ue=S.parenthesizedAssign,Ie=S.trailingComma,S.parenthesizedAssign=S.trailingComma=-1):(S=new ie,O=!0);var st=this.start,Lt=this.startLoc;(this.type===ee.parenL||this.type===ee.name)&&(this.potentialArrowAt=this.start);var It=this.parseMaybeConditional(m,S);if(j&&(It=j.call(this,It,st,Lt)),this.type.isAssign){var wr=this.startNodeAt(st,Lt);return wr.operator=this.value,wr.left=this.type===ee.eq?this.toAssignable(It,!1,S):It,O||(S.parenthesizedAssign=S.trailingComma=S.doubleProto=-1),S.shorthandAssign>=wr.left.start&&(S.shorthandAssign=-1),this.checkLVal(It),this.next(),wr.right=this.parseMaybeAssign(m),this.finishNode(wr,"AssignmentExpression")}else O&&this.checkExpressionErrors(S,!0);return ue>-1&&(S.parenthesizedAssign=ue),Ie>-1&&(S.trailingComma=Ie),It},Ur.parseMaybeConditional=function(m,S){var j=this.start,O=this.startLoc,ue=this.parseExprOps(m,S);if(this.checkExpressionErrors(S))return ue;if(this.eat(ee.question)){var Ie=this.startNodeAt(j,O);return Ie.test=ue,Ie.consequent=this.parseMaybeAssign(),this.expect(ee.colon),Ie.alternate=this.parseMaybeAssign(m),this.finishNode(Ie,"ConditionalExpression")}return ue},Ur.parseExprOps=function(m,S){var j=this.start,O=this.startLoc,ue=this.parseMaybeUnary(S,!1);return this.checkExpressionErrors(S)||ue.start===j&&ue.type==="ArrowFunctionExpression"?ue:this.parseExprOp(ue,j,O,-1,m)},Ur.parseExprOp=function(m,S,j,O,ue){var Ie=this.type.binop;if(Ie!=null&&(!ue||this.type!==ee._in)&&Ie>O){var st=this.type===ee.logicalOR||this.type===ee.logicalAND,Lt=this.type===ee.coalesce;Lt&&(Ie=ee.logicalAND.binop);var It=this.value;this.next();var wr=this.start,jr=this.startLoc,Qn=this.parseExprOp(this.parseMaybeUnary(null,!1),wr,jr,Ie,ue),Mi=this.buildBinary(S,j,m,Qn,It,st||Lt);return(st&&this.type===ee.coalesce||Lt&&(this.type===ee.logicalOR||this.type===ee.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Mi,S,j,O,ue)}return m},Ur.buildBinary=function(m,S,j,O,ue,Ie){var st=this.startNodeAt(m,S);return st.left=j,st.operator=ue,st.right=O,this.finishNode(st,Ie?"LogicalExpression":"BinaryExpression")},Ur.parseMaybeUnary=function(m,S){var j=this.start,O=this.startLoc,ue;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))ue=this.parseAwait(),S=!0;else if(this.type.prefix){var Ie=this.startNode(),st=this.type===ee.incDec;Ie.operator=this.value,Ie.prefix=!0,this.next(),Ie.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(m,!0),st?this.checkLVal(Ie.argument):this.strict&&Ie.operator==="delete"&&Ie.argument.type==="Identifier"?this.raiseRecoverable(Ie.start,"Deleting local variable in strict mode"):S=!0,ue=this.finishNode(Ie,st?"UpdateExpression":"UnaryExpression")}else{if(ue=this.parseExprSubscripts(m),this.checkExpressionErrors(m))return ue;for(;this.type.postfix&&!this.canInsertSemicolon();){var Lt=this.startNodeAt(j,O);Lt.operator=this.value,Lt.prefix=!1,Lt.argument=ue,this.checkLVal(ue),this.next(),ue=this.finishNode(Lt,"UpdateExpression")}}return!S&&this.eat(ee.starstar)?this.buildBinary(j,O,ue,this.parseMaybeUnary(null,!1),"**",!1):ue},Ur.parseExprSubscripts=function(m){var S=this.start,j=this.startLoc,O=this.parseExprAtom(m);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var ue=this.parseSubscripts(O,S,j);return m&&ue.type==="MemberExpression"&&(m.parenthesizedAssign>=ue.start&&(m.parenthesizedAssign=-1),m.parenthesizedBind>=ue.start&&(m.parenthesizedBind=-1)),ue},Ur.parseSubscripts=function(m,S,j,O){for(var ue=this.options.ecmaVersion>=8&&m.type==="Identifier"&&m.name==="async"&&this.lastTokEnd===m.end&&!this.canInsertSemicolon()&&m.end-m.start==5&&this.potentialArrowAt===m.start,Ie=!1;;){var st=this.parseSubscript(m,S,j,O,ue,Ie);if(st.optional&&(Ie=!0),st===m||st.type==="ArrowFunctionExpression"){if(Ie){var Lt=this.startNodeAt(S,j);Lt.expression=st,st=this.finishNode(Lt,"ChainExpression")}return st}m=st}},Ur.parseSubscript=function(m,S,j,O,ue,Ie){var st=this.options.ecmaVersion>=11,Lt=st&&this.eat(ee.questionDot);O&&Lt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var It=this.eat(ee.bracketL);if(It||Lt&&this.type!==ee.parenL&&this.type!==ee.backQuote||this.eat(ee.dot)){var wr=this.startNodeAt(S,j);wr.object=m,wr.property=It?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),wr.computed=!!It,It&&this.expect(ee.bracketR),st&&(wr.optional=Lt),m=this.finishNode(wr,"MemberExpression")}else if(!O&&this.eat(ee.parenL)){var jr=new ie,Qn=this.yieldPos,Mi=this.awaitPos,fi=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var qn=this.parseExprList(ee.parenR,this.options.ecmaVersion>=8,!1,jr);if(ue&&!Lt&&!this.canInsertSemicolon()&&this.eat(ee.arrow))return this.checkPatternErrors(jr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Qn,this.awaitPos=Mi,this.awaitIdentPos=fi,this.parseArrowExpression(this.startNodeAt(S,j),qn,!0);this.checkExpressionErrors(jr,!0),this.yieldPos=Qn||this.yieldPos,this.awaitPos=Mi||this.awaitPos,this.awaitIdentPos=fi||this.awaitIdentPos;var wa=this.startNodeAt(S,j);wa.callee=m,wa.arguments=qn,st&&(wa.optional=Lt),m=this.finishNode(wa,"CallExpression")}else if(this.type===ee.backQuote){(Lt||Ie)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var ka=this.startNodeAt(S,j);ka.tag=m,ka.quasi=this.parseTemplate({isTagged:!0}),m=this.finishNode(ka,"TaggedTemplateExpression")}return m},Ur.parseExprAtom=function(m){this.type===ee.slash&&this.readRegexp();var S,j=this.potentialArrowAt===this.start;switch(this.type){case ee._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),S=this.startNode(),this.next(),this.type===ee.parenL&&!this.allowDirectSuper&&this.raise(S.start,"super() call outside constructor of a subclass"),this.type!==ee.dot&&this.type!==ee.bracketL&&this.type!==ee.parenL&&this.unexpected(),this.finishNode(S,"Super");case ee._this:return S=this.startNode(),this.next(),this.finishNode(S,"ThisExpression");case ee.name:var O=this.start,ue=this.startLoc,Ie=this.containsEsc,st=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Ie&&st.name==="async"&&!this.canInsertSemicolon()&&this.eat(ee._function))return this.parseFunction(this.startNodeAt(O,ue),0,!1,!0);if(j&&!this.canInsertSemicolon()){if(this.eat(ee.arrow))return this.parseArrowExpression(this.startNodeAt(O,ue),[st],!1);if(this.options.ecmaVersion>=8&&st.name==="async"&&this.type===ee.name&&!Ie)return st=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(ee.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,ue),[st],!0)}return st;case ee.regexp:var Lt=this.value;return S=this.parseLiteral(Lt.value),S.regex={pattern:Lt.pattern,flags:Lt.flags},S;case ee.num:case ee.string:return this.parseLiteral(this.value);case ee._null:case ee._true:case ee._false:return S=this.startNode(),S.value=this.type===ee._null?null:this.type===ee._true,S.raw=this.type.keyword,this.next(),this.finishNode(S,"Literal");case ee.parenL:var It=this.start,wr=this.parseParenAndDistinguishExpression(j);return m&&(m.parenthesizedAssign<0&&!this.isSimpleAssignTarget(wr)&&(m.parenthesizedAssign=It),m.parenthesizedBind<0&&(m.parenthesizedBind=It)),wr;case ee.bracketL:return S=this.startNode(),this.next(),S.elements=this.parseExprList(ee.bracketR,!0,!0,m),this.finishNode(S,"ArrayExpression");case ee.braceL:return this.parseObj(!1,m);case ee._function:return S=this.startNode(),this.next(),this.parseFunction(S,0);case ee._class:return this.parseClass(this.startNode(),!1);case ee._new:return this.parseNew();case ee.backQuote:return this.parseTemplate();case ee._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Ur.parseExprImport=function(){var m=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var S=this.parseIdent(!0);switch(this.type){case ee.parenL:return this.parseDynamicImport(m);case ee.dot:return m.meta=S,this.parseImportMeta(m);default:this.unexpected()}},Ur.parseDynamicImport=function(m){if(this.next(),m.source=this.parseMaybeAssign(),!this.eat(ee.parenR)){var S=this.start;this.eat(ee.comma)&&this.eat(ee.parenR)?this.raiseRecoverable(S,"Trailing comma is not allowed in import()"):this.unexpected(S)}return this.finishNode(m,"ImportExpression")},Ur.parseImportMeta=function(m){this.next();var S=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="meta"&&this.raiseRecoverable(m.property.start,"The only valid meta property for import is 'import.meta'"),S&&this.raiseRecoverable(m.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(m.start,"Cannot use 'import.meta' outside a module"),this.finishNode(m,"MetaProperty")},Ur.parseLiteral=function(m){var S=this.startNode();return S.value=m,S.raw=this.input.slice(this.start,this.end),S.raw.charCodeAt(S.raw.length-1)===110&&(S.bigint=S.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(S,"Literal")},Ur.parseParenExpression=function(){this.expect(ee.parenL);var m=this.parseExpression();return this.expect(ee.parenR),m},Ur.parseParenAndDistinguishExpression=function(m){var S=this.start,j=this.startLoc,O,ue=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Ie=this.start,st=this.startLoc,Lt=[],It=!0,wr=!1,jr=new ie,Qn=this.yieldPos,Mi=this.awaitPos,fi;for(this.yieldPos=0,this.awaitPos=0;this.type!==ee.parenR;)if(It?It=!1:this.expect(ee.comma),ue&&this.afterTrailingComma(ee.parenR,!0)){wr=!0;break}else if(this.type===ee.ellipsis){fi=this.start,Lt.push(this.parseParenItem(this.parseRestBinding())),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Lt.push(this.parseMaybeAssign(!1,jr,this.parseParenItem));var qn=this.start,wa=this.startLoc;if(this.expect(ee.parenR),m&&!this.canInsertSemicolon()&&this.eat(ee.arrow))return this.checkPatternErrors(jr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Qn,this.awaitPos=Mi,this.parseParenArrowList(S,j,Lt);(!Lt.length||wr)&&this.unexpected(this.lastTokStart),fi&&this.unexpected(fi),this.checkExpressionErrors(jr,!0),this.yieldPos=Qn||this.yieldPos,this.awaitPos=Mi||this.awaitPos,Lt.length>1?(O=this.startNodeAt(Ie,st),O.expressions=Lt,this.finishNodeAt(O,"SequenceExpression",qn,wa)):O=Lt[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var ka=this.startNodeAt(S,j);return ka.expression=O,this.finishNode(ka,"ParenthesizedExpression")}else return O},Ur.parseParenItem=function(m){return m},Ur.parseParenArrowList=function(m,S,j){return this.parseArrowExpression(this.startNodeAt(m,S),j)};var nn=[];Ur.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var m=this.startNode(),S=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(ee.dot)){m.meta=S;var j=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="target"&&this.raiseRecoverable(m.property.start,"The only valid meta property for new is 'new.target'"),j&&this.raiseRecoverable(m.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(m.start,"'new.target' can only be used in functions"),this.finishNode(m,"MetaProperty")}var O=this.start,ue=this.startLoc,Ie=this.type===ee._import;return m.callee=this.parseSubscripts(this.parseExprAtom(),O,ue,!0),Ie&&m.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(ee.parenL)?m.arguments=this.parseExprList(ee.parenR,this.options.ecmaVersion>=8,!1):m.arguments=nn,this.finishNode(m,"NewExpression")},Ur.parseTemplateElement=function(m){var S=m.isTagged,j=this.startNode();return this.type===ee.invalidTemplate?(S||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),j.value={raw:this.value,cooked:null}):j.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),j.tail=this.type===ee.backQuote,this.finishNode(j,"TemplateElement")},Ur.parseTemplate=function(m){m===void 0&&(m={});var S=m.isTagged;S===void 0&&(S=!1);var j=this.startNode();this.next(),j.expressions=[];var O=this.parseTemplateElement({isTagged:S});for(j.quasis=[O];!O.tail;)this.type===ee.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(ee.dollarBraceL),j.expressions.push(this.parseExpression()),this.expect(ee.braceR),j.quasis.push(O=this.parseTemplateElement({isTagged:S}));return this.next(),this.finishNode(j,"TemplateLiteral")},Ur.isAsyncProp=function(m){return!m.computed&&m.key.type==="Identifier"&&m.key.name==="async"&&(this.type===ee.name||this.type===ee.num||this.type===ee.string||this.type===ee.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===ee.star)&&!vr.test(this.input.slice(this.lastTokEnd,this.start))},Ur.parseObj=function(m,S){var j=this.startNode(),O=!0,ue={};for(j.properties=[],this.next();!this.eat(ee.braceR);){if(O)O=!1;else if(this.expect(ee.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(ee.braceR))break;var Ie=this.parseProperty(m,S);m||this.checkPropClash(Ie,ue,S),j.properties.push(Ie)}return this.finishNode(j,m?"ObjectPattern":"ObjectExpression")},Ur.parseProperty=function(m,S){var j=this.startNode(),O,ue,Ie,st;if(this.options.ecmaVersion>=9&&this.eat(ee.ellipsis))return m?(j.argument=this.parseIdent(!1),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(j,"RestElement")):(this.type===ee.parenL&&S&&(S.parenthesizedAssign<0&&(S.parenthesizedAssign=this.start),S.parenthesizedBind<0&&(S.parenthesizedBind=this.start)),j.argument=this.parseMaybeAssign(!1,S),this.type===ee.comma&&S&&S.trailingComma<0&&(S.trailingComma=this.start),this.finishNode(j,"SpreadElement"));this.options.ecmaVersion>=6&&(j.method=!1,j.shorthand=!1,(m||S)&&(Ie=this.start,st=this.startLoc),m||(O=this.eat(ee.star)));var Lt=this.containsEsc;return this.parsePropertyName(j),!m&&!Lt&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(j)?(ue=!0,O=this.options.ecmaVersion>=9&&this.eat(ee.star),this.parsePropertyName(j,S)):ue=!1,this.parsePropertyValue(j,m,O,ue,Ie,st,S,Lt),this.finishNode(j,"Property")},Ur.parsePropertyValue=function(m,S,j,O,ue,Ie,st,Lt){if((j||O)&&this.type===ee.colon&&this.unexpected(),this.eat(ee.colon))m.value=S?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,st),m.kind="init";else if(this.options.ecmaVersion>=6&&this.type===ee.parenL)S&&this.unexpected(),m.kind="init",m.method=!0,m.value=this.parseMethod(j,O);else if(!S&&!Lt&&this.options.ecmaVersion>=5&&!m.computed&&m.key.type==="Identifier"&&(m.key.name==="get"||m.key.name==="set")&&this.type!==ee.comma&&this.type!==ee.braceR&&this.type!==ee.eq){(j||O)&&this.unexpected(),m.kind=m.key.name,this.parsePropertyName(m),m.value=this.parseMethod(!1);var It=m.kind==="get"?0:1;if(m.value.params.length!==It){var wr=m.value.start;m.kind==="get"?this.raiseRecoverable(wr,"getter should have no params"):this.raiseRecoverable(wr,"setter should have exactly one param")}else m.kind==="set"&&m.value.params[0].type==="RestElement"&&this.raiseRecoverable(m.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!m.computed&&m.key.type==="Identifier"?((j||O)&&this.unexpected(),this.checkUnreserved(m.key),m.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ue),m.kind="init",S?m.value=this.parseMaybeDefault(ue,Ie,m.key):this.type===ee.eq&&st?(st.shorthandAssign<0&&(st.shorthandAssign=this.start),m.value=this.parseMaybeDefault(ue,Ie,m.key)):m.value=m.key,m.shorthand=!0):this.unexpected()},Ur.parsePropertyName=function(m){if(this.options.ecmaVersion>=6){if(this.eat(ee.bracketL))return m.computed=!0,m.key=this.parseMaybeAssign(),this.expect(ee.bracketR),m.key;m.computed=!1}return m.key=this.type===ee.num||this.type===ee.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Ur.initFunction=function(m){m.id=null,this.options.ecmaVersion>=6&&(m.generator=m.expression=!1),this.options.ecmaVersion>=8&&(m.async=!1)},Ur.parseMethod=function(m,S,j){var O=this.startNode(),ue=this.yieldPos,Ie=this.awaitPos,st=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=m),this.options.ecmaVersion>=8&&(O.async=!!S),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(er(S,O.generator)|Le|(j?kt:0)),this.expect(ee.parenL),O.params=this.parseBindingList(ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=ue,this.awaitPos=Ie,this.awaitIdentPos=st,this.finishNode(O,"FunctionExpression")},Ur.parseArrowExpression=function(m,S,j){var O=this.yieldPos,ue=this.awaitPos,Ie=this.awaitIdentPos;return this.enterScope(er(j,!1)|Te),this.initFunction(m),this.options.ecmaVersion>=8&&(m.async=!!j),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,m.params=this.toAssignableList(S,!0),this.parseFunctionBody(m,!0,!1),this.yieldPos=O,this.awaitPos=ue,this.awaitIdentPos=Ie,this.finishNode(m,"ArrowFunctionExpression")},Ur.parseFunctionBody=function(m,S,j){var O=S&&this.type!==ee.braceL,ue=this.strict,Ie=!1;if(O)m.body=this.parseMaybeAssign(),m.expression=!0,this.checkParams(m,!1);else{var st=this.options.ecmaVersion>=7&&!this.isSimpleParamList(m.params);(!ue||st)&&(Ie=this.strictDirective(this.end),Ie&&st&&this.raiseRecoverable(m.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Lt=this.labels;this.labels=[],Ie&&(this.strict=!0),this.checkParams(m,!ue&&!Ie&&!S&&!j&&this.isSimpleParamList(m.params)),this.strict&&m.id&&this.checkLVal(m.id,yt),m.body=this.parseBlock(!1,void 0,Ie&&!ue),m.expression=!1,this.adaptDirectivePrologue(m.body.body),this.labels=Lt}this.exitScope()},Ur.isSimpleParamList=function(m){for(var S=0,j=m;S<j.length;S+=1){var O=j[S];if(O.type!=="Identifier")return!1}return!0},Ur.checkParams=function(m,S){for(var j={},O=0,ue=m.params;O<ue.length;O+=1){var Ie=ue[O];this.checkLVal(Ie,Z,S?null:j)}},Ur.parseExprList=function(m,S,j,O){for(var ue=[],Ie=!0;!this.eat(m);){if(Ie)Ie=!1;else if(this.expect(ee.comma),S&&this.afterTrailingComma(m))break;var st=void 0;j&&this.type===ee.comma?st=null:this.type===ee.ellipsis?(st=this.parseSpread(O),O&&this.type===ee.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):st=this.parseMaybeAssign(!1,O),ue.push(st)}return ue},Ur.checkUnreserved=function(m){var S=m.start,j=m.end,O=m.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(S,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(S,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(S,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(S,j).indexOf("\\")!==-1)){var ue=this.strict?this.reservedWordsStrict:this.reservedWords;ue.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(S,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(S,"The keyword '"+O+"' is reserved"))}},Ur.parseIdent=function(m,S){var j=this.startNode();return this.type===ee.name?j.name=this.value:this.type.keyword?(j.name=this.type.keyword,(j.name==="class"||j.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!m),this.finishNode(j,"Identifier"),m||(this.checkUnreserved(j),j.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=j.start)),j},Ur.parseYield=function(m){this.yieldPos||(this.yieldPos=this.start);var S=this.startNode();return this.next(),this.type===ee.semi||this.canInsertSemicolon()||this.type!==ee.star&&!this.type.startsExpr?(S.delegate=!1,S.argument=null):(S.delegate=this.eat(ee.star),S.argument=this.parseMaybeAssign(m)),this.finishNode(S,"YieldExpression")},Ur.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var m=this.startNode();return this.next(),m.argument=this.parseMaybeUnary(null,!1),this.finishNode(m,"AwaitExpression")};var Jr=St.prototype;Jr.raise=function(m,S){var j=ft(this.input,m);S+=" ("+j.line+":"+j.column+")";var O=new SyntaxError(S);throw O.pos=m,O.loc=j,O.raisedAt=this.pos,O},Jr.raiseRecoverable=Jr.raise,Jr.curPosition=function(){if(this.options.locations)return new ye(this.curLine,this.pos-this.lineStart)};var Cr=St.prototype,kn=function(S){this.flags=S,this.var=[],this.lexical=[],this.functions=[]};Cr.enterScope=function(m){this.scopeStack.push(new kn(m))},Cr.exitScope=function(){this.scopeStack.pop()},Cr.treatFunctionsAsVarInScope=function(m){return m.flags&yn||!this.inModule&&m.flags&cn},Cr.declareName=function(m,S,j){var O=!1;if(S===Ee){var ue=this.currentScope();O=ue.lexical.indexOf(m)>-1||ue.functions.indexOf(m)>-1||ue.var.indexOf(m)>-1,ue.lexical.push(m),this.inModule&&ue.flags&cn&&delete this.undefinedExports[m]}else if(S===Qe){var Ie=this.currentScope();Ie.lexical.push(m)}else if(S===je){var st=this.currentScope();this.treatFunctionsAsVar?O=st.lexical.indexOf(m)>-1:O=st.lexical.indexOf(m)>-1||st.var.indexOf(m)>-1,st.functions.push(m)}else for(var Lt=this.scopeStack.length-1;Lt>=0;--Lt){var It=this.scopeStack[Lt];if(It.lexical.indexOf(m)>-1&&!(It.flags&Ue&&It.lexical[0]===m)||!this.treatFunctionsAsVarInScope(It)&&It.functions.indexOf(m)>-1){O=!0;break}if(It.var.push(m),this.inModule&&It.flags&cn&&delete this.undefinedExports[m],It.flags&Vi)break}O&&this.raiseRecoverable(j,"Identifier '"+m+"' has already been declared")},Cr.checkLocalExport=function(m){this.scopeStack[0].lexical.indexOf(m.name)===-1&&this.scopeStack[0].var.indexOf(m.name)===-1&&(this.undefinedExports[m.name]=m)},Cr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Cr.currentVarScope=function(){for(var m=this.scopeStack.length-1;;m--){var S=this.scopeStack[m];if(S.flags&Vi)return S}},Cr.currentThisScope=function(){for(var m=this.scopeStack.length-1;;m--){var S=this.scopeStack[m];if(S.flags&Vi&&!(S.flags&Te))return S}};var Zn=function(S,j,O){this.type="",this.start=j,this.end=0,S.options.locations&&(this.loc=new _t(S,O)),S.options.directSourceFile&&(this.sourceFile=S.options.directSourceFile),S.options.ranges&&(this.range=[j,0])},Si=St.prototype;Si.startNode=function(){return new Zn(this,this.start,this.startLoc)},Si.startNodeAt=function(m,S){return new Zn(this,m,S)};function zi(m,S,j,O){return m.type=S,m.end=j,this.options.locations&&(m.loc.end=O),this.options.ranges&&(m.range[1]=j),m}Si.finishNode=function(m,S){return zi.call(this,m,S,this.lastTokEnd,this.lastTokEndLoc)},Si.finishNodeAt=function(m,S,j,O){return zi.call(this,m,S,j,O)};var Ji=function(S,j,O,ue,Ie){this.token=S,this.isExpr=!!j,this.preserveSpace=!!O,this.override=ue,this.generator=!!Ie},Di={b_stat:new Ji("{",!1),b_expr:new Ji("{",!0),b_tmpl:new Ji("${",!1),p_stat:new Ji("(",!1),p_expr:new Ji("(",!0),q_tmpl:new Ji("`",!0,!0,function(m){return m.tryReadTemplateToken()}),f_stat:new Ji("function",!1),f_expr:new Ji("function",!0),f_expr_gen:new Ji("function",!0,!1,null,!0),f_gen:new Ji("function",!1,!1,null,!0)},Oi=St.prototype;Oi.initialContext=function(){return[Di.b_stat]},Oi.braceIsBlock=function(m){var S=this.curContext();return S===Di.f_expr||S===Di.f_stat?!0:m===ee.colon&&(S===Di.b_stat||S===Di.b_expr)?!S.isExpr:m===ee._return||m===ee.name&&this.exprAllowed?vr.test(this.input.slice(this.lastTokEnd,this.start)):m===ee._else||m===ee.semi||m===ee.eof||m===ee.parenR||m===ee.arrow?!0:m===ee.braceL?S===Di.b_stat:m===ee._var||m===ee._const||m===ee.name?!1:!this.exprAllowed},Oi.inGeneratorContext=function(){for(var m=this.context.length-1;m>=1;m--){var S=this.context[m];if(S.token==="function")return S.generator}return!1},Oi.updateContext=function(m){var S,j=this.type;j.keyword&&m===ee.dot?this.exprAllowed=!1:(S=j.updateContext)?S.call(this,m):this.exprAllowed=j.beforeExpr},ee.parenR.updateContext=ee.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var m=this.context.pop();m===Di.b_stat&&this.curContext().token==="function"&&(m=this.context.pop()),this.exprAllowed=!m.isExpr},ee.braceL.updateContext=function(m){this.context.push(this.braceIsBlock(m)?Di.b_stat:Di.b_expr),this.exprAllowed=!0},ee.dollarBraceL.updateContext=function(){this.context.push(Di.b_tmpl),this.exprAllowed=!0},ee.parenL.updateContext=function(m){var S=m===ee._if||m===ee._for||m===ee._with||m===ee._while;this.context.push(S?Di.p_stat:Di.p_expr),this.exprAllowed=!0},ee.incDec.updateContext=function(){},ee._function.updateContext=ee._class.updateContext=function(m){m.beforeExpr&&m!==ee.semi&&m!==ee._else&&!(m===ee._return&&vr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((m===ee.colon||m===ee.braceL)&&this.curContext()===Di.b_stat)?this.context.push(Di.f_expr):this.context.push(Di.f_stat),this.exprAllowed=!1},ee.backQuote.updateContext=function(){this.curContext()===Di.q_tmpl?this.context.pop():this.context.push(Di.q_tmpl),this.exprAllowed=!1},ee.star.updateContext=function(m){if(m===ee._function){var S=this.context.length-1;this.context[S]===Di.f_expr?this.context[S]=Di.f_expr_gen:this.context[S]=Di.f_gen}this.exprAllowed=!0},ee.name.updateContext=function(m){var S=!1;this.options.ecmaVersion>=6&&m!==ee.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(S=!0),this.exprAllowed=S};var X="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ce=X+" Extended_Pictographic",me=ce,z={9:X,10:ce,11:me},oe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",ve="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ae=ve+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",se=Ae+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Ce={9:ve,10:Ae,11:se},ct={};function xr(m){var S=ct[m]={binary:Re(z[m]+" "+oe),nonBinary:{General_Category:Re(oe),Script:Re(Ce[m])}};S.nonBinary.Script_Extensions=S.nonBinary.Script,S.nonBinary.gc=S.nonBinary.General_Category,S.nonBinary.sc=S.nonBinary.Script,S.nonBinary.scx=S.nonBinary.Script_Extensions}xr(9),xr(10),xr(11);var Ht=St.prototype,Jt=function(S){this.parser=S,this.validFlags="gim"+(S.options.ecmaVersion>=6?"uy":"")+(S.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ct[S.options.ecmaVersion>=11?11:S.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Jt.prototype.reset=function(S,j,O){var ue=O.indexOf("u")!==-1;this.start=S|0,this.source=j+"",this.flags=O,this.switchU=ue&&this.parser.options.ecmaVersion>=6,this.switchN=ue&&this.parser.options.ecmaVersion>=9},Jt.prototype.raise=function(S){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+S)},Jt.prototype.at=function(S,j){j===void 0&&(j=!1);var O=this.source,ue=O.length;if(S>=ue)return-1;var Ie=O.charCodeAt(S);if(!(j||this.switchU)||Ie<=55295||Ie>=57344||S+1>=ue)return Ie;var st=O.charCodeAt(S+1);return st>=56320&&st<=57343?(Ie<<10)+st-56613888:Ie},Jt.prototype.nextIndex=function(S,j){j===void 0&&(j=!1);var O=this.source,ue=O.length;if(S>=ue)return ue;var Ie=O.charCodeAt(S),st;return!(j||this.switchU)||Ie<=55295||Ie>=57344||S+1>=ue||(st=O.charCodeAt(S+1))<56320||st>57343?S+1:S+2},Jt.prototype.current=function(S){return S===void 0&&(S=!1),this.at(this.pos,S)},Jt.prototype.lookahead=function(S){return S===void 0&&(S=!1),this.at(this.nextIndex(this.pos,S),S)},Jt.prototype.advance=function(S){S===void 0&&(S=!1),this.pos=this.nextIndex(this.pos,S)},Jt.prototype.eat=function(S,j){return j===void 0&&(j=!1),this.current(j)===S?(this.advance(j),!0):!1};function Rr(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Ht.validateRegExpFlags=function(m){for(var S=m.validFlags,j=m.flags,O=0;O<j.length;O++){var ue=j.charAt(O);S.indexOf(ue)===-1&&this.raise(m.start,"Invalid regular expression flag"),j.indexOf(ue,O+1)>-1&&this.raise(m.start,"Duplicate regular expression flag")}},Ht.validateRegExpPattern=function(m){this.regexp_pattern(m),!m.switchN&&this.options.ecmaVersion>=9&&m.groupNames.length>0&&(m.switchN=!0,this.regexp_pattern(m))},Ht.regexp_pattern=function(m){m.pos=0,m.lastIntValue=0,m.lastStringValue="",m.lastAssertionIsQuantifiable=!1,m.numCapturingParens=0,m.maxBackReference=0,m.groupNames.length=0,m.backReferenceNames.length=0,this.regexp_disjunction(m),m.pos!==m.source.length&&(m.eat(41)&&m.raise("Unmatched ')'"),(m.eat(93)||m.eat(125))&&m.raise("Lone quantifier brackets")),m.maxBackReference>m.numCapturingParens&&m.raise("Invalid escape");for(var S=0,j=m.backReferenceNames;S<j.length;S+=1){var O=j[S];m.groupNames.indexOf(O)===-1&&m.raise("Invalid named capture referenced")}},Ht.regexp_disjunction=function(m){for(this.regexp_alternative(m);m.eat(124);)this.regexp_alternative(m);this.regexp_eatQuantifier(m,!0)&&m.raise("Nothing to repeat"),m.eat(123)&&m.raise("Lone quantifier brackets")},Ht.regexp_alternative=function(m){for(;m.pos<m.source.length&&this.regexp_eatTerm(m););},Ht.regexp_eatTerm=function(m){return this.regexp_eatAssertion(m)?(m.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(m)&&m.switchU&&m.raise("Invalid quantifier"),!0):(m.switchU?this.regexp_eatAtom(m):this.regexp_eatExtendedAtom(m))?(this.regexp_eatQuantifier(m),!0):!1},Ht.regexp_eatAssertion=function(m){var S=m.pos;if(m.lastAssertionIsQuantifiable=!1,m.eat(94)||m.eat(36))return!0;if(m.eat(92)){if(m.eat(66)||m.eat(98))return!0;m.pos=S}if(m.eat(40)&&m.eat(63)){var j=!1;if(this.options.ecmaVersion>=9&&(j=m.eat(60)),m.eat(61)||m.eat(33))return this.regexp_disjunction(m),m.eat(41)||m.raise("Unterminated group"),m.lastAssertionIsQuantifiable=!j,!0}return m.pos=S,!1},Ht.regexp_eatQuantifier=function(m,S){return S===void 0&&(S=!1),this.regexp_eatQuantifierPrefix(m,S)?(m.eat(63),!0):!1},Ht.regexp_eatQuantifierPrefix=function(m,S){return m.eat(42)||m.eat(43)||m.eat(63)||this.regexp_eatBracedQuantifier(m,S)},Ht.regexp_eatBracedQuantifier=function(m,S){var j=m.pos;if(m.eat(123)){var O=0,ue=-1;if(this.regexp_eatDecimalDigits(m)&&(O=m.lastIntValue,m.eat(44)&&this.regexp_eatDecimalDigits(m)&&(ue=m.lastIntValue),m.eat(125)))return ue!==-1&&ue<O&&!S&&m.raise("numbers out of order in {} quantifier"),!0;m.switchU&&!S&&m.raise("Incomplete quantifier"),m.pos=j}return!1},Ht.regexp_eatAtom=function(m){return this.regexp_eatPatternCharacters(m)||m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)},Ht.regexp_eatReverseSolidusAtomEscape=function(m){var S=m.pos;if(m.eat(92)){if(this.regexp_eatAtomEscape(m))return!0;m.pos=S}return!1},Ht.regexp_eatUncapturingGroup=function(m){var S=m.pos;if(m.eat(40)){if(m.eat(63)&&m.eat(58)){if(this.regexp_disjunction(m),m.eat(41))return!0;m.raise("Unterminated group")}m.pos=S}return!1},Ht.regexp_eatCapturingGroup=function(m){if(m.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(m):m.current()===63&&m.raise("Invalid group"),this.regexp_disjunction(m),m.eat(41))return m.numCapturingParens+=1,!0;m.raise("Unterminated group")}return!1},Ht.regexp_eatExtendedAtom=function(m){return m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)||this.regexp_eatInvalidBracedQuantifier(m)||this.regexp_eatExtendedPatternCharacter(m)},Ht.regexp_eatInvalidBracedQuantifier=function(m){return this.regexp_eatBracedQuantifier(m,!0)&&m.raise("Nothing to repeat"),!1},Ht.regexp_eatSyntaxCharacter=function(m){var S=m.current();return Mn(S)?(m.lastIntValue=S,m.advance(),!0):!1};function Mn(m){return m===36||m>=40&&m<=43||m===46||m===63||m>=91&&m<=94||m>=123&&m<=125}Ht.regexp_eatPatternCharacters=function(m){for(var S=m.pos,j=0;(j=m.current())!==-1&&!Mn(j);)m.advance();return m.pos!==S},Ht.regexp_eatExtendedPatternCharacter=function(m){var S=m.current();return S!==-1&&S!==36&&!(S>=40&&S<=43)&&S!==46&&S!==63&&S!==91&&S!==94&&S!==124?(m.advance(),!0):!1},Ht.regexp_groupSpecifier=function(m){if(m.eat(63)){if(this.regexp_eatGroupName(m)){m.groupNames.indexOf(m.lastStringValue)!==-1&&m.raise("Duplicate capture group name"),m.groupNames.push(m.lastStringValue);return}m.raise("Invalid group")}},Ht.regexp_eatGroupName=function(m){if(m.lastStringValue="",m.eat(60)){if(this.regexp_eatRegExpIdentifierName(m)&&m.eat(62))return!0;m.raise("Invalid capture group name")}return!1},Ht.regexp_eatRegExpIdentifierName=function(m){if(m.lastStringValue="",this.regexp_eatRegExpIdentifierStart(m)){for(m.lastStringValue+=Rr(m.lastIntValue);this.regexp_eatRegExpIdentifierPart(m);)m.lastStringValue+=Rr(m.lastIntValue);return!0}return!1},Ht.regexp_eatRegExpIdentifierStart=function(m){var S=m.pos,j=this.options.ecmaVersion>=11,O=m.current(j);return m.advance(j),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,j)&&(O=m.lastIntValue),Pn(O)?(m.lastIntValue=O,!0):(m.pos=S,!1)};function Pn(m){return et(m,!0)||m===36||m===95}Ht.regexp_eatRegExpIdentifierPart=function(m){var S=m.pos,j=this.options.ecmaVersion>=11,O=m.current(j);return m.advance(j),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,j)&&(O=m.lastIntValue),$t(O)?(m.lastIntValue=O,!0):(m.pos=S,!1)};function $t(m){return Yt(m,!0)||m===36||m===95||m===8204||m===8205}Ht.regexp_eatAtomEscape=function(m){return this.regexp_eatBackReference(m)||this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)||m.switchN&&this.regexp_eatKGroupName(m)?!0:(m.switchU&&(m.current()===99&&m.raise("Invalid unicode escape"),m.raise("Invalid escape")),!1)},Ht.regexp_eatBackReference=function(m){var S=m.pos;if(this.regexp_eatDecimalEscape(m)){var j=m.lastIntValue;if(m.switchU)return j>m.maxBackReference&&(m.maxBackReference=j),!0;if(j<=m.numCapturingParens)return!0;m.pos=S}return!1},Ht.regexp_eatKGroupName=function(m){if(m.eat(107)){if(this.regexp_eatGroupName(m))return m.backReferenceNames.push(m.lastStringValue),!0;m.raise("Invalid named reference")}return!1},Ht.regexp_eatCharacterEscape=function(m){return this.regexp_eatControlEscape(m)||this.regexp_eatCControlLetter(m)||this.regexp_eatZero(m)||this.regexp_eatHexEscapeSequence(m)||this.regexp_eatRegExpUnicodeEscapeSequence(m,!1)||!m.switchU&&this.regexp_eatLegacyOctalEscapeSequence(m)||this.regexp_eatIdentityEscape(m)},Ht.regexp_eatCControlLetter=function(m){var S=m.pos;if(m.eat(99)){if(this.regexp_eatControlLetter(m))return!0;m.pos=S}return!1},Ht.regexp_eatZero=function(m){return m.current()===48&&!Li(m.lookahead())?(m.lastIntValue=0,m.advance(),!0):!1},Ht.regexp_eatControlEscape=function(m){var S=m.current();return S===116?(m.lastIntValue=9,m.advance(),!0):S===110?(m.lastIntValue=10,m.advance(),!0):S===118?(m.lastIntValue=11,m.advance(),!0):S===102?(m.lastIntValue=12,m.advance(),!0):S===114?(m.lastIntValue=13,m.advance(),!0):!1},Ht.regexp_eatControlLetter=function(m){var S=m.current();return En(S)?(m.lastIntValue=S%32,m.advance(),!0):!1};function En(m){return m>=65&&m<=90||m>=97&&m<=122}Ht.regexp_eatRegExpUnicodeEscapeSequence=function(m,S){S===void 0&&(S=!1);var j=m.pos,O=S||m.switchU;if(m.eat(117)){if(this.regexp_eatFixedHexDigits(m,4)){var ue=m.lastIntValue;if(O&&ue>=55296&&ue<=56319){var Ie=m.pos;if(m.eat(92)&&m.eat(117)&&this.regexp_eatFixedHexDigits(m,4)){var st=m.lastIntValue;if(st>=56320&&st<=57343)return m.lastIntValue=(ue-55296)*1024+(st-56320)+65536,!0}m.pos=Ie,m.lastIntValue=ue}return!0}if(O&&m.eat(123)&&this.regexp_eatHexDigits(m)&&m.eat(125)&&on(m.lastIntValue))return!0;O&&m.raise("Invalid unicode escape"),m.pos=j}return!1};function on(m){return m>=0&&m<=1114111}Ht.regexp_eatIdentityEscape=function(m){if(m.switchU)return this.regexp_eatSyntaxCharacter(m)?!0:m.eat(47)?(m.lastIntValue=47,!0):!1;var S=m.current();return S!==99&&(!m.switchN||S!==107)?(m.lastIntValue=S,m.advance(),!0):!1},Ht.regexp_eatDecimalEscape=function(m){m.lastIntValue=0;var S=m.current();if(S>=49&&S<=57){do m.lastIntValue=10*m.lastIntValue+(S-48),m.advance();while((S=m.current())>=48&&S<=57);return!0}return!1},Ht.regexp_eatCharacterClassEscape=function(m){var S=m.current();if(ln(S))return m.lastIntValue=-1,m.advance(),!0;if(m.switchU&&this.options.ecmaVersion>=9&&(S===80||S===112)){if(m.lastIntValue=-1,m.advance(),m.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(m)&&m.eat(125))return!0;m.raise("Invalid property name")}return!1};function ln(m){return m===100||m===68||m===115||m===83||m===119||m===87}Ht.regexp_eatUnicodePropertyValueExpression=function(m){var S=m.pos;if(this.regexp_eatUnicodePropertyName(m)&&m.eat(61)){var j=m.lastStringValue;if(this.regexp_eatUnicodePropertyValue(m)){var O=m.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(m,j,O),!0}}if(m.pos=S,this.regexp_eatLoneUnicodePropertyNameOrValue(m)){var ue=m.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(m,ue),!0}return!1},Ht.regexp_validateUnicodePropertyNameAndValue=function(m,S,j){zr(m.unicodeProperties.nonBinary,S)||m.raise("Invalid property name"),m.unicodeProperties.nonBinary[S].test(j)||m.raise("Invalid property value")},Ht.regexp_validateUnicodePropertyNameOrValue=function(m,S){m.unicodeProperties.binary.test(S)||m.raise("Invalid property name")},Ht.regexp_eatUnicodePropertyName=function(m){var S=0;for(m.lastStringValue="";Ai(S=m.current());)m.lastStringValue+=Rr(S),m.advance();return m.lastStringValue!==""};function Ai(m){return En(m)||m===95}Ht.regexp_eatUnicodePropertyValue=function(m){var S=0;for(m.lastStringValue="";bn(S=m.current());)m.lastStringValue+=Rr(S),m.advance();return m.lastStringValue!==""};function bn(m){return Ai(m)||Li(m)}Ht.regexp_eatLoneUnicodePropertyNameOrValue=function(m){return this.regexp_eatUnicodePropertyValue(m)},Ht.regexp_eatCharacterClass=function(m){if(m.eat(91)){if(m.eat(94),this.regexp_classRanges(m),m.eat(93))return!0;m.raise("Unterminated character class")}return!1},Ht.regexp_classRanges=function(m){for(;this.regexp_eatClassAtom(m);){var S=m.lastIntValue;if(m.eat(45)&&this.regexp_eatClassAtom(m)){var j=m.lastIntValue;m.switchU&&(S===-1||j===-1)&&m.raise("Invalid character class"),S!==-1&&j!==-1&&S>j&&m.raise("Range out of order in character class")}}},Ht.regexp_eatClassAtom=function(m){var S=m.pos;if(m.eat(92)){if(this.regexp_eatClassEscape(m))return!0;if(m.switchU){var j=m.current();(j===99||Ki(j))&&m.raise("Invalid class escape"),m.raise("Invalid escape")}m.pos=S}var O=m.current();return O!==93?(m.lastIntValue=O,m.advance(),!0):!1},Ht.regexp_eatClassEscape=function(m){var S=m.pos;if(m.eat(98))return m.lastIntValue=8,!0;if(m.switchU&&m.eat(45))return m.lastIntValue=45,!0;if(!m.switchU&&m.eat(99)){if(this.regexp_eatClassControlLetter(m))return!0;m.pos=S}return this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)},Ht.regexp_eatClassControlLetter=function(m){var S=m.current();return Li(S)||S===95?(m.lastIntValue=S%32,m.advance(),!0):!1},Ht.regexp_eatHexEscapeSequence=function(m){var S=m.pos;if(m.eat(120)){if(this.regexp_eatFixedHexDigits(m,2))return!0;m.switchU&&m.raise("Invalid escape"),m.pos=S}return!1},Ht.regexp_eatDecimalDigits=function(m){var S=m.pos,j=0;for(m.lastIntValue=0;Li(j=m.current());)m.lastIntValue=10*m.lastIntValue+(j-48),m.advance();return m.pos!==S};function Li(m){return m>=48&&m<=57}Ht.regexp_eatHexDigits=function(m){var S=m.pos,j=0;for(m.lastIntValue=0;Yi(j=m.current());)m.lastIntValue=16*m.lastIntValue+si(j),m.advance();return m.pos!==S};function Yi(m){return m>=48&&m<=57||m>=65&&m<=70||m>=97&&m<=102}function si(m){return m>=65&&m<=70?10+(m-65):m>=97&&m<=102?10+(m-97):m-48}Ht.regexp_eatLegacyOctalEscapeSequence=function(m){if(this.regexp_eatOctalDigit(m)){var S=m.lastIntValue;if(this.regexp_eatOctalDigit(m)){var j=m.lastIntValue;S<=3&&this.regexp_eatOctalDigit(m)?m.lastIntValue=S*64+j*8+m.lastIntValue:m.lastIntValue=S*8+j}else m.lastIntValue=S;return!0}return!1},Ht.regexp_eatOctalDigit=function(m){var S=m.current();return Ki(S)?(m.lastIntValue=S-48,m.advance(),!0):(m.lastIntValue=0,!1)};function Ki(m){return m>=48&&m<=55}Ht.regexp_eatFixedHexDigits=function(m,S){var j=m.pos;m.lastIntValue=0;for(var O=0;O<S;++O){var ue=m.current();if(!Yi(ue))return m.pos=j,!1;m.lastIntValue=16*m.lastIntValue+si(ue),m.advance()}return!0};var Ni=function(S){this.type=S.type,this.value=S.value,this.start=S.start,this.end=S.end,S.options.locations&&(this.loc=new _t(S,S.startLoc,S.endLoc)),S.options.ranges&&(this.range=[S.start,S.end])},Ti=St.prototype;Ti.next=function(m){!m&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ni(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ti.getToken=function(){return this.next(),new Ni(this)},typeof Symbol!="undefined"&&(Ti[Symbol.iterator]=function(){var m=this;return{next:function(){var S=m.getToken();return{done:S.type===ee.eof,value:S}}}}),Ti.curContext=function(){return this.context[this.context.length-1]},Ti.nextToken=function(){var m=this.curContext();if((!m||!m.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(ee.eof);if(m.override)return m.override(this);this.readToken(this.fullCharCodeAtPos())},Ti.readToken=function(m){return et(m,this.options.ecmaVersion>=6)||m===92?this.readWord():this.getTokenFromCode(m)},Ti.fullCharCodeAtPos=function(){var m=this.input.charCodeAt(this.pos);if(m<=55295||m>=57344)return m;var S=this.input.charCodeAt(this.pos+1);return(m<<10)+S-56613888},Ti.skipBlockComment=function(){var m=this.options.onComment&&this.curPosition(),S=this.pos,j=this.input.indexOf("*/",this.pos+=2);if(j===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=j+2,this.options.locations){Ct.lastIndex=S;for(var O;(O=Ct.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(S+2,j),S,this.pos,m,this.curPosition())},Ti.skipLineComment=function(m){for(var S=this.pos,j=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=m);this.pos<this.input.length&&!Ke(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(S+m,this.pos),S,this.pos,j,this.curPosition())},Ti.skipSpace=function(){e:for(;this.pos<this.input.length;){var m=this.input.charCodeAt(this.pos);switch(m){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(m>8&&m<14||m>=5760&&Rt.test(String.fromCharCode(m)))++this.pos;else break e}}},Ti.finishToken=function(m,S){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var j=this.type;this.type=m,this.value=S,this.updateContext(j)},Ti.readToken_dot=function(){var m=this.input.charCodeAt(this.pos+1);if(m>=48&&m<=57)return this.readNumber(!0);var S=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&m===46&&S===46?(this.pos+=3,this.finishToken(ee.ellipsis)):(++this.pos,this.finishToken(ee.dot))},Ti.readToken_slash=function(){var m=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):m===61?this.finishOp(ee.assign,2):this.finishOp(ee.slash,1)},Ti.readToken_mult_modulo_exp=function(m){var S=this.input.charCodeAt(this.pos+1),j=1,O=m===42?ee.star:ee.modulo;return this.options.ecmaVersion>=7&&m===42&&S===42&&(++j,O=ee.starstar,S=this.input.charCodeAt(this.pos+2)),S===61?this.finishOp(ee.assign,j+1):this.finishOp(O,j)},Ti.readToken_pipe_amp=function(m){var S=this.input.charCodeAt(this.pos+1);if(S===m){if(this.options.ecmaVersion>=12){var j=this.input.charCodeAt(this.pos+2);if(j===61)return this.finishOp(ee.assign,3)}return this.finishOp(m===124?ee.logicalOR:ee.logicalAND,2)}return S===61?this.finishOp(ee.assign,2):this.finishOp(m===124?ee.bitwiseOR:ee.bitwiseAND,1)},Ti.readToken_caret=function(){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(ee.assign,2):this.finishOp(ee.bitwiseXOR,1)},Ti.readToken_plus_min=function(m){var S=this.input.charCodeAt(this.pos+1);return S===m?S===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||vr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(ee.incDec,2):S===61?this.finishOp(ee.assign,2):this.finishOp(ee.plusMin,1)},Ti.readToken_lt_gt=function(m){var S=this.input.charCodeAt(this.pos+1),j=1;return S===m?(j=m===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+j)===61?this.finishOp(ee.assign,j+1):this.finishOp(ee.bitShift,j)):S===33&&m===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(S===61&&(j=2),this.finishOp(ee.relational,j))},Ti.readToken_eq_excl=function(m){var S=this.input.charCodeAt(this.pos+1);return S===61?this.finishOp(ee.equality,this.input.charCodeAt(this.pos+2)===61?3:2):m===61&&S===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(ee.arrow)):this.finishOp(m===61?ee.eq:ee.prefix,1)},Ti.readToken_question=function(){var m=this.options.ecmaVersion;if(m>=11){var S=this.input.charCodeAt(this.pos+1);if(S===46){var j=this.input.charCodeAt(this.pos+2);if(j<48||j>57)return this.finishOp(ee.questionDot,2)}if(S===63){if(m>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(ee.assign,3)}return this.finishOp(ee.coalesce,2)}}return this.finishOp(ee.question,1)},Ti.getTokenFromCode=function(m){switch(m){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(ee.parenL);case 41:return++this.pos,this.finishToken(ee.parenR);case 59:return++this.pos,this.finishToken(ee.semi);case 44:return++this.pos,this.finishToken(ee.comma);case 91:return++this.pos,this.finishToken(ee.bracketL);case 93:return++this.pos,this.finishToken(ee.bracketR);case 123:return++this.pos,this.finishToken(ee.braceL);case 125:return++this.pos,this.finishToken(ee.braceR);case 58:return++this.pos,this.finishToken(ee.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(ee.backQuote);case 48:var S=this.input.charCodeAt(this.pos+1);if(S===120||S===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(S===111||S===79)return this.readRadixNumber(8);if(S===98||S===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(m);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(m);case 124:case 38:return this.readToken_pipe_amp(m);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(m);case 60:case 62:return this.readToken_lt_gt(m);case 61:case 33:return this.readToken_eq_excl(m);case 63:return this.readToken_question();case 126:return this.finishOp(ee.prefix,1)}this.raise(this.pos,"Unexpected character '"+oi(m)+"'")},Ti.finishOp=function(m,S){var j=this.input.slice(this.pos,this.pos+S);return this.pos+=S,this.finishToken(m,j)},Ti.readRegexp=function(){for(var m,S,j=this.pos;;){this.pos>=this.input.length&&this.raise(j,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(vr.test(O)&&this.raise(j,"Unterminated regular expression"),m)m=!1;else{if(O==="[")S=!0;else if(O==="]"&&S)S=!1;else if(O==="/"&&!S)break;m=O==="\\"}++this.pos}var ue=this.input.slice(j,this.pos);++this.pos;var Ie=this.pos,st=this.readWord1();this.containsEsc&&this.unexpected(Ie);var Lt=this.regexpState||(this.regexpState=new Jt(this));Lt.reset(j,ue,st),this.validateRegExpFlags(Lt),this.validateRegExpPattern(Lt);var It=null;try{It=new RegExp(ue,st)}catch(wr){}return this.finishToken(ee.regexp,{pattern:ue,flags:st,value:It})},Ti.readInt=function(m,S,j){for(var O=this.options.ecmaVersion>=12&&S===void 0,ue=j&&this.input.charCodeAt(this.pos)===48,Ie=this.pos,st=0,Lt=0,It=0,wr=S==null?Infinity:S;It<wr;++It,++this.pos){var jr=this.input.charCodeAt(this.pos),Qn=void 0;if(O&&jr===95){ue&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Lt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),It===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Lt=jr;continue}if(jr>=97?Qn=jr-97+10:jr>=65?Qn=jr-65+10:jr>=48&&jr<=57?Qn=jr-48:Qn=Infinity,Qn>=m)break;Lt=jr,st=st*m+Qn}return O&&Lt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Ie||S!=null&&this.pos-Ie!==S?null:st};function ca(m,S){return S?parseInt(m,8):parseFloat(m.replace(/_/g,""))}function Sa(m){return typeof BigInt!="function"?null:BigInt(m.replace(/_/g,""))}Ti.readRadixNumber=function(m){var S=this.pos;this.pos+=2;var j=this.readInt(m);return j==null&&this.raise(this.start+2,"Expected number in radix "+m),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(j=Sa(this.input.slice(S,this.pos)),++this.pos):et(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ee.num,j)},Ti.readNumber=function(m){var S=this.pos;!m&&this.readInt(10,void 0,!0)===null&&this.raise(S,"Invalid number");var j=this.pos-S>=2&&this.input.charCodeAt(S)===48;j&&this.strict&&this.raise(S,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!j&&!m&&this.options.ecmaVersion>=11&&O===110){var ue=Sa(this.input.slice(S,this.pos));return++this.pos,et(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ee.num,ue)}j&&/[89]/.test(this.input.slice(S,this.pos))&&(j=!1),O===46&&!j&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!j&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(S,"Invalid number")),et(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Ie=ca(this.input.slice(S,this.pos),j);return this.finishToken(ee.num,Ie)},Ti.readCodePoint=function(){var m=this.input.charCodeAt(this.pos),S;if(m===123){this.options.ecmaVersion<6&&this.unexpected();var j=++this.pos;S=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,S>1114111&&this.invalidStringToken(j,"Code point out of bounds")}else S=this.readHexChar(4);return S};function oi(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Ti.readString=function(m){for(var S="",j=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===m)break;O===92?(S+=this.input.slice(j,this.pos),S+=this.readEscapedChar(!1),j=this.pos):(Ke(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return S+=this.input.slice(j,this.pos++),this.finishToken(ee.string,S)};var ri={};Ti.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(m){if(m===ri)this.readInvalidTemplateToken();else throw m}this.inTemplateElement=!1},Ti.invalidStringToken=function(m,S){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw ri;this.raise(m,S)},Ti.readTmplToken=function(){for(var m="",S=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var j=this.input.charCodeAt(this.pos);if(j===96||j===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===ee.template||this.type===ee.invalidTemplate)?j===36?(this.pos+=2,this.finishToken(ee.dollarBraceL)):(++this.pos,this.finishToken(ee.backQuote)):(m+=this.input.slice(S,this.pos),this.finishToken(ee.template,m));if(j===92)m+=this.input.slice(S,this.pos),m+=this.readEscapedChar(!0),S=this.pos;else if(Ke(j)){switch(m+=this.input.slice(S,this.pos),++this.pos,j){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:m+=`
`;break;default:m+=String.fromCharCode(j);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),S=this.pos}else++this.pos}},Ti.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(ee.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Ti.readEscapedChar=function(m){var S=this.input.charCodeAt(++this.pos);switch(++this.pos,S){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return oi(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(m){var j=this.pos-1;return this.invalidStringToken(j,"Invalid escape sequence in template string"),null}default:if(S>=48&&S<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],ue=parseInt(O,8);return ue>255&&(O=O.slice(0,-1),ue=parseInt(O,8)),this.pos+=O.length-1,S=this.input.charCodeAt(this.pos),(O!=="0"||S===56||S===57)&&(this.strict||m)&&this.invalidStringToken(this.pos-1-O.length,m?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(ue)}return Ke(S)?"":String.fromCharCode(S)}},Ti.readHexChar=function(m){var S=this.pos,j=this.readInt(16,m);return j===null&&this.invalidStringToken(S,"Bad character escape sequence"),j},Ti.readWord1=function(){this.containsEsc=!1;for(var m="",S=!0,j=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var ue=this.fullCharCodeAtPos();if(Yt(ue,O))this.pos+=ue<=65535?1:2;else if(ue===92){this.containsEsc=!0,m+=this.input.slice(j,this.pos);var Ie=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var st=this.readCodePoint();(S?et:Yt)(st,O)||this.invalidStringToken(Ie,"Invalid Unicode escape"),m+=oi(st),j=this.pos}else break;S=!1}return m+this.input.slice(j,this.pos)},Ti.readWord=function(){var m=this.readWord1(),S=ee.name;return this.keywords.test(m)&&(S=xt[m]),this.finishToken(S,m)};var Gi="7.4.1";St.acorn={Parser:St,version:Gi,defaultOptions:Nt,Position:ye,SourceLocation:_t,getLineInfo:ft,Node:Zn,TokenType:Gt,tokTypes:ee,keywordTypes:xt,TokContext:Ji,tokContexts:Di,isIdentifierChar:Yt,isIdentifierStart:et,Token:Ni,isNewLine:Ke,lineBreak:vr,lineBreakG:Ct,nonASCIIwhitespace:Rt};function pa(m,S){return St.parse(m,S)}function Ho(m,S,j){return St.parseExpressionAt(m,S,j)}function ya(m,S){return St.tokenizer(m,S)}function yi(m,S){m.prototype=Object.create(S.prototype),m.prototype.constructor=m,m.__proto__=S}function ga(m){var S=typeof Map=="function"?new Map:void 0;return ga=function(O){if(O===null||!Ao(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof S!="undefined"){if(S.has(O))return S.get(O);S.set(O,ue)}function ue(){return Ea(O,arguments,Ya(this).constructor)}return ue.prototype=Object.create(O.prototype,{constructor:{value:ue,enumerable:!1,writable:!0,configurable:!0}}),Xa(ue,O)},ga(m)}function Ws(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Ea(m,S,j){return Ws()?Ea=Reflect.construct:Ea=function(ue,Ie,st){var Lt=[null];Lt.push.apply(Lt,Ie);var It=Function.bind.apply(ue,Lt),wr=new It;return st&&Xa(wr,st.prototype),wr},Ea.apply(null,arguments)}function Ao(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function Xa(m,S){return Xa=Object.setPrototypeOf||function(O,ue){return O.__proto__=ue,O},Xa(m,S)}function Ya(m){return Ya=Object.setPrototypeOf?Object.getPrototypeOf:function(j){return j.__proto__||Object.getPrototypeOf(j)},Ya(m)}var Wo=function(m){yi(S,m);function S(){return m.apply(this,arguments)||this}return S}(ga(Error)),Ui=function(m){yi(S,m);function S(){return m.apply(this,arguments)||this}return S}(ga(SyntaxError)),To=function(m){yi(S,m);function S(){return m.apply(this,arguments)||this}return S}(ga(ReferenceError)),Lo=function(m){yi(S,m);function S(){return m.apply(this,arguments)||this}return S}(ga(TypeError)),lo=function(m){yi(S,m);function S(){return m.apply(this,arguments)||this}return S}(Wo),Ro=function(m){yi(S,m);function S(){return m.apply(this,arguments)||this}return S}(Ui),Hi=function(m){yi(S,m);function S(){return m.apply(this,arguments)||this}return S}(To),Ra={UnknownError:[3001,"%0",lo],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",lo],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Hi],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Hi],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Hi],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Hi],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Hi],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Hi],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Hi],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Hi],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Hi],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Hi],FunctionUndefinedReferenceError:[2001,"%0 is not a function",To],VariableUndefinedReferenceError:[2002,"%0 is not defined",To],IsNotConstructor:[2003,"%0 is not a constructor",Lo]};function Fa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function ms(m,S,j){return Fa()?ms=Reflect.construct:ms=function(ue,Ie,st){var Lt=[null];Lt.push.apply(Lt,Ie);var It=Function.bind.apply(ue,Lt),wr=new It;return st&&_a(wr,st.prototype),wr},ms.apply(null,arguments)}function _a(m,S){return _a=Object.setPrototypeOf||function(O,ue){return O.__proto__=ue,O},_a(m,S)}var xe="0.0.2";function ke(m,S){Object.defineProperty(m,"name",{value:S,writable:!1,enumerable:!1,configurable:!0})}var ut=Object.prototype.hasOwnProperty,Xt=Symbol("Break"),Xr=Symbol("Continue"),Kn=Symbol("DefaultCase"),gi=Symbol("EmptyStatementReturn"),io=Symbol("WithScopeName"),Ka=Symbol("SuperScopeName"),co=Symbol("RootScopeName"),Xo=Symbol("GlobalScopeName");function Xs(m){return typeof m=="function"}var ys=function(){function m(j){this.interpreter=j}var S=m.prototype;return S.generator=function(){var O=this.interpreter;function ue(){return this.getCurrentScope()}function Ie(){return this.getGlobalScope()}function st(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:ue.bind(O),getGlobalScope:Ie.bind(O),getCurrentContext:st.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},m}();function mo(m,S,j){if(j===void 0&&(j=!0),!(m instanceof ys))throw new Error("Illegal call");if(typeof S!="string")return S;if(!!S){var O=m.generator(),ue=O.getOptions(),Ie={timeout:ue.timeout,_initEnv:function(){j||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},st=j?O.getGlobalScope():O.getCurrentScope(),Lt=new Po(st,Ie);return Lt.evaluate(S)}}Object.defineProperty(mo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function ls(m){if(!(m instanceof ys))throw new Error("Illegal call");for(var S=m.generator(),j=arguments.length,O=new Array(j>1?j-1:0),ue=1;ue<j;ue++)O[ue-1]=arguments[ue];var Ie=O.pop(),st=new Po(S.getGlobalScope(),S.getOptions()),Lt=`
		    (function anonymous(`+O.join(",")+`){
		        `+Ie+`
		    });
		    `;return st.evaluate(Lt)}Object.defineProperty(ls,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var No=function(S){this.value=S},Yo=function(S){this.value=S},_o=function(S){this.value=S},Ei=function(S,j,O){j===void 0&&(j=null),this.name=O,this.parent=j,this.data=S,this.labelStack=[]};function Cs(){}function As(m,S){return m===void 0&&(m=null),new Ei(Object.create(null),m,S)}function gs(m){return Object.create(m)}var Aa={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:mo,Function:ls};typeof JSON!="undefined"&&(Aa.JSON=JSON),typeof Promise!="undefined"&&(Aa.Promise=Promise),typeof Set!="undefined"&&(Aa.Set=Set),typeof Map!="undefined"&&(Aa.Map=Map),typeof Symbol!="undefined"&&(Aa.Symbol=Symbol),typeof Proxy!="undefined"&&(Aa.Proxy=Proxy),typeof WeakMap!="undefined"&&(Aa.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Aa.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Aa.Reflect=Reflect);var Po=function(){function m(j,O){j===void 0&&(j=m.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||m.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?m.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=j||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var S=m.prototype;return S.initEnvironment=function(O){var ue;if(O instanceof Ei)ue=O;else{var Ie=null,st=this.createSuperScope(O);this.options.rootContext&&(Ie=new Ei(gs(this.options.rootContext),st,co)),ue=new Ei(O,Ie||st,Xo)}this.globalScope=ue,this.currentScope=this.globalScope,this.globalContext=ue.data,this.currentContext=ue.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Lt=this.options._initEnv;Lt&&Lt.call(this)},S.getExecStartTime=function(){return this.execStartTime},S.getExecutionTime=function(){return this.execEndTime-this.execStartTime},S.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},S.getOptions=function(){return this.options},S.getGlobalScope=function(){return this.globalScope},S.getCurrentScope=function(){return this.currentScope},S.getCurrentContext=function(){return this.currentContext},S.isInterruptThrow=function(O){return O instanceof lo||O instanceof Hi||O instanceof Ro},S.createSuperScope=function(O){var ue=Object.assign({},Aa),Ie=Object.keys(ue);return Ie.forEach(function(st){st in O&&delete ue[st]}),new Ei(ue,null,Ka)},S.setCurrentContext=function(O){this.currentContext=O},S.setCurrentScope=function(O){this.currentScope=O},S.evaluate=function(O){O===void 0&&(O="");var ue;if(!!O)return ue=pa(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||m.ecmaVersion}),this.evaluateNode(ue,O)},S.appendCode=function(O){return this.evaluate(O)},S.evaluateNode=function(O,ue){var Ie=this;ue===void 0&&(ue=""),this.value=void 0,this.source=ue,this.sourceList.push(ue),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var st=this.getCurrentScope(),Lt=this.getCurrentContext(),It=st.labelStack.concat([]),wr=this.callStack.concat([]),jr=function(){Ie.setCurrentScope(st),Ie.setCurrentContext(Lt),st.labelStack=It,Ie.callStack=wr};try{var Qn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Qn()}catch(Mi){throw Mi}finally{jr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},S.createErrorMessage=function(O,ue,Ie){var st=O[1].replace("%0",String(ue));return Ie!==null&&(st+=this.getNodePosition(Ie||this.lastExecNode)),st},S.createError=function(O,ue){return new ue(O)},S.createThrowError=function(O,ue){return this.createError(O,ue)},S.createInternalThrowError=function(O,ue,Ie){return this.createError(this.createErrorMessage(O,ue,Ie),O[2])},S.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,ue=Date.now();return ue-this.execStartTime>O},S.getNodePosition=function(O){if(O){var ue="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+ue:""}return""},S.createClosure=function(O){var ue=this,Ie;switch(O.type){case"BinaryExpression":Ie=this.binaryExpressionHandler(O);break;case"LogicalExpression":Ie=this.logicalExpressionHandler(O);break;case"UnaryExpression":Ie=this.unaryExpressionHandler(O);break;case"UpdateExpression":Ie=this.updateExpressionHandler(O);break;case"ObjectExpression":Ie=this.objectExpressionHandler(O);break;case"ArrayExpression":Ie=this.arrayExpressionHandler(O);break;case"CallExpression":Ie=this.callExpressionHandler(O);break;case"NewExpression":Ie=this.newExpressionHandler(O);break;case"MemberExpression":Ie=this.memberExpressionHandler(O);break;case"ThisExpression":Ie=this.thisExpressionHandler(O);break;case"SequenceExpression":Ie=this.sequenceExpressionHandler(O);break;case"Literal":Ie=this.literalHandler(O);break;case"Identifier":Ie=this.identifierHandler(O);break;case"AssignmentExpression":Ie=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":Ie=this.functionDeclarationHandler(O);break;case"VariableDeclaration":Ie=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":Ie=this.programHandler(O);break;case"ExpressionStatement":Ie=this.expressionStatementHandler(O);break;case"EmptyStatement":Ie=this.emptyStatementHandler(O);break;case"ReturnStatement":Ie=this.returnStatementHandler(O);break;case"FunctionExpression":Ie=this.functionExpressionHandler(O);break;case"IfStatement":Ie=this.ifStatementHandler(O);break;case"ConditionalExpression":Ie=this.conditionalExpressionHandler(O);break;case"ForStatement":Ie=this.forStatementHandler(O);break;case"WhileStatement":Ie=this.whileStatementHandler(O);break;case"DoWhileStatement":Ie=this.doWhileStatementHandler(O);break;case"ForInStatement":Ie=this.forInStatementHandler(O);break;case"WithStatement":Ie=this.withStatementHandler(O);break;case"ThrowStatement":Ie=this.throwStatementHandler(O);break;case"TryStatement":Ie=this.tryStatementHandler(O);break;case"ContinueStatement":Ie=this.continueStatementHandler(O);break;case"BreakStatement":Ie=this.breakStatementHandler(O);break;case"SwitchStatement":Ie=this.switchStatementHandler(O);break;case"LabeledStatement":Ie=this.labeledStatementHandler(O);break;case"DebuggerStatement":Ie=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(Ra.NodeTypeSyntaxError,O.type,O)}return function(){var st=ue.options.timeout;if(st&&st>0&&ue.checkTimeout())throw ue.createInternalThrowError(Ra.ExecutionTimeOutError,st,null);return ue.lastExecNode=O,Ie.apply(void 0,arguments)}},S.binaryExpressionHandler=function(O){var ue=this,Ie=this.createClosure(O.left),st=this.createClosure(O.right);return function(){var Lt=Ie(),It=st();switch(O.operator){case"==":return Lt==It;case"!=":return Lt!=It;case"===":return Lt===It;case"!==":return Lt!==It;case"<":return Lt<It;case"<=":return Lt<=It;case">":return Lt>It;case">=":return Lt>=It;case"<<":return Lt<<It;case">>":return Lt>>It;case">>>":return Lt>>>It;case"+":return Lt+It;case"-":return Lt-It;case"*":return Lt*It;case"**":return Math.pow(Lt,It);case"/":return Lt/It;case"%":return Lt%It;case"|":return Lt|It;case"^":return Lt^It;case"&":return Lt&It;case"in":return Lt in It;case"instanceof":return Lt instanceof It;default:throw ue.createInternalThrowError(Ra.BinaryOperatorSyntaxError,O.operator,O)}}},S.logicalExpressionHandler=function(O){var ue=this,Ie=this.createClosure(O.left),st=this.createClosure(O.right);return function(){switch(O.operator){case"||":return Ie()||st();case"&&":return Ie()&&st();default:throw ue.createInternalThrowError(Ra.LogicalOperatorSyntaxError,O.operator,O)}}},S.unaryExpressionHandler=function(O){var ue=this;switch(O.operator){case"delete":var Ie=this.createObjectGetter(O.argument),st=this.createNameGetter(O.argument);return function(){var jr=Ie(),Qn=st();return delete jr[Qn]};default:var Lt;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var It=this.createObjectGetter(O.argument),wr=this.createNameGetter(O.argument);Lt=function(){return It()[wr()]}}else Lt=this.createClosure(O.argument);return function(){var jr=Lt();switch(O.operator){case"-":return-jr;case"+":return+jr;case"!":return!jr;case"~":return~jr;case"void":return;case"typeof":return typeof jr;default:throw ue.createInternalThrowError(Ra.UnaryOperatorSyntaxError,O.operator,O)}}}},S.updateExpressionHandler=function(O){var ue=this,Ie=this.createObjectGetter(O.argument),st=this.createNameGetter(O.argument);return function(){var Lt=Ie(),It=st();switch(ue.assertVariable(Lt,It,O),O.operator){case"++":return O.prefix?++Lt[It]:Lt[It]++;case"--":return O.prefix?--Lt[It]:Lt[It]--;default:throw ue.createInternalThrowError(Ra.UpdateOperatorSyntaxError,O.operator,O)}}},S.objectExpressionHandler=function(O){var ue=this,Ie=[];function st(It){return It.type==="Identifier"?It.name:It.type==="Literal"?It.value:this.throwError(Ra.ObjectStructureSyntaxError,It.type,It)}var Lt=Object.create(null);return O.properties.forEach(function(It){var wr=It.kind,jr=st(It.key);(!Lt[jr]||wr==="init")&&(Lt[jr]={}),Lt[jr][wr]=ue.createClosure(It.value),Ie.push({key:jr,property:It})}),function(){for(var It={},wr=Ie.length,jr=0;jr<wr;jr++){var Qn=Ie[jr],Mi=Qn.key,fi=Lt[Mi],qn=fi.init?fi.init():void 0,wa=fi.get?fi.get():function(){},ka=fi.set?fi.set():function(Ts){};if("set"in fi||"get"in fi){var Qi={configurable:!0,enumerable:!0,get:wa,set:ka};Object.defineProperty(It,Mi,Qi)}else{var cs=Qn.property,xo=cs.kind;cs.key.type==="Identifier"&&cs.value.type==="FunctionExpression"&&xo==="init"&&!cs.value.id&&ke(qn,cs.key.name),It[Mi]=qn}}return It}},S.arrayExpressionHandler=function(O){var ue=this,Ie=O.elements.map(function(st){return st&&ue.createClosure(st)});return function(){for(var st=Ie.length,Lt=Array(st),It=0;It<st;It++){var wr=Ie[It];wr&&(Lt[It]=wr())}return Lt}},S.safeObjectGet=function(O,ue,Ie){return O[ue]},S.createCallFunctionGetter=function(O){var ue=this;switch(O.type){case"MemberExpression":var Ie=this.createClosure(O.object),st=this.createMemberKeyGetter(O),Lt=this.source;return function(){var wr=Ie(),jr=st(),Qn=ue.safeObjectGet(wr,jr,O);if(!Qn||!Xs(Qn)){var Mi=Lt.slice(O.start,O.end);throw ue.createInternalThrowError(Ra.FunctionUndefinedReferenceError,Mi,O)}return Qn.__IS_EVAL_FUNC?function(fi){return Qn(new ys(ue),fi,!0)}:Qn.__IS_FUNCTION_FUNC?function(){for(var fi=arguments.length,qn=new Array(fi),wa=0;wa<fi;wa++)qn[wa]=arguments[wa];return Qn.apply(void 0,[new ys(ue)].concat(qn))}:Qn.bind(wr)};default:var It=this.createClosure(O);return function(){var wr="";O.type==="Identifier"&&(wr=O.name);var jr=It();if(!jr||!Xs(jr))throw ue.createInternalThrowError(Ra.FunctionUndefinedReferenceError,wr,O);if(O.type==="Identifier"&&jr.__IS_EVAL_FUNC&&wr==="eval")return function(fi){var qn=ue.getScopeFromName(wr,ue.getCurrentScope()),wa=qn.name===Ka||qn.name===Xo||qn.name===co;return jr(new ys(ue),fi,!wa)};if(jr.__IS_EVAL_FUNC)return function(fi){return jr(new ys(ue),fi,!0)};if(jr.__IS_FUNCTION_FUNC)return function(){for(var fi=arguments.length,qn=new Array(fi),wa=0;wa<fi;wa++)qn[wa]=arguments[wa];return jr.apply(void 0,[new ys(ue)].concat(qn))};var Qn=ue.options.globalContextInFunction;if(O.type==="Identifier"){var Mi=ue.getIdentifierScope(O);Mi.name===io&&(Qn=Mi.data)}return jr.bind(Qn)}}},S.callExpressionHandler=function(O){var ue=this,Ie=this.createCallFunctionGetter(O.callee),st=O.arguments.map(function(Lt){return ue.createClosure(Lt)});return function(){return Ie().apply(void 0,st.map(function(Lt){return Lt()}))}},S.functionExpressionHandler=function(O){var ue=this,Ie=this,st=this.source,Lt=this.collectDeclVars,It=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var wr=O.id?O.id.name:"",jr=O.params.length,Qn=O.params.map(function(wa){return ue.createParamNameGetter(wa)}),Mi=this.createClosure(O.body),fi=this.collectDeclVars,qn=this.collectDeclFuncs;return this.collectDeclVars=Lt,this.collectDeclFuncs=It,function(){var wa=Ie.getCurrentScope(),ka=function Qi(){for(var cs=arguments.length,xo=new Array(cs),Ts=0;Ts<cs;Ts++)xo[Ts]=arguments[Ts];Ie.callStack.push(""+wr);var au=Ie.getCurrentScope(),Bs=As(wa,"FunctionScope("+wr+")");Ie.setCurrentScope(Bs),Ie.addDeclarationsToScope(fi,qn,Bs),wr&&(Bs.data[wr]=Qi),Bs.data.arguments=arguments,Qn.forEach(function(Ks,$s){Bs.data[Ks()]=xo[$s]});var rl=Ie.getCurrentContext();Ie.setCurrentContext(this);var Ys=Mi();if(Ie.setCurrentContext(rl),Ie.setCurrentScope(au),Ie.callStack.pop(),Ys instanceof No)return Ys.value};return ke(ka,wr),Object.defineProperty(ka,"length",{value:jr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(ka,"toString",{value:function(){return st.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(ka,"valueOf",{value:function(){return st.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),ka}},S.newExpressionHandler=function(O){var ue=this,Ie=this.source,st=this.createClosure(O.callee),Lt=O.arguments.map(function(It){return ue.createClosure(It)});return function(){var It=st();if(!Xs(It)||It.__IS_EVAL_FUNC){var wr=O.callee,jr=Ie.slice(wr.start,wr.end);throw ue.createInternalThrowError(Ra.IsNotConstructor,jr,O)}return It.__IS_FUNCTION_FUNC?It.apply(void 0,[new ys(ue)].concat(Lt.map(function(Qn){return Qn()}))):ms(It,Lt.map(function(Qn){return Qn()}))}},S.memberExpressionHandler=function(O){var ue=this.createClosure(O.object),Ie=this.createMemberKeyGetter(O);return function(){var st=ue(),Lt=Ie();return st[Lt]}},S.thisExpressionHandler=function(O){var ue=this;return function(){return ue.getCurrentContext()}},S.sequenceExpressionHandler=function(O){var ue=this,Ie=O.expressions.map(function(st){return ue.createClosure(st)});return function(){for(var st,Lt=Ie.length,It=0;It<Lt;It++){var wr=Ie[It];st=wr()}return st}},S.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},S.identifierHandler=function(O){var ue=this;return function(){var Ie=ue.getCurrentScope(),st=ue.getScopeDataFromName(O.name,Ie);return ue.assertVariable(st,O.name,O),st[O.name]}},S.getIdentifierScope=function(O){var ue=this.getCurrentScope(),Ie=this.getScopeFromName(O.name,ue);return Ie},S.assignmentExpressionHandler=function(O){var ue=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var Ie=this.createObjectGetter(O.left),st=this.createNameGetter(O.left),Lt=this.createClosure(O.right);return function(){var It=Ie(),wr=st(),jr=Lt();switch(O.operator!=="="&&ue.assertVariable(It,wr,O),O.operator){case"=":return It[wr]=jr;case"+=":return It[wr]+=jr;case"-=":return It[wr]-=jr;case"*=":return It[wr]*=jr;case"**=":return It[wr]=Math.pow(It[wr],jr);case"/=":return It[wr]/=jr;case"%=":return It[wr]%=jr;case"<<=":return It[wr]<<=jr;case">>=":return It[wr]>>=jr;case">>>=":return It[wr]>>>=jr;case"&=":return It[wr]&=jr;case"^=":return It[wr]^=jr;case"|=":return It[wr]|=jr;default:throw ue.createInternalThrowError(Ra.AssignmentExpressionSyntaxError,O.type,O)}}},S.functionDeclarationHandler=function(O){if(O.id){var ue=this.functionExpressionHandler(O);Object.defineProperty(ue,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,ue)}return function(){return gi}},S.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(Ra.VariableTypeSyntaxError,O.type,O)},S.variableDeclarationHandler=function(O){for(var ue=this,Ie,st=[],Lt=0;Lt<O.declarations.length;Lt++){var It=O.declarations[Lt];this.varDeclaration(this.getVariableName(It.id)),It.init&&st.push({type:"AssignmentExpression",operator:"=",left:It.id,right:It.init})}return st.length&&(Ie=this.createClosure({type:"BlockStatement",body:st})),function(){if(Ie){var wr=ue.isVarDeclMode;ue.isVarDeclMode=!0,Ie(),ue.isVarDeclMode=wr}return gi}},S.assertVariable=function(O,ue,Ie){if(O===this.globalScope.data&&!(ue in O))throw this.createInternalThrowError(Ra.VariableUndefinedReferenceError,ue,Ie)},S.programHandler=function(O){var ue=this,Ie=O.body.map(function(st){return ue.createClosure(st)});return function(){for(var st=gi,Lt=0;Lt<Ie.length;Lt++){var It=Ie[Lt],wr=ue.setValue(It());if(wr!==gi&&(st=wr,st instanceof No||st instanceof Yo||st instanceof _o||st===Xt||st===Xr))break}return st}},S.expressionStatementHandler=function(O){return this.createClosure(O.expression)},S.emptyStatementHandler=function(O){return function(){return gi}},S.returnStatementHandler=function(O){var ue=O.argument?this.createClosure(O.argument):Cs;return function(){return new No(ue())}},S.ifStatementHandler=function(O){var ue=this.createClosure(O.test),Ie=this.createClosure(O.consequent),st=O.alternate?this.createClosure(O.alternate):function(){return gi};return function(){return ue()?Ie():st()}},S.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},S.forStatementHandler=function(O){var ue=this,Ie=Cs,st=O.test?this.createClosure(O.test):function(){return!0},Lt=Cs,It=this.createClosure(O.body);return O.type==="ForStatement"&&(Ie=O.init?this.createClosure(O.init):Ie,Lt=O.update?this.createClosure(O.update):Cs),function(wr){var jr,Qn=gi,Mi=O.type==="DoWhileStatement";for(wr&&wr.type==="LabeledStatement"&&(jr=wr.label.name),Ie();Mi||st();Lt()){Mi=!1;var fi=ue.setValue(It());if(!(fi===gi||fi===Xr)){if(fi===Xt)break;if(Qn=fi,Qn instanceof _o&&Qn.value===jr){Qn=gi;continue}if(Qn instanceof No||Qn instanceof Yo||Qn instanceof _o)break}}return Qn}},S.whileStatementHandler=function(O){return this.forStatementHandler(O)},S.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},S.forInStatementHandler=function(O){var ue=this,Ie=O.left,st=this.createClosure(O.right),Lt=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),Ie=O.left.declarations[0].id),function(It){var wr,jr=gi,Qn;It&&It.type==="LabeledStatement"&&(wr=It.label.name);var Mi=st();for(Qn in Mi){ue.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Ie,right:{type:"Literal",value:Qn}})();var fi=ue.setValue(Lt());if(!(fi===gi||fi===Xr)){if(fi===Xt)break;if(jr=fi,jr instanceof _o&&jr.value===wr){jr=gi;continue}if(jr instanceof No||jr instanceof Yo||jr instanceof _o)break}}return jr}},S.withStatementHandler=function(O){var ue=this,Ie=this.createClosure(O.object),st=this.createClosure(O.body);return function(){var Lt=Ie(),It=ue.getCurrentScope(),wr=new Ei(Lt,It,io);ue.setCurrentScope(wr);var jr=ue.setValue(st());return ue.setCurrentScope(It),jr}},S.throwStatementHandler=function(O){var ue=this,Ie=this.createClosure(O.argument);return function(){throw ue.setValue(void 0),Ie()}},S.tryStatementHandler=function(O){var ue=this,Ie=this.createClosure(O.block),st=O.handler?this.catchClauseHandler(O.handler):null,Lt=O.finalizer?this.createClosure(O.finalizer):null;return function(){var It=ue.getCurrentScope(),wr=ue.getCurrentContext(),jr=It.labelStack.concat([]),Qn=ue.callStack.concat([]),Mi=gi,fi,qn,wa=function(){ue.setCurrentScope(It),ue.setCurrentContext(wr),It.labelStack=jr,ue.callStack=Qn};try{Mi=ue.setValue(Ie()),Mi instanceof No&&(fi=Mi)}catch(ka){if(wa(),ue.isInterruptThrow(ka))throw ka;if(st)try{Mi=ue.setValue(st(ka)),Mi instanceof No&&(fi=Mi)}catch(Qi){if(wa(),ue.isInterruptThrow(Qi))throw Qi;qn=Qi}}if(Lt)try{Mi=Lt(),Mi instanceof No&&(fi=Mi)}catch(ka){if(wa(),ue.isInterruptThrow(ka))throw ka;qn=ka}if(qn)throw qn;return fi||Mi}},S.catchClauseHandler=function(O){var ue=this,Ie=this.createParamNameGetter(O.param),st=this.createClosure(O.body);return function(Lt){var It,wr=ue.getCurrentScope(),jr=wr.data,Qn=Ie(),Mi=ut.call(jr,Qn),fi=jr[Qn];return jr[Qn]=Lt,It=st(),Mi?jr[Qn]=fi:delete jr[Qn],It}},S.continueStatementHandler=function(O){return function(){return O.label?new _o(O.label.name):Xr}},S.breakStatementHandler=function(O){return function(){return O.label?new Yo(O.label.name):Xt}},S.switchStatementHandler=function(O){var ue=this,Ie=this.createClosure(O.discriminant),st=O.cases.map(function(Lt){return ue.switchCaseHandler(Lt)});return function(){for(var Lt=Ie(),It=!1,wr,jr,Qn,Mi=0;Mi<st.length;Mi++){var fi=st[Mi](),qn=fi.testClosure();if(qn===Kn){Qn=fi;continue}if(It||qn===Lt){if(It=!0,jr=ue.setValue(fi.bodyClosure()),jr===gi)continue;if(jr===Xt||(wr=jr,wr instanceof No||wr instanceof Yo||wr instanceof _o||wr===Xr))break}}if(!It&&Qn){jr=ue.setValue(Qn.bodyClosure());var wa=jr===gi||jr===Xt||jr===Xr;wa||(wr=jr)}return wr}},S.switchCaseHandler=function(O){var ue=O.test?this.createClosure(O.test):function(){return Kn},Ie=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:ue,bodyClosure:Ie}}},S.labeledStatementHandler=function(O){var ue=this,Ie=O.label.name,st=this.createClosure(O.body);return function(){var Lt,It=ue.getCurrentScope();return It.labelStack.push(Ie),Lt=st(O),Lt instanceof Yo&&Lt.value===Ie&&(Lt=gi),It.labelStack.pop(),Lt}},S.debuggerStatementHandler=function(O){return function(){debugger;return gi}},S.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(Ra.ParamTypeSyntaxError,O.type,O)},S.createObjectKeyGetter=function(O){var ue;return O.type==="Identifier"?ue=function(){return O.name}:ue=this.createClosure(O),function(){return ue()}},S.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},S.createObjectGetter=function(O){var ue=this;switch(O.type){case"Identifier":return function(){return ue.getScopeDataFromName(O.name,ue.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(Ra.AssignmentTypeSyntaxError,O.type,O)}},S.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(Ra.AssignmentTypeSyntaxError,O.type,O)}},S.varDeclaration=function(O){var ue=this.collectDeclVars;ue[O]=void 0},S.funcDeclaration=function(O,ue){var Ie=this.collectDeclFuncs;Ie[O]=ue},S.addDeclarationsToScope=function(O,ue,Ie){var st=Ie.data;for(var Lt in ue){var It=ue[Lt];st[Lt]=It&&It()}for(var wr in O)wr in st||(st[wr]=void 0)},S.getScopeValue=function(O,ue){var Ie=this.getScopeFromName(O,ue);return Ie.data[O]},S.getScopeDataFromName=function(O,ue){return this.getScopeFromName(O,ue).data},S.getScopeFromName=function(O,ue){var Ie=ue;do if(O in Ie.data)return Ie;while(Ie=Ie.parent);return this.globalScope},S.setValue=function(O){var ue=this.callStack.length;return this.isVarDeclMode||ue||O===gi||O===Xt||O===Xr||O instanceof Yo||O instanceof _o||(this.value=O instanceof No?O.value:O),O},S.getValue=function(){return this.value},m}();Po.version=xe,Po.eval=mo,Po.Function=ls,Po.ecmaVersion=5,Po.globalContextInFunction=void 0,Po.global=Object.create(null);function mu(m){return m===void 0&&(m=Object.create(null)),m}function bl(m,S,j){S===void 0&&(S=[]),j===void 0&&(j={});var O=j.parsingContext,ue=j.timeout===void 0?0:j.timeout,Ie=`
    (function anonymous(`+S.join(",")+`){
         `+m+`
    });
    `,st=new Po(O,{ecmaVersion:j.ecmaVersion,timeout:ue,rootContext:j.rootContext,globalContextInFunction:j.globalContextInFunction});return st.evaluate(Ie)}function Zu(m,S,j){var O=new Po(S,j);return O.evaluate(m)}var Vl=Zu,tl=function(){function m(j){this._code=j}var S=m.prototype;return S.runInContext=function(O){return Zu(this._code,O)},S.runInNewContext=function(O){return Zu(this._code,O)},m}(),yu=function(m,S,j){return Zu(m,S,j)};function Ba(){for(var m=arguments.length,S=new Array(m),j=0;j<m;j++)S[j]=arguments[j];var O=S.pop();return bl(O||"",S)}var ju=yu},88307:function(Or,U,E){(function(le,C){Or.exports=C(E(18857))})(this,function(le){"use strict";var C=function(V){return V instanceof Uint8Array||V instanceof Uint16Array||V instanceof Uint32Array||V instanceof Int8Array||V instanceof Int16Array||V instanceof Int32Array||V instanceof Float32Array||V instanceof Float64Array||V instanceof Uint8ClampedArray},p=function(V,Me){for(var $e=Object.keys(Me),ar=0;ar<$e.length;++ar)V[$e[ar]]=Me[$e[ar]];return V},A=`
`;function Q(V){return typeof atob!="undefined"?atob(V):"base64:"+V}function Y(V){var Me=new Error("(regl) "+V);throw console.error(Me),Me}function W(V,Me){V||Y(Me)}function L(V){return V?": "+V:""}function N(V,Me,$e){V in Me||Y("unknown parameter ("+V+")"+L($e)+". possible values: "+Object.keys(Me).join())}function Be(V,Me){C(V)||Y("invalid parameter type"+L(Me)+". must be a typed array")}function Ye(V,Me){switch(Me){case"number":return typeof V=="number";case"object":return typeof V=="object";case"string":return typeof V=="string";case"boolean":return typeof V=="boolean";case"function":return typeof V=="function";case"undefined":return typeof V=="undefined";case"symbol":return typeof V=="symbol"}}function Je(V,Me,$e){Ye(V,Me)||Y("invalid parameter type"+L($e)+". expected "+Me+", got "+typeof V)}function et(V,Me){V>=0&&(V|0)===V||Y("invalid parameter type, ("+V+")"+L(Me)+". must be a nonnegative integer")}function Yt(V,Me,$e){Me.indexOf(V)<0&&Y("invalid value"+L($e)+". must be one of: "+Me)}var Gt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function tr(V){Object.keys(V).forEach(function(Me){Gt.indexOf(Me)<0&&Y('invalid regl constructor argument "'+Me+'". must be one of '+Gt)})}function zt(V,Me){for(V=V+"";V.length<Me;)V=" "+V;return V}function Pt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function xt(V,Me){this.number=V,this.line=Me,this.errors=[]}function yr(V,Me,$e){this.file=V,this.line=Me,this.message=$e}function ee(){var V=new Error,Me=(V.stack||V).toString(),$e=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Me);if($e)return $e[1];var ar=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Me);return ar?ar[1]:"unknown"}function vr(){var V=new Error,Me=(V.stack||V).toString(),$e=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Me);if($e)return $e[1];var ar=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Me);return ar?ar[1]:"unknown"}function Ct(V,Me){var $e=V.split(`
`),ar=1,Mr=0,rr={unknown:new Pt,0:new Pt};rr.unknown.name=rr[0].name=Me||ee(),rr.unknown.lines.push(new xt(0,""));for(var Er=0;Er<$e.length;++Er){var Fr=$e[Er],Gr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Fr);if(Gr)switch(Gr[1]){case"line":var Kr=/(\d+)(\s+\d+)?/.exec(Gr[2]);Kr&&(ar=Kr[1]|0,Kr[2]&&(Mr=Kr[2]|0,Mr in rr||(rr[Mr]=new Pt)));break;case"define":var Qr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Gr[2]);Qr&&(rr[Mr].name=Qr[1]?Q(Qr[2]):Qr[2]);break}rr[Mr].lines.push(new xt(ar++,Fr))}return Object.keys(rr).forEach(function(tn){var pn=rr[tn];pn.lines.forEach(function(Wr){pn.index[Wr.number]=Wr})}),rr}function Ke(V){var Me=[];return V.split(`
`).forEach(function($e){if(!($e.length<5)){var ar=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec($e);ar?Me.push(new yr(ar[1]|0,ar[2]|0,ar[3].trim())):$e.length>0&&Me.push(new yr("unknown",0,$e))}}),Me}function Rt(V,Me){Me.forEach(function($e){var ar=V[$e.file];if(ar){var Mr=ar.index[$e.line];if(Mr){Mr.errors.push($e),ar.hasErrors=!0;return}}V.unknown.hasErrors=!0,V.unknown.lines[0].errors.push($e)})}function Xe(V,Me,$e,ar,Mr){if(!V.getShaderParameter(Me,V.COMPILE_STATUS)){var rr=V.getShaderInfoLog(Me),Er=ar===V.FRAGMENT_SHADER?"fragment":"vertex";ye($e,"string",Er+" shader source must be a string",Mr);var Fr=Ct($e,Mr),Gr=Ke(rr);Rt(Fr,Gr),Object.keys(Fr).forEach(function(Kr){var Qr=Fr[Kr];if(!Qr.hasErrors)return;var tn=[""],pn=[""];function Wr(en,Ot){tn.push(en),pn.push(Ot||"")}Wr("file number "+Kr+": "+Qr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Qr.lines.forEach(function(en){if(en.errors.length>0){Wr(zt(en.number,4)+"|  ","background-color:yellow; font-weight:bold"),Wr(en.line+A,"color:red; background-color:yellow; font-weight:bold");var Ot=0;en.errors.forEach(function(pr){var Yr=pr.message,Cn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Yr);if(Cn){var Ar=Cn[1];switch(Yr=Cn[2],Ar){case"assign":Ar="=";break}Ot=Math.max(en.line.indexOf(Ar,Ot),0)}else Ot=0;Wr(zt("| ",6)),Wr(zt("^^^",Ot+3)+A,"font-weight:bold"),Wr(zt("| ",6)),Wr(Yr+A,"font-weight:bold")}),Wr(zt("| ",6)+A)}else Wr(zt(en.number,4)+"|  "),Wr(en.line+A,"color:red")}),typeof document!="undefined"&&!window.chrome?(pn[0]=tn.join("%c"),console.log.apply(console,pn)):console.log(tn.join(""))}),W.raise("Error compiling "+Er+" shader, "+Fr[0].name)}}function Ut(V,Me,$e,ar,Mr){if(!V.getProgramParameter(Me,V.LINK_STATUS)){var rr=V.getProgramInfoLog(Me),Er=Ct($e,Mr),Fr=Ct(ar,Mr),Gr='Error linking program with vertex shader, "'+Fr[0].name+'", and fragment shader "'+Er[0].name+'"';typeof document!="undefined"?console.log("%c"+Gr+A+"%c"+rr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Gr+A+rr),W.raise(Gr)}}function _r(V){V._commandRef=ee()}function or(V,Me,$e,ar){_r(V);function Mr(Gr){return Gr?ar.id(Gr):0}V._fragId=Mr(V.static.frag),V._vertId=Mr(V.static.vert);function rr(Gr,Kr){Object.keys(Kr).forEach(function(Qr){Gr[ar.id(Qr)]=!0})}var Er=V._uniformSet={};rr(Er,Me.static),rr(Er,Me.dynamic);var Fr=V._attributeSet={};rr(Fr,$e.static),rr(Fr,$e.dynamic),V._hasCount="count"in V.static||"count"in V.dynamic||"elements"in V.static||"elements"in V.dynamic}function zr(V,Me){var $e=vr();Y(V+" in command "+(Me||ee())+($e==="unknown"?"":" called from "+$e))}function he(V,Me,$e){V||zr(Me,$e||ee())}function Re(V,Me,$e,ar){V in Me||zr("unknown parameter ("+V+")"+L($e)+". possible values: "+Object.keys(Me).join(),ar||ee())}function ye(V,Me,$e,ar){Ye(V,Me)||zr("invalid parameter type"+L($e)+". expected "+Me+", got "+typeof V,ar||ee())}function _t(V){V()}function ft(V,Me,$e){V.texture?Yt(V.texture._texture.internalformat,Me,"unsupported texture format for attachment"):Yt(V.renderbuffer._renderbuffer.format,$e,"unsupported renderbuffer format for attachment")}var Nt=33071,Ft=9728,kr=9984,cn=9985,yn=9986,Vi=9987,ir=5120,de=5121,Te=5122,Ue=5123,Le=5124,kt=5125,er=5126,w=32819,Z=32820,Ee=33635,je=34042,Qe=36193,yt={};yt[ir]=yt[de]=1,yt[Te]=yt[Ue]=yt[Qe]=yt[Ee]=yt[w]=yt[Z]=2,yt[Le]=yt[kt]=yt[er]=yt[je]=4;function St(V,Me){return V===Z||V===w||V===Ee?2:V===je?4:yt[V]*Me}function jt(V){return!(V&V-1)&&!!V}function Et(V,Me,$e){var ar,Mr=Me.width,rr=Me.height,Er=Me.channels;W(Mr>0&&Mr<=$e.maxTextureSize&&rr>0&&rr<=$e.maxTextureSize,"invalid texture shape"),(V.wrapS!==Nt||V.wrapT!==Nt)&&W(jt(Mr)&&jt(rr),"incompatible wrap mode for texture, both width and height must be power of 2"),Me.mipmask===1?Mr!==1&&rr!==1&&W(V.minFilter!==kr&&V.minFilter!==yn&&V.minFilter!==cn&&V.minFilter!==Vi,"min filter requires mipmap"):(W(jt(Mr)&&jt(rr),"texture must be a square power of 2 to support mipmapping"),W(Me.mipmask===(Mr<<1)-1,"missing or incomplete mipmap data")),Me.type===er&&($e.extensions.indexOf("oes_texture_float_linear")<0&&W(V.minFilter===Ft&&V.magFilter===Ft,"filter not supported, must enable oes_texture_float_linear"),W(!V.genMipmaps,"mipmap generation not supported with float textures"));var Fr=Me.images;for(ar=0;ar<16;++ar)if(Fr[ar]){var Gr=Mr>>ar,Kr=rr>>ar;W(Me.mipmask&1<<ar,"missing mipmap data");var Qr=Fr[ar];if(W(Qr.width===Gr&&Qr.height===Kr,"invalid shape for mip images"),W(Qr.format===Me.format&&Qr.internalformat===Me.internalformat&&Qr.type===Me.type,"incompatible type for mip image"),!Qr.compressed)if(Qr.data){var tn=Math.ceil(St(Qr.type,Er)*Gr/Qr.unpackAlignment)*Qr.unpackAlignment;W(Qr.data.byteLength===tn*Kr,"invalid data for image, buffer size is inconsistent with image format")}else Qr.element||Qr.copy}else V.genMipmaps||W((Me.mipmask&1<<ar)==0,"extra mipmap data");Me.compressed&&W(!V.genMipmaps,"mipmap generation for compressed images not supported")}function Qt(V,Me,$e,ar){var Mr=V.width,rr=V.height,Er=V.channels;W(Mr>0&&Mr<=ar.maxTextureSize&&rr>0&&rr<=ar.maxTextureSize,"invalid texture shape"),W(Mr===rr,"cube map must be square"),W(Me.wrapS===Nt&&Me.wrapT===Nt,"wrap mode not supported by cube map");for(var Fr=0;Fr<$e.length;++Fr){var Gr=$e[Fr];W(Gr.width===Mr&&Gr.height===rr,"inconsistent cube map face shape"),Me.genMipmaps&&(W(!Gr.compressed,"can not generate mipmap for compressed textures"),W(Gr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Kr=Gr.images,Qr=0;Qr<16;++Qr){var tn=Kr[Qr];if(tn){var pn=Mr>>Qr,Wr=rr>>Qr;W(Gr.mipmask&1<<Qr,"missing mipmap data"),W(tn.width===pn&&tn.height===Wr,"invalid shape for mip images"),W(tn.format===V.format&&tn.internalformat===V.internalformat&&tn.type===V.type,"incompatible type for mip image"),tn.compressed||(tn.data?W(tn.data.byteLength===pn*Wr*Math.max(St(tn.type,Er),tn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):tn.element||tn.copy)}}}}var ie=p(W,{optional:_t,raise:Y,commandRaise:zr,command:he,parameter:N,commandParameter:Re,constructor:tr,type:Je,commandType:ye,isTypedArray:Be,nni:et,oneOf:Yt,shaderError:Xe,linkError:Ut,callSite:vr,saveCommandRef:_r,saveDrawInfo:or,framebufferFormat:ft,guessCommand:ee,texture2D:Et,textureCube:Qt}),sr=0,Br=0,Lr=5,rt=6;function gt(V,Me){this.id=sr++,this.type=V,this.data=Me}function pt(V){return V.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function dr(V){if(V.length===0)return[];var Me=V.charAt(0),$e=V.charAt(V.length-1);if(V.length>1&&Me===$e&&(Me==='"'||Me==="'"))return['"'+pt(V.substr(1,V.length-2))+'"'];var ar=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(V);if(ar)return dr(V.substr(0,ar.index)).concat(dr(ar[1])).concat(dr(V.substr(ar.index+ar[0].length)));var Mr=V.split(".");if(Mr.length===1)return['"'+pt(V)+'"'];for(var rr=[],Er=0;Er<Mr.length;++Er)rr=rr.concat(dr(Mr[Er]));return rr}function Vr(V){return"["+dr(V).join("][")+"]"}function Ur(V,Me){return new gt(V,Vr(Me+""))}function nn(V){return typeof V=="function"&&!V._reglType||V instanceof gt}function Jr(V,Me){if(typeof V=="function")return new gt(Br,V);if(typeof V=="number"||typeof V=="boolean")return new gt(Lr,V);if(Array.isArray(V))return new gt(rt,V.map(function($e,ar){return Jr($e,Me+"["+ar+"]")}));if(V instanceof gt)return V;ie(!1,"invalid option type in uniform "+Me)}var Cr={DynamicVariable:gt,define:Ur,isDynamic:nn,unbox:Jr,accessor:Vr},kn={next:typeof requestAnimationFrame=="function"?function(V){return requestAnimationFrame(V)}:function(V){return setTimeout(V,16)},cancel:typeof cancelAnimationFrame=="function"?function(V){return cancelAnimationFrame(V)}:clearTimeout},Zn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Si=Zn?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function zi(){var V={"":0},Me=[""];return{id:function($e){var ar=V[$e];return ar||(ar=V[$e]=Me.length,Me.push($e),ar)},str:function($e){return Me[$e]}}}function Ji(V,Me,$e){var ar=document.createElement("canvas");p(ar.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),V.appendChild(ar),V===document.body&&(ar.style.position="absolute",p(V.style,{margin:0,padding:0}));function Mr(){var Fr=window.innerWidth,Gr=window.innerHeight;if(V!==document.body){var Kr=ar.getBoundingClientRect();Fr=Kr.right-Kr.left,Gr=Kr.bottom-Kr.top}ar.width=$e*Fr,ar.height=$e*Gr}var rr;V!==document.body&&typeof ResizeObserver=="function"?(rr=new ResizeObserver(function(){setTimeout(Mr)}),rr.observe(V)):window.addEventListener("resize",Mr,!1);function Er(){rr?rr.disconnect():window.removeEventListener("resize",Mr),V.removeChild(ar)}return Mr(),{canvas:ar,onDestroy:Er}}function Di(V,Me){function $e(ar){try{return V.getContext(ar,Me)}catch(Mr){return null}}return $e("webgl")||$e("experimental-webgl")||$e("webgl-experimental")}function Oi(V){return typeof V.nodeName=="string"&&typeof V.appendChild=="function"&&typeof V.getBoundingClientRect=="function"}function X(V){return typeof V.drawArrays=="function"||typeof V.drawElements=="function"}function ce(V){return typeof V=="string"?V.split():(ie(Array.isArray(V),"invalid extension array"),V)}function me(V){return typeof V=="string"?(ie(typeof document!="undefined","not supported outside of DOM"),document.querySelector(V)):V}function z(V){var Me=V||{},$e,ar,Mr,rr,Er={},Fr=[],Gr=[],Kr=typeof window=="undefined"?1:window.devicePixelRatio,Qr=!1,tn=function(en){en&&ie.raise(en)},pn=function(){};if(typeof Me=="string"?(ie(typeof document!="undefined","selector queries only supported in DOM environments"),$e=document.querySelector(Me),ie($e,"invalid query string for element")):typeof Me=="object"?Oi(Me)?$e=Me:X(Me)?(rr=Me,Mr=rr.canvas):(ie.constructor(Me),"gl"in Me?rr=Me.gl:"canvas"in Me?Mr=me(Me.canvas):"container"in Me&&(ar=me(Me.container)),"attributes"in Me&&(Er=Me.attributes,ie.type(Er,"object","invalid context attributes")),"extensions"in Me&&(Fr=ce(Me.extensions)),"optionalExtensions"in Me&&(Gr=ce(Me.optionalExtensions)),"onDone"in Me&&(ie.type(Me.onDone,"function","invalid or missing onDone callback"),tn=Me.onDone),"profile"in Me&&(Qr=!!Me.profile),"pixelRatio"in Me&&(Kr=+Me.pixelRatio,ie(Kr>0,"invalid pixel ratio"))):ie.raise("invalid arguments to regl"),$e&&($e.nodeName.toLowerCase()==="canvas"?Mr=$e:ar=$e),!rr){if(!Mr){ie(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Wr=Ji(ar||document.body,tn,Kr);if(!Wr)return null;Mr=Wr.canvas,pn=Wr.onDestroy}Er.premultipliedAlpha===void 0&&(Er.premultipliedAlpha=!0),rr=Di(Mr,Er)}return rr?{gl:rr,canvas:Mr,container:ar,extensions:Fr,optionalExtensions:Gr,pixelRatio:Kr,profile:Qr,onDone:tn,onDestroy:pn}:(pn(),tn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function oe(V,Me){var $e={};function ar(Fr){ie.type(Fr,"string","extension name must be string");var Gr=Fr.toLowerCase(),Kr;try{Kr=$e[Gr]=Mr(Fr)}catch(Qr){}return!!Kr}function Mr(Fr){return V.getExtension(Fr)?V.getExtension(Fr):V.getExtension(Fr.toLowerCase())?V.getExtension(Fr.toLowerCase()):null}for(var rr=0;rr<Me.extensions.length;++rr){var Er=Me.extensions[rr];if(!ar(Er))return Me.onDestroy(),Me.onDone('"'+Er+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Me.optionalExtensions.forEach(ar),{extensions:$e,restore:function(){Object.keys($e).forEach(function(Fr){if($e[Fr]&&!ar(Fr))throw new Error("(regl): error restoring extension "+Fr)})}}}function ve(V,Me){for(var $e=Array(V),ar=0;ar<V;++ar)$e[ar]=Me(ar);return $e}var Ae=5120,se=5121,Ce=5122,ct=5123,xr=5124,Ht=5125,Jt=5126;function Rr(V){for(var Me=16;Me<=1<<28;Me*=16)if(V<=Me)return Me;return 0}function Mn(V){var Me,$e;return Me=(V>65535)<<4,V>>>=Me,$e=(V>255)<<3,V>>>=$e,Me|=$e,$e=(V>15)<<2,V>>>=$e,Me|=$e,$e=(V>3)<<1,V>>>=$e,Me|=$e,Me|V>>1}function Pn(){var V=ve(8,function(){return[]});function Me(rr){var Er=Rr(rr),Fr=V[Mn(Er)>>2];return Fr.length>0?Fr.pop():new ArrayBuffer(Er)}function $e(rr){V[Mn(rr.byteLength)>>2].push(rr)}function ar(rr,Er){var Fr=null;switch(rr){case Ae:Fr=new Int8Array(Me(Er),0,Er);break;case se:Fr=new Uint8Array(Me(Er),0,Er);break;case Ce:Fr=new Int16Array(Me(2*Er),0,Er);break;case ct:Fr=new Uint16Array(Me(2*Er),0,Er);break;case xr:Fr=new Int32Array(Me(4*Er),0,Er);break;case Ht:Fr=new Uint32Array(Me(4*Er),0,Er);break;case Jt:Fr=new Float32Array(Me(4*Er),0,Er);break;default:return null}return Fr.length!==Er?Fr.subarray(0,Er):Fr}function Mr(rr){$e(rr.buffer)}return{alloc:Me,free:$e,allocType:ar,freeType:Mr}}var $t=Pn();$t.zero=Pn();var En=3408,on=3410,ln=3411,Ai=3412,bn=3413,Li=3414,Yi=3415,si=33901,Ki=33902,Ni=3379,Ti=3386,ca=34921,Sa=36347,oi=36348,ri=35661,Gi=35660,pa=34930,Ho=36349,ya=34076,yi=34024,ga=7936,Ws=7937,Ea=7938,Ao=35724,Xa=34047,Ya=36063,Wo=34852,Ui=3553,To=34067,Lo=34069,lo=33984,Ro=6408,Hi=5126,Ra=5121,Fa=36160,ms=36053,_a=36064,xe=16384,ke=function(V,Me){var $e=1;Me.ext_texture_filter_anisotropic&&($e=V.getParameter(Xa));var ar=1,Mr=1;Me.webgl_draw_buffers&&(ar=V.getParameter(Wo),Mr=V.getParameter(Ya));var rr=!!Me.oes_texture_float;if(rr){var Er=V.createTexture();V.bindTexture(Ui,Er),V.texImage2D(Ui,0,Ro,1,1,0,Ro,Hi,null);var Fr=V.createFramebuffer();if(V.bindFramebuffer(Fa,Fr),V.framebufferTexture2D(Fa,_a,Ui,Er,0),V.bindTexture(Ui,null),V.checkFramebufferStatus(Fa)!==ms)rr=!1;else{V.viewport(0,0,1,1),V.clearColor(1,0,0,1),V.clear(xe);var Gr=$t.allocType(Hi,4);V.readPixels(0,0,1,1,Ro,Hi,Gr),V.getError()?rr=!1:(V.deleteFramebuffer(Fr),V.deleteTexture(Er),rr=Gr[0]===1),$t.freeType(Gr)}}var Kr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Qr=!0;if(!Kr){var tn=V.createTexture(),pn=$t.allocType(Ra,36);V.activeTexture(lo),V.bindTexture(To,tn),V.texImage2D(Lo,0,Ro,3,3,0,Ro,Ra,pn),$t.freeType(pn),V.bindTexture(To,null),V.deleteTexture(tn),Qr=!V.getError()}return{colorBits:[V.getParameter(on),V.getParameter(ln),V.getParameter(Ai),V.getParameter(bn)],depthBits:V.getParameter(Li),stencilBits:V.getParameter(Yi),subpixelBits:V.getParameter(En),extensions:Object.keys(Me).filter(function(Wr){return!!Me[Wr]}),maxAnisotropic:$e,maxDrawbuffers:ar,maxColorAttachments:Mr,pointSizeDims:V.getParameter(si),lineWidthDims:V.getParameter(Ki),maxViewportDims:V.getParameter(Ti),maxCombinedTextureUnits:V.getParameter(ri),maxCubeMapSize:V.getParameter(ya),maxRenderbufferSize:V.getParameter(yi),maxTextureUnits:V.getParameter(pa),maxTextureSize:V.getParameter(Ni),maxAttributes:V.getParameter(ca),maxVertexUniforms:V.getParameter(Sa),maxVertexTextureUnits:V.getParameter(Gi),maxVaryingVectors:V.getParameter(oi),maxFragmentUniforms:V.getParameter(Ho),glsl:V.getParameter(Ao),renderer:V.getParameter(Ws),vendor:V.getParameter(ga),version:V.getParameter(Ea),readFloat:rr,npotTextureCube:Qr}};function ut(V){return!!V&&typeof V=="object"&&Array.isArray(V.shape)&&Array.isArray(V.stride)&&typeof V.offset=="number"&&V.shape.length===V.stride.length&&(Array.isArray(V.data)||C(V.data))}var Xt=function(V){return Object.keys(V).map(function(Me){return V[Me]})},Xr={shape:Xo,flatten:co};function Kn(V,Me,$e){for(var ar=0;ar<Me;++ar)$e[ar]=V[ar]}function gi(V,Me,$e,ar){for(var Mr=0,rr=0;rr<Me;++rr)for(var Er=V[rr],Fr=0;Fr<$e;++Fr)ar[Mr++]=Er[Fr]}function io(V,Me,$e,ar,Mr,rr){for(var Er=rr,Fr=0;Fr<Me;++Fr)for(var Gr=V[Fr],Kr=0;Kr<$e;++Kr)for(var Qr=Gr[Kr],tn=0;tn<ar;++tn)Mr[Er++]=Qr[tn]}function Ka(V,Me,$e,ar,Mr){for(var rr=1,Er=$e+1;Er<Me.length;++Er)rr*=Me[Er];var Fr=Me[$e];if(Me.length-$e==4){var Gr=Me[$e+1],Kr=Me[$e+2],Qr=Me[$e+3];for(Er=0;Er<Fr;++Er)io(V[Er],Gr,Kr,Qr,ar,Mr),Mr+=rr}else for(Er=0;Er<Fr;++Er)Ka(V[Er],Me,$e+1,ar,Mr),Mr+=rr}function co(V,Me,$e,ar){var Mr=1;if(Me.length)for(var rr=0;rr<Me.length;++rr)Mr*=Me[rr];else Mr=0;var Er=ar||$t.allocType($e,Mr);switch(Me.length){case 0:break;case 1:Kn(V,Me[0],Er);break;case 2:gi(V,Me[0],Me[1],Er);break;case 3:io(V,Me[0],Me[1],Me[2],Er,0);break;default:Ka(V,Me,0,Er,0)}return Er}function Xo(V){for(var Me=[],$e=V;$e.length;$e=$e[0])Me.push($e.length);return Me}var Xs={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ys=5120,mo=5122,ls=5124,No=5121,Yo=5123,_o=5125,Ei=5126,Cs=5126,As={int8:ys,int16:mo,int32:ls,uint8:No,uint16:Yo,uint32:_o,float:Ei,float32:Cs},gs=35048,Aa=35040,Po={dynamic:gs,stream:Aa,static:35044},mu=Xr.flatten,bl=Xr.shape,Zu=35044,Vl=35040,tl=5121,yu=5126,Ba=[];Ba[5120]=1,Ba[5122]=2,Ba[5124]=4,Ba[5121]=1,Ba[5123]=2,Ba[5125]=4,Ba[5126]=4;function ju(V){return Xs[Object.prototype.toString.call(V)]|0}function m(V,Me){for(var $e=0;$e<Me.length;++$e)V[$e]=Me[$e]}function S(V,Me,$e,ar,Mr,rr,Er){for(var Fr=0,Gr=0;Gr<$e;++Gr)for(var Kr=0;Kr<ar;++Kr)V[Fr++]=Me[Mr*Gr+rr*Kr+Er]}function j(V,Me,$e,ar){var Mr=0,rr={};function Er(Ot){this.id=Mr++,this.buffer=V.createBuffer(),this.type=Ot,this.usage=Zu,this.byteLength=0,this.dimension=1,this.dtype=tl,this.persistentData=null,$e.profile&&(this.stats={size:0})}Er.prototype.bind=function(){V.bindBuffer(this.type,this.buffer)},Er.prototype.destroy=function(){pn(this)};var Fr=[];function Gr(Ot,pr){var Yr=Fr.pop();return Yr||(Yr=new Er(Ot)),Yr.bind(),tn(Yr,pr,Vl,0,1,!1),Yr}function Kr(Ot){Fr.push(Ot)}function Qr(Ot,pr,Yr){Ot.byteLength=pr.byteLength,V.bufferData(Ot.type,pr,Yr)}function tn(Ot,pr,Yr,Cn,Ar,wn){var qr;if(Ot.usage=Yr,Array.isArray(pr)){if(Ot.dtype=Cn||yu,pr.length>0){var ci;if(Array.isArray(pr[0])){qr=bl(pr);for(var Tr=1,br=1;br<qr.length;++br)Tr*=qr[br];Ot.dimension=Tr,ci=mu(pr,qr,Ot.dtype),Qr(Ot,ci,Yr),wn?Ot.persistentData=ci:$t.freeType(ci)}else if(typeof pr[0]=="number"){Ot.dimension=Ar;var Wn=$t.allocType(Ot.dtype,pr.length);m(Wn,pr),Qr(Ot,Wn,Yr),wn?Ot.persistentData=Wn:$t.freeType(Wn)}else C(pr[0])?(Ot.dimension=pr[0].length,Ot.dtype=Cn||ju(pr[0])||yu,ci=mu(pr,[pr.length,pr[0].length],Ot.dtype),Qr(Ot,ci,Yr),wn?Ot.persistentData=ci:$t.freeType(ci)):ie.raise("invalid buffer data")}}else if(C(pr))Ot.dtype=Cn||ju(pr),Ot.dimension=Ar,Qr(Ot,pr,Yr),wn&&(Ot.persistentData=new Uint8Array(new Uint8Array(pr.buffer)));else if(ut(pr)){qr=pr.shape;var hn=pr.stride,$r=pr.offset,gn=0,Sn=0,Ri=0,Ii=0;qr.length===1?(gn=qr[0],Sn=1,Ri=hn[0],Ii=0):qr.length===2?(gn=qr[0],Sn=qr[1],Ri=hn[0],Ii=hn[1]):ie.raise("invalid shape"),Ot.dtype=Cn||ju(pr.data)||yu,Ot.dimension=Sn;var Tn=$t.allocType(Ot.dtype,gn*Sn);S(Tn,pr.data,gn,Sn,Ri,Ii,$r),Qr(Ot,Tn,Yr),wn?Ot.persistentData=Tn:$t.freeType(Tn)}else pr instanceof ArrayBuffer?(Ot.dtype=tl,Ot.dimension=Ar,Qr(Ot,pr,Yr),wn&&(Ot.persistentData=new Uint8Array(new Uint8Array(pr)))):ie.raise("invalid buffer data")}function pn(Ot){Me.bufferCount--,ar(Ot);var pr=Ot.buffer;ie(pr,"buffer must not be deleted already"),V.deleteBuffer(pr),Ot.buffer=null,delete rr[Ot.id]}function Wr(Ot,pr,Yr,Cn){Me.bufferCount++;var Ar=new Er(pr);rr[Ar.id]=Ar;function wn(Tr){var br=Zu,Wn=null,hn=0,$r=0,gn=1;return Array.isArray(Tr)||C(Tr)||ut(Tr)||Tr instanceof ArrayBuffer?Wn=Tr:typeof Tr=="number"?hn=Tr|0:Tr&&(ie.type(Tr,"object","buffer arguments must be an object, a number or an array"),"data"in Tr&&(ie(Wn===null||Array.isArray(Wn)||C(Wn)||ut(Wn),"invalid data for buffer"),Wn=Tr.data),"usage"in Tr&&(ie.parameter(Tr.usage,Po,"invalid buffer usage"),br=Po[Tr.usage]),"type"in Tr&&(ie.parameter(Tr.type,As,"invalid buffer type"),$r=As[Tr.type]),"dimension"in Tr&&(ie.type(Tr.dimension,"number","invalid dimension"),gn=Tr.dimension|0),"length"in Tr&&(ie.nni(hn,"buffer length must be a nonnegative integer"),hn=Tr.length|0)),Ar.bind(),Wn?tn(Ar,Wn,br,$r,gn,Cn):(hn&&V.bufferData(Ar.type,hn,br),Ar.dtype=$r||tl,Ar.usage=br,Ar.dimension=gn,Ar.byteLength=hn),$e.profile&&(Ar.stats.size=Ar.byteLength*Ba[Ar.dtype]),wn}function qr(Tr,br){ie(br+Tr.byteLength<=Ar.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Tr.byteLength+" starting from offset "+br+" to a buffer of size "+Ar.byteLength),V.bufferSubData(Ar.type,br,Tr)}function ci(Tr,br){var Wn=(br||0)|0,hn;if(Ar.bind(),C(Tr)||Tr instanceof ArrayBuffer)qr(Tr,Wn);else if(Array.isArray(Tr)){if(Tr.length>0)if(typeof Tr[0]=="number"){var $r=$t.allocType(Ar.dtype,Tr.length);m($r,Tr),qr($r,Wn),$t.freeType($r)}else if(Array.isArray(Tr[0])||C(Tr[0])){hn=bl(Tr);var gn=mu(Tr,hn,Ar.dtype);qr(gn,Wn),$t.freeType(gn)}else ie.raise("invalid buffer data")}else if(ut(Tr)){hn=Tr.shape;var Sn=Tr.stride,Ri=0,Ii=0,Tn=0,An=0;hn.length===1?(Ri=hn[0],Ii=1,Tn=Sn[0],An=0):hn.length===2?(Ri=hn[0],Ii=hn[1],Tn=Sn[0],An=Sn[1]):ie.raise("invalid shape");var wi=Array.isArray(Tr.data)?Ar.dtype:ju(Tr.data),Bi=$t.allocType(wi,Ri*Ii);S(Bi,Tr.data,Ri,Ii,Tn,An,Tr.offset),qr(Bi,Wn),$t.freeType(Bi)}else ie.raise("invalid data for buffer subdata");return wn}return Yr||wn(Ot),wn._reglType="buffer",wn._buffer=Ar,wn.subdata=ci,$e.profile&&(wn.stats=Ar.stats),wn.destroy=function(){pn(Ar)},wn}function en(){Xt(rr).forEach(function(Ot){Ot.buffer=V.createBuffer(),V.bindBuffer(Ot.type,Ot.buffer),V.bufferData(Ot.type,Ot.persistentData||Ot.byteLength,Ot.usage)})}return $e.profile&&(Me.getTotalBufferSize=function(){var Ot=0;return Object.keys(rr).forEach(function(pr){Ot+=rr[pr].stats.size}),Ot}),{create:Wr,createStream:Gr,destroyStream:Kr,clear:function(){Xt(rr).forEach(pn),Fr.forEach(pn)},getBuffer:function(Ot){return Ot&&Ot._buffer instanceof Er?Ot._buffer:null},restore:en,_initBuffer:tn}}var O=0,ue=0,Ie=1,st=1,Lt=4,It=4,wr={points:O,point:ue,lines:Ie,line:st,triangles:Lt,triangle:It,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},jr=0,Qn=1,Mi=4,fi=5120,qn=5121,wa=5122,ka=5123,Qi=5124,cs=5125,xo=34963,Ts=35040,au=35044;function Bs(V,Me,$e,ar){var Mr={},rr=0,Er={uint8:qn,uint16:ka};Me.oes_element_index_uint&&(Er.uint32=cs);function Fr(en){this.id=rr++,Mr[this.id]=this,this.buffer=en,this.primType=Mi,this.vertCount=0,this.type=0}Fr.prototype.bind=function(){this.buffer.bind()};var Gr=[];function Kr(en){var Ot=Gr.pop();return Ot||(Ot=new Fr($e.create(null,xo,!0,!1)._buffer)),tn(Ot,en,Ts,-1,-1,0,0),Ot}function Qr(en){Gr.push(en)}function tn(en,Ot,pr,Yr,Cn,Ar,wn){en.buffer.bind();var qr;if(Ot){var ci=wn;!wn&&(!C(Ot)||ut(Ot)&&!C(Ot.data))&&(ci=Me.oes_element_index_uint?cs:ka),$e._initBuffer(en.buffer,Ot,pr,ci,3)}else V.bufferData(xo,Ar,pr),en.buffer.dtype=qr||qn,en.buffer.usage=pr,en.buffer.dimension=3,en.buffer.byteLength=Ar;if(qr=wn,!wn){switch(en.buffer.dtype){case qn:case fi:qr=qn;break;case ka:case wa:qr=ka;break;case cs:case Qi:qr=cs;break;default:ie.raise("unsupported type for element array")}en.buffer.dtype=qr}en.type=qr,ie(qr!==cs||!!Me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Tr=Cn;Tr<0&&(Tr=en.buffer.byteLength,qr===ka?Tr>>=1:qr===cs&&(Tr>>=2)),en.vertCount=Tr;var br=Yr;if(Yr<0){br=Mi;var Wn=en.buffer.dimension;Wn===1&&(br=jr),Wn===2&&(br=Qn),Wn===3&&(br=Mi)}en.primType=br}function pn(en){ar.elementsCount--,ie(en.buffer!==null,"must not double destroy elements"),delete Mr[en.id],en.buffer.destroy(),en.buffer=null}function Wr(en,Ot){var pr=$e.create(null,xo,!0),Yr=new Fr(pr._buffer);ar.elementsCount++;function Cn(Ar){if(!Ar)pr(),Yr.primType=Mi,Yr.vertCount=0,Yr.type=qn;else if(typeof Ar=="number")pr(Ar),Yr.primType=Mi,Yr.vertCount=Ar|0,Yr.type=qn;else{var wn=null,qr=au,ci=-1,Tr=-1,br=0,Wn=0;Array.isArray(Ar)||C(Ar)||ut(Ar)?wn=Ar:(ie.type(Ar,"object","invalid arguments for elements"),"data"in Ar&&(wn=Ar.data,ie(Array.isArray(wn)||C(wn)||ut(wn),"invalid data for element buffer")),"usage"in Ar&&(ie.parameter(Ar.usage,Po,"invalid element buffer usage"),qr=Po[Ar.usage]),"primitive"in Ar&&(ie.parameter(Ar.primitive,wr,"invalid element buffer primitive"),ci=wr[Ar.primitive]),"count"in Ar&&(ie(typeof Ar.count=="number"&&Ar.count>=0,"invalid vertex count for elements"),Tr=Ar.count|0),"type"in Ar&&(ie.parameter(Ar.type,Er,"invalid buffer type"),Wn=Er[Ar.type]),"length"in Ar?br=Ar.length|0:(br=Tr,Wn===ka||Wn===wa?br*=2:(Wn===cs||Wn===Qi)&&(br*=4))),tn(Yr,wn,qr,ci,Tr,br,Wn)}return Cn}return Cn(en),Cn._reglType="elements",Cn._elements=Yr,Cn.subdata=function(Ar,wn){return pr.subdata(Ar,wn),Cn},Cn.destroy=function(){pn(Yr)},Cn}return{create:Wr,createStream:Kr,destroyStream:Qr,getElements:function(en){return typeof en=="function"&&en._elements instanceof Fr?en._elements:null},clear:function(){Xt(Mr).forEach(pn)}}}var rl=new Float32Array(1),Ys=new Uint32Array(rl.buffer),Ks=5123;function $s(V){for(var Me=$t.allocType(Ks,V.length),$e=0;$e<V.length;++$e)if(isNaN(V[$e]))Me[$e]=65535;else if(V[$e]===Infinity)Me[$e]=31744;else if(V[$e]===-Infinity)Me[$e]=64512;else{rl[0]=V[$e];var ar=Ys[0],Mr=ar>>>31<<15,rr=(ar<<1>>>24)-127,Er=ar>>13&(1<<10)-1;if(rr<-24)Me[$e]=Mr;else if(rr<-14){var Fr=-14-rr;Me[$e]=Mr+(Er+(1<<10)>>Fr)}else rr>15?Me[$e]=Mr+31744:Me[$e]=Mr+(rr+15<<10)+Er}return Me}function ao(V){return Array.isArray(V)||C(V)}var wu=function(V){return!(V&V-1)&&!!V},nl=34467,fs=3553,Gl=34067,ou=34069,Ns=6408,uc=6406,Cu=6407,Ta=6409,Au=6410,Hl=32854,Tu=32855,lc=36194,cc=32819,Rc=32820,kc=33635,Sl=34042,gu=6402,il=34041,al=35904,Vu=35906,ol=36193,Gu=33776,zs=33777,fc=33778,hc=33779,Dc=35986,Hu=35987,El=34798,Wl=35840,pc=35841,Wu=35842,wl=35843,Cl=36196,Pu=5121,Xl=5123,za=5125,Mu=5126,sl=10242,Yl=10243,Kl=10497,Xu=33071,$c=33648,ul=10240,$a=10241,ll=9728,Yu=9729,Js=9984,ia=9985,Ua=9986,_s=9987,Al=33170,Iu=4352,Tl=4353,Jc=4354,Qc=34046,Pl=3317,$l=37440,Ou=37441,ko=37443,Us=37444,cl=33984,bo=[Js,Ua,ia,_s],Dn=[0,Ta,Au,Cu,Ns],fo={};fo[Ta]=fo[uc]=fo[gu]=1,fo[il]=fo[Au]=2,fo[Cu]=fo[al]=3,fo[Ns]=fo[Vu]=4;function Lu(V){return"[object "+V+"]"}var fl=Lu("HTMLCanvasElement"),Qs=Lu("OffscreenCanvas"),Ps=Lu("CanvasRenderingContext2D"),dc=Lu("ImageBitmap"),dn=Lu("HTMLImageElement"),Jl=Lu("HTMLVideoElement"),Ql=Object.keys(Xs).concat([fl,Qs,Ps,dc,dn,Jl]),Ru=[];Ru[Pu]=1,Ru[Mu]=4,Ru[ol]=2,Ru[Xl]=2,Ru[za]=4;var ja=[];ja[Hl]=2,ja[Tu]=2,ja[lc]=2,ja[il]=4,ja[Gu]=.5,ja[zs]=.5,ja[fc]=1,ja[hc]=1,ja[Dc]=.5,ja[Hu]=1,ja[El]=1,ja[Wl]=.5,ja[pc]=.25,ja[Wu]=.5,ja[wl]=.25,ja[Cl]=.5;function Ms(V){return Array.isArray(V)&&(V.length===0||typeof V[0]=="number")}function ql(V){if(!Array.isArray(V))return!1;var Me=V.length;return!(Me===0||!ao(V[0]))}function _u(V){return Object.prototype.toString.call(V)}function Is(V){return _u(V)===fl}function su(V){return _u(V)===Qs}function Fc(V){return _u(V)===Ps}function Ml(V){return _u(V)===dc}function vc(V){return _u(V)===dn}function Bc(V){return _u(V)===Jl}function qs(V){var Me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(Me&&V&&V.getContext)}function Os(V){if(!V)return!1;if(qs(V))return!0;var Me=_u(V);return Ql.indexOf(Me)>=0?!0:Ms(V)||ql(V)||ut(V)}function qi(V){return Xs[Object.prototype.toString.call(V)]|0}function xu(V,Me){var $e=Me.length;switch(V.type){case Pu:case Xl:case za:case Mu:var ar=$t.allocType(V.type,$e);ar.set(Me),V.data=ar;break;case ol:V.data=$s(Me);break;default:ie.raise("unsupported texture type, must specify a typed array")}}function Zs(V,Me){return $t.allocType(V.type===ol?Mu:V.type,Me)}function zo(V,Me){V.type===ol?(V.data=$s(Me),$t.freeType(Me)):V.data=Me}function hl(V,Me,$e,ar,Mr,rr){for(var Er=V.width,Fr=V.height,Gr=V.channels,Kr=Er*Fr*Gr,Qr=Zs(V,Kr),tn=0,pn=0;pn<Fr;++pn)for(var Wr=0;Wr<Er;++Wr)for(var en=0;en<Gr;++en)Qr[tn++]=Me[$e*Wr+ar*pn+Mr*en+rr];zo(V,Qr)}function uu(V,Me,$e,ar,Mr,rr){var Er;if(typeof ja[V]!="undefined"?Er=ja[V]:Er=fo[V]*Ru[Me],rr&&(Er*=6),Mr){for(var Fr=0,Gr=$e;Gr>=1;)Fr+=Er*Gr*Gr,Gr/=2;return Fr}else return Er*$e*ar}function lu(V,Me,$e,ar,Mr,rr,Er){var Fr={"don't care":Iu,"dont care":Iu,nice:Jc,fast:Tl},Gr={repeat:Kl,clamp:Xu,mirror:$c},Kr={nearest:ll,linear:Yu},Qr=p({mipmap:_s,"nearest mipmap nearest":Js,"linear mipmap nearest":ia,"nearest mipmap linear":Ua,"linear mipmap linear":_s},Kr),tn={none:0,browser:Us},pn={uint8:Pu,rgba4:cc,rgb565:kc,"rgb5 a1":Rc},Wr={alpha:uc,luminance:Ta,"luminance alpha":Au,rgb:Cu,rgba:Ns,rgba4:Hl,"rgb5 a1":Tu,rgb565:lc},en={};Me.ext_srgb&&(Wr.srgb=al,Wr.srgba=Vu),Me.oes_texture_float&&(pn.float32=pn.float=Mu),Me.oes_texture_half_float&&(pn.float16=pn["half float"]=ol),Me.webgl_depth_texture&&(p(Wr,{depth:gu,"depth stencil":il}),p(pn,{uint16:Xl,uint32:za,"depth stencil":Sl})),Me.webgl_compressed_texture_s3tc&&p(en,{"rgb s3tc dxt1":Gu,"rgba s3tc dxt1":zs,"rgba s3tc dxt3":fc,"rgba s3tc dxt5":hc}),Me.webgl_compressed_texture_atc&&p(en,{"rgb atc":Dc,"rgba atc explicit alpha":Hu,"rgba atc interpolated alpha":El}),Me.webgl_compressed_texture_pvrtc&&p(en,{"rgb pvrtc 4bppv1":Wl,"rgb pvrtc 2bppv1":pc,"rgba pvrtc 4bppv1":Wu,"rgba pvrtc 2bppv1":wl}),Me.webgl_compressed_texture_etc1&&(en["rgb etc1"]=Cl);var Ot=Array.prototype.slice.call(V.getParameter(nl)||new Uint32Array(0));Object.keys(en).forEach(function(He){var cr=en[He];Ot.indexOf(cr)>=0&&(Wr[He]=cr)});var pr=Object.keys(Wr);$e.textureFormats=pr;var Yr=[];Object.keys(Wr).forEach(function(He){var cr=Wr[He];Yr[cr]=He});var Cn=[];Object.keys(pn).forEach(function(He){var cr=pn[He];Cn[cr]=He});var Ar=[];Object.keys(Kr).forEach(function(He){var cr=Kr[He];Ar[cr]=He});var wn=[];Object.keys(Qr).forEach(function(He){var cr=Qr[He];wn[cr]=He});var qr=[];Object.keys(Gr).forEach(function(He){var cr=Gr[He];qr[cr]=He});var ci=pr.reduce(function(He,cr){var Kt=Wr[cr];return Kt===Ta||Kt===uc||Kt===Ta||Kt===Au||Kt===gu||Kt===il||Me.ext_srgb&&(Kt===al||Kt===Vu)?He[Kt]=Kt:Kt===Tu||cr.indexOf("rgba")>=0?He[Kt]=Ns:He[Kt]=Cu,He},{});function Tr(){this.internalformat=Ns,this.format=Ns,this.type=Pu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Us,this.width=0,this.height=0,this.channels=0}function br(He,cr){He.internalformat=cr.internalformat,He.format=cr.format,He.type=cr.type,He.compressed=cr.compressed,He.premultiplyAlpha=cr.premultiplyAlpha,He.flipY=cr.flipY,He.unpackAlignment=cr.unpackAlignment,He.colorSpace=cr.colorSpace,He.width=cr.width,He.height=cr.height,He.channels=cr.channels}function Wn(He,cr){if(!(typeof cr!="object"||!cr)){if("premultiplyAlpha"in cr&&(ie.type(cr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),He.premultiplyAlpha=cr.premultiplyAlpha),"flipY"in cr&&(ie.type(cr.flipY,"boolean","invalid texture flip"),He.flipY=cr.flipY),"alignment"in cr&&(ie.oneOf(cr.alignment,[1,2,4,8],"invalid texture unpack alignment"),He.unpackAlignment=cr.alignment),"colorSpace"in cr&&(ie.parameter(cr.colorSpace,tn,"invalid colorSpace"),He.colorSpace=tn[cr.colorSpace]),"type"in cr){var Kt=cr.type;ie(Me.oes_texture_float||!(Kt==="float"||Kt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),ie(Me.oes_texture_half_float||!(Kt==="half float"||Kt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ie(Me.webgl_depth_texture||!(Kt==="uint16"||Kt==="uint32"||Kt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ie.parameter(Kt,pn,"invalid texture type"),He.type=pn[Kt]}var Fn=He.width,ua=He.height,De=He.channels,Se=!1;"shape"in cr?(ie(Array.isArray(cr.shape)&&cr.shape.length>=2,"shape must be an array"),Fn=cr.shape[0],ua=cr.shape[1],cr.shape.length===3&&(De=cr.shape[2],ie(De>0&&De<=4,"invalid number of channels"),Se=!0),ie(Fn>=0&&Fn<=$e.maxTextureSize,"invalid width"),ie(ua>=0&&ua<=$e.maxTextureSize,"invalid height")):("radius"in cr&&(Fn=ua=cr.radius,ie(Fn>=0&&Fn<=$e.maxTextureSize,"invalid radius")),"width"in cr&&(Fn=cr.width,ie(Fn>=0&&Fn<=$e.maxTextureSize,"invalid width")),"height"in cr&&(ua=cr.height,ie(ua>=0&&ua<=$e.maxTextureSize,"invalid height")),"channels"in cr&&(De=cr.channels,ie(De>0&&De<=4,"invalid number of channels"),Se=!0)),He.width=Fn|0,He.height=ua|0,He.channels=De|0;var it=!1;if("format"in cr){var Tt=cr.format;ie(Me.webgl_depth_texture||!(Tt==="depth"||Tt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ie.parameter(Tt,Wr,"invalid texture format");var nr=He.internalformat=Wr[Tt];He.format=ci[nr],Tt in pn&&("type"in cr||(He.type=pn[Tt])),Tt in en&&(He.compressed=!0),it=!0}!Se&&it?He.channels=fo[He.format]:Se&&!it?He.channels!==Dn[He.format]&&(He.format=He.internalformat=Dn[He.channels]):it&&Se&&ie(He.channels===fo[He.format],"number of channels inconsistent with specified format")}}function hn(He){V.pixelStorei($l,He.flipY),V.pixelStorei(Ou,He.premultiplyAlpha),V.pixelStorei(ko,He.colorSpace),V.pixelStorei(Pl,He.unpackAlignment)}function $r(){Tr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function gn(He,cr){var Kt=null;if(Os(cr)?Kt=cr:cr&&(ie.type(cr,"object","invalid pixel data type"),Wn(He,cr),"x"in cr&&(He.xOffset=cr.x|0),"y"in cr&&(He.yOffset=cr.y|0),Os(cr.data)&&(Kt=cr.data)),ie(!He.compressed||Kt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),cr.copy){ie(!Kt,"can not specify copy and data field for the same texture");var Fn=Mr.viewportWidth,ua=Mr.viewportHeight;He.width=He.width||Fn-He.xOffset,He.height=He.height||ua-He.yOffset,He.needsCopy=!0,ie(He.xOffset>=0&&He.xOffset<Fn&&He.yOffset>=0&&He.yOffset<ua&&He.width>0&&He.width<=Fn&&He.height>0&&He.height<=ua,"copy texture read out of bounds")}else if(!Kt)He.width=He.width||1,He.height=He.height||1,He.channels=He.channels||4;else if(C(Kt))He.channels=He.channels||4,He.data=Kt,!("type"in cr)&&He.type===Pu&&(He.type=qi(Kt));else if(Ms(Kt))He.channels=He.channels||4,xu(He,Kt),He.alignment=1,He.needsFree=!0;else if(ut(Kt)){var De=Kt.data;!Array.isArray(De)&&He.type===Pu&&(He.type=qi(De));var Se=Kt.shape,it=Kt.stride,Tt,nr,dt,lt,at,Oe;Se.length===3?(dt=Se[2],Oe=it[2]):(ie(Se.length===2,"invalid ndarray pixel data, must be 2 or 3D"),dt=1,Oe=1),Tt=Se[0],nr=Se[1],lt=it[0],at=it[1],He.alignment=1,He.width=Tt,He.height=nr,He.channels=dt,He.format=He.internalformat=Dn[dt],He.needsFree=!0,hl(He,De,lt,at,Oe,Kt.offset)}else if(qs(Kt)||Is(Kt)||su(Kt)||Fc(Kt))qs(Kt)||Is(Kt)||su(Kt)?He.element=Kt:He.element=Kt.canvas,He.width=He.element.width,He.height=He.element.height,He.channels=4;else if(Ml(Kt))He.element=Kt,He.width=Kt.width,He.height=Kt.height,He.channels=4;else if(vc(Kt))He.element=Kt,He.width=Kt.naturalWidth,He.height=Kt.naturalHeight,He.channels=4;else if(Bc(Kt))He.element=Kt,He.width=Kt.videoWidth,He.height=Kt.videoHeight,He.channels=4;else if(ql(Kt)){var tt=He.width||Kt[0].length,Fe=He.height||Kt.length,Dt=He.channels;ao(Kt[0][0])?Dt=Dt||Kt[0][0].length:Dt=Dt||1;for(var Vt=Xr.shape(Kt),Dr=1,fn=0;fn<Vt.length;++fn)Dr*=Vt[fn];var sn=Zs(He,Dr);Xr.flatten(Kt,Vt,"",sn),zo(He,sn),He.alignment=1,He.width=tt,He.height=Fe,He.channels=Dt,He.format=He.internalformat=Dn[Dt],He.needsFree=!0}He.type===Mu?ie($e.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):He.type===ol&&ie($e.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Sn(He,cr,Kt){var Fn=He.element,ua=He.data,De=He.internalformat,Se=He.format,it=He.type,Tt=He.width,nr=He.height;hn(He),Fn?V.texImage2D(cr,Kt,Se,Se,it,Fn):He.compressed?V.compressedTexImage2D(cr,Kt,De,Tt,nr,0,ua):He.needsCopy?(ar(),V.copyTexImage2D(cr,Kt,Se,He.xOffset,He.yOffset,Tt,nr,0)):V.texImage2D(cr,Kt,Se,Tt,nr,0,Se,it,ua||null)}function Ri(He,cr,Kt,Fn,ua){var De=He.element,Se=He.data,it=He.internalformat,Tt=He.format,nr=He.type,dt=He.width,lt=He.height;hn(He),De?V.texSubImage2D(cr,ua,Kt,Fn,Tt,nr,De):He.compressed?V.compressedTexSubImage2D(cr,ua,Kt,Fn,it,dt,lt,Se):He.needsCopy?(ar(),V.copyTexSubImage2D(cr,ua,Kt,Fn,He.xOffset,He.yOffset,dt,lt)):V.texSubImage2D(cr,ua,Kt,Fn,dt,lt,Tt,nr,Se)}var Ii=[];function Tn(){return Ii.pop()||new $r}function An(He){He.needsFree&&$t.freeType(He.data),$r.call(He),Ii.push(He)}function wi(){Tr.call(this),this.genMipmaps=!1,this.mipmapHint=Iu,this.mipmask=0,this.images=Array(16)}function Bi(He,cr,Kt){var Fn=He.images[0]=Tn();He.mipmask=1,Fn.width=He.width=cr,Fn.height=He.height=Kt,Fn.channels=He.channels=4}function Fi(He,cr){var Kt=null;if(Os(cr))Kt=He.images[0]=Tn(),br(Kt,He),gn(Kt,cr),He.mipmask=1;else if(Wn(He,cr),Array.isArray(cr.mipmap))for(var Fn=cr.mipmap,ua=0;ua<Fn.length;++ua)Kt=He.images[ua]=Tn(),br(Kt,He),Kt.width>>=ua,Kt.height>>=ua,gn(Kt,Fn[ua]),He.mipmask|=1<<ua;else Kt=He.images[0]=Tn(),br(Kt,He),gn(Kt,cr),He.mipmask=1;br(He,He.images[0]),He.compressed&&(He.internalformat===Gu||He.internalformat===zs||He.internalformat===fc||He.internalformat===hc)&&ie(He.width%4==0&&He.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function vo(He,cr){for(var Kt=He.images,Fn=0;Fn<Kt.length;++Fn){if(!Kt[Fn])return;Sn(Kt[Fn],cr,Fn)}}var wo=[];function ra(){var He=wo.pop()||new wi;Tr.call(He),He.mipmask=0;for(var cr=0;cr<16;++cr)He.images[cr]=null;return He}function Ls(He){for(var cr=He.images,Kt=0;Kt<cr.length;++Kt)cr[Kt]&&An(cr[Kt]),cr[Kt]=null;wo.push(He)}function so(){this.minFilter=ll,this.magFilter=ll,this.wrapS=Xu,this.wrapT=Xu,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Iu}function ds(He,cr){if("min"in cr){var Kt=cr.min;ie.parameter(Kt,Qr),He.minFilter=Qr[Kt],bo.indexOf(He.minFilter)>=0&&!("faces"in cr)&&(He.genMipmaps=!0)}if("mag"in cr){var Fn=cr.mag;ie.parameter(Fn,Kr),He.magFilter=Kr[Fn]}var ua=He.wrapS,De=He.wrapT;if("wrap"in cr){var Se=cr.wrap;typeof Se=="string"?(ie.parameter(Se,Gr),ua=De=Gr[Se]):Array.isArray(Se)&&(ie.parameter(Se[0],Gr),ie.parameter(Se[1],Gr),ua=Gr[Se[0]],De=Gr[Se[1]])}else{if("wrapS"in cr){var it=cr.wrapS;ie.parameter(it,Gr),ua=Gr[it]}if("wrapT"in cr){var Tt=cr.wrapT;ie.parameter(Tt,Gr),De=Gr[Tt]}}if(He.wrapS=ua,He.wrapT=De,"anisotropic"in cr){var nr=cr.anisotropic;ie(typeof nr=="number"&&nr>=1&&nr<=$e.maxAnisotropic,"aniso samples must be between 1 and "),He.anisotropic=cr.anisotropic}if("mipmap"in cr){var dt=!1;switch(typeof cr.mipmap){case"string":ie.parameter(cr.mipmap,Fr,"invalid mipmap hint"),He.mipmapHint=Fr[cr.mipmap],He.genMipmaps=!0,dt=!0;break;case"boolean":dt=He.genMipmaps=cr.mipmap;break;case"object":ie(Array.isArray(cr.mipmap),"invalid mipmap type"),He.genMipmaps=!1,dt=!0;break;default:ie.raise("invalid mipmap type")}dt&&!("min"in cr)&&(He.minFilter=Js)}}function jo(He,cr){V.texParameteri(cr,$a,He.minFilter),V.texParameteri(cr,ul,He.magFilter),V.texParameteri(cr,sl,He.wrapS),V.texParameteri(cr,Yl,He.wrapT),Me.ext_texture_filter_anisotropic&&V.texParameteri(cr,Qc,He.anisotropic),He.genMipmaps&&(V.hint(Al,He.mipmapHint),V.generateMipmap(cr))}var os=0,$o={},Co=$e.maxTextureUnits,Vo=Array(Co).map(function(){return null});function ji(He){Tr.call(this),this.mipmask=0,this.internalformat=Ns,this.id=os++,this.refCount=1,this.target=He,this.texture=V.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new so,Er.profile&&(this.stats={size:0})}function Jo(He){V.activeTexture(cl),V.bindTexture(He.target,He.texture)}function xa(){var He=Vo[0];He?V.bindTexture(He.target,He.texture):V.bindTexture(fs,null)}function ro(He){var cr=He.texture;ie(cr,"must not double destroy texture");var Kt=He.unit,Fn=He.target;Kt>=0&&(V.activeTexture(cl+Kt),V.bindTexture(Fn,null),Vo[Kt]=null),V.deleteTexture(cr),He.texture=null,He.params=null,He.pixels=null,He.refCount=0,delete $o[He.id],rr.textureCount--}p(ji.prototype,{bind:function(){var He=this;He.bindCount+=1;var cr=He.unit;if(cr<0){for(var Kt=0;Kt<Co;++Kt){var Fn=Vo[Kt];if(Fn){if(Fn.bindCount>0)continue;Fn.unit=-1}Vo[Kt]=He,cr=Kt;break}cr>=Co&&ie.raise("insufficient number of texture units"),Er.profile&&rr.maxTextureUnits<cr+1&&(rr.maxTextureUnits=cr+1),He.unit=cr,V.activeTexture(cl+cr),V.bindTexture(He.target,He.texture)}return cr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ro(this)}});function vi(He,cr){var Kt=new ji(fs);$o[Kt.id]=Kt,rr.textureCount++;function Fn(Se,it){var Tt=Kt.texInfo;so.call(Tt);var nr=ra();return typeof Se=="number"?typeof it=="number"?Bi(nr,Se|0,it|0):Bi(nr,Se|0,Se|0):Se?(ie.type(Se,"object","invalid arguments to regl.texture"),ds(Tt,Se),Fi(nr,Se)):Bi(nr,1,1),Tt.genMipmaps&&(nr.mipmask=(nr.width<<1)-1),Kt.mipmask=nr.mipmask,br(Kt,nr),ie.texture2D(Tt,nr,$e),Kt.internalformat=nr.internalformat,Fn.width=nr.width,Fn.height=nr.height,Jo(Kt),vo(nr,fs),jo(Tt,fs),xa(),Ls(nr),Er.profile&&(Kt.stats.size=uu(Kt.internalformat,Kt.type,nr.width,nr.height,Tt.genMipmaps,!1)),Fn.format=Yr[Kt.internalformat],Fn.type=Cn[Kt.type],Fn.mag=Ar[Tt.magFilter],Fn.min=wn[Tt.minFilter],Fn.wrapS=qr[Tt.wrapS],Fn.wrapT=qr[Tt.wrapT],Fn}function ua(Se,it,Tt,nr){ie(!!Se,"must specify image data");var dt=it|0,lt=Tt|0,at=nr|0,Oe=Tn();return br(Oe,Kt),Oe.width=0,Oe.height=0,gn(Oe,Se),Oe.width=Oe.width||(Kt.width>>at)-dt,Oe.height=Oe.height||(Kt.height>>at)-lt,ie(Kt.type===Oe.type&&Kt.format===Oe.format&&Kt.internalformat===Oe.internalformat,"incompatible format for texture.subimage"),ie(dt>=0&&lt>=0&&dt+Oe.width<=Kt.width&&lt+Oe.height<=Kt.height,"texture.subimage write out of bounds"),ie(Kt.mipmask&1<<at,"missing mipmap data"),ie(Oe.data||Oe.element||Oe.needsCopy,"missing image data"),Jo(Kt),Ri(Oe,fs,dt,lt,at),xa(),An(Oe),Fn}function De(Se,it){var Tt=Se|0,nr=it|0||Tt;if(Tt===Kt.width&&nr===Kt.height)return Fn;Fn.width=Kt.width=Tt,Fn.height=Kt.height=nr,Jo(Kt);for(var dt=0;Kt.mipmask>>dt;++dt){var lt=Tt>>dt,at=nr>>dt;if(!lt||!at)break;V.texImage2D(fs,dt,Kt.format,lt,at,0,Kt.format,Kt.type,null)}return xa(),Er.profile&&(Kt.stats.size=uu(Kt.internalformat,Kt.type,Tt,nr,!1,!1)),Fn}return Fn(He,cr),Fn.subimage=ua,Fn.resize=De,Fn._reglType="texture2d",Fn._texture=Kt,Er.profile&&(Fn.stats=Kt.stats),Fn.destroy=function(){Kt.decRef()},Fn}function sa(He,cr,Kt,Fn,ua,De){var Se=new ji(Gl);$o[Se.id]=Se,rr.cubeCount++;var it=new Array(6);function Tt(lt,at,Oe,tt,Fe,Dt){var Vt,Dr=Se.texInfo;for(so.call(Dr),Vt=0;Vt<6;++Vt)it[Vt]=ra();if(typeof lt=="number"||!lt){var fn=lt|0||1;for(Vt=0;Vt<6;++Vt)Bi(it[Vt],fn,fn)}else if(typeof lt=="object")if(at)Fi(it[0],lt),Fi(it[1],at),Fi(it[2],Oe),Fi(it[3],tt),Fi(it[4],Fe),Fi(it[5],Dt);else if(ds(Dr,lt),Wn(Se,lt),"faces"in lt){var sn=lt.faces;for(ie(Array.isArray(sn)&&sn.length===6,"cube faces must be a length 6 array"),Vt=0;Vt<6;++Vt)ie(typeof sn[Vt]=="object"&&!!sn[Vt],"invalid input for cube map face"),br(it[Vt],Se),Fi(it[Vt],sn[Vt])}else for(Vt=0;Vt<6;++Vt)Fi(it[Vt],lt);else ie.raise("invalid arguments to cube map");for(br(Se,it[0]),ie.optional(function(){$e.npotTextureCube||ie(wu(Se.width)&&wu(Se.height),"your browser does not support non power or two texture dimensions")}),Dr.genMipmaps?Se.mipmask=(it[0].width<<1)-1:Se.mipmask=it[0].mipmask,ie.textureCube(Se,Dr,it,$e),Se.internalformat=it[0].internalformat,Tt.width=it[0].width,Tt.height=it[0].height,Jo(Se),Vt=0;Vt<6;++Vt)vo(it[Vt],ou+Vt);for(jo(Dr,Gl),xa(),Er.profile&&(Se.stats.size=uu(Se.internalformat,Se.type,Tt.width,Tt.height,Dr.genMipmaps,!0)),Tt.format=Yr[Se.internalformat],Tt.type=Cn[Se.type],Tt.mag=Ar[Dr.magFilter],Tt.min=wn[Dr.minFilter],Tt.wrapS=qr[Dr.wrapS],Tt.wrapT=qr[Dr.wrapT],Vt=0;Vt<6;++Vt)Ls(it[Vt]);return Tt}function nr(lt,at,Oe,tt,Fe){ie(!!at,"must specify image data"),ie(typeof lt=="number"&&lt===(lt|0)&&lt>=0&&lt<6,"invalid face");var Dt=Oe|0,Vt=tt|0,Dr=Fe|0,fn=Tn();return br(fn,Se),fn.width=0,fn.height=0,gn(fn,at),fn.width=fn.width||(Se.width>>Dr)-Dt,fn.height=fn.height||(Se.height>>Dr)-Vt,ie(Se.type===fn.type&&Se.format===fn.format&&Se.internalformat===fn.internalformat,"incompatible format for texture.subimage"),ie(Dt>=0&&Vt>=0&&Dt+fn.width<=Se.width&&Vt+fn.height<=Se.height,"texture.subimage write out of bounds"),ie(Se.mipmask&1<<Dr,"missing mipmap data"),ie(fn.data||fn.element||fn.needsCopy,"missing image data"),Jo(Se),Ri(fn,ou+lt,Dt,Vt,Dr),xa(),An(fn),Tt}function dt(lt){var at=lt|0;if(at!==Se.width){Tt.width=Se.width=at,Tt.height=Se.height=at,Jo(Se);for(var Oe=0;Oe<6;++Oe)for(var tt=0;Se.mipmask>>tt;++tt)V.texImage2D(ou+Oe,tt,Se.format,at>>tt,at>>tt,0,Se.format,Se.type,null);return xa(),Er.profile&&(Se.stats.size=uu(Se.internalformat,Se.type,Tt.width,Tt.height,!1,!0)),Tt}}return Tt(He,cr,Kt,Fn,ua,De),Tt.subimage=nr,Tt.resize=dt,Tt._reglType="textureCube",Tt._texture=Se,Er.profile&&(Tt.stats=Se.stats),Tt.destroy=function(){Se.decRef()},Tt}function Ga(){for(var He=0;He<Co;++He)V.activeTexture(cl+He),V.bindTexture(fs,null),Vo[He]=null;Xt($o).forEach(ro),rr.cubeCount=0,rr.textureCount=0}Er.profile&&(rr.getTotalTextureSize=function(){var He=0;return Object.keys($o).forEach(function(cr){He+=$o[cr].stats.size}),He});function uo(){for(var He=0;He<Co;++He){var cr=Vo[He];cr&&(cr.bindCount=0,cr.unit=-1,Vo[He]=null)}Xt($o).forEach(function(Kt){Kt.texture=V.createTexture(),V.bindTexture(Kt.target,Kt.texture);for(var Fn=0;Fn<32;++Fn)if((Kt.mipmask&1<<Fn)!=0)if(Kt.target===fs)V.texImage2D(fs,Fn,Kt.internalformat,Kt.width>>Fn,Kt.height>>Fn,0,Kt.internalformat,Kt.type,null);else for(var ua=0;ua<6;++ua)V.texImage2D(ou+ua,Fn,Kt.internalformat,Kt.width>>Fn,Kt.height>>Fn,0,Kt.internalformat,Kt.type,null);jo(Kt.texInfo,Kt.target)})}function Qu(){for(var He=0;He<Co;++He){var cr=Vo[He];cr&&(cr.bindCount=0,cr.unit=-1,Vo[He]=null),V.activeTexture(cl+He),V.bindTexture(fs,null),V.bindTexture(Gl,null)}}return{create2D:vi,createCube:sa,clear:Ga,getTexture:function(He){return null},restore:uo,refresh:Qu}}var So=36161,ku=32854,ai=32855,Hn=36194,Il=33189,ns=36168,eu=34041,Ko=35907,cu=34836,mc=34842,ec=34843,Wi=[];Wi[ku]=2,Wi[ai]=2,Wi[Hn]=2,Wi[Il]=2,Wi[ns]=1,Wi[eu]=4,Wi[Ko]=4,Wi[cu]=16,Wi[mc]=8,Wi[ec]=6;function Do(V,Me,$e){return Wi[V]*Me*$e}var Nc=function(V,Me,$e,ar,Mr){var rr={rgba4:ku,rgb565:Hn,"rgb5 a1":ai,depth:Il,stencil:ns,"depth stencil":eu};Me.ext_srgb&&(rr.srgba=Ko),Me.ext_color_buffer_half_float&&(rr.rgba16f=mc,rr.rgb16f=ec),Me.webgl_color_buffer_float&&(rr.rgba32f=cu);var Er=[];Object.keys(rr).forEach(function(Wr){var en=rr[Wr];Er[en]=Wr});var Fr=0,Gr={};function Kr(Wr){this.id=Fr++,this.refCount=1,this.renderbuffer=Wr,this.format=ku,this.width=0,this.height=0,Mr.profile&&(this.stats={size:0})}Kr.prototype.decRef=function(){--this.refCount<=0&&Qr(this)};function Qr(Wr){var en=Wr.renderbuffer;ie(en,"must not double destroy renderbuffer"),V.bindRenderbuffer(So,null),V.deleteRenderbuffer(en),Wr.renderbuffer=null,Wr.refCount=0,delete Gr[Wr.id],ar.renderbufferCount--}function tn(Wr,en){var Ot=new Kr(V.createRenderbuffer());Gr[Ot.id]=Ot,ar.renderbufferCount++;function pr(Cn,Ar){var wn=0,qr=0,ci=ku;if(typeof Cn=="object"&&Cn){var Tr=Cn;if("shape"in Tr){var br=Tr.shape;ie(Array.isArray(br)&&br.length>=2,"invalid renderbuffer shape"),wn=br[0]|0,qr=br[1]|0}else"radius"in Tr&&(wn=qr=Tr.radius|0),"width"in Tr&&(wn=Tr.width|0),"height"in Tr&&(qr=Tr.height|0);"format"in Tr&&(ie.parameter(Tr.format,rr,"invalid renderbuffer format"),ci=rr[Tr.format])}else typeof Cn=="number"?(wn=Cn|0,typeof Ar=="number"?qr=Ar|0:qr=wn):Cn?ie.raise("invalid arguments to renderbuffer constructor"):wn=qr=1;if(ie(wn>0&&qr>0&&wn<=$e.maxRenderbufferSize&&qr<=$e.maxRenderbufferSize,"invalid renderbuffer size"),!(wn===Ot.width&&qr===Ot.height&&ci===Ot.format))return pr.width=Ot.width=wn,pr.height=Ot.height=qr,Ot.format=ci,V.bindRenderbuffer(So,Ot.renderbuffer),V.renderbufferStorage(So,ci,wn,qr),ie(V.getError()===0,"invalid render buffer format"),Mr.profile&&(Ot.stats.size=Do(Ot.format,Ot.width,Ot.height)),pr.format=Er[Ot.format],pr}function Yr(Cn,Ar){var wn=Cn|0,qr=Ar|0||wn;return wn===Ot.width&&qr===Ot.height||(ie(wn>0&&qr>0&&wn<=$e.maxRenderbufferSize&&qr<=$e.maxRenderbufferSize,"invalid renderbuffer size"),pr.width=Ot.width=wn,pr.height=Ot.height=qr,V.bindRenderbuffer(So,Ot.renderbuffer),V.renderbufferStorage(So,Ot.format,wn,qr),ie(V.getError()===0,"invalid render buffer format"),Mr.profile&&(Ot.stats.size=Do(Ot.format,Ot.width,Ot.height))),pr}return pr(Wr,en),pr.resize=Yr,pr._reglType="renderbuffer",pr._renderbuffer=Ot,Mr.profile&&(pr.stats=Ot.stats),pr.destroy=function(){Ot.decRef()},pr}Mr.profile&&(ar.getTotalRenderbufferSize=function(){var Wr=0;return Object.keys(Gr).forEach(function(en){Wr+=Gr[en].stats.size}),Wr});function pn(){Xt(Gr).forEach(function(Wr){Wr.renderbuffer=V.createRenderbuffer(),V.bindRenderbuffer(So,Wr.renderbuffer),V.renderbufferStorage(So,Wr.format,Wr.width,Wr.height)}),V.bindRenderbuffer(So,null)}return{create:tn,clear:function(){Xt(Gr).forEach(Qr)},restore:pn}},xs=36160,tc=36161,bs=3553,hs=34069,pl=36064,fu=36096,Ol=36128,Ku=33306,Ll=36053,zc=36054,Rl=36055,dl=36057,yc=36061,Du=36193,Fu=5121,gc=5126,Bu=6407,js=6408,_c=6402,Nu=[Bu,js],kl=[];kl[js]=4,kl[Bu]=3;var $u=[];$u[Fu]=1,$u[gc]=4,$u[Du]=2;var n=32854,u=32855,a=36194,h=33189,g=36168,b=34041,P=35907,D=34836,H=34842,ae=34843,be=[n,u,a,P,H,ae,D],we={};we[Ll]="complete",we[zc]="incomplete attachment",we[dl]="incomplete dimensions",we[Rl]="incomplete, missing attachment",we[yc]="unsupported";function Pe(V,Me,$e,ar,Mr,rr){var Er={cur:null,next:null,dirty:!1,setFBO:null},Fr=["rgba"],Gr=["rgba4","rgb565","rgb5 a1"];Me.ext_srgb&&Gr.push("srgba"),Me.ext_color_buffer_half_float&&Gr.push("rgba16f","rgb16f"),Me.webgl_color_buffer_float&&Gr.push("rgba32f");var Kr=["uint8"];Me.oes_texture_half_float&&Kr.push("half float","float16"),Me.oes_texture_float&&Kr.push("float","float32");function Qr($r,gn,Sn){this.target=$r,this.texture=gn,this.renderbuffer=Sn;var Ri=0,Ii=0;gn?(Ri=gn.width,Ii=gn.height):Sn&&(Ri=Sn.width,Ii=Sn.height),this.width=Ri,this.height=Ii}function tn($r){$r&&($r.texture&&$r.texture._texture.decRef(),$r.renderbuffer&&$r.renderbuffer._renderbuffer.decRef())}function pn($r,gn,Sn){if(!!$r)if($r.texture){var Ri=$r.texture._texture,Ii=Math.max(1,Ri.width),Tn=Math.max(1,Ri.height);ie(Ii===gn&&Tn===Sn,"inconsistent width/height for supplied texture"),Ri.refCount+=1}else{var An=$r.renderbuffer._renderbuffer;ie(An.width===gn&&An.height===Sn,"inconsistent width/height for renderbuffer"),An.refCount+=1}}function Wr($r,gn){gn&&(gn.texture?V.framebufferTexture2D(xs,$r,gn.target,gn.texture._texture.texture,0):V.framebufferRenderbuffer(xs,$r,tc,gn.renderbuffer._renderbuffer.renderbuffer))}function en($r){var gn=bs,Sn=null,Ri=null,Ii=$r;typeof $r=="object"&&(Ii=$r.data,"target"in $r&&(gn=$r.target|0)),ie.type(Ii,"function","invalid attachment data");var Tn=Ii._reglType;return Tn==="texture2d"?(Sn=Ii,ie(gn===bs)):Tn==="textureCube"?(Sn=Ii,ie(gn>=hs&&gn<hs+6,"invalid cube map target")):Tn==="renderbuffer"?(Ri=Ii,gn=tc):ie.raise("invalid regl object for attachment"),new Qr(gn,Sn,Ri)}function Ot($r,gn,Sn,Ri,Ii){if(Sn){var Tn=ar.create2D({width:$r,height:gn,format:Ri,type:Ii});return Tn._texture.refCount=0,new Qr(bs,Tn,null)}else{var An=Mr.create({width:$r,height:gn,format:Ri});return An._renderbuffer.refCount=0,new Qr(tc,null,An)}}function pr($r){return $r&&($r.texture||$r.renderbuffer)}function Yr($r,gn,Sn){$r&&($r.texture?$r.texture.resize(gn,Sn):$r.renderbuffer&&$r.renderbuffer.resize(gn,Sn),$r.width=gn,$r.height=Sn)}var Cn=0,Ar={};function wn(){this.id=Cn++,Ar[this.id]=this,this.framebuffer=V.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function qr($r){$r.colorAttachments.forEach(tn),tn($r.depthAttachment),tn($r.stencilAttachment),tn($r.depthStencilAttachment)}function ci($r){var gn=$r.framebuffer;ie(gn,"must not double destroy framebuffer"),V.deleteFramebuffer(gn),$r.framebuffer=null,rr.framebufferCount--,delete Ar[$r.id]}function Tr($r){var gn;V.bindFramebuffer(xs,$r.framebuffer);var Sn=$r.colorAttachments;for(gn=0;gn<Sn.length;++gn)Wr(pl+gn,Sn[gn]);for(gn=Sn.length;gn<$e.maxColorAttachments;++gn)V.framebufferTexture2D(xs,pl+gn,bs,null,0);V.framebufferTexture2D(xs,Ku,bs,null,0),V.framebufferTexture2D(xs,fu,bs,null,0),V.framebufferTexture2D(xs,Ol,bs,null,0),Wr(fu,$r.depthAttachment),Wr(Ol,$r.stencilAttachment),Wr(Ku,$r.depthStencilAttachment);var Ri=V.checkFramebufferStatus(xs);!V.isContextLost()&&Ri!==Ll&&ie.raise("framebuffer configuration not supported, status = "+we[Ri]),V.bindFramebuffer(xs,Er.next?Er.next.framebuffer:null),Er.cur=Er.next,V.getError()}function br($r,gn){var Sn=new wn;rr.framebufferCount++;function Ri(Tn,An){var wi;ie(Er.next!==Sn,"can not update framebuffer which is currently in use");var Bi=0,Fi=0,vo=!0,wo=!0,ra=null,Ls=!0,so="rgba",ds="uint8",jo=1,os=null,$o=null,Co=null,Vo=!1;if(typeof Tn=="number")Bi=Tn|0,Fi=An|0||Bi;else if(!Tn)Bi=Fi=1;else{ie.type(Tn,"object","invalid arguments for framebuffer");var ji=Tn;if("shape"in ji){var Jo=ji.shape;ie(Array.isArray(Jo)&&Jo.length>=2,"invalid shape for framebuffer"),Bi=Jo[0],Fi=Jo[1]}else"radius"in ji&&(Bi=Fi=ji.radius),"width"in ji&&(Bi=ji.width),"height"in ji&&(Fi=ji.height);("color"in ji||"colors"in ji)&&(ra=ji.color||ji.colors,Array.isArray(ra)&&ie(ra.length===1||Me.webgl_draw_buffers,"multiple render targets not supported")),ra||("colorCount"in ji&&(jo=ji.colorCount|0,ie(jo>0,"invalid color buffer count")),"colorTexture"in ji&&(Ls=!!ji.colorTexture,so="rgba4"),"colorType"in ji&&(ds=ji.colorType,Ls?(ie(Me.oes_texture_float||!(ds==="float"||ds==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ie(Me.oes_texture_half_float||!(ds==="half float"||ds==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ds==="half float"||ds==="float16"?(ie(Me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),so="rgba16f"):(ds==="float"||ds==="float32")&&(ie(Me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),so="rgba32f"),ie.oneOf(ds,Kr,"invalid color type")),"colorFormat"in ji&&(so=ji.colorFormat,Fr.indexOf(so)>=0?Ls=!0:Gr.indexOf(so)>=0?Ls=!1:ie.optional(function(){Ls?ie.oneOf(ji.colorFormat,Fr,"invalid color format for texture"):ie.oneOf(ji.colorFormat,Gr,"invalid color format for renderbuffer")}))),("depthTexture"in ji||"depthStencilTexture"in ji)&&(Vo=!!(ji.depthTexture||ji.depthStencilTexture),ie(!Vo||Me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ji&&(typeof ji.depth=="boolean"?vo=ji.depth:(os=ji.depth,wo=!1)),"stencil"in ji&&(typeof ji.stencil=="boolean"?wo=ji.stencil:($o=ji.stencil,vo=!1)),"depthStencil"in ji&&(typeof ji.depthStencil=="boolean"?vo=wo=ji.depthStencil:(Co=ji.depthStencil,vo=!1,wo=!1))}var xa=null,ro=null,vi=null,sa=null;if(Array.isArray(ra))xa=ra.map(en);else if(ra)xa=[en(ra)];else for(xa=new Array(jo),wi=0;wi<jo;++wi)xa[wi]=Ot(Bi,Fi,Ls,so,ds);ie(Me.webgl_draw_buffers||xa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ie(xa.length<=$e.maxColorAttachments,"too many color attachments, not supported"),Bi=Bi||xa[0].width,Fi=Fi||xa[0].height,os?ro=en(os):vo&&!wo&&(ro=Ot(Bi,Fi,Vo,"depth","uint32")),$o?vi=en($o):wo&&!vo&&(vi=Ot(Bi,Fi,!1,"stencil","uint8")),Co?sa=en(Co):!os&&!$o&&wo&&vo&&(sa=Ot(Bi,Fi,Vo,"depth stencil","depth stencil")),ie(!!os+!!$o+!!Co<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ga=null;for(wi=0;wi<xa.length;++wi)if(pn(xa[wi],Bi,Fi),ie(!xa[wi]||xa[wi].texture&&Nu.indexOf(xa[wi].texture._texture.format)>=0||xa[wi].renderbuffer&&be.indexOf(xa[wi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+wi+" is invalid"),xa[wi]&&xa[wi].texture){var uo=kl[xa[wi].texture._texture.format]*$u[xa[wi].texture._texture.type];Ga===null?Ga=uo:ie(Ga===uo,"all color attachments much have the same number of bits per pixel.")}return pn(ro,Bi,Fi),ie(!ro||ro.texture&&ro.texture._texture.format===_c||ro.renderbuffer&&ro.renderbuffer._renderbuffer.format===h,"invalid depth attachment for framebuffer object"),pn(vi,Bi,Fi),ie(!vi||vi.renderbuffer&&vi.renderbuffer._renderbuffer.format===g,"invalid stencil attachment for framebuffer object"),pn(sa,Bi,Fi),ie(!sa||sa.texture&&sa.texture._texture.format===b||sa.renderbuffer&&sa.renderbuffer._renderbuffer.format===b,"invalid depth-stencil attachment for framebuffer object"),qr(Sn),Sn.width=Bi,Sn.height=Fi,Sn.colorAttachments=xa,Sn.depthAttachment=ro,Sn.stencilAttachment=vi,Sn.depthStencilAttachment=sa,Ri.color=xa.map(pr),Ri.depth=pr(ro),Ri.stencil=pr(vi),Ri.depthStencil=pr(sa),Ri.width=Sn.width,Ri.height=Sn.height,Tr(Sn),Ri}function Ii(Tn,An){ie(Er.next!==Sn,"can not resize a framebuffer which is currently in use");var wi=Math.max(Tn|0,1),Bi=Math.max(An|0||wi,1);if(wi===Sn.width&&Bi===Sn.height)return Ri;for(var Fi=Sn.colorAttachments,vo=0;vo<Fi.length;++vo)Yr(Fi[vo],wi,Bi);return Yr(Sn.depthAttachment,wi,Bi),Yr(Sn.stencilAttachment,wi,Bi),Yr(Sn.depthStencilAttachment,wi,Bi),Sn.width=Ri.width=wi,Sn.height=Ri.height=Bi,Tr(Sn),Ri}return Ri($r,gn),p(Ri,{resize:Ii,_reglType:"framebuffer",_framebuffer:Sn,destroy:function(){ci(Sn),qr(Sn)},use:function(Tn){Er.setFBO({framebuffer:Ri},Tn)}})}function Wn($r){var gn=Array(6);function Sn(Ii){var Tn;ie(gn.indexOf(Er.next)<0,"can not update framebuffer which is currently in use");var An={color:null},wi=0,Bi=null,Fi="rgba",vo="uint8",wo=1;if(typeof Ii=="number")wi=Ii|0;else if(!Ii)wi=1;else{ie.type(Ii,"object","invalid arguments for framebuffer");var ra=Ii;if("shape"in ra){var Ls=ra.shape;ie(Array.isArray(Ls)&&Ls.length>=2,"invalid shape for framebuffer"),ie(Ls[0]===Ls[1],"cube framebuffer must be square"),wi=Ls[0]}else"radius"in ra&&(wi=ra.radius|0),"width"in ra?(wi=ra.width|0,"height"in ra&&ie(ra.height===wi,"must be square")):"height"in ra&&(wi=ra.height|0);("color"in ra||"colors"in ra)&&(Bi=ra.color||ra.colors,Array.isArray(Bi)&&ie(Bi.length===1||Me.webgl_draw_buffers,"multiple render targets not supported")),Bi||("colorCount"in ra&&(wo=ra.colorCount|0,ie(wo>0,"invalid color buffer count")),"colorType"in ra&&(ie.oneOf(ra.colorType,Kr,"invalid color type"),vo=ra.colorType),"colorFormat"in ra&&(Fi=ra.colorFormat,ie.oneOf(ra.colorFormat,Fr,"invalid color format for texture"))),"depth"in ra&&(An.depth=ra.depth),"stencil"in ra&&(An.stencil=ra.stencil),"depthStencil"in ra&&(An.depthStencil=ra.depthStencil)}var so;if(Bi)if(Array.isArray(Bi))for(so=[],Tn=0;Tn<Bi.length;++Tn)so[Tn]=Bi[Tn];else so=[Bi];else{so=Array(wo);var ds={radius:wi,format:Fi,type:vo};for(Tn=0;Tn<wo;++Tn)so[Tn]=ar.createCube(ds)}for(An.color=Array(so.length),Tn=0;Tn<so.length;++Tn){var jo=so[Tn];ie(typeof jo=="function"&&jo._reglType==="textureCube","invalid cube map"),wi=wi||jo.width,ie(jo.width===wi&&jo.height===wi,"invalid cube map shape"),An.color[Tn]={target:hs,data:so[Tn]}}for(Tn=0;Tn<6;++Tn){for(var os=0;os<so.length;++os)An.color[os].target=hs+Tn;Tn>0&&(An.depth=gn[0].depth,An.stencil=gn[0].stencil,An.depthStencil=gn[0].depthStencil),gn[Tn]?gn[Tn](An):gn[Tn]=br(An)}return p(Sn,{width:wi,height:wi,color:so})}function Ri(Ii){var Tn,An=Ii|0;if(ie(An>0&&An<=$e.maxCubeMapSize,"invalid radius for cube fbo"),An===Sn.width)return Sn;var wi=Sn.color;for(Tn=0;Tn<wi.length;++Tn)wi[Tn].resize(An);for(Tn=0;Tn<6;++Tn)gn[Tn].resize(An);return Sn.width=Sn.height=An,Sn}return Sn($r),p(Sn,{faces:gn,resize:Ri,_reglType:"framebufferCube",destroy:function(){gn.forEach(function(Ii){Ii.destroy()})}})}function hn(){Er.cur=null,Er.next=null,Er.dirty=!0,Xt(Ar).forEach(function($r){$r.framebuffer=V.createFramebuffer(),Tr($r)})}return p(Er,{getFramebuffer:function($r){if(typeof $r=="function"&&$r._reglType==="framebuffer"){var gn=$r._framebuffer;if(gn instanceof wn)return gn}return null},create:br,createCube:Wn,clear:function(){Xt(Ar).forEach(ci)},restore:hn})}var We=5126,Ve=34962,nt=34963,ze=["attributes","elements","offset","count","primitive","instances"];function ot(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=We,this.offset=0,this.stride=0,this.divisor=0}function bt(V,Me,$e,ar,Mr,rr,Er){for(var Fr=$e.maxAttributes,Gr=new Array(Fr),Kr=0;Kr<Fr;++Kr)Gr[Kr]=new ot;var Qr=0,tn={},pn={Record:ot,scope:{},state:Gr,currentVAO:null,targetVAO:null,restore:en()?qr:function(){},createVAO:ci,getVAO:pr,destroyBuffer:Wr,setVAO:en()?Yr:Cn,clear:en()?Ar:function(){}};function Wr(Tr){for(var br=0;br<Gr.length;++br){var Wn=Gr[br];Wn.buffer===Tr&&(V.disableVertexAttribArray(br),Wn.buffer=null)}}function en(){return Me.oes_vertex_array_object}function Ot(){return Me.angle_instanced_arrays}function pr(Tr){return typeof Tr=="function"&&Tr._vao?Tr._vao:null}function Yr(Tr){if(Tr!==pn.currentVAO){var br=en();Tr?br.bindVertexArrayOES(Tr.vao):br.bindVertexArrayOES(null),pn.currentVAO=Tr}}function Cn(Tr){if(Tr!==pn.currentVAO){if(Tr)Tr.bindAttrs();else{for(var br=Ot(),Wn=0;Wn<Gr.length;++Wn){var hn=Gr[Wn];hn.buffer?(V.enableVertexAttribArray(Wn),hn.buffer.bind(),V.vertexAttribPointer(Wn,hn.size,hn.type,hn.normalized,hn.stride,hn.offfset),br&&hn.divisor&&br.vertexAttribDivisorANGLE(Wn,hn.divisor)):(V.disableVertexAttribArray(Wn),V.vertexAttrib4f(Wn,hn.x,hn.y,hn.z,hn.w))}Er.elements?V.bindBuffer(nt,Er.elements.buffer.buffer):V.bindBuffer(nt,null)}pn.currentVAO=Tr}}function Ar(){Xt(tn).forEach(function(Tr){Tr.destroy()})}function wn(){this.id=++Qr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Tr=en();Tr?this.vao=Tr.createVertexArrayOES():this.vao=null,tn[this.id]=this,this.buffers=[]}wn.prototype.bindAttrs=function(){for(var Tr=Ot(),br=this.attributes,Wn=0;Wn<br.length;++Wn){var hn=br[Wn];hn.buffer?(V.enableVertexAttribArray(Wn),V.bindBuffer(Ve,hn.buffer.buffer),V.vertexAttribPointer(Wn,hn.size,hn.type,hn.normalized,hn.stride,hn.offset),Tr&&hn.divisor&&Tr.vertexAttribDivisorANGLE(Wn,hn.divisor)):(V.disableVertexAttribArray(Wn),V.vertexAttrib4f(Wn,hn.x,hn.y,hn.z,hn.w))}for(var $r=br.length;$r<Fr;++$r)V.disableVertexAttribArray($r);var gn=rr.getElements(this.elements);gn?V.bindBuffer(nt,gn.buffer.buffer):V.bindBuffer(nt,null)},wn.prototype.refresh=function(){var Tr=en();Tr&&(Tr.bindVertexArrayOES(this.vao),this.bindAttrs(),pn.currentVAO=null,Tr.bindVertexArrayOES(null))},wn.prototype.destroy=function(){if(this.vao){var Tr=en();this===pn.currentVAO&&(pn.currentVAO=null,Tr.bindVertexArrayOES(null)),Tr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),tn[this.id]&&(delete tn[this.id],ar.vaoCount-=1)};function qr(){var Tr=en();Tr&&Xt(tn).forEach(function(br){br.refresh()})}function ci(Tr){var br=new wn;ar.vaoCount+=1;function Wn(hn){var $r;if(Array.isArray(hn))$r=hn,br.elements&&br.ownsElements&&br.elements.destroy(),br.elements=null,br.ownsElements=!1,br.offset=0,br.count=0,br.instances=-1,br.primitive=4;else{if(ie(typeof hn=="object","invalid arguments for create vao"),ie("attributes"in hn,"must specify attributes for vao"),hn.elements){var gn=hn.elements;br.ownsElements?typeof gn=="function"&&gn._reglType==="elements"?(br.elements.destroy(),br.ownsElements=!1):(br.elements(gn),br.ownsElements=!1):rr.getElements(hn.elements)?(br.elements=hn.elements,br.ownsElements=!1):(br.elements=rr.create(hn.elements),br.ownsElements=!0)}else br.elements=null,br.ownsElements=!1;$r=hn.attributes,br.offset=0,br.count=-1,br.instances=-1,br.primitive=4,br.elements&&(br.count=br.elements._elements.vertCount,br.primitive=br.elements._elements.primType),"offset"in hn&&(br.offset=hn.offset|0),"count"in hn&&(br.count=hn.count|0),"instances"in hn&&(br.instances=hn.instances|0),"primitive"in hn&&(ie(hn.primitive in wr,"bad primitive type: "+hn.primitive),br.primitive=wr[hn.primitive]),ie.optional(()=>{for(var vo=Object.keys(hn),wo=0;wo<vo.length;++wo)ie(ze.indexOf(vo[wo])>=0,'invalid option for vao: "'+vo[wo]+'" valid options are '+ze)}),ie(Array.isArray($r),"attributes must be an array")}ie($r.length<Fr,"too many attributes"),ie($r.length>0,"must specify at least one attribute");var Sn={},Ri=br.attributes;Ri.length=$r.length;for(var Ii=0;Ii<$r.length;++Ii){var Tn=$r[Ii],An=Ri[Ii]=new ot,wi=Tn.data||Tn;if(Array.isArray(wi)||C(wi)||ut(wi)){var Bi;br.buffers[Ii]&&(Bi=br.buffers[Ii],C(wi)&&Bi._buffer.byteLength>=wi.byteLength?Bi.subdata(wi):(Bi.destroy(),br.buffers[Ii]=null)),br.buffers[Ii]||(Bi=br.buffers[Ii]=Mr.create(Tn,Ve,!1,!0)),An.buffer=Mr.getBuffer(Bi),An.size=An.buffer.dimension|0,An.normalized=!1,An.type=An.buffer.dtype,An.offset=0,An.stride=0,An.divisor=0,An.state=1,Sn[Ii]=1}else Mr.getBuffer(Tn)?(An.buffer=Mr.getBuffer(Tn),An.size=An.buffer.dimension|0,An.normalized=!1,An.type=An.buffer.dtype,An.offset=0,An.stride=0,An.divisor=0,An.state=1):Mr.getBuffer(Tn.buffer)?(An.buffer=Mr.getBuffer(Tn.buffer),An.size=(+Tn.size||An.buffer.dimension)|0,An.normalized=!!Tn.normalized||!1,"type"in Tn?(ie.parameter(Tn.type,As,"invalid buffer type"),An.type=As[Tn.type]):An.type=An.buffer.dtype,An.offset=(Tn.offset||0)|0,An.stride=(Tn.stride||0)|0,An.divisor=(Tn.divisor||0)|0,An.state=1,ie(An.size>=1&&An.size<=4,"size must be between 1 and 4"),ie(An.offset>=0,"invalid offset"),ie(An.stride>=0&&An.stride<=255,"stride must be between 0 and 255"),ie(An.divisor>=0,"divisor must be positive"),ie(!An.divisor||!!Me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Tn?(ie(Ii>0,"first attribute must not be a constant"),An.x=+Tn.x||0,An.y=+Tn.y||0,An.z=+Tn.z||0,An.w=+Tn.w||0,An.state=2):ie(!1,"invalid attribute spec for location "+Ii)}for(var Fi=0;Fi<br.buffers.length;++Fi)!Sn[Fi]&&br.buffers[Fi]&&(br.buffers[Fi].destroy(),br.buffers[Fi]=null);return br.refresh(),Wn}return Wn.destroy=function(){for(var hn=0;hn<br.buffers.length;++hn)br.buffers[hn]&&br.buffers[hn].destroy();br.buffers.length=0,br.ownsElements&&(br.elements.destroy(),br.elements=null,br.ownsElements=!1),br.destroy()},Wn._vao=br,Wn._reglType="vao",Wn(Tr)}return pn}var Zt=35632,hr=35633,ur=35718,gr=35721;function Nr(V,Me,$e,ar){var Mr={},rr={};function Er(Ot,pr,Yr,Cn){this.name=Ot,this.id=pr,this.location=Yr,this.info=Cn}function Fr(Ot,pr){for(var Yr=0;Yr<Ot.length;++Yr)if(Ot[Yr].id===pr.id){Ot[Yr].location=pr.location;return}Ot.push(pr)}function Gr(Ot,pr,Yr){var Cn=Ot===Zt?Mr:rr,Ar=Cn[pr];if(!Ar){var wn=Me.str(pr);Ar=V.createShader(Ot),V.shaderSource(Ar,wn),V.compileShader(Ar),ie.shaderError(V,Ar,wn,Ot,Yr),Cn[pr]=Ar}return Ar}var Kr={},Qr=[],tn=0;function pn(Ot,pr){this.id=tn++,this.fragId=Ot,this.vertId=pr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ar.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Wr(Ot,pr,Yr){var Cn,Ar,wn=Gr(Zt,Ot.fragId),qr=Gr(hr,Ot.vertId),ci=Ot.program=V.createProgram();if(V.attachShader(ci,wn),V.attachShader(ci,qr),Yr)for(Cn=0;Cn<Yr.length;++Cn){var Tr=Yr[Cn];V.bindAttribLocation(ci,Tr[0],Tr[1])}V.linkProgram(ci),ie.linkError(V,ci,Me.str(Ot.fragId),Me.str(Ot.vertId),pr);var br=V.getProgramParameter(ci,ur);ar.profile&&(Ot.stats.uniformsCount=br);var Wn=Ot.uniforms;for(Cn=0;Cn<br;++Cn)if(Ar=V.getActiveUniform(ci,Cn),Ar)if(Ar.size>1)for(var hn=0;hn<Ar.size;++hn){var $r=Ar.name.replace("[0]","["+hn+"]");Fr(Wn,new Er($r,Me.id($r),V.getUniformLocation(ci,$r),Ar))}else Fr(Wn,new Er(Ar.name,Me.id(Ar.name),V.getUniformLocation(ci,Ar.name),Ar));var gn=V.getProgramParameter(ci,gr);ar.profile&&(Ot.stats.attributesCount=gn);var Sn=Ot.attributes;for(Cn=0;Cn<gn;++Cn)Ar=V.getActiveAttrib(ci,Cn),Ar&&Fr(Sn,new Er(Ar.name,Me.id(Ar.name),V.getAttribLocation(ci,Ar.name),Ar))}ar.profile&&($e.getMaxUniformsCount=function(){var Ot=0;return Qr.forEach(function(pr){pr.stats.uniformsCount>Ot&&(Ot=pr.stats.uniformsCount)}),Ot},$e.getMaxAttributesCount=function(){var Ot=0;return Qr.forEach(function(pr){pr.stats.attributesCount>Ot&&(Ot=pr.stats.attributesCount)}),Ot});function en(){Mr={},rr={};for(var Ot=0;Ot<Qr.length;++Ot)Wr(Qr[Ot],null,Qr[Ot].attributes.map(function(pr){return[pr.location,pr.name]}))}return{clear:function(){var Ot=V.deleteShader.bind(V);Xt(Mr).forEach(Ot),Mr={},Xt(rr).forEach(Ot),rr={},Qr.forEach(function(pr){V.deleteProgram(pr.program)}),Qr.length=0,Kr={},$e.shaderCount=0},program:function(Ot,pr,Yr,Cn){ie.command(Ot>=0,"missing vertex shader",Yr),ie.command(pr>=0,"missing fragment shader",Yr);var Ar=Kr[pr];Ar||(Ar=Kr[pr]={});var wn=Ar[Ot];if(wn&&(wn.refCount++,!Cn))return wn;var qr=new pn(pr,Ot);return $e.shaderCount++,Wr(qr,Yr,Cn),wn||(Ar[Ot]=qr),Qr.push(qr),p(qr,{destroy:function(){if(qr.refCount--,qr.refCount<=0){V.deleteProgram(qr.program);var ci=Qr.indexOf(qr);Qr.splice(ci,1),$e.shaderCount--}Ar[qr.vertId].refCount<=0&&(V.deleteShader(rr[qr.vertId]),delete rr[qr.vertId],delete Kr[qr.fragId][qr.vertId]),Object.keys(Kr[qr.fragId]).length||(V.deleteShader(Mr[qr.fragId]),delete Mr[qr.fragId],delete Kr[qr.fragId])}})},restore:en,shader:Gr,frag:-1,vert:-1}}var an=6408,Hr=5121,In=3333,ni=5126;function hi(V,Me,$e,ar,Mr,rr,Er){function Fr(Qr){var tn;Me.next===null?(ie(Mr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),tn=Hr):(ie(Me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),tn=Me.next.colorAttachments[0].texture._texture.type,ie.optional(function(){rr.oes_texture_float?(ie(tn===Hr||tn===ni,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),tn===ni&&ie(Er.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ie(tn===Hr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var pn=0,Wr=0,en=ar.framebufferWidth,Ot=ar.framebufferHeight,pr=null;C(Qr)?pr=Qr:Qr&&(ie.type(Qr,"object","invalid arguments to regl.read()"),pn=Qr.x|0,Wr=Qr.y|0,ie(pn>=0&&pn<ar.framebufferWidth,"invalid x offset for regl.read"),ie(Wr>=0&&Wr<ar.framebufferHeight,"invalid y offset for regl.read"),en=(Qr.width||ar.framebufferWidth-pn)|0,Ot=(Qr.height||ar.framebufferHeight-Wr)|0,pr=Qr.data||null),pr&&(tn===Hr?ie(pr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):tn===ni&&ie(pr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ie(en>0&&en+pn<=ar.framebufferWidth,"invalid width for read pixels"),ie(Ot>0&&Ot+Wr<=ar.framebufferHeight,"invalid height for read pixels"),$e();var Yr=en*Ot*4;return pr||(tn===Hr?pr=new Uint8Array(Yr):tn===ni&&(pr=pr||new Float32Array(Yr))),ie.isTypedArray(pr,"data buffer for regl.read() must be a typedarray"),ie(pr.byteLength>=Yr,"data buffer for regl.read() too small"),V.pixelStorei(In,4),V.readPixels(pn,Wr,en,Ot,an,tn,pr),pr}function Gr(Qr){var tn;return Me.setFBO({framebuffer:Qr.framebuffer},function(){tn=Fr(Qr)}),tn}function Kr(Qr){return!Qr||!("framebuffer"in Qr)?Fr(Qr):Gr(Qr)}return Kr}function ii(V){return Array.prototype.slice.call(V)}function ea(V){return ii(V).join("")}function Bn(){var V=0,Me=[],$e=[];function ar(tn){for(var pn=0;pn<$e.length;++pn)if($e[pn]===tn)return Me[pn];var Wr="g"+V++;return Me.push(Wr),$e.push(tn),Wr}function Mr(){var tn=[];function pn(){tn.push.apply(tn,ii(arguments))}var Wr=[];function en(){var Ot="v"+V++;return Wr.push(Ot),arguments.length>0&&(tn.push(Ot,"="),tn.push.apply(tn,ii(arguments)),tn.push(";")),Ot}return p(pn,{def:en,toString:function(){return ea([Wr.length>0?"var "+Wr.join(",")+";":"",ea(tn)])}})}function rr(){var tn=Mr(),pn=Mr(),Wr=tn.toString,en=pn.toString;function Ot(pr,Yr){pn(pr,Yr,"=",tn.def(pr,Yr),";")}return p(function(){tn.apply(tn,ii(arguments))},{def:tn.def,entry:tn,exit:pn,save:Ot,set:function(pr,Yr,Cn){Ot(pr,Yr),tn(pr,Yr,"=",Cn,";")},toString:function(){return Wr()+en()}})}function Er(){var tn=ea(arguments),pn=rr(),Wr=rr(),en=pn.toString,Ot=Wr.toString;return p(pn,{then:function(){return pn.apply(pn,ii(arguments)),this},else:function(){return Wr.apply(Wr,ii(arguments)),this},toString:function(){var pr=Ot();return pr&&(pr="else{"+pr+"}"),ea(["if(",tn,"){",en(),"}",pr])}})}var Fr=Mr(),Gr={};function Kr(tn,pn){var Wr=[];function en(){var Ar="a"+Wr.length;return Wr.push(Ar),Ar}pn=pn||0;for(var Ot=0;Ot<pn;++Ot)en();var pr=rr(),Yr=pr.toString,Cn=Gr[tn]=p(pr,{arg:en,toString:function(){return ea(["function(",Wr.join(),"){",Yr(),"}"])}});return Cn}function Qr(){var tn=['"use strict";',Fr,"return {"];Object.keys(Gr).forEach(function(Ot){tn.push('"',Ot,'":',Gr[Ot].toString(),",")}),tn.push("}");var pn=ea(tn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Wr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",en=Wr?le.Function.apply(null,Me.concat(pn)):Function.apply(null,Me.concat(pn));return en.apply(null,$e)}return{global:Fr,link:ar,block:Mr,proc:Kr,scope:rr,cond:Er,compile:Qr}}var _i="xyzw".split(""),te=5121,q=1,R=2,F=0,ne=1,pe=2,ht=3,wt=4,At=5,qt=6,Pr="dither",vn="blend.enable",zn="blend.color",$n="blend.equation",xi="blend.func",li="depth.enable",Zi="depth.func",$i="depth.range",ba="depth.mask",oo="colorMask",Ia="cull.enable",ho="cull.face",Va="frontFace",ta="lineWidth",da="polygonOffset.enable",Na="polygonOffset.offset",ha="sample.alpha",Pa="sample.enable",Eo="sample.coverage",Fo="stencil.enable",oa="stencil.mask",Uo="stencil.func",po="stencil.opFront",tu="stencil.opBack",xc="scissor.enable",Dl="scissor.box",Ju="viewport",hu="profile",Fl="framebuffer",Vs="vert",vl="frag",ml="elements",pu="primitive",Mo="count",qc="offset",ef="instances",pf="vao",Rf="Width",ru="Height",tf=Fl+Rf,bc=Fl+ru,_p=Ju+Rf,Bl=Ju+ru,nh="drawingBuffer",Sc=nh+Rf,df=nh+ru,Vp=[xi,$n,Uo,po,tu,Eo,Ju,Dl,Na],vf=34962,Dh=34963,Gp=35632,xp=35633,ih=3553,Fh=34067,kf=2884,Bh=3042,rf=3024,Nh=2960,is=2929,Df=3089,zh=32823,ah=32926,oh=32928,nf=5126,Ff=35664,Bf=35665,yl=35666,Nf=5124,af=35667,sh=35668,Ec=35669,Uh=35670,mf=35671,yf=35672,gf=35673,Nl=35674,bu=35675,_f=35676,zf=35678,xf=35680,Zh=4,bf=1028,gl=1029,uh=2304,Uf=2305,jh=32775,lh=32776,bp=519,wc=7680,Uc=0,Vh=1,Sf=32774,of=513,zu=36160,Sp=36064,zl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Gh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],_l={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},rc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Hh={frag:Gp,vert:xp},ch={cw:uh,ccw:Uf};function Ef(V){return Array.isArray(V)||C(V)||ut(V)}function fh(V){return V.sort(function(Me,$e){return Me===Ju?-1:$e===Ju?1:Me<$e?-1:1})}function ps(V,Me,$e,ar){this.thisDep=V,this.contextDep=Me,this.propDep=$e,this.append=ar}function Zo(V){return V&&!(V.thisDep||V.contextDep||V.propDep)}function as(V){return new ps(!1,!1,!1,V)}function du(V,Me){var $e=V.type;if($e===F){var ar=V.data.length;return new ps(!0,ar>=1,ar>=2,Me)}else if($e===wt){var Mr=V.data;return new ps(Mr.thisDep,Mr.contextDep,Mr.propDep,Me)}else{if($e===At)return new ps(!1,!1,!1,Me);if($e===qt){for(var rr=!1,Er=!1,Fr=!1,Gr=0;Gr<V.data.length;++Gr){var Kr=V.data[Gr];if(Kr.type===ne)Fr=!0;else if(Kr.type===pe)Er=!0;else if(Kr.type===ht)rr=!0;else if(Kr.type===F){rr=!0;var Qr=Kr.data;Qr>=1&&(Er=!0),Qr>=2&&(Fr=!0)}else Kr.type===wt&&(rr=rr||Kr.data.thisDep,Er=Er||Kr.data.contextDep,Fr=Fr||Kr.data.propDep)}return new ps(rr,Er,Fr,Me)}else return new ps($e===ht,$e===pe,$e===ne,Me)}}var hh=new ps(!1,!1,!1,function(){});function Wh(V,Me,$e,ar,Mr,rr,Er,Fr,Gr,Kr,Qr,tn,pn,Wr,en){var Ot=Kr.Record,pr={add:32774,subtract:32778,"reverse subtract":32779};$e.ext_blend_minmax&&(pr.min=jh,pr.max=lh);var Yr=$e.angle_instanced_arrays,Cn=$e.webgl_draw_buffers,Ar=$e.oes_vertex_array_object,wn={dirty:!0,profile:en.profile},qr={},ci=[],Tr={},br={};function Wn(De){return De.replace(".","_")}function hn(De,Se,it){var Tt=Wn(De);ci.push(De),qr[Tt]=wn[Tt]=!!it,Tr[Tt]=Se}function $r(De,Se,it){var Tt=Wn(De);ci.push(De),Array.isArray(it)?(wn[Tt]=it.slice(),qr[Tt]=it.slice()):wn[Tt]=qr[Tt]=it,br[Tt]=Se}hn(Pr,rf),hn(vn,Bh),$r(zn,"blendColor",[0,0,0,0]),$r($n,"blendEquationSeparate",[Sf,Sf]),$r(xi,"blendFuncSeparate",[Vh,Uc,Vh,Uc]),hn(li,is,!0),$r(Zi,"depthFunc",of),$r($i,"depthRange",[0,1]),$r(ba,"depthMask",!0),$r(oo,oo,[!0,!0,!0,!0]),hn(Ia,kf),$r(ho,"cullFace",gl),$r(Va,Va,Uf),$r(ta,ta,1),hn(da,zh),$r(Na,"polygonOffset",[0,0]),hn(ha,ah),hn(Pa,oh),$r(Eo,"sampleCoverage",[1,!1]),hn(Fo,Nh),$r(oa,"stencilMask",-1),$r(Uo,"stencilFunc",[bp,0,-1]),$r(po,"stencilOpSeparate",[bf,wc,wc,wc]),$r(tu,"stencilOpSeparate",[gl,wc,wc,wc]),hn(xc,Df),$r(Dl,"scissor",[0,0,V.drawingBufferWidth,V.drawingBufferHeight]),$r(Ju,Ju,[0,0,V.drawingBufferWidth,V.drawingBufferHeight]);var gn={gl:V,context:pn,strings:Me,next:qr,current:wn,draw:tn,elements:rr,buffer:Mr,shader:Qr,attributes:Kr.state,vao:Kr,uniforms:Gr,framebuffer:Fr,extensions:$e,timer:Wr,isBufferArgs:Ef},Sn={primTypes:wr,compareFuncs:_l,blendFuncs:zl,blendEquations:pr,stencilOps:rc,glTypes:As,orientationType:ch};ie.optional(function(){gn.isArrayLike=ao}),Cn&&(Sn.backBuffer=[gl],Sn.drawBuffer=ve(ar.maxDrawbuffers,function(De){return De===0?[0]:ve(De,function(Se){return Sp+Se})}));var Ri=0;function Ii(){var De=Bn(),Se=De.link,it=De.global;De.id=Ri++,De.batchId="0";var Tt=Se(gn),nr=De.shared={props:"a0"};Object.keys(gn).forEach(function(tt){nr[tt]=it.def(Tt,".",tt)}),ie.optional(function(){De.CHECK=Se(ie),De.commandStr=ie.guessCommand(),De.command=Se(De.commandStr),De.assert=function(tt,Fe,Dt){tt("if(!(",Fe,"))",this.CHECK,".commandRaise(",Se(Dt),",",this.command,");")},Sn.invalidBlendCombinations=Gh});var dt=De.next={},lt=De.current={};Object.keys(br).forEach(function(tt){Array.isArray(wn[tt])&&(dt[tt]=it.def(nr.next,".",tt),lt[tt]=it.def(nr.current,".",tt))});var at=De.constants={};Object.keys(Sn).forEach(function(tt){at[tt]=it.def(JSON.stringify(Sn[tt]))}),De.invoke=function(tt,Fe){switch(Fe.type){case F:var Dt=["this",nr.context,nr.props,De.batchId];return tt.def(Se(Fe.data),".call(",Dt.slice(0,Math.max(Fe.data.length+1,4)),")");case ne:return tt.def(nr.props,Fe.data);case pe:return tt.def(nr.context,Fe.data);case ht:return tt.def("this",Fe.data);case wt:return Fe.data.append(De,tt),Fe.data.ref;case At:return Fe.data.toString();case qt:return Fe.data.map(function(Vt){return De.invoke(tt,Vt)})}},De.attribCache={};var Oe={};return De.scopeAttrib=function(tt){var Fe=Me.id(tt);if(Fe in Oe)return Oe[Fe];var Dt=Kr.scope[Fe];Dt||(Dt=Kr.scope[Fe]=new Ot);var Vt=Oe[Fe]=Se(Dt);return Vt},De}function Tn(De){var Se=De.static,it=De.dynamic,Tt;if(hu in Se){var nr=!!Se[hu];Tt=as(function(lt,at){return nr}),Tt.enable=nr}else if(hu in it){var dt=it[hu];Tt=du(dt,function(lt,at){return lt.invoke(at,dt)})}return Tt}function An(De,Se){var it=De.static,Tt=De.dynamic;if(Fl in it){var nr=it[Fl];return nr?(nr=Fr.getFramebuffer(nr),ie.command(nr,"invalid framebuffer object"),as(function(lt,at){var Oe=lt.link(nr),tt=lt.shared;at.set(tt.framebuffer,".next",Oe);var Fe=tt.context;return at.set(Fe,"."+tf,Oe+".width"),at.set(Fe,"."+bc,Oe+".height"),Oe})):as(function(lt,at){var Oe=lt.shared;at.set(Oe.framebuffer,".next","null");var tt=Oe.context;return at.set(tt,"."+tf,tt+"."+Sc),at.set(tt,"."+bc,tt+"."+df),"null"})}else if(Fl in Tt){var dt=Tt[Fl];return du(dt,function(lt,at){var Oe=lt.invoke(at,dt),tt=lt.shared,Fe=tt.framebuffer,Dt=at.def(Fe,".getFramebuffer(",Oe,")");ie.optional(function(){lt.assert(at,"!"+Oe+"||"+Dt,"invalid framebuffer object")}),at.set(Fe,".next",Dt);var Vt=tt.context;return at.set(Vt,"."+tf,Dt+"?"+Dt+".width:"+Vt+"."+Sc),at.set(Vt,"."+bc,Dt+"?"+Dt+".height:"+Vt+"."+df),Dt})}else return null}function wi(De,Se,it){var Tt=De.static,nr=De.dynamic;function dt(Oe){if(Oe in Tt){var tt=Tt[Oe];ie.commandType(tt,"object","invalid "+Oe,it.commandStr);var Fe=!0,Dt=tt.x|0,Vt=tt.y|0,Dr,fn;return"width"in tt?(Dr=tt.width|0,ie.command(Dr>=0,"invalid "+Oe,it.commandStr)):Fe=!1,"height"in tt?(fn=tt.height|0,ie.command(fn>=0,"invalid "+Oe,it.commandStr)):Fe=!1,new ps(!Fe&&Se&&Se.thisDep,!Fe&&Se&&Se.contextDep,!Fe&&Se&&Se.propDep,function(un,Yn){var On=un.shared.context,jn=Dr;"width"in tt||(jn=Yn.def(On,".",tf,"-",Dt));var Vn=fn;return"height"in tt||(Vn=Yn.def(On,".",bc,"-",Vt)),[Dt,Vt,jn,Vn]})}else if(Oe in nr){var sn=nr[Oe],_n=du(sn,function(un,Yn){var On=un.invoke(Yn,sn);ie.optional(function(){un.assert(Yn,On+"&&typeof "+On+'==="object"',"invalid "+Oe)});var jn=un.shared.context,Vn=Yn.def(On,".x|0"),Gn=Yn.def(On,".y|0"),pi=Yn.def('"width" in ',On,"?",On,".width|0:","(",jn,".",tf,"-",Vn,")"),Ha=Yn.def('"height" in ',On,"?",On,".height|0:","(",jn,".",bc,"-",Gn,")");return ie.optional(function(){un.assert(Yn,pi+">=0&&"+Ha+">=0","invalid "+Oe)}),[Vn,Gn,pi,Ha]});return Se&&(_n.thisDep=_n.thisDep||Se.thisDep,_n.contextDep=_n.contextDep||Se.contextDep,_n.propDep=_n.propDep||Se.propDep),_n}else return Se?new ps(Se.thisDep,Se.contextDep,Se.propDep,function(un,Yn){var On=un.shared.context;return[0,0,Yn.def(On,".",tf),Yn.def(On,".",bc)]}):null}var lt=dt(Ju);if(lt){var at=lt;lt=new ps(lt.thisDep,lt.contextDep,lt.propDep,function(Oe,tt){var Fe=at.append(Oe,tt),Dt=Oe.shared.context;return tt.set(Dt,"."+_p,Fe[2]),tt.set(Dt,"."+Bl,Fe[3]),Fe})}return{viewport:lt,scissor_box:dt(Dl)}}function Bi(De,Se){var it=De.static,Tt=typeof it[vl]=="string"&&typeof it[Vs]=="string";if(Tt){if(Object.keys(Se.dynamic).length>0)return null;var nr=Se.static,dt=Object.keys(nr);if(dt.length>0&&typeof nr[dt[0]]=="number"){for(var lt=[],at=0;at<dt.length;++at)ie(typeof nr[dt[at]]=="number","must specify all vertex attribute locations when using vaos"),lt.push([nr[dt[at]]|0,dt[at]]);return lt}}return null}function Fi(De,Se,it){var Tt=De.static,nr=De.dynamic;function dt(Fe){if(Fe in Tt){var Dt=Me.id(Tt[Fe]);ie.optional(function(){Qr.shader(Hh[Fe],Dt,ie.guessCommand())});var Vt=as(function(){return Dt});return Vt.id=Dt,Vt}else if(Fe in nr){var Dr=nr[Fe];return du(Dr,function(fn,sn){var _n=fn.invoke(sn,Dr),un=sn.def(fn.shared.strings,".id(",_n,")");return ie.optional(function(){sn(fn.shared.shader,".shader(",Hh[Fe],",",un,",",fn.command,");")}),un})}return null}var lt=dt(vl),at=dt(Vs),Oe=null,tt;return Zo(lt)&&Zo(at)?(Oe=Qr.program(at.id,lt.id,null,it),tt=as(function(Fe,Dt){return Fe.link(Oe)})):tt=new ps(lt&&lt.thisDep||at&&at.thisDep,lt&&lt.contextDep||at&&at.contextDep,lt&&lt.propDep||at&&at.propDep,function(Fe,Dt){var Vt=Fe.shared.shader,Dr;lt?Dr=lt.append(Fe,Dt):Dr=Dt.def(Vt,".",vl);var fn;at?fn=at.append(Fe,Dt):fn=Dt.def(Vt,".",Vs);var sn=Vt+".program("+fn+","+Dr;return ie.optional(function(){sn+=","+Fe.command}),Dt.def(sn+")")}),{frag:lt,vert:at,progVar:tt,program:Oe}}function vo(De,Se){var it=De.static,Tt=De.dynamic,nr={},dt=!1;function lt(){if(pf in it){var Yn=it[pf];return Yn!==null&&Kr.getVAO(Yn)===null&&(Yn=Kr.createVAO(Yn)),dt=!0,nr.vao=Yn,as(function(jn){var Vn=Kr.getVAO(Yn);return Vn?jn.link(Vn):"null"})}else if(pf in Tt){dt=!0;var On=Tt[pf];return du(On,function(jn,Vn){var Gn=jn.invoke(Vn,On);return Vn.def(jn.shared.vao+".getVAO("+Gn+")")})}return null}var at=lt(),Oe=!1;function tt(){if(ml in it){var Yn=it[ml];if(nr.elements=Yn,Ef(Yn)){var On=nr.elements=rr.create(Yn,!0);Yn=rr.getElements(On),Oe=!0}else Yn&&(Yn=rr.getElements(Yn),Oe=!0,ie.command(Yn,"invalid elements",Se.commandStr));var jn=as(function(Gn,pi){if(Yn){var Ha=Gn.link(Yn);return Gn.ELEMENTS=Ha,Ha}return Gn.ELEMENTS=null,null});return jn.value=Yn,jn}else if(ml in Tt){Oe=!0;var Vn=Tt[ml];return du(Vn,function(Gn,pi){var Ha=Gn.shared,Bo=Ha.isBufferArgs,xl=Ha.elements,Qa=Gn.invoke(pi,Vn),Oa=pi.def("null"),Ss=pi.def(Bo,"(",Qa,")"),Uu=Gn.cond(Ss).then(Oa,"=",xl,".createStream(",Qa,");").else(Oa,"=",xl,".getElements(",Qa,");");return ie.optional(function(){Gn.assert(Uu.else,"!"+Qa+"||"+Oa,"invalid elements")}),pi.entry(Uu),pi.exit(Gn.cond(Ss).then(xl,".destroyStream(",Oa,");")),Gn.ELEMENTS=Oa,Oa})}else if(dt)return new ps(at.thisDep,at.contextDep,at.propDep,function(Gn,pi){return pi.def(Gn.shared.vao+".currentVAO?"+Gn.shared.elements+".getElements("+Gn.shared.vao+".currentVAO.elements):null")});return null}var Fe=tt();function Dt(){if(pu in it){var Yn=it[pu];return nr.primitive=Yn,ie.commandParameter(Yn,wr,"invalid primitve",Se.commandStr),as(function(jn,Vn){return wr[Yn]})}else if(pu in Tt){var On=Tt[pu];return du(On,function(jn,Vn){var Gn=jn.constants.primTypes,pi=jn.invoke(Vn,On);return ie.optional(function(){jn.assert(Vn,pi+" in "+Gn,"invalid primitive, must be one of "+Object.keys(wr))}),Vn.def(Gn,"[",pi,"]")})}else{if(Oe)return Zo(Fe)?Fe.value?as(function(jn,Vn){return Vn.def(jn.ELEMENTS,".primType")}):as(function(){return Zh}):new ps(Fe.thisDep,Fe.contextDep,Fe.propDep,function(jn,Vn){var Gn=jn.ELEMENTS;return Vn.def(Gn,"?",Gn,".primType:",Zh)});if(dt)return new ps(at.thisDep,at.contextDep,at.propDep,function(jn,Vn){return Vn.def(jn.shared.vao+".currentVAO?"+jn.shared.vao+".currentVAO.primitive:"+Zh)})}return null}function Vt(Yn,On){if(Yn in it){var jn=it[Yn]|0;return On?nr.offset=jn:nr.instances=jn,ie.command(!On||jn>=0,"invalid "+Yn,Se.commandStr),as(function(Gn,pi){return On&&(Gn.OFFSET=jn),jn})}else if(Yn in Tt){var Vn=Tt[Yn];return du(Vn,function(Gn,pi){var Ha=Gn.invoke(pi,Vn);return On&&(Gn.OFFSET=Ha,ie.optional(function(){Gn.assert(pi,Ha+">=0","invalid "+Yn)})),Ha})}else if(On){if(Oe)return as(function(Gn,pi){return Gn.OFFSET=0,0});if(dt)return new ps(at.thisDep,at.contextDep,at.propDep,function(Gn,pi){return pi.def(Gn.shared.vao+".currentVAO?"+Gn.shared.vao+".currentVAO.offset:0")})}else if(dt)return new ps(at.thisDep,at.contextDep,at.propDep,function(Gn,pi){return pi.def(Gn.shared.vao+".currentVAO?"+Gn.shared.vao+".currentVAO.instances:-1")});return null}var Dr=Vt(qc,!0);function fn(){if(Mo in it){var Yn=it[Mo]|0;return nr.count=Yn,ie.command(typeof Yn=="number"&&Yn>=0,"invalid vertex count",Se.commandStr),as(function(){return Yn})}else if(Mo in Tt){var On=Tt[Mo];return du(On,function(pi,Ha){var Bo=pi.invoke(Ha,On);return ie.optional(function(){pi.assert(Ha,"typeof "+Bo+'==="number"&&'+Bo+">=0&&"+Bo+"===("+Bo+"|0)","invalid vertex count")}),Bo})}else if(Oe)if(Zo(Fe)){if(Fe)return Dr?new ps(Dr.thisDep,Dr.contextDep,Dr.propDep,function(pi,Ha){var Bo=Ha.def(pi.ELEMENTS,".vertCount-",pi.OFFSET);return ie.optional(function(){pi.assert(Ha,Bo+">=0","invalid vertex offset/element buffer too small")}),Bo}):as(function(pi,Ha){return Ha.def(pi.ELEMENTS,".vertCount")});var jn=as(function(){return-1});return ie.optional(function(){jn.MISSING=!0}),jn}else{var Vn=new ps(Fe.thisDep||Dr.thisDep,Fe.contextDep||Dr.contextDep,Fe.propDep||Dr.propDep,function(pi,Ha){var Bo=pi.ELEMENTS;return pi.OFFSET?Ha.def(Bo,"?",Bo,".vertCount-",pi.OFFSET,":-1"):Ha.def(Bo,"?",Bo,".vertCount:-1")});return ie.optional(function(){Vn.DYNAMIC=!0}),Vn}else if(dt){var Gn=new ps(at.thisDep,at.contextDep,at.propDep,function(pi,Ha){return Ha.def(pi.shared.vao,".currentVAO?",pi.shared.vao,".currentVAO.count:-1")});return Gn}return null}var sn=Dt(),_n=fn(),un=Vt(ef,!1);return{elements:Fe,primitive:sn,count:_n,instances:un,offset:Dr,vao:at,vaoActive:dt,elementsActive:Oe,static:nr}}function wo(De,Se){var it=De.static,Tt=De.dynamic,nr={};return ci.forEach(function(dt){var lt=Wn(dt);function at(Oe,tt){if(dt in it){var Fe=Oe(it[dt]);nr[lt]=as(function(){return Fe})}else if(dt in Tt){var Dt=Tt[dt];nr[lt]=du(Dt,function(Vt,Dr){return tt(Vt,Dr,Vt.invoke(Dr,Dt))})}}switch(dt){case Ia:case vn:case Pr:case Fo:case li:case xc:case da:case ha:case Pa:case ba:return at(function(Oe){return ie.commandType(Oe,"boolean",dt,Se.commandStr),Oe},function(Oe,tt,Fe){return ie.optional(function(){Oe.assert(tt,"typeof "+Fe+'==="boolean"',"invalid flag "+dt,Oe.commandStr)}),Fe});case Zi:return at(function(Oe){return ie.commandParameter(Oe,_l,"invalid "+dt,Se.commandStr),_l[Oe]},function(Oe,tt,Fe){var Dt=Oe.constants.compareFuncs;return ie.optional(function(){Oe.assert(tt,Fe+" in "+Dt,"invalid "+dt+", must be one of "+Object.keys(_l))}),tt.def(Dt,"[",Fe,"]")});case $i:return at(function(Oe){return ie.command(ao(Oe)&&Oe.length===2&&typeof Oe[0]=="number"&&typeof Oe[1]=="number"&&Oe[0]<=Oe[1],"depth range is 2d array",Se.commandStr),Oe},function(Oe,tt,Fe){ie.optional(function(){Oe.assert(tt,Oe.shared.isArrayLike+"("+Fe+")&&"+Fe+".length===2&&typeof "+Fe+'[0]==="number"&&typeof '+Fe+'[1]==="number"&&'+Fe+"[0]<="+Fe+"[1]","depth range must be a 2d array")});var Dt=tt.def("+",Fe,"[0]"),Vt=tt.def("+",Fe,"[1]");return[Dt,Vt]});case xi:return at(function(Oe){ie.commandType(Oe,"object","blend.func",Se.commandStr);var tt="srcRGB"in Oe?Oe.srcRGB:Oe.src,Fe="srcAlpha"in Oe?Oe.srcAlpha:Oe.src,Dt="dstRGB"in Oe?Oe.dstRGB:Oe.dst,Vt="dstAlpha"in Oe?Oe.dstAlpha:Oe.dst;return ie.commandParameter(tt,zl,lt+".srcRGB",Se.commandStr),ie.commandParameter(Fe,zl,lt+".srcAlpha",Se.commandStr),ie.commandParameter(Dt,zl,lt+".dstRGB",Se.commandStr),ie.commandParameter(Vt,zl,lt+".dstAlpha",Se.commandStr),ie.command(Gh.indexOf(tt+", "+Dt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+tt+", "+Dt+")",Se.commandStr),[zl[tt],zl[Dt],zl[Fe],zl[Vt]]},function(Oe,tt,Fe){var Dt=Oe.constants.blendFuncs;ie.optional(function(){Oe.assert(tt,Fe+"&&typeof "+Fe+'==="object"',"invalid blend func, must be an object")});function Vt(On,jn){var Vn=tt.def('"',On,jn,'" in ',Fe,"?",Fe,".",On,jn,":",Fe,".",On);return ie.optional(function(){Oe.assert(tt,Vn+" in "+Dt,"invalid "+dt+"."+On+jn+", must be one of "+Object.keys(zl))}),Vn}var Dr=Vt("src","RGB"),fn=Vt("dst","RGB");ie.optional(function(){var On=Oe.constants.invalidBlendCombinations;Oe.assert(tt,On+".indexOf("+Dr+'+", "+'+fn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var sn=tt.def(Dt,"[",Dr,"]"),_n=tt.def(Dt,"[",Vt("src","Alpha"),"]"),un=tt.def(Dt,"[",fn,"]"),Yn=tt.def(Dt,"[",Vt("dst","Alpha"),"]");return[sn,un,_n,Yn]});case $n:return at(function(Oe){if(typeof Oe=="string")return ie.commandParameter(Oe,pr,"invalid "+dt,Se.commandStr),[pr[Oe],pr[Oe]];if(typeof Oe=="object")return ie.commandParameter(Oe.rgb,pr,dt+".rgb",Se.commandStr),ie.commandParameter(Oe.alpha,pr,dt+".alpha",Se.commandStr),[pr[Oe.rgb],pr[Oe.alpha]];ie.commandRaise("invalid blend.equation",Se.commandStr)},function(Oe,tt,Fe){var Dt=Oe.constants.blendEquations,Vt=tt.def(),Dr=tt.def(),fn=Oe.cond("typeof ",Fe,'==="string"');return ie.optional(function(){function sn(_n,un,Yn){Oe.assert(_n,Yn+" in "+Dt,"invalid "+un+", must be one of "+Object.keys(pr))}sn(fn.then,dt,Fe),Oe.assert(fn.else,Fe+"&&typeof "+Fe+'==="object"',"invalid "+dt),sn(fn.else,dt+".rgb",Fe+".rgb"),sn(fn.else,dt+".alpha",Fe+".alpha")}),fn.then(Vt,"=",Dr,"=",Dt,"[",Fe,"];"),fn.else(Vt,"=",Dt,"[",Fe,".rgb];",Dr,"=",Dt,"[",Fe,".alpha];"),tt(fn),[Vt,Dr]});case zn:return at(function(Oe){return ie.command(ao(Oe)&&Oe.length===4,"blend.color must be a 4d array",Se.commandStr),ve(4,function(tt){return+Oe[tt]})},function(Oe,tt,Fe){return ie.optional(function(){Oe.assert(tt,Oe.shared.isArrayLike+"("+Fe+")&&"+Fe+".length===4","blend.color must be a 4d array")}),ve(4,function(Dt){return tt.def("+",Fe,"[",Dt,"]")})});case oa:return at(function(Oe){return ie.commandType(Oe,"number",lt,Se.commandStr),Oe|0},function(Oe,tt,Fe){return ie.optional(function(){Oe.assert(tt,"typeof "+Fe+'==="number"',"invalid stencil.mask")}),tt.def(Fe,"|0")});case Uo:return at(function(Oe){ie.commandType(Oe,"object",lt,Se.commandStr);var tt=Oe.cmp||"keep",Fe=Oe.ref||0,Dt="mask"in Oe?Oe.mask:-1;return ie.commandParameter(tt,_l,dt+".cmp",Se.commandStr),ie.commandType(Fe,"number",dt+".ref",Se.commandStr),ie.commandType(Dt,"number",dt+".mask",Se.commandStr),[_l[tt],Fe,Dt]},function(Oe,tt,Fe){var Dt=Oe.constants.compareFuncs;ie.optional(function(){function sn(){Oe.assert(tt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}sn(Fe+"&&typeof ",Fe,'==="object"'),sn('!("cmp" in ',Fe,")||(",Fe,".cmp in ",Dt,")")});var Vt=tt.def('"cmp" in ',Fe,"?",Dt,"[",Fe,".cmp]",":",wc),Dr=tt.def(Fe,".ref|0"),fn=tt.def('"mask" in ',Fe,"?",Fe,".mask|0:-1");return[Vt,Dr,fn]});case po:case tu:return at(function(Oe){ie.commandType(Oe,"object",lt,Se.commandStr);var tt=Oe.fail||"keep",Fe=Oe.zfail||"keep",Dt=Oe.zpass||"keep";return ie.commandParameter(tt,rc,dt+".fail",Se.commandStr),ie.commandParameter(Fe,rc,dt+".zfail",Se.commandStr),ie.commandParameter(Dt,rc,dt+".zpass",Se.commandStr),[dt===tu?gl:bf,rc[tt],rc[Fe],rc[Dt]]},function(Oe,tt,Fe){var Dt=Oe.constants.stencilOps;ie.optional(function(){Oe.assert(tt,Fe+"&&typeof "+Fe+'==="object"',"invalid "+dt)});function Vt(Dr){return ie.optional(function(){Oe.assert(tt,'!("'+Dr+'" in '+Fe+")||("+Fe+"."+Dr+" in "+Dt+")","invalid "+dt+"."+Dr+", must be one of "+Object.keys(rc))}),tt.def('"',Dr,'" in ',Fe,"?",Dt,"[",Fe,".",Dr,"]:",wc)}return[dt===tu?gl:bf,Vt("fail"),Vt("zfail"),Vt("zpass")]});case Na:return at(function(Oe){ie.commandType(Oe,"object",lt,Se.commandStr);var tt=Oe.factor|0,Fe=Oe.units|0;return ie.commandType(tt,"number",lt+".factor",Se.commandStr),ie.commandType(Fe,"number",lt+".units",Se.commandStr),[tt,Fe]},function(Oe,tt,Fe){ie.optional(function(){Oe.assert(tt,Fe+"&&typeof "+Fe+'==="object"',"invalid "+dt)});var Dt=tt.def(Fe,".factor|0"),Vt=tt.def(Fe,".units|0");return[Dt,Vt]});case ho:return at(function(Oe){var tt=0;return Oe==="front"?tt=bf:Oe==="back"&&(tt=gl),ie.command(!!tt,lt,Se.commandStr),tt},function(Oe,tt,Fe){return ie.optional(function(){Oe.assert(tt,Fe+'==="front"||'+Fe+'==="back"',"invalid cull.face")}),tt.def(Fe,'==="front"?',bf,":",gl)});case ta:return at(function(Oe){return ie.command(typeof Oe=="number"&&Oe>=ar.lineWidthDims[0]&&Oe<=ar.lineWidthDims[1],"invalid line width, must be a positive number between "+ar.lineWidthDims[0]+" and "+ar.lineWidthDims[1],Se.commandStr),Oe},function(Oe,tt,Fe){return ie.optional(function(){Oe.assert(tt,"typeof "+Fe+'==="number"&&'+Fe+">="+ar.lineWidthDims[0]+"&&"+Fe+"<="+ar.lineWidthDims[1],"invalid line width")}),Fe});case Va:return at(function(Oe){return ie.commandParameter(Oe,ch,lt,Se.commandStr),ch[Oe]},function(Oe,tt,Fe){return ie.optional(function(){Oe.assert(tt,Fe+'==="cw"||'+Fe+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),tt.def(Fe+'==="cw"?'+uh+":"+Uf)});case oo:return at(function(Oe){return ie.command(ao(Oe)&&Oe.length===4,"color.mask must be length 4 array",Se.commandStr),Oe.map(function(tt){return!!tt})},function(Oe,tt,Fe){return ie.optional(function(){Oe.assert(tt,Oe.shared.isArrayLike+"("+Fe+")&&"+Fe+".length===4","invalid color.mask")}),ve(4,function(Dt){return"!!"+Fe+"["+Dt+"]"})});case Eo:return at(function(Oe){ie.command(typeof Oe=="object"&&Oe,lt,Se.commandStr);var tt="value"in Oe?Oe.value:1,Fe=!!Oe.invert;return ie.command(typeof tt=="number"&&tt>=0&&tt<=1,"sample.coverage.value must be a number between 0 and 1",Se.commandStr),[tt,Fe]},function(Oe,tt,Fe){ie.optional(function(){Oe.assert(tt,Fe+"&&typeof "+Fe+'==="object"',"invalid sample.coverage")});var Dt=tt.def('"value" in ',Fe,"?+",Fe,".value:1"),Vt=tt.def("!!",Fe,".invert");return[Dt,Vt]})}}),nr}function ra(De,Se){var it=De.static,Tt=De.dynamic,nr={};return Object.keys(it).forEach(function(dt){var lt=it[dt],at;if(typeof lt=="number"||typeof lt=="boolean")at=as(function(){return lt});else if(typeof lt=="function"){var Oe=lt._reglType;Oe==="texture2d"||Oe==="textureCube"?at=as(function(tt){return tt.link(lt)}):Oe==="framebuffer"||Oe==="framebufferCube"?(ie.command(lt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+dt+'"',Se.commandStr),at=as(function(tt){return tt.link(lt.color[0])})):ie.commandRaise('invalid data for uniform "'+dt+'"',Se.commandStr)}else ao(lt)?at=as(function(tt){var Fe=tt.global.def("[",ve(lt.length,function(Dt){return ie.command(typeof lt[Dt]=="number"||typeof lt[Dt]=="boolean","invalid uniform "+dt,tt.commandStr),lt[Dt]}),"]");return Fe}):ie.commandRaise('invalid or missing data for uniform "'+dt+'"',Se.commandStr);at.value=lt,nr[dt]=at}),Object.keys(Tt).forEach(function(dt){var lt=Tt[dt];nr[dt]=du(lt,function(at,Oe){return at.invoke(Oe,lt)})}),nr}function Ls(De,Se){var it=De.static,Tt=De.dynamic,nr={};return Object.keys(it).forEach(function(dt){var lt=it[dt],at=Me.id(dt),Oe=new Ot;if(Ef(lt))Oe.state=q,Oe.buffer=Mr.getBuffer(Mr.create(lt,vf,!1,!0)),Oe.type=0;else{var tt=Mr.getBuffer(lt);if(tt)Oe.state=q,Oe.buffer=tt,Oe.type=0;else if(ie.command(typeof lt=="object"&&lt,"invalid data for attribute "+dt,Se.commandStr),"constant"in lt){var Fe=lt.constant;Oe.buffer="null",Oe.state=R,typeof Fe=="number"?Oe.x=Fe:(ie.command(ao(Fe)&&Fe.length>0&&Fe.length<=4,"invalid constant for attribute "+dt,Se.commandStr),_i.forEach(function(un,Yn){Yn<Fe.length&&(Oe[un]=Fe[Yn])}))}else{Ef(lt.buffer)?tt=Mr.getBuffer(Mr.create(lt.buffer,vf,!1,!0)):tt=Mr.getBuffer(lt.buffer),ie.command(!!tt,'missing buffer for attribute "'+dt+'"',Se.commandStr);var Dt=lt.offset|0;ie.command(Dt>=0,'invalid offset for attribute "'+dt+'"',Se.commandStr);var Vt=lt.stride|0;ie.command(Vt>=0&&Vt<256,'invalid stride for attribute "'+dt+'", must be integer betweeen [0, 255]',Se.commandStr);var Dr=lt.size|0;ie.command(!("size"in lt)||Dr>0&&Dr<=4,'invalid size for attribute "'+dt+'", must be 1,2,3,4',Se.commandStr);var fn=!!lt.normalized,sn=0;"type"in lt&&(ie.commandParameter(lt.type,As,"invalid type for attribute "+dt,Se.commandStr),sn=As[lt.type]);var _n=lt.divisor|0;ie.optional(function(){"divisor"in lt&&(ie.command(_n===0||Yr,'cannot specify divisor for attribute "'+dt+'", instancing not supported',Se.commandStr),ie.command(_n>=0,'invalid divisor for attribute "'+dt+'"',Se.commandStr));var un=Se.commandStr,Yn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(lt).forEach(function(On){ie.command(Yn.indexOf(On)>=0,'unknown parameter "'+On+'" for attribute pointer "'+dt+'" (valid parameters are '+Yn+")",un)})}),Oe.buffer=tt,Oe.state=q,Oe.size=Dr,Oe.normalized=fn,Oe.type=sn||tt.dtype,Oe.offset=Dt,Oe.stride=Vt,Oe.divisor=_n}}nr[dt]=as(function(un,Yn){var On=un.attribCache;if(at in On)return On[at];var jn={isStream:!1};return Object.keys(Oe).forEach(function(Vn){jn[Vn]=Oe[Vn]}),Oe.buffer&&(jn.buffer=un.link(Oe.buffer),jn.type=jn.type||jn.buffer+".dtype"),On[at]=jn,jn})}),Object.keys(Tt).forEach(function(dt){var lt=Tt[dt];function at(Oe,tt){var Fe=Oe.invoke(tt,lt),Dt=Oe.shared,Vt=Oe.constants,Dr=Dt.isBufferArgs,fn=Dt.buffer;ie.optional(function(){Oe.assert(tt,Fe+"&&(typeof "+Fe+'==="object"||typeof '+Fe+'==="function")&&('+Dr+"("+Fe+")||"+fn+".getBuffer("+Fe+")||"+fn+".getBuffer("+Fe+".buffer)||"+Dr+"("+Fe+'.buffer)||("constant" in '+Fe+"&&(typeof "+Fe+'.constant==="number"||'+Dt.isArrayLike+"("+Fe+".constant))))",'invalid dynamic attribute "'+dt+'"')});var sn={isStream:tt.def(!1)},_n=new Ot;_n.state=q,Object.keys(_n).forEach(function(jn){sn[jn]=tt.def(""+_n[jn])});var un=sn.buffer,Yn=sn.type;tt("if(",Dr,"(",Fe,")){",sn.isStream,"=true;",un,"=",fn,".createStream(",vf,",",Fe,");",Yn,"=",un,".dtype;","}else{",un,"=",fn,".getBuffer(",Fe,");","if(",un,"){",Yn,"=",un,".dtype;",'}else if("constant" in ',Fe,"){",sn.state,"=",R,";","if(typeof "+Fe+'.constant === "number"){',sn[_i[0]],"=",Fe,".constant;",_i.slice(1).map(function(jn){return sn[jn]}).join("="),"=0;","}else{",_i.map(function(jn,Vn){return sn[jn]+"="+Fe+".constant.length>"+Vn+"?"+Fe+".constant["+Vn+"]:0;"}).join(""),"}}else{","if(",Dr,"(",Fe,".buffer)){",un,"=",fn,".createStream(",vf,",",Fe,".buffer);","}else{",un,"=",fn,".getBuffer(",Fe,".buffer);","}",Yn,'="type" in ',Fe,"?",Vt.glTypes,"[",Fe,".type]:",un,".dtype;",sn.normalized,"=!!",Fe,".normalized;");function On(jn){tt(sn[jn],"=",Fe,".",jn,"|0;")}return On("size"),On("offset"),On("stride"),On("divisor"),tt("}}"),tt.exit("if(",sn.isStream,"){",fn,".destroyStream(",un,");","}"),sn}nr[dt]=du(lt,at)}),nr}function so(De){var Se=De.static,it=De.dynamic,Tt={};return Object.keys(Se).forEach(function(nr){var dt=Se[nr];Tt[nr]=as(function(lt,at){return typeof dt=="number"||typeof dt=="boolean"?""+dt:lt.link(dt)})}),Object.keys(it).forEach(function(nr){var dt=it[nr];Tt[nr]=du(dt,function(lt,at){return lt.invoke(at,dt)})}),Tt}function ds(De,Se,it,Tt,nr){var dt=De.static,lt=De.dynamic;ie.optional(function(){var On=[Fl,Vs,vl,ml,pu,qc,Mo,ef,hu,pf].concat(ci);function jn(Vn){Object.keys(Vn).forEach(function(Gn){ie.command(On.indexOf(Gn)>=0,'unknown parameter "'+Gn+'"',nr.commandStr)})}jn(dt),jn(lt)});var at=Bi(De,Se),Oe=An(De,nr),tt=wi(De,Oe,nr),Fe=vo(De,nr),Dt=wo(De,nr),Vt=Fi(De,nr,at);function Dr(On){var jn=tt[On];jn&&(Dt[On]=jn)}Dr(Ju),Dr(Wn(Dl));var fn=Object.keys(Dt).length>0,sn={framebuffer:Oe,draw:Fe,shader:Vt,state:Dt,dirty:fn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(sn.profile=Tn(De,nr),sn.uniforms=ra(it,nr),sn.drawVAO=sn.scopeVAO=Fe.vao,!sn.drawVAO&&Vt.program&&!at&&$e.angle_instanced_arrays&&Fe.static.elements){var _n=!0,un=Vt.program.attributes.map(function(On){var jn=Se.static[On];return _n=_n&&!!jn,jn});if(_n&&un.length>0){var Yn=Kr.getVAO(Kr.createVAO({attributes:un,elements:Fe.static.elements}));sn.drawVAO=new ps(null,null,null,function(On,jn){return On.link(Yn)}),sn.useVAO=!0}}return at?sn.useVAO=!0:sn.attributes=Ls(Se,nr),sn.context=so(Tt,nr),sn}function jo(De,Se,it){var Tt=De.shared,nr=Tt.context,dt=De.scope();Object.keys(it).forEach(function(lt){Se.save(nr,"."+lt);var at=it[lt],Oe=at.append(De,Se);Array.isArray(Oe)?dt(nr,".",lt,"=[",Oe.join(),"];"):dt(nr,".",lt,"=",Oe,";")}),Se(dt)}function os(De,Se,it,Tt){var nr=De.shared,dt=nr.gl,lt=nr.framebuffer,at;Cn&&(at=Se.def(nr.extensions,".webgl_draw_buffers"));var Oe=De.constants,tt=Oe.drawBuffer,Fe=Oe.backBuffer,Dt;it?Dt=it.append(De,Se):Dt=Se.def(lt,".next"),Tt||Se("if(",Dt,"!==",lt,".cur){"),Se("if(",Dt,"){",dt,".bindFramebuffer(",zu,",",Dt,".framebuffer);"),Cn&&Se(at,".drawBuffersWEBGL(",tt,"[",Dt,".colorAttachments.length]);"),Se("}else{",dt,".bindFramebuffer(",zu,",null);"),Cn&&Se(at,".drawBuffersWEBGL(",Fe,");"),Se("}",lt,".cur=",Dt,";"),Tt||Se("}")}function $o(De,Se,it){var Tt=De.shared,nr=Tt.gl,dt=De.current,lt=De.next,at=Tt.current,Oe=Tt.next,tt=De.cond(at,".dirty");ci.forEach(function(Fe){var Dt=Wn(Fe);if(!(Dt in it.state)){var Vt,Dr;if(Dt in lt){Vt=lt[Dt],Dr=dt[Dt];var fn=ve(wn[Dt].length,function(_n){return tt.def(Vt,"[",_n,"]")});tt(De.cond(fn.map(function(_n,un){return _n+"!=="+Dr+"["+un+"]"}).join("||")).then(nr,".",br[Dt],"(",fn,");",fn.map(function(_n,un){return Dr+"["+un+"]="+_n}).join(";"),";"))}else{Vt=tt.def(Oe,".",Dt);var sn=De.cond(Vt,"!==",at,".",Dt);tt(sn),Dt in Tr?sn(De.cond(Vt).then(nr,".enable(",Tr[Dt],");").else(nr,".disable(",Tr[Dt],");"),at,".",Dt,"=",Vt,";"):sn(nr,".",br[Dt],"(",Vt,");",at,".",Dt,"=",Vt,";")}}}),Object.keys(it.state).length===0&&tt(at,".dirty=false;"),Se(tt)}function Co(De,Se,it,Tt){var nr=De.shared,dt=De.current,lt=nr.current,at=nr.gl;fh(Object.keys(it)).forEach(function(Oe){var tt=it[Oe];if(!(Tt&&!Tt(tt))){var Fe=tt.append(De,Se);if(Tr[Oe]){var Dt=Tr[Oe];Zo(tt)?Fe?Se(at,".enable(",Dt,");"):Se(at,".disable(",Dt,");"):Se(De.cond(Fe).then(at,".enable(",Dt,");").else(at,".disable(",Dt,");")),Se(lt,".",Oe,"=",Fe,";")}else if(ao(Fe)){var Vt=dt[Oe];Se(at,".",br[Oe],"(",Fe,");",Fe.map(function(Dr,fn){return Vt+"["+fn+"]="+Dr}).join(";"),";")}else Se(at,".",br[Oe],"(",Fe,");",lt,".",Oe,"=",Fe,";")}})}function Vo(De,Se){Yr&&(De.instancing=Se.def(De.shared.extensions,".angle_instanced_arrays"))}function ji(De,Se,it,Tt,nr){var dt=De.shared,lt=De.stats,at=dt.current,Oe=dt.timer,tt=it.profile;function Fe(){var On=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return On||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Dt,Vt;function Dr(On){Dt=Se.def(),On(Dt,"=",Fe(),";"),typeof nr=="string"?On(lt,".count+=",nr,";"):On(lt,".count++;"),Wr&&(Tt?(Vt=Se.def(),On(Vt,"=",Oe,".getNumPendingQueries();")):On(Oe,".beginQuery(",lt,");"))}function fn(On){On(lt,".cpuTime+=",Fe(),"-",Dt,";"),Wr&&(Tt?On(Oe,".pushScopeStats(",Vt,",",Oe,".getNumPendingQueries(),",lt,");"):On(Oe,".endQuery();"))}function sn(On){var jn=Se.def(at,".profile");Se(at,".profile=",On,";"),Se.exit(at,".profile=",jn,";")}var _n;if(tt){if(Zo(tt)){tt.enable?(Dr(Se),fn(Se.exit),sn("true")):sn("false");return}_n=tt.append(De,Se),sn(_n)}else _n=Se.def(at,".profile");var un=De.block();Dr(un),Se("if(",_n,"){",un,"}");var Yn=De.block();fn(Yn),Se.exit("if(",_n,"){",Yn,"}")}function Jo(De,Se,it,Tt,nr){var dt=De.shared;function lt(Oe){switch(Oe){case Ff:case af:case mf:return 2;case Bf:case sh:case yf:return 3;case yl:case Ec:case gf:return 4;default:return 1}}function at(Oe,tt,Fe){var Dt=dt.gl,Vt=Se.def(Oe,".location"),Dr=Se.def(dt.attributes,"[",Vt,"]"),fn=Fe.state,sn=Fe.buffer,_n=[Fe.x,Fe.y,Fe.z,Fe.w],un=["buffer","normalized","offset","stride"];function Yn(){Se("if(!",Dr,".buffer){",Dt,".enableVertexAttribArray(",Vt,");}");var jn=Fe.type,Vn;if(Fe.size?Vn=Se.def(Fe.size,"||",tt):Vn=tt,Se("if(",Dr,".type!==",jn,"||",Dr,".size!==",Vn,"||",un.map(function(pi){return Dr+"."+pi+"!=="+Fe[pi]}).join("||"),"){",Dt,".bindBuffer(",vf,",",sn,".buffer);",Dt,".vertexAttribPointer(",[Vt,Vn,jn,Fe.normalized,Fe.stride,Fe.offset],");",Dr,".type=",jn,";",Dr,".size=",Vn,";",un.map(function(pi){return Dr+"."+pi+"="+Fe[pi]+";"}).join(""),"}"),Yr){var Gn=Fe.divisor;Se("if(",Dr,".divisor!==",Gn,"){",De.instancing,".vertexAttribDivisorANGLE(",[Vt,Gn],");",Dr,".divisor=",Gn,";}")}}function On(){Se("if(",Dr,".buffer){",Dt,".disableVertexAttribArray(",Vt,");",Dr,".buffer=null;","}if(",_i.map(function(jn,Vn){return Dr+"."+jn+"!=="+_n[Vn]}).join("||"),"){",Dt,".vertexAttrib4f(",Vt,",",_n,");",_i.map(function(jn,Vn){return Dr+"."+jn+"="+_n[Vn]+";"}).join(""),"}")}fn===q?Yn():fn===R?On():(Se("if(",fn,"===",q,"){"),Yn(),Se("}else{"),On(),Se("}"))}Tt.forEach(function(Oe){var tt=Oe.name,Fe=it.attributes[tt],Dt;if(Fe){if(!nr(Fe))return;Dt=Fe.append(De,Se)}else{if(!nr(hh))return;var Vt=De.scopeAttrib(tt);ie.optional(function(){De.assert(Se,Vt+".state","missing attribute "+tt)}),Dt={},Object.keys(new Ot).forEach(function(Dr){Dt[Dr]=Se.def(Vt,".",Dr)})}at(De.link(Oe),lt(Oe.info.type),Dt)})}function xa(De,Se,it,Tt,nr,dt){for(var lt=De.shared,at=lt.gl,Oe,tt=0;tt<Tt.length;++tt){var Fe=Tt[tt],Dt=Fe.name,Vt=Fe.info.type,Dr=it.uniforms[Dt],fn=De.link(Fe),sn=fn+".location",_n;if(Dr){if(!nr(Dr))continue;if(Zo(Dr)){var un=Dr.value;if(ie.command(un!==null&&typeof un!="undefined",'missing uniform "'+Dt+'"',De.commandStr),Vt===zf||Vt===xf){ie.command(typeof un=="function"&&(Vt===zf&&(un._reglType==="texture2d"||un._reglType==="framebuffer")||Vt===xf&&(un._reglType==="textureCube"||un._reglType==="framebufferCube")),"invalid texture for uniform "+Dt,De.commandStr);var Yn=De.link(un._texture||un.color[0]._texture);Se(at,".uniform1i(",sn,",",Yn+".bind());"),Se.exit(Yn,".unbind();")}else if(Vt===Nl||Vt===bu||Vt===_f){ie.optional(function(){ie.command(ao(un),"invalid matrix for uniform "+Dt,De.commandStr),ie.command(Vt===Nl&&un.length===4||Vt===bu&&un.length===9||Vt===_f&&un.length===16,"invalid length for matrix uniform "+Dt,De.commandStr)});var On=De.global.def("new Float32Array(["+Array.prototype.slice.call(un)+"])"),jn=2;Vt===bu?jn=3:Vt===_f&&(jn=4),Se(at,".uniformMatrix",jn,"fv(",sn,",false,",On,");")}else{switch(Vt){case nf:ie.commandType(un,"number","uniform "+Dt,De.commandStr),Oe="1f";break;case Ff:ie.command(ao(un)&&un.length===2,"uniform "+Dt,De.commandStr),Oe="2f";break;case Bf:ie.command(ao(un)&&un.length===3,"uniform "+Dt,De.commandStr),Oe="3f";break;case yl:ie.command(ao(un)&&un.length===4,"uniform "+Dt,De.commandStr),Oe="4f";break;case Uh:ie.commandType(un,"boolean","uniform "+Dt,De.commandStr),Oe="1i";break;case Nf:ie.commandType(un,"number","uniform "+Dt,De.commandStr),Oe="1i";break;case mf:ie.command(ao(un)&&un.length===2,"uniform "+Dt,De.commandStr),Oe="2i";break;case af:ie.command(ao(un)&&un.length===2,"uniform "+Dt,De.commandStr),Oe="2i";break;case yf:ie.command(ao(un)&&un.length===3,"uniform "+Dt,De.commandStr),Oe="3i";break;case sh:ie.command(ao(un)&&un.length===3,"uniform "+Dt,De.commandStr),Oe="3i";break;case gf:ie.command(ao(un)&&un.length===4,"uniform "+Dt,De.commandStr),Oe="4i";break;case Ec:ie.command(ao(un)&&un.length===4,"uniform "+Dt,De.commandStr),Oe="4i";break}Se(at,".uniform",Oe,"(",sn,",",ao(un)?Array.prototype.slice.call(un):un,");")}continue}else _n=Dr.append(De,Se)}else{if(!nr(hh))continue;_n=Se.def(lt.uniforms,"[",Me.id(Dt),"]")}Vt===zf?(ie(!Array.isArray(_n),"must specify a scalar prop for textures"),Se("if(",_n,"&&",_n,'._reglType==="framebuffer"){',_n,"=",_n,".color[0];","}")):Vt===xf&&(ie(!Array.isArray(_n),"must specify a scalar prop for cube maps"),Se("if(",_n,"&&",_n,'._reglType==="framebufferCube"){',_n,"=",_n,".color[0];","}")),ie.optional(function(){function Ss(qu,Zf){De.assert(Se,qu,'bad data or missing for uniform "'+Dt+'".  '+Zf)}function Uu(qu){ie(!Array.isArray(_n),"must not specify an array type for uniform"),Ss("typeof "+_n+'==="'+qu+'"',"invalid type, expected "+qu)}function Su(qu,Zf){Array.isArray(_n)?ie(_n.length===qu,"must have length "+qu):Ss(lt.isArrayLike+"("+_n+")&&"+_n+".length==="+qu,"invalid vector, should have length "+qu,De.commandStr)}function vh(qu){ie(!Array.isArray(_n),"must not specify a value type"),Ss("typeof "+_n+'==="function"&&'+_n+'._reglType==="texture'+(qu===ih?"2d":"Cube")+'"',"invalid texture type",De.commandStr)}switch(Vt){case Nf:Uu("number");break;case af:Su(2,"number");break;case sh:Su(3,"number");break;case Ec:Su(4,"number");break;case nf:Uu("number");break;case Ff:Su(2,"number");break;case Bf:Su(3,"number");break;case yl:Su(4,"number");break;case Uh:Uu("boolean");break;case mf:Su(2,"boolean");break;case yf:Su(3,"boolean");break;case gf:Su(4,"boolean");break;case Nl:Su(4,"number");break;case bu:Su(9,"number");break;case _f:Su(16,"number");break;case zf:vh(ih);break;case xf:vh(Fh);break}});var Vn=1;switch(Vt){case zf:case xf:var Gn=Se.def(_n,"._texture");Se(at,".uniform1i(",sn,",",Gn,".bind());"),Se.exit(Gn,".unbind();");continue;case Nf:case Uh:Oe="1i";break;case af:case mf:Oe="2i",Vn=2;break;case sh:case yf:Oe="3i",Vn=3;break;case Ec:case gf:Oe="4i",Vn=4;break;case nf:Oe="1f";break;case Ff:Oe="2f",Vn=2;break;case Bf:Oe="3f",Vn=3;break;case yl:Oe="4f",Vn=4;break;case Nl:Oe="Matrix2fv";break;case bu:Oe="Matrix3fv";break;case _f:Oe="Matrix4fv";break}if(Oe.charAt(0)==="M"){Se(at,".uniform",Oe,"(",sn,",");var pi=Math.pow(Vt-Nl+2,2),Ha=De.global.def("new Float32Array(",pi,")");Array.isArray(_n)?Se("false,(",ve(pi,function(Ss){return Ha+"["+Ss+"]="+_n[Ss]}),",",Ha,")"):Se("false,(Array.isArray(",_n,")||",_n," instanceof Float32Array)?",_n,":(",ve(pi,function(Ss){return Ha+"["+Ss+"]="+_n+"["+Ss+"]"}),",",Ha,")"),Se(");")}else if(Vn>1){for(var Bo=[],xl=[],Qa=0;Qa<Vn;++Qa)Array.isArray(_n)?xl.push(_n[Qa]):xl.push(Se.def(_n+"["+Qa+"]")),dt&&Bo.push(Se.def());dt&&Se("if(!",De.batchId,"||",Bo.map(function(Ss,Uu){return Ss+"!=="+xl[Uu]}).join("||"),"){",Bo.map(function(Ss,Uu){return Ss+"="+xl[Uu]+";"}).join("")),Se(at,".uniform",Oe,"(",sn,",",xl.join(","),");"),dt&&Se("}")}else{if(ie(!Array.isArray(_n),"uniform value must not be an array"),dt){var Oa=Se.def();Se("if(!",De.batchId,"||",Oa,"!==",_n,"){",Oa,"=",_n,";")}Se(at,".uniform",Oe,"(",sn,",",_n,");"),dt&&Se("}")}}}function ro(De,Se,it,Tt){var nr=De.shared,dt=nr.gl,lt=nr.draw,at=Tt.draw;function Oe(){var Vn=at.elements,Gn,pi=Se;return Vn?((Vn.contextDep&&Tt.contextDynamic||Vn.propDep)&&(pi=it),Gn=Vn.append(De,pi),at.elementsActive&&pi("if("+Gn+")"+dt+".bindBuffer("+Dh+","+Gn+".buffer.buffer);")):(Gn=pi.def(),pi(Gn,"=",lt,".",ml,";","if(",Gn,"){",dt,".bindBuffer(",Dh,",",Gn,".buffer.buffer);}","else if(",nr.vao,".currentVAO){",Gn,"=",De.shared.elements+".getElements("+nr.vao,".currentVAO.elements);",Ar?"":"if("+Gn+")"+dt+".bindBuffer("+Dh+","+Gn+".buffer.buffer);","}")),Gn}function tt(){var Vn=at.count,Gn,pi=Se;return Vn?((Vn.contextDep&&Tt.contextDynamic||Vn.propDep)&&(pi=it),Gn=Vn.append(De,pi),ie.optional(function(){Vn.MISSING&&De.assert(Se,"false","missing vertex count"),Vn.DYNAMIC&&De.assert(pi,Gn+">=0","missing vertex count")})):(Gn=pi.def(lt,".",Mo),ie.optional(function(){De.assert(pi,Gn+">=0","missing vertex count")})),Gn}var Fe=Oe();function Dt(Vn){var Gn=at[Vn];return Gn?Gn.contextDep&&Tt.contextDynamic||Gn.propDep?Gn.append(De,it):Gn.append(De,Se):Se.def(lt,".",Vn)}var Vt=Dt(pu),Dr=Dt(qc),fn=tt();if(typeof fn=="number"){if(fn===0)return}else it("if(",fn,"){"),it.exit("}");var sn,_n;Yr&&(sn=Dt(ef),_n=De.instancing);var un=Fe+".type",Yn=at.elements&&Zo(at.elements)&&!at.vaoActive;function On(){function Vn(){it(_n,".drawElementsInstancedANGLE(",[Vt,fn,un,Dr+"<<(("+un+"-"+te+")>>1)",sn],");")}function Gn(){it(_n,".drawArraysInstancedANGLE(",[Vt,Dr,fn,sn],");")}Fe&&Fe!=="null"?Yn?Vn():(it("if(",Fe,"){"),Vn(),it("}else{"),Gn(),it("}")):Gn()}function jn(){function Vn(){it(dt+".drawElements("+[Vt,fn,un,Dr+"<<(("+un+"-"+te+")>>1)"]+");")}function Gn(){it(dt+".drawArrays("+[Vt,Dr,fn]+");")}Fe&&Fe!=="null"?Yn?Vn():(it("if(",Fe,"){"),Vn(),it("}else{"),Gn(),it("}")):Gn()}Yr&&(typeof sn!="number"||sn>=0)?typeof sn=="string"?(it("if(",sn,">0){"),On(),it("}else if(",sn,"<0){"),jn(),it("}")):On():jn()}function vi(De,Se,it,Tt,nr){var dt=Ii(),lt=dt.proc("body",nr);return ie.optional(function(){dt.commandStr=Se.commandStr,dt.command=dt.link(Se.commandStr)}),Yr&&(dt.instancing=lt.def(dt.shared.extensions,".angle_instanced_arrays")),De(dt,lt,it,Tt),dt.compile().body}function sa(De,Se,it,Tt){Vo(De,Se),it.useVAO?it.drawVAO?Se(De.shared.vao,".setVAO(",it.drawVAO.append(De,Se),");"):Se(De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"):(Se(De.shared.vao,".setVAO(null);"),Jo(De,Se,it,Tt.attributes,function(){return!0})),xa(De,Se,it,Tt.uniforms,function(){return!0},!1),ro(De,Se,Se,it)}function Ga(De,Se){var it=De.proc("draw",1);Vo(De,it),jo(De,it,Se.context),os(De,it,Se.framebuffer),$o(De,it,Se),Co(De,it,Se.state),ji(De,it,Se,!1,!0);var Tt=Se.shader.progVar.append(De,it);if(it(De.shared.gl,".useProgram(",Tt,".program);"),Se.shader.program)sa(De,it,Se,Se.shader.program);else{it(De.shared.vao,".setVAO(null);");var nr=De.global.def("{}"),dt=it.def(Tt,".id"),lt=it.def(nr,"[",dt,"]");it(De.cond(lt).then(lt,".call(this,a0);").else(lt,"=",nr,"[",dt,"]=",De.link(function(at){return vi(sa,De,Se,at,1)}),"(",Tt,");",lt,".call(this,a0);"))}Object.keys(Se.state).length>0&&it(De.shared.current,".dirty=true;"),De.shared.vao&&it(De.shared.vao,".setVAO(null);")}function uo(De,Se,it,Tt){De.batchId="a1",Vo(De,Se);function nr(){return!0}Jo(De,Se,it,Tt.attributes,nr),xa(De,Se,it,Tt.uniforms,nr,!1),ro(De,Se,Se,it)}function Qu(De,Se,it,Tt){Vo(De,Se);var nr=it.contextDep,dt=Se.def(),lt="a0",at="a1",Oe=Se.def();De.shared.props=Oe,De.batchId=dt;var tt=De.scope(),Fe=De.scope();Se(tt.entry,"for(",dt,"=0;",dt,"<",at,";++",dt,"){",Oe,"=",lt,"[",dt,"];",Fe,"}",tt.exit);function Dt(un){return un.contextDep&&nr||un.propDep}function Vt(un){return!Dt(un)}if(it.needsContext&&jo(De,Fe,it.context),it.needsFramebuffer&&os(De,Fe,it.framebuffer),Co(De,Fe,it.state,Dt),it.profile&&Dt(it.profile)&&ji(De,Fe,it,!1,!0),Tt)it.useVAO?it.drawVAO?Dt(it.drawVAO)?Fe(De.shared.vao,".setVAO(",it.drawVAO.append(De,Fe),");"):tt(De.shared.vao,".setVAO(",it.drawVAO.append(De,tt),");"):tt(De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"):(tt(De.shared.vao,".setVAO(null);"),Jo(De,tt,it,Tt.attributes,Vt),Jo(De,Fe,it,Tt.attributes,Dt)),xa(De,tt,it,Tt.uniforms,Vt,!1),xa(De,Fe,it,Tt.uniforms,Dt,!0),ro(De,tt,Fe,it);else{var Dr=De.global.def("{}"),fn=it.shader.progVar.append(De,Fe),sn=Fe.def(fn,".id"),_n=Fe.def(Dr,"[",sn,"]");Fe(De.shared.gl,".useProgram(",fn,".program);","if(!",_n,"){",_n,"=",Dr,"[",sn,"]=",De.link(function(un){return vi(uo,De,it,un,2)}),"(",fn,");}",_n,".call(this,a0[",dt,"],",dt,");")}}function He(De,Se){var it=De.proc("batch",2);De.batchId="0",Vo(De,it);var Tt=!1,nr=!0;Object.keys(Se.context).forEach(function(Dr){Tt=Tt||Se.context[Dr].propDep}),Tt||(jo(De,it,Se.context),nr=!1);var dt=Se.framebuffer,lt=!1;dt?(dt.propDep?Tt=lt=!0:dt.contextDep&&Tt&&(lt=!0),lt||os(De,it,dt)):os(De,it,null),Se.state.viewport&&Se.state.viewport.propDep&&(Tt=!0);function at(Dr){return Dr.contextDep&&Tt||Dr.propDep}$o(De,it,Se),Co(De,it,Se.state,function(Dr){return!at(Dr)}),(!Se.profile||!at(Se.profile))&&ji(De,it,Se,!1,"a1"),Se.contextDep=Tt,Se.needsContext=nr,Se.needsFramebuffer=lt;var Oe=Se.shader.progVar;if(Oe.contextDep&&Tt||Oe.propDep)Qu(De,it,Se,null);else{var tt=Oe.append(De,it);if(it(De.shared.gl,".useProgram(",tt,".program);"),Se.shader.program)Qu(De,it,Se,Se.shader.program);else{it(De.shared.vao,".setVAO(null);");var Fe=De.global.def("{}"),Dt=it.def(tt,".id"),Vt=it.def(Fe,"[",Dt,"]");it(De.cond(Vt).then(Vt,".call(this,a0,a1);").else(Vt,"=",Fe,"[",Dt,"]=",De.link(function(Dr){return vi(Qu,De,Se,Dr,2)}),"(",tt,");",Vt,".call(this,a0,a1);"))}}Object.keys(Se.state).length>0&&it(De.shared.current,".dirty=true;"),De.shared.vao&&it(De.shared.vao,".setVAO(null);")}function cr(De,Se){var it=De.proc("scope",3);De.batchId="a2";var Tt=De.shared,nr=Tt.current;jo(De,it,Se.context),Se.framebuffer&&Se.framebuffer.append(De,it),fh(Object.keys(Se.state)).forEach(function(lt){var at=Se.state[lt],Oe=at.append(De,it);ao(Oe)?Oe.forEach(function(tt,Fe){it.set(De.next[lt],"["+Fe+"]",tt)}):it.set(Tt.next,"."+lt,Oe)}),ji(De,it,Se,!0,!0),[ml,qc,Mo,ef,pu].forEach(function(lt){var at=Se.draw[lt];!at||it.set(Tt.draw,"."+lt,""+at.append(De,it))}),Object.keys(Se.uniforms).forEach(function(lt){var at=Se.uniforms[lt].append(De,it);Array.isArray(at)&&(at="["+at.join()+"]"),it.set(Tt.uniforms,"["+Me.id(lt)+"]",at)}),Object.keys(Se.attributes).forEach(function(lt){var at=Se.attributes[lt].append(De,it),Oe=De.scopeAttrib(lt);Object.keys(new Ot).forEach(function(tt){it.set(Oe,"."+tt,at[tt])})}),Se.scopeVAO&&it.set(Tt.vao,".targetVAO",Se.scopeVAO.append(De,it));function dt(lt){var at=Se.shader[lt];at&&it.set(Tt.shader,"."+lt,at.append(De,it))}dt(Vs),dt(vl),Object.keys(Se.state).length>0&&(it(nr,".dirty=true;"),it.exit(nr,".dirty=true;")),it("a1(",De.shared.context,",a0,",De.batchId,");")}function Kt(De){if(!(typeof De!="object"||ao(De))){for(var Se=Object.keys(De),it=0;it<Se.length;++it)if(Cr.isDynamic(De[Se[it]]))return!0;return!1}}function Fn(De,Se,it){var Tt=Se.static[it];if(!Tt||!Kt(Tt))return;var nr=De.global,dt=Object.keys(Tt),lt=!1,at=!1,Oe=!1,tt=De.global.def("{}");dt.forEach(function(Dt){var Vt=Tt[Dt];if(Cr.isDynamic(Vt)){typeof Vt=="function"&&(Vt=Tt[Dt]=Cr.unbox(Vt));var Dr=du(Vt,null);lt=lt||Dr.thisDep,Oe=Oe||Dr.propDep,at=at||Dr.contextDep}else{switch(nr(tt,".",Dt,"="),typeof Vt){case"number":nr(Vt);break;case"string":nr('"',Vt,'"');break;case"object":Array.isArray(Vt)&&nr("[",Vt.join(),"]");break;default:nr(De.link(Vt));break}nr(";")}});function Fe(Dt,Vt){dt.forEach(function(Dr){var fn=Tt[Dr];if(!!Cr.isDynamic(fn)){var sn=Dt.invoke(Vt,fn);Vt(tt,".",Dr,"=",sn,";")}})}Se.dynamic[it]=new Cr.DynamicVariable(wt,{thisDep:lt,contextDep:at,propDep:Oe,ref:tt,append:Fe}),delete Se.static[it]}function ua(De,Se,it,Tt,nr){var dt=Ii();dt.stats=dt.link(nr),Object.keys(Se.static).forEach(function(at){Fn(dt,Se,at)}),Vp.forEach(function(at){Fn(dt,De,at)});var lt=ds(De,Se,it,Tt,dt);return Ga(dt,lt),cr(dt,lt),He(dt,lt),p(dt.compile(),{destroy:function(){lt.shader.program.destroy()}})}return{next:qr,current:wn,procs:function(){var De=Ii(),Se=De.proc("poll"),it=De.proc("refresh"),Tt=De.block();Se(Tt),it(Tt);var nr=De.shared,dt=nr.gl,lt=nr.next,at=nr.current;Tt(at,".dirty=false;"),os(De,Se),os(De,it,null,!0);var Oe;Yr&&(Oe=De.link(Yr)),$e.oes_vertex_array_object&&it(De.link($e.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var tt=0;tt<ar.maxAttributes;++tt){var Fe=it.def(nr.attributes,"[",tt,"]"),Dt=De.cond(Fe,".buffer");Dt.then(dt,".enableVertexAttribArray(",tt,");",dt,".bindBuffer(",vf,",",Fe,".buffer.buffer);",dt,".vertexAttribPointer(",tt,",",Fe,".size,",Fe,".type,",Fe,".normalized,",Fe,".stride,",Fe,".offset);").else(dt,".disableVertexAttribArray(",tt,");",dt,".vertexAttrib4f(",tt,",",Fe,".x,",Fe,".y,",Fe,".z,",Fe,".w);",Fe,".buffer=null;"),it(Dt),Yr&&it(Oe,".vertexAttribDivisorANGLE(",tt,",",Fe,".divisor);")}return it(De.shared.vao,".currentVAO=null;",De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"),Object.keys(Tr).forEach(function(Vt){var Dr=Tr[Vt],fn=Tt.def(lt,".",Vt),sn=De.block();sn("if(",fn,"){",dt,".enable(",Dr,")}else{",dt,".disable(",Dr,")}",at,".",Vt,"=",fn,";"),it(sn),Se("if(",fn,"!==",at,".",Vt,"){",sn,"}")}),Object.keys(br).forEach(function(Vt){var Dr=br[Vt],fn=wn[Vt],sn,_n,un=De.block();if(un(dt,".",Dr,"("),ao(fn)){var Yn=fn.length;sn=De.global.def(lt,".",Vt),_n=De.global.def(at,".",Vt),un(ve(Yn,function(On){return sn+"["+On+"]"}),");",ve(Yn,function(On){return _n+"["+On+"]="+sn+"["+On+"];"}).join("")),Se("if(",ve(Yn,function(On){return sn+"["+On+"]!=="+_n+"["+On+"]"}).join("||"),"){",un,"}")}else sn=Tt.def(lt,".",Vt),_n=Tt.def(at,".",Vt),un(sn,");",at,".",Vt,"=",sn,";"),Se("if(",sn,"!==",_n,"){",un,"}");it(un)}),De.compile()}(),compile:ua}}function Xh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Yh=34918,ph=34919,Kh=35007,$h=function(V,Me){if(!Me.ext_disjoint_timer_query)return null;var $e=[];function ar(){return $e.pop()||Me.ext_disjoint_timer_query.createQueryEXT()}function Mr(Yr){$e.push(Yr)}var rr=[];function Er(Yr){var Cn=ar();Me.ext_disjoint_timer_query.beginQueryEXT(Kh,Cn),rr.push(Cn),Wr(rr.length-1,rr.length,Yr)}function Fr(){Me.ext_disjoint_timer_query.endQueryEXT(Kh)}function Gr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Kr=[];function Qr(){return Kr.pop()||new Gr}function tn(Yr){Kr.push(Yr)}var pn=[];function Wr(Yr,Cn,Ar){var wn=Qr();wn.startQueryIndex=Yr,wn.endQueryIndex=Cn,wn.sum=0,wn.stats=Ar,pn.push(wn)}var en=[],Ot=[];function pr(){var Yr,Cn,Ar=rr.length;if(Ar!==0){Ot.length=Math.max(Ot.length,Ar+1),en.length=Math.max(en.length,Ar+1),en[0]=0,Ot[0]=0;var wn=0;for(Yr=0,Cn=0;Cn<rr.length;++Cn){var qr=rr[Cn];Me.ext_disjoint_timer_query.getQueryObjectEXT(qr,ph)?(wn+=Me.ext_disjoint_timer_query.getQueryObjectEXT(qr,Yh),Mr(qr)):rr[Yr++]=qr,en[Cn+1]=wn,Ot[Cn+1]=Yr}for(rr.length=Yr,Yr=0,Cn=0;Cn<pn.length;++Cn){var ci=pn[Cn],Tr=ci.startQueryIndex,br=ci.endQueryIndex;ci.sum+=en[br]-en[Tr];var Wn=Ot[Tr],hn=Ot[br];hn===Wn?(ci.stats.gpuTime+=ci.sum/1e6,tn(ci)):(ci.startQueryIndex=Wn,ci.endQueryIndex=hn,pn[Yr++]=ci)}pn.length=Yr}}return{beginQuery:Er,endQuery:Fr,pushScopeStats:Wr,update:pr,getNumPendingQueries:function(){return rr.length},clear:function(){$e.push.apply($e,rr);for(var Yr=0;Yr<$e.length;Yr++)Me.ext_disjoint_timer_query.deleteQueryEXT($e[Yr]);rr.length=0,$e.length=0},restore:function(){rr.length=0,$e.length=0}}},Ep=16384,wp=256,wf=1024,Jh=34962,Cc="webglcontextlost",Cf="webglcontextrestored",Ja=1,Qh=2,nc=3;function Ac(V,Me){for(var $e=0;$e<V.length;++$e)if(V[$e]===Me)return $e;return-1}function dh(V){var Me=z(V);if(!Me)return null;var $e=Me.gl,ar=$e.getContextAttributes(),Mr=$e.isContextLost(),rr=oe($e,Me);if(!rr)return null;var Er=zi(),Fr=Xh(),Gr=rr.extensions,Kr=$h($e,Gr),Qr=Si(),tn=$e.drawingBufferWidth,pn=$e.drawingBufferHeight,Wr={tick:0,time:0,viewportWidth:tn,viewportHeight:pn,framebufferWidth:tn,framebufferHeight:pn,drawingBufferWidth:tn,drawingBufferHeight:pn,pixelRatio:Me.pixelRatio},en={},Ot={elements:null,primitive:4,count:-1,offset:0,instances:-1},pr=ke($e,Gr),Yr=j($e,Fr,Me,wn),Cn=Bs($e,Gr,Yr,Fr),Ar=bt($e,Gr,pr,Fr,Yr,Cn,Ot);function wn(vi){return Ar.destroyBuffer(vi)}var qr=Nr($e,Er,Fr,Me),ci=lu($e,Gr,pr,function(){Wn.procs.poll()},Wr,Fr,Me),Tr=Nc($e,Gr,pr,Fr,Me),br=Pe($e,Gr,pr,ci,Tr,Fr),Wn=Wh($e,Er,Gr,pr,Yr,Cn,ci,br,en,Ar,qr,Ot,Wr,Kr,Me),hn=hi($e,br,Wn.procs.poll,Wr,ar,Gr,pr),$r=Wn.next,gn=$e.canvas,Sn=[],Ri=[],Ii=[],Tn=[Me.onDestroy],An=null;function wi(){if(Sn.length===0){Kr&&Kr.update(),An=null;return}An=kn.next(wi),Vo();for(var vi=Sn.length-1;vi>=0;--vi){var sa=Sn[vi];sa&&sa(Wr,null,0)}$e.flush(),Kr&&Kr.update()}function Bi(){!An&&Sn.length>0&&(An=kn.next(wi))}function Fi(){An&&(kn.cancel(wi),An=null)}function vo(vi){vi.preventDefault(),Mr=!0,Fi(),Ri.forEach(function(sa){sa()})}function wo(vi){$e.getError(),Mr=!1,rr.restore(),qr.restore(),Yr.restore(),ci.restore(),Tr.restore(),br.restore(),Ar.restore(),Kr&&Kr.restore(),Wn.procs.refresh(),Bi(),Ii.forEach(function(sa){sa()})}var ra=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!ra&&gn&&(gn.addEventListener(Cc,vo,!1),gn.addEventListener(Cf,wo,!1));function Ls(){Sn.length=0,Fi(),!ra&&gn&&(gn.removeEventListener(Cc,vo),gn.removeEventListener(Cf,wo)),qr.clear(),br.clear(),Tr.clear(),Ar.clear(),ci.clear(),Cn.clear(),Yr.clear(),Kr&&Kr.clear(),Tn.forEach(function(vi){vi()})}function so(vi){ie(!!vi,"invalid args to regl({...})"),ie.type(vi,"object","invalid args to regl({...})");function sa(dt){var lt=p({},dt);delete lt.uniforms,delete lt.attributes,delete lt.context,delete lt.vao,"stencil"in lt&&lt.stencil.op&&(lt.stencil.opBack=lt.stencil.opFront=lt.stencil.op,delete lt.stencil.op);function at(Oe){if(Oe in lt){var tt=lt[Oe];delete lt[Oe],Object.keys(tt).forEach(function(Fe){lt[Oe+"."+Fe]=tt[Fe]})}}return at("blend"),at("depth"),at("cull"),at("stencil"),at("polygonOffset"),at("scissor"),at("sample"),"vao"in dt&&(lt.vao=dt.vao),lt}function Ga(dt,lt){var at={},Oe={};return Object.keys(dt).forEach(function(tt){var Fe=dt[tt];if(Cr.isDynamic(Fe)){Oe[tt]=Cr.unbox(Fe,tt);return}else if(lt&&Array.isArray(Fe)){for(var Dt=0;Dt<Fe.length;++Dt)if(Cr.isDynamic(Fe[Dt])){Oe[tt]=Cr.unbox(Fe,tt);return}}at[tt]=Fe}),{dynamic:Oe,static:at}}var uo=Ga(vi.context||{},!0),Qu=Ga(vi.uniforms||{},!0),He=Ga(vi.attributes||{},!1),cr=Ga(sa(vi),!1),Kt={gpuTime:0,cpuTime:0,count:0},Fn=Wn.compile(cr,He,Qu,uo,Kt),ua=Fn.draw,De=Fn.batch,Se=Fn.scope,it=[];function Tt(dt){for(;it.length<dt;)it.push(null);return it}function nr(dt,lt){var at;if(Mr&&ie.raise("context lost"),typeof dt=="function")return Se.call(this,null,dt,0);if(typeof lt=="function")if(typeof dt=="number")for(at=0;at<dt;++at)Se.call(this,null,lt,at);else if(Array.isArray(dt))for(at=0;at<dt.length;++at)Se.call(this,dt[at],lt,at);else return Se.call(this,dt,lt,0);else if(typeof dt=="number"){if(dt>0)return De.call(this,Tt(dt|0),dt|0)}else if(Array.isArray(dt)){if(dt.length)return De.call(this,dt,dt.length)}else return ua.call(this,dt)}return p(nr,{stats:Kt,destroy:function(){Fn.destroy()}})}var ds=br.setFBO=so({framebuffer:Cr.define.call(null,Ja,"framebuffer")});function jo(vi,sa){var Ga=0;Wn.procs.poll();var uo=sa.color;uo&&($e.clearColor(+uo[0]||0,+uo[1]||0,+uo[2]||0,+uo[3]||0),Ga|=Ep),"depth"in sa&&($e.clearDepth(+sa.depth),Ga|=wp),"stencil"in sa&&($e.clearStencil(sa.stencil|0),Ga|=wf),ie(!!Ga,"called regl.clear with no buffer specified"),$e.clear(Ga)}function os(vi){if(ie(typeof vi=="object"&&vi,"regl.clear() takes an object as input"),"framebuffer"in vi)if(vi.framebuffer&&vi.framebuffer_reglType==="framebufferCube")for(var sa=0;sa<6;++sa)ds(p({framebuffer:vi.framebuffer.faces[sa]},vi),jo);else ds(vi,jo);else jo(null,vi)}function $o(vi){ie.type(vi,"function","regl.frame() callback must be a function"),Sn.push(vi);function sa(){var Ga=Ac(Sn,vi);ie(Ga>=0,"cannot cancel a frame twice");function uo(){var Qu=Ac(Sn,uo);Sn[Qu]=Sn[Sn.length-1],Sn.length-=1,Sn.length<=0&&Fi()}Sn[Ga]=uo}return Bi(),{cancel:sa}}function Co(){var vi=$r.viewport,sa=$r.scissor_box;vi[0]=vi[1]=sa[0]=sa[1]=0,Wr.viewportWidth=Wr.framebufferWidth=Wr.drawingBufferWidth=vi[2]=sa[2]=$e.drawingBufferWidth,Wr.viewportHeight=Wr.framebufferHeight=Wr.drawingBufferHeight=vi[3]=sa[3]=$e.drawingBufferHeight}function Vo(){Wr.tick+=1,Wr.time=Jo(),Co(),Wn.procs.poll()}function ji(){ci.refresh(),Co(),Wn.procs.refresh(),Kr&&Kr.update()}function Jo(){return(Si()-Qr)/1e3}ji();function xa(vi,sa){ie.type(sa,"function","listener callback must be a function");var Ga;switch(vi){case"frame":return $o(sa);case"lost":Ga=Ri;break;case"restore":Ga=Ii;break;case"destroy":Ga=Tn;break;default:ie.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ga.push(sa),{cancel:function(){for(var uo=0;uo<Ga.length;++uo)if(Ga[uo]===sa){Ga[uo]=Ga[Ga.length-1],Ga.pop();return}}}}var ro=p(so,{clear:os,prop:Cr.define.bind(null,Ja),context:Cr.define.bind(null,Qh),this:Cr.define.bind(null,nc),draw:so({}),buffer:function(vi){return Yr.create(vi,Jh,!1,!1)},elements:function(vi){return Cn.create(vi,!1)},texture:ci.create2D,cube:ci.createCube,renderbuffer:Tr.create,framebuffer:br.create,framebufferCube:br.createCube,vao:Ar.createVAO,attributes:ar,frame:$o,on:xa,limits:pr,hasExtension:function(vi){return pr.extensions.indexOf(vi.toLowerCase())>=0},read:hn,destroy:Ls,_gl:$e,_refresh:ji,poll:function(){Vo(),Kr&&Kr.update()},now:Jo,stats:Fr});return Me.onDone(null,ro),ro}return dh})},49029:function(Or){var U=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function E(le){return le.match(U)||[]}Or.exports=E},29750:function(Or){function U(E,le,C){return E===E&&(C!==void 0&&(E=E<=C?E:C),le!==void 0&&(E=E>=le?E:le)),E}Or.exports=U},18674:function(Or){function U(E){return function(le){return E==null?void 0:E[le]}}Or.exports=U},98805:function(Or,U,E){var le=E(40180),C=E(62689),p=E(83140),A=E(79833);function Q(Y){return function(W){W=A(W);var L=C(W)?p(W):void 0,N=L?L[0]:W.charAt(0),Be=L?le(L,1).join(""):W.slice(1);return N[Y]()+Be}}Or.exports=Q},35393:function(Or,U,E){var le=E(62663),C=E(53816),p=E(58748),A="['\u2019]",Q=RegExp(A,"g");function Y(W){return function(L){return le(p(C(L).replace(Q,"")),W,"")}}Or.exports=Y},69389:function(Or,U,E){var le=E(18674),C={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=le(C);Or.exports=p},93157:function(Or){var U=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function E(le){return U.test(le)}Or.exports=E},2757:function(Or){var U="\\ud800-\\udfff",E="\\u0300-\\u036f",le="\\ufe20-\\ufe2f",C="\\u20d0-\\u20ff",p=E+le+C,A="\\u2700-\\u27bf",Q="a-z\\xdf-\\xf6\\xf8-\\xff",Y="\\xac\\xb1\\xd7\\xf7",W="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",L="\\u2000-\\u206f",N=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Be="A-Z\\xc0-\\xd6\\xd8-\\xde",Ye="\\ufe0e\\ufe0f",Je=Y+W+L+N,et="['\u2019]",Yt="["+Je+"]",Gt="["+p+"]",tr="\\d+",zt="["+A+"]",Pt="["+Q+"]",xt="[^"+U+Je+tr+A+Q+Be+"]",yr="\\ud83c[\\udffb-\\udfff]",ee="(?:"+Gt+"|"+yr+")",vr="[^"+U+"]",Ct="(?:\\ud83c[\\udde6-\\uddff]){2}",Ke="[\\ud800-\\udbff][\\udc00-\\udfff]",Rt="["+Be+"]",Xe="\\u200d",Ut="(?:"+Pt+"|"+xt+")",_r="(?:"+Rt+"|"+xt+")",or="(?:"+et+"(?:d|ll|m|re|s|t|ve))?",zr="(?:"+et+"(?:D|LL|M|RE|S|T|VE))?",he=ee+"?",Re="["+Ye+"]?",ye="(?:"+Xe+"(?:"+[vr,Ct,Ke].join("|")+")"+Re+he+")*",_t="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ft="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Nt=Re+he+ye,Ft="(?:"+[zt,Ct,Ke].join("|")+")"+Nt,kr=RegExp([Rt+"?"+Pt+"+"+or+"(?="+[Yt,Rt,"$"].join("|")+")",_r+"+"+zr+"(?="+[Yt,Rt+Ut,"$"].join("|")+")",Rt+"?"+Ut+"+"+or,Rt+"+"+zr,ft,_t,tr,Ft].join("|"),"g");function cn(yn){return yn.match(kr)||[]}Or.exports=cn},68929:function(Or,U,E){var le=E(48403),C=E(35393),p=C(function(A,Q,Y){return Q=Q.toLowerCase(),A+(Y?le(Q):Q)});Or.exports=p},48403:function(Or,U,E){var le=E(79833),C=E(11700);function p(A){return C(le(A).toLowerCase())}Or.exports=p},74691:function(Or,U,E){var le=E(29750),C=E(14841);function p(A,Q,Y){return Y===void 0&&(Y=Q,Q=void 0),Y!==void 0&&(Y=C(Y),Y=Y===Y?Y:0),Q!==void 0&&(Q=C(Q),Q=Q===Q?Q:0),le(C(A),Q,Y)}Or.exports=p},53816:function(Or,U,E){var le=E(69389),C=E(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,A="\\u0300-\\u036f",Q="\\ufe20-\\ufe2f",Y="\\u20d0-\\u20ff",W=A+Q+Y,L="["+W+"]",N=RegExp(L,"g");function Be(Ye){return Ye=C(Ye),Ye&&Ye.replace(p,le).replace(N,"")}Or.exports=Be},14293:function(Or){function U(E){return E==null}Or.exports=U},81763:function(Or,U,E){var le=E(44239),C=E(37005),p="[object Number]";function A(Q){return typeof Q=="number"||C(Q)&&le(Q)==p}Or.exports=A},30236:function(Or,U,E){var le=E(42980),C=E(21463),p=C(function(A,Q,Y,W){le(A,Q,Y,W)});Or.exports=p},44908:function(Or,U,E){var le=E(45652);function C(p){return p&&p.length?le(p):[]}Or.exports=C},11700:function(Or,U,E){var le=E(98805),C=le("toUpperCase");Or.exports=C},58748:function(Or,U,E){var le=E(49029),C=E(93157),p=E(79833),A=E(2757);function Q(Y,W,L){return Y=p(Y),W=L?void 0:W,W===void 0?C(Y)?A(Y):le(Y):Y.match(W)||[]}Or.exports=Q},6158:function(Or){(function(U,E){Or.exports=E()})(this,function(){"use strict";var U,E,le;function C(p,A){if(!U)U=A;else if(!E)E=A;else{var Q="var sharedChunk = {}; ("+U+")(sharedChunk); ("+E+")(sharedChunk);",Y={};U(Y),le=A(Y),typeof window!="undefined"&&(le.workerUrl=window.URL.createObjectURL(new Blob([Q],{type:"text/javascript"})))}}return C(["exports"],function(p){"use strict";function A(e,t){return e(t={exports:{}},t.exports),t.exports}var Q=Y;function Y(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}Y.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},Y.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},Y.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},Y.prototype.solveCurveX=function(e,t){var r,f,v,y,x;for(t===void 0&&(t=1e-6),v=e,x=0;x<8;x++){if(y=this.sampleCurveX(v)-e,Math.abs(y)<t)return v;var M=this.sampleCurveDerivativeX(v);if(Math.abs(M)<1e-6)break;v-=y/M}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(y=this.sampleCurveX(v),Math.abs(y-e)<t)return v;e>y?r=v:f=v,v=.5*(f-r)+r}return v},Y.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var W=L;function L(e,t){this.x=e,this.y=t}L.prototype={clone:function(){return new L(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},L.convert=function(e){return e instanceof L?e:Array.isArray(e)?new L(e[0],e[1]):e};var N=typeof self!="undefined"?self:{},Be=Math.pow(2,53)-1;function Ye(e,t,r,f){var v=new Q(e,t,r,f);return function(y){return v.solve(y)}}var Je=Ye(.25,.1,.25,1);function et(e,t,r){return Math.min(r,Math.max(t,e))}function Yt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Gt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var y=v[f];for(var x in y)e[x]=y[x]}return e}var tr=1;function zt(){return tr++}function Pt(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function xt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function yr(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function ee(e,t){return e.indexOf(t,e.length-t.length)!==-1}function vr(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function Ct(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function Ke(e){return Array.isArray(e)?e.map(Ke):typeof e=="object"&&e?vr(e,Ke):e}var Rt={};function Xe(e){Rt[e]||(typeof console!="undefined"&&console.warn(e),Rt[e]=!0)}function Ut(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function _r(e){for(var t=0,r=0,f=e.length,v=f-1,y=void 0,x=void 0;r<f;v=r++)t+=((x=e[v]).x-(y=e[r]).x)*(y.y+x.y);return t}function or(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function zr(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,y,x){var M=y||x;return t[v]=!M||M.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var he=null;function Re(e){if(he==null){var t=e.navigator?e.navigator.userAgent:null;he=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return he}function ye(e){try{var t=N[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var _t,ft,Nt,Ft,kr=N.performance&&N.performance.now?N.performance.now.bind(N.performance):Date.now.bind(Date),cn=N.requestAnimationFrame||N.mozRequestAnimationFrame||N.webkitRequestAnimationFrame||N.msRequestAnimationFrame,yn=N.cancelAnimationFrame||N.mozCancelAnimationFrame||N.webkitCancelAnimationFrame||N.msCancelAnimationFrame,Vi={now:kr,frame:function(e){var t=cn(e);return{cancel:function(){return yn(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=N.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return _t||(_t=N.document.createElement("a")),_t.href=e,_t.href},hardwareConcurrency:N.navigator&&N.navigator.hardwareConcurrency||4,get devicePixelRatio(){return N.devicePixelRatio},get prefersReducedMotion(){return!!N.matchMedia&&(ft==null&&(ft=N.matchMedia("(prefers-reduced-motion: reduce)")),ft.matches)}},ir={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},de={supported:!1,testSupport:function(e){!Te&&Ft&&(Ue?Le(e):Nt=e)}},Te=!1,Ue=!1;function Le(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Ft),e.isContextLost())return;de.supported=!0}catch(r){}e.deleteTexture(t),Te=!0}N.document&&((Ft=N.document.createElement("img")).onload=function(){Nt&&Le(Nt),Nt=null,Ue=!0},Ft.onerror=function(){Te=!0,Nt=null},Ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var kt="01",er=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function w(e){return e.indexOf("mapbox:")===0}er.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",kt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},er.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},er.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},er.prototype.normalizeStyleURL=function(e,t){if(!w(e))return e;var r=Qe(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},er.prototype.normalizeGlyphsURL=function(e,t){if(!w(e))return e;var r=Qe(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},er.prototype.normalizeSourceURL=function(e,t){if(!w(e))return e;var r=Qe(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},er.prototype.normalizeSpriteURL=function(e,t,r,f){var v=Qe(e);return w(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,yt(v))},er.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!w(e))return e;var r=Qe(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Vi.devicePixelRatio>=2||t===512?"@2x":"")+(de.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var y=0,x=v;y<x.length;y+=1){var M=x[y].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(r.params)||ir.ACCESS_TOKEN;return ir.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},er.prototype.canonicalizeTileURL=function(e,t){var r=Qe(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(y){return!y.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},er.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&w(t),f=[],v=0,y=e.tiles||[];v<y.length;v+=1){var x=y[v];Ee(x)?f.push(this.canonicalizeTileURL(x,r)):f.push(x)}return f},er.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=Qe(ir.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!ir.REQUIRE_ACCESS_TOKEN)return yt(e);if(!(t=t||ir.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(y){return y.indexOf("access_token")===-1}),e.params.push("access_token="+t),yt(e)};var Z=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Ee(e){return Z.test(e)}var je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qe(e){var t=e.match(je);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function yt(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function St(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(N.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var jt=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};jt.prototype.getStorageKey=function(e){var t,r=St(ir.ACCESS_TOKEN);return t=r&&r.u?N.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):ir.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},jt.prototype.fetchEventData=function(){var e=ye("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=N.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=N.localStorage.getItem(r);v&&(this.anonId=v)}catch(y){Xe("Unable to read from LocalStorage")}},jt.prototype.saveEventData=function(){var e=ye("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{N.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&N.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){Xe("Unable to write to LocalStorage")}},jt.prototype.processRequests=function(e){},jt.prototype.postEvent=function(e,t,r,f){var v=this;if(ir.EVENTS_URL){var y=Qe(ir.EVENTS_URL);y.params.push("access_token="+(f||ir.ACCESS_TOKEN||""));var x={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:kt,userId:this.anonId},M=t?Gt(x,t):x,B={url:yt(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Oi(B,function(G){v.pendingRequest=null,r(G),v.saveEventData(),v.processRequests(f)})}},jt.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Et,Qt,ie=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,y){this.skuToken=v,(ir.EVENTS_URL&&y||ir.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(x){return w(x)||Ee(x)}))&&this.queueRequest({id:f,timestamp:Date.now()},y)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),y=v.id,x=v.timestamp;y&&this.success[y]||(this.anonId||this.fetchEventData(),xt(this.anonId)||(this.anonId=Pt()),this.postEvent(x,{skuToken:this.skuToken},function(M){M||y&&(f.success[y]=!0)},r))}},t}(jt),sr=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){ir.EVENTS_URL&&ir.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return w(v)||Ee(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=St(ir.ACCESS_TOKEN),y=v?v.u:ir.ACCESS_TOKEN,x=y!==this.eventData.tokenU;xt(this.anonId)||(this.anonId=Pt(),x=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var B=new Date(this.eventData.lastSuccess),G=new Date(M),K=(M-this.eventData.lastSuccess)/864e5;x=x||K>=1||K<-1||B.getDate()!==G.getDate()}else x=!0;if(!x)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(re){re||(f.eventData.lastSuccess=M,f.eventData.tokenU=y)},r)}},t}(jt)),Br=sr.postTurnstileEvent.bind(sr),Lr=new ie,rt=Lr.postMapLoadEvent.bind(Lr),gt=500,pt=50;function dr(){N.caches&&!Et&&(Et=N.caches.open("mapbox-tiles"))}function Vr(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Ur,nn=1/0;function Jr(){return Ur==null&&(Ur=N.OffscreenCanvas&&new N.OffscreenCanvas(1,1).getContext("2d")&&typeof N.createImageBitmap=="function"),Ur}var Cr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Cr);var kn=function(e){function t(r,f,v){f===401&&Ee(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),Zn=or()?function(){return self.worker&&self.worker.referrer}:function(){return(N.location.protocol==="blob:"?N.parent:N).location.href},Si,zi,Ji=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Zn())&&!/^\w+:/.test(r))){if(N.fetch&&N.Request&&N.AbortController&&N.Request.prototype.hasOwnProperty("signal"))return function(f,v){var y,x=new N.AbortController,M=new N.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Zn(),signal:x.signal}),B=!1,G=!1,K=(y=M.url).indexOf("sku=")>0&&Ee(y);f.type==="json"&&M.headers.set("Accept","application/json");var re=function(ge,Ze,Ge){if(!G){if(ge&&ge.message!=="SecurityError"&&Xe(ge),Ze&&Ge)return fe(Ze);var vt=Date.now();N.fetch(M).then(function(qe){if(qe.ok){var Mt=K?qe.clone():null;return fe(qe,Mt,vt)}return v(new kn(qe.statusText,qe.status,f.url))}).catch(function(qe){qe.code!==20&&v(new Error(qe.message))})}},fe=function(ge,Ze,Ge){(f.type==="arrayBuffer"?ge.arrayBuffer():f.type==="json"?ge.json():ge.text()).then(function(vt){G||(Ze&&Ge&&function(qe,Mt,Wt){if(dr(),Et){var lr={status:Mt.status,statusText:Mt.statusText,headers:new N.Headers};Mt.headers.forEach(function(Ir,rn){return lr.headers.set(rn,Ir)});var fr=zr(Mt.headers.get("Cache-Control")||"");fr["no-store"]||(fr["max-age"]&&lr.headers.set("Expires",new Date(Wt+1e3*fr["max-age"]).toUTCString()),new Date(lr.headers.get("Expires")).getTime()-Wt<42e4||function(Ir,rn){if(Qt===void 0)try{new Response(new ReadableStream),Qt=!0}catch(mn){Qt=!1}Qt?rn(Ir.body):Ir.blob().then(rn)}(Mt,function(Ir){var rn=new N.Response(Ir,lr);dr(),Et&&Et.then(function(mn){return mn.put(Vr(qe.url),rn)}).catch(function(mn){return Xe(mn.message)})}))}}(M,Ze,Ge),B=!0,v(null,vt,ge.headers.get("Cache-Control"),ge.headers.get("Expires")))}).catch(function(vt){G||v(new Error(vt.message))})};return K?function(ge,Ze){if(dr(),!Et)return Ze(null);var Ge=Vr(ge.url);Et.then(function(vt){vt.match(Ge).then(function(qe){var Mt=function(Wt){if(!Wt)return!1;var lr=new Date(Wt.headers.get("Expires")||0),fr=zr(Wt.headers.get("Cache-Control")||"");return lr>Date.now()&&!fr["no-cache"]}(qe);vt.delete(Ge),Mt&&vt.put(Ge,qe.clone()),Ze(null,qe,Mt)}).catch(Ze)}).catch(Ze)}(M,re):re(null,null),{cancel:function(){G=!0,B||x.abort()}}}(e,t);if(or()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var y=new N.XMLHttpRequest;for(var x in y.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(y.responseType="arraybuffer"),f.headers)y.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=f.credentials==="include",y.onerror=function(){v(new Error(y.statusText))},y.onload=function(){if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){var M=y.response;if(f.type==="json")try{M=JSON.parse(y.response)}catch(B){return v(B)}v(null,M,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else v(new kn(y.statusText,y.status,f.url))},y.send(f.body),{cancel:function(){return y.abort()}}}(e,t)},Di=function(e,t){return Ji(Gt(e,{type:"arrayBuffer"}),t)},Oi=function(e,t){return Ji(Gt(e,{method:"POST"}),t)},X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Si=[],zi=0;var ce=function(e,t){if(de.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),zi>=ir.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return Si.push(r),r}zi++;var f=!1,v=function(){if(!f)for(f=!0,zi--;Si.length&&zi<ir.MAX_PARALLEL_IMAGE_REQUESTS;){var x=Si.shift();x.cancelled||(x.cancel=ce(x.requestParameters,x.callback).cancel)}},y=Di(e,function(x,M,B,G){v(),x?t(x):M&&(Jr()?function(K,re){var fe=new N.Blob([new Uint8Array(K)],{type:"image/png"});N.createImageBitmap(fe).then(function(ge){re(null,ge)}).catch(function(ge){re(new Error("Could not load image because of "+ge.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,t):function(K,re,fe,ge){var Ze=new N.Image,Ge=N.URL;Ze.onload=function(){re(null,Ze),Ge.revokeObjectURL(Ze.src),Ze.onload=null,N.requestAnimationFrame(function(){Ze.src=X})},Ze.onerror=function(){return re(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var vt=new N.Blob([new Uint8Array(K)],{type:"image/png"});Ze.cacheControl=fe,Ze.expires=ge,Ze.src=K.byteLength?Ge.createObjectURL(vt):X}(M,t,B,G))});return{cancel:function(){y.cancel(),v()}}};function me(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function z(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var oe=function(e,t){t===void 0&&(t={}),Gt(this,t),this.type=e},ve=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Gt({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(oe),Ae=function(){};Ae.prototype.on=function(e,t){return this._listeners=this._listeners||{},me(e,t,this._listeners),this},Ae.prototype.off=function(e,t){return z(e,t,this._listeners),z(e,t,this._oneTimeListeners),this},Ae.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},me(e,t,this._oneTimeListeners),this},Ae.prototype.fire=function(e,t){typeof e=="string"&&(e=new oe(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var y=0,x=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];y<x.length;y+=1){var M=x[y];z(r,M,this._oneTimeListeners),M.call(this,e)}var B=this._eventedParent;B&&(Gt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),B.fire(e))}else e instanceof ve&&console.error(e.error);return this},Ae.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Ae.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var se={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ce=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function ct(e){var t=e.value;return t?[new Ce(e.key,t,"constants have been deprecated as of v8")]:[]}function xr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var y=v[f];for(var x in y)e[x]=y[x]}return e}function Ht(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Jt(e){if(Array.isArray(e))return e.map(Jt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Jt(e[r]);return t}return Ht(e)}var Rr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Mn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};Mn.prototype.concat=function(e){return new Mn(this,e)},Mn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Mn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Pn={kind:"null"},$t={kind:"number"},En={kind:"string"},on={kind:"boolean"},ln={kind:"color"},Ai={kind:"object"},bn={kind:"value"},Li={kind:"collator"},Yi={kind:"formatted"},si={kind:"resolvedImage"};function Ki(e,t){return{kind:"array",itemType:e,N:t}}function Ni(e){if(e.kind==="array"){var t=Ni(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var Ti=[Pn,$t,En,on,ln,Yi,Ai,Ki(bn),si];function ca(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ca(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=Ti;r<f.length;r+=1)if(!ca(f[r],t))return null}}return"Expected "+Ni(e)+" but found "+Ni(t)+" instead."}function Sa(e,t){return t.some(function(r){return r.kind===e.kind})}function oi(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var ri=A(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(M){return(M=Math.round(M))<0?0:M>255?255:M}function v(M){return f(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function y(M){return(B=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:B>1?1:B;var B}function x(M,B,G){return G<0?G+=1:G>1&&(G-=1),6*G<1?M+(B-M)*G*6:2*G<1?B:3*G<2?M+(B-M)*(2/3-G)*6:M}try{t.parseCSSColor=function(M){var B,G=M.replace(/ /g,"").toLowerCase();if(G in r)return r[G].slice();if(G[0]==="#")return G.length===4?(B=parseInt(G.substr(1),16))>=0&&B<=4095?[(3840&B)>>4|(3840&B)>>8,240&B|(240&B)>>4,15&B|(15&B)<<4,1]:null:G.length===7&&(B=parseInt(G.substr(1),16))>=0&&B<=16777215?[(16711680&B)>>16,(65280&B)>>8,255&B,1]:null;var K=G.indexOf("("),re=G.indexOf(")");if(K!==-1&&re+1===G.length){var fe=G.substr(0,K),ge=G.substr(K+1,re-(K+1)).split(","),Ze=1;switch(fe){case"rgba":if(ge.length!==4)return null;Ze=y(ge.pop());case"rgb":return ge.length!==3?null:[v(ge[0]),v(ge[1]),v(ge[2]),Ze];case"hsla":if(ge.length!==4)return null;Ze=y(ge.pop());case"hsl":if(ge.length!==3)return null;var Ge=(parseFloat(ge[0])%360+360)%360/360,vt=y(ge[1]),qe=y(ge[2]),Mt=qe<=.5?qe*(vt+1):qe+vt-qe*vt,Wt=2*qe-Mt;return[f(255*x(Wt,Mt,Ge+1/3)),f(255*x(Wt,Mt,Ge)),f(255*x(Wt,Mt,Ge-1/3)),Ze];default:return null}}return null}}catch(M){}}).parseCSSColor,Gi=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};Gi.parse=function(e){if(e){if(e instanceof Gi)return e;if(typeof e=="string"){var t=ri(e);if(t)return new Gi(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Gi.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Gi.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Gi.black=new Gi(0,0,0,1),Gi.white=new Gi(1,1,1,1),Gi.transparent=new Gi(0,0,0,0),Gi.red=new Gi(1,0,0,1);var pa=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};pa.prototype.compare=function(e,t){return this.collator.compare(e,t)},pa.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Ho=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},ya=function(e){this.sections=e};ya.fromString=function(e){return new ya([new Ho(e,null,null,null,null)])},ya.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},ya.factory=function(e){return e instanceof ya?e:ya.fromString(e)},ya.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},ya.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var yi=function(e){this.name=e.name,this.available=e.available};function ga(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ws(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Gi||e instanceof pa||e instanceof ya||e instanceof yi)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!Ws(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!Ws(e[f]))return!1;return!0}return!1}function Ea(e){if(e===null)return Pn;if(typeof e=="string")return En;if(typeof e=="boolean")return on;if(typeof e=="number")return $t;if(e instanceof Gi)return ln;if(e instanceof pa)return Li;if(e instanceof ya)return Yi;if(e instanceof yi)return si;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var y=Ea(v[f]);if(t){if(t===y)continue;t=bn;break}t=y}return Ki(t||bn,r)}return Ai}function Ao(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Gi||e instanceof ya||e instanceof yi?e.toString():JSON.stringify(e)}yi.prototype.toString=function(){return this.name},yi.fromString=function(e){return e?new yi({name:e,available:!1}):null},yi.prototype.serialize=function(){return["image",this.name]};var Xa=function(e,t){this.type=e,this.value=t};Xa.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!Ws(e[1]))return t.error("invalid value");var r=e[1],f=Ea(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Xa(f,r)},Xa.prototype.evaluate=function(){return this.value},Xa.prototype.eachChild=function(){},Xa.prototype.outputDefined=function(){return!0},Xa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Gi?["rgba"].concat(this.value.toArray()):this.value instanceof ya?this.value.serialize():this.value};var Ya=function(e){this.name="ExpressionEvaluationError",this.message=e};Ya.prototype.toJSON=function(){return this.message};var Wo={string:En,number:$t,boolean:on,object:Ai},Ui=function(e,t){this.type=e,this.args=t};Ui.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var y,x;if(e.length>2){var M=e[1];if(typeof M!="string"||!(M in Wo)||M==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);y=Wo[M],f++}else y=bn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],f++}r=Ki(y,x)}else r=Wo[v];for(var B=[];f<e.length;f++){var G=t.parse(e[f],f,bn);if(!G)return null;B.push(G)}return new Ui(r,B)},Ui.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!ca(this.type,Ea(r)))return r;if(t===this.args.length-1)throw new Ya("Expected value to be of type "+Ni(this.type)+", but found "+Ni(Ea(r))+" instead.")}return null},Ui.prototype.eachChild=function(e){this.args.forEach(e)},Ui.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Ui.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var To=function(e){this.type=Yi,this.sections=e};To.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,y=1;y<=e.length-1;++y){var x=e[y];if(v&&typeof x=="object"&&!Array.isArray(x)){v=!1;var M=null;if(x["font-scale"]&&!(M=t.parse(x["font-scale"],1,$t)))return null;var B=null;if(x["text-font"]&&!(B=t.parse(x["text-font"],1,Ki(En))))return null;var G=null;if(x["text-color"]&&!(G=t.parse(x["text-color"],1,ln)))return null;var K=f[f.length-1];K.scale=M,K.font=B,K.textColor=G}else{var re=t.parse(e[y],1,bn);if(!re)return null;var fe=re.type.kind;if(fe!=="string"&&fe!=="value"&&fe!=="null"&&fe!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:re,scale:null,font:null,textColor:null})}}return new To(f)},To.prototype.evaluate=function(e){return new ya(this.sections.map(function(t){var r=t.content.evaluate(e);return Ea(r)===si?new Ho("",r,null,null,null):new Ho(Ao(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},To.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},To.prototype.outputDefined=function(){return!1},To.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var Lo=function(e){this.type=si,this.input=e};Lo.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,En);return r?new Lo(r):t.error("No image name provided.")},Lo.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=yi.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},Lo.prototype.eachChild=function(e){e(this.input)},Lo.prototype.outputDefined=function(){return!1},Lo.prototype.serialize=function(){return["image",this.input.serialize()]};var lo={"to-boolean":on,"to-color":ln,"to-number":$t,"to-string":En},Ro=function(e,t){this.type=e,this.args=t};Ro.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=lo[r],v=[],y=1;y<e.length;y++){var x=t.parse(e[y],y,bn);if(!x)return null;v.push(x)}return new Ro(f,v)},Ro.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Gi)return t;if(typeof t=="string"){var y=e.parseColor(t);if(y)return y}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":ga(t[0],t[1],t[2],t[3])))return new Gi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ya(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var x=null,M=0,B=this.args;M<B.length;M+=1){if((x=B[M].evaluate(e))===null)return 0;var G=Number(x);if(!isNaN(G))return G}throw new Ya("Could not convert "+JSON.stringify(x)+" to number.")}return this.type.kind==="formatted"?ya.fromString(Ao(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?yi.fromString(Ao(this.args[0].evaluate(e))):Ao(this.args[0].evaluate(e))},Ro.prototype.eachChild=function(e){this.args.forEach(e)},Ro.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Ro.prototype.serialize=function(){if(this.type.kind==="formatted")return new To([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Lo(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Hi=["Unknown","Point","LineString","Polygon"],Ra=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ra.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ra.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Hi[this.feature.type]:this.feature.type:null},Ra.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ra.prototype.canonicalID=function(){return this.canonical},Ra.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ra.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Gi.parse(e)),t};var Fa=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};Fa.prototype.evaluate=function(e){return this._evaluate(e,this.args)},Fa.prototype.eachChild=function(e){this.args.forEach(e)},Fa.prototype.outputDefined=function(){return!1},Fa.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},Fa.parse=function(e,t){var r,f=e[0],v=Fa.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var y=Array.isArray(v)?v[0]:v.type,x=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,M=x.filter(function(ui){var Nn=ui[0];return!Array.isArray(Nn)||Nn.length===e.length-1}),B=null,G=0,K=M;G<K.length;G+=1){var re=K[G],fe=re[0],ge=re[1];B=new Cs(t.registry,t.path,null,t.scope);for(var Ze=[],Ge=!1,vt=1;vt<e.length;vt++){var qe=e[vt],Mt=Array.isArray(fe)?fe[vt-1]:fe.type,Wt=B.parse(qe,1+Ze.length,Mt);if(!Wt){Ge=!0;break}Ze.push(Wt)}if(!Ge)if(Array.isArray(fe)&&fe.length!==Ze.length)B.error("Expected "+fe.length+" arguments, but found "+Ze.length+" instead.");else{for(var lr=0;lr<Ze.length;lr++){var fr=Array.isArray(fe)?fe[lr]:fe.type,Ir=Ze[lr];B.concat(lr+1).checkSubtype(fr,Ir.type)}if(B.errors.length===0)return new Fa(f,y,ge,Ze)}}if(M.length===1)(r=t.errors).push.apply(r,B.errors);else{for(var rn=(M.length?M:x).map(function(ui){var Nn;return Nn=ui[0],Array.isArray(Nn)?"("+Nn.map(Ni).join(", ")+")":"("+Ni(Nn.type)+"...)"}).join(" | "),mn=[],ei=1;ei<e.length;ei++){var Ln=t.parse(e[ei],1+mn.length);if(!Ln)return null;mn.push(Ni(Ln.type))}t.error("Expected arguments of type "+rn+", but found ("+mn.join(", ")+") instead.")}return null},Fa.register=function(e,t){for(var r in Fa.definitions=t,t)e[r]=Fa};var ms=function(e,t,r){this.type=Li,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function _a(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function xe(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function ke(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function ut(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function Xt(e,t){for(var r,f,v,y,x,M,B,G=!1,K=0,re=t.length;K<re;K++)for(var fe=t[K],ge=0,Ze=fe.length;ge<Ze-1;ge++){if((y=(r=e)[0]-(f=fe[ge])[0])*(B=r[1]-(v=fe[ge+1])[1])-(M=r[0]-v[0])*(x=r[1]-f[1])==0&&y*M<=0&&x*B<=0)return!1;ut(e,fe[ge],fe[ge+1])&&(G=!G)}return G}function Xr(e,t){for(var r=0;r<t.length;r++)if(Xt(e,t[r]))return!0;return!1}function Kn(e,t,r,f){var v=f[0]-r[0],y=f[1]-r[1],x=(e[0]-r[0])*y-v*(e[1]-r[1]),M=(t[0]-r[0])*y-v*(t[1]-r[1]);return x>0&&M<0||x<0&&M>0}function gi(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var y=v[f],x=0;x<y.length-1;++x)if((re=[(K=y[x+1])[0]-(G=y[x])[0],K[1]-G[1]])[0]*(fe=[(B=t)[0]-(M=e)[0],B[1]-M[1]])[1]-re[1]*fe[0]!=0&&Kn(M,B,G,K)&&Kn(G,K,M,B))return!0;var M,B,G,K,re,fe;return!1}function io(e,t){for(var r=0;r<e.length;++r)if(!Xt(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(gi(e[f],e[f+1],t))return!1;return!0}function Ka(e,t){for(var r=0;r<t.length;r++)if(io(e,t[r]))return!0;return!1}function co(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var y=[],x=0;x<e[v].length;x++){var M=ke(e[v][x],r);_a(t,M),y.push(M)}f.push(y)}return f}function Xo(e,t,r){for(var f=[],v=0;v<e.length;v++){var y=co(e[v],t,r);f.push(y)}return f}function Xs(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,y=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;y===0&&(y=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=y}_a(t,e)}function ys(e,t,r,f){for(var v=8192*Math.pow(2,f.z),y=[8192*f.x,8192*f.y],x=[],M=0,B=e;M<B.length;M+=1)for(var G=0,K=B[M];G<K.length;G+=1){var re=K[G],fe=[re.x+y[0],re.y+y[1]];Xs(fe,t,r,v),x.push(fe)}return x}function mo(e,t,r,f){for(var v,y=8192*Math.pow(2,f.z),x=[8192*f.x,8192*f.y],M=[],B=0,G=e;B<G.length;B+=1){for(var K=[],re=0,fe=G[B];re<fe.length;re+=1){var ge=fe[re],Ze=[ge.x+x[0],ge.y+x[1]];_a(t,Ze),K.push(Ze)}M.push(K)}if(t[2]-t[0]<=y/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var Ge=0,vt=M;Ge<vt.length;Ge+=1)for(var qe=0,Mt=vt[Ge];qe<Mt.length;qe+=1)Xs(Mt[qe],t,r,y)}return M}ms.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,on);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,on);if(!v)return null;var y=null;return r.locale&&!(y=t.parse(r.locale,1,En))?null:new ms(f,v,y)},ms.prototype.evaluate=function(e){return new pa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},ms.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},ms.prototype.outputDefined=function(){return!1},ms.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var ls=function(e,t){this.type=on,this.geojson=e,this.geometries=t};function No(e){if(e instanceof Fa&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof ls)return!1;var t=!0;return e.eachChild(function(r){t&&!No(r)&&(t=!1)}),t}function Yo(e){if(e instanceof Fa&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!Yo(r)&&(t=!1)}),t}function _o(e,t){if(e instanceof Fa&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!_o(f,t)&&(r=!1)}),r}ls.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(Ws(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ls(r,r.features[f].geometry)}else if(r.type==="Feature"){var y=r.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new ls(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new ls(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ls.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],y=t.canonicalID();if(r.type==="Polygon"){var x=co(r.coordinates,v,y),M=ys(t.geometry(),f,v,y);if(!xe(f,v))return!1;for(var B=0,G=M;B<G.length;B+=1)if(!Xt(G[B],x))return!1}if(r.type==="MultiPolygon"){var K=Xo(r.coordinates,v,y),re=ys(t.geometry(),f,v,y);if(!xe(f,v))return!1;for(var fe=0,ge=re;fe<ge.length;fe+=1)if(!Xr(ge[fe],K))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],y=t.canonicalID();if(r.type==="Polygon"){var x=co(r.coordinates,v,y),M=mo(t.geometry(),f,v,y);if(!xe(f,v))return!1;for(var B=0,G=M;B<G.length;B+=1)if(!io(G[B],x))return!1}if(r.type==="MultiPolygon"){var K=Xo(r.coordinates,v,y),re=mo(t.geometry(),f,v,y);if(!xe(f,v))return!1;for(var fe=0,ge=re;fe<ge.length;fe+=1)if(!Ka(ge[fe],K))return!1}return!0}(e,this.geometries)}return!1},ls.prototype.eachChild=function(){},ls.prototype.outputDefined=function(){return!0},ls.prototype.serialize=function(){return["within",this.geojson]};var Ei=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};Ei.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new Ei(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Ei.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Ei.prototype.eachChild=function(){},Ei.prototype.outputDefined=function(){return!1},Ei.prototype.serialize=function(){return["var",this.name]};var Cs=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new Mn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(y){return"["+y+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function As(e,t){for(var r,f=e.length-1,v=0,y=f,x=0;v<=y;)if((r=e[x=Math.floor((v+y)/2)])<=t){if(x===f||t<e[x+1])return x;v=x+1}else{if(!(r>t))throw new Ya("Input is not a number.");y=x-1}return 0}Cs.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},Cs.prototype._parse=function(e,t){function r(G,K,re){return re==="assert"?new Ui(K,[G]):re==="coerce"?new Ro(K,[G]):G}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var y=v.parse(e,this);if(!y)return null;if(this.expectedType){var x=this.expectedType,M=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||M.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(x,M))return null}else y=r(y,x,t.typeAnnotation||"coerce");else y=r(y,x,t.typeAnnotation||"assert")}if(!(y instanceof Xa)&&y.type.kind!=="resolvedImage"&&function G(K){if(K instanceof Ei)return G(K.boundExpression);if(K instanceof Fa&&K.name==="error"||K instanceof ms||K instanceof ls)return!1;var re=K instanceof Ro||K instanceof Ui,fe=!0;return K.eachChild(function(ge){fe=re?fe&&G(ge):fe&&ge instanceof Xa}),!!fe&&No(K)&&_o(K,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(y)){var B=new Ra;try{y=new Xa(y.type,y.evaluate(B))}catch(G){return this.error(G.message),null}}return y}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Cs.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new Cs(this.registry,f,t||null,v,this.errors)},Cs.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new Rr(f,e))},Cs.prototype.checkSubtype=function(e,t){var r=ca(e,t);return r&&this.error(r),r};var gs=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var y=v[f],x=y[1];this.labels.push(y[0]),this.outputs.push(x)}};function Aa(e,t,r){return e*(1-r)+t*r}gs.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,$t);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var y=1;y<e.length;y+=2){var x=y===1?-1/0:e[y],M=e[y+1],B=y,G=y+1;if(typeof x!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(f.length&&f[f.length-1][0]>=x)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);var K=t.parse(M,G,v);if(!K)return null;v=v||K.type,f.push([x,K])}return new gs(v,r,f)},gs.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[As(t,f)].evaluate(e)},gs.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},gs.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},gs.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var Po=Object.freeze({__proto__:null,number:Aa,color:function(e,t,r){return new Gi(Aa(e.r,t.r,r),Aa(e.g,t.g,r),Aa(e.b,t.b,r),Aa(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return Aa(f,t[v],r)})}}),mu=6/29*3*(6/29),bl=Math.PI/180,Zu=180/Math.PI;function Vl(e){return e>.008856451679035631?Math.pow(e,1/3):e/mu+4/29}function tl(e){return e>6/29?e*e*e:mu*(e-4/29)}function yu(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ba(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ju(e){var t=Ba(e.r),r=Ba(e.g),f=Ba(e.b),v=Vl((.4124564*t+.3575761*r+.1804375*f)/.95047),y=Vl((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*y-16,a:500*(v-y),b:200*(y-Vl((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function m(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*tl(t),r=.95047*tl(r),f=1.08883*tl(f),new Gi(yu(3.2404542*r-1.5371385*t-.4985314*f),yu(-.969266*r+1.8760108*t+.041556*f),yu(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function S(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var j={forward:ju,reverse:m,interpolate:function(e,t,r){return{l:Aa(e.l,t.l,r),a:Aa(e.a,t.a,r),b:Aa(e.b,t.b,r),alpha:Aa(e.alpha,t.alpha,r)}}},O={forward:function(e){var t=ju(e),r=t.l,f=t.a,v=t.b,y=Math.atan2(v,f)*Zu;return{h:y<0?y+360:y,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*bl,r=e.c;return m({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:S(e.h,t.h,r),c:Aa(e.c,t.c,r),l:Aa(e.l,t.l,r),alpha:Aa(e.alpha,t.alpha,r)}}},ue=Object.freeze({__proto__:null,lab:j,hcl:O}),Ie=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var y=0,x=v;y<x.length;y+=1){var M=x[y],B=M[1];this.labels.push(M[0]),this.outputs.push(B)}};function st(e,t,r,f){var v=f-r,y=e-r;return v===0?0:t===1?y/v:(Math.pow(t,y)-1)/(Math.pow(t,v)-1)}Ie.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=st(t,e.base,r,f);else if(e.name==="linear")v=st(t,1,r,f);else if(e.name==="cubic-bezier"){var y=e.controlPoints;v=new Q(y[0],y[1],y[2],y[3]).solve(st(t,1,r,f))}return v},Ie.parse=function(e,t){var r=e[0],f=e[1],v=e[2],y=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var x=f[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:x}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var M=f.slice(1);if(M.length!==4||M.some(function(vt){return typeof vt!="number"||vt<0||vt>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:M}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,$t)))return null;var B=[],G=null;r==="interpolate-hcl"||r==="interpolate-lab"?G=ln:t.expectedType&&t.expectedType.kind!=="value"&&(G=t.expectedType);for(var K=0;K<y.length;K+=2){var re=y[K],fe=y[K+1],ge=K+3,Ze=K+4;if(typeof re!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ge);if(B.length&&B[B.length-1][0]>=re)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ge);var Ge=t.parse(fe,Ze,G);if(!Ge)return null;G=G||Ge.type,B.push([re,Ge])}return G.kind==="number"||G.kind==="color"||G.kind==="array"&&G.itemType.kind==="number"&&typeof G.N=="number"?new Ie(G,r,f,v,B):t.error("Type "+Ni(G)+" is not interpolatable.")},Ie.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var y=As(t,f),x=Ie.interpolationFactor(this.interpolation,f,t[y],t[y+1]),M=r[y].evaluate(e),B=r[y+1].evaluate(e);return this.operator==="interpolate"?Po[this.type.kind.toLowerCase()](M,B,x):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(M),O.forward(B),x)):j.reverse(j.interpolate(j.forward(M),j.forward(B),x))},Ie.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Ie.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Ie.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Lt=function(e,t){this.type=e,this.args=t};Lt.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],y=0,x=e.slice(1);y<x.length;y+=1){var M=t.parse(x[y],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!M)return null;r=r||M.type,v.push(M)}var B=f&&v.some(function(G){return ca(f,G.type)});return new Lt(B?bn:r,v)},Lt.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,y=this.args;v<y.length&&(f++,(r=y[v].evaluate(e))&&r instanceof yi&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Lt.prototype.eachChild=function(e){this.args.forEach(e)},Lt.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Lt.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var It=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};It.prototype.evaluate=function(e){return this.result.evaluate(e)},It.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},It.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var y=t.parse(e[f+1],f+1);if(!y)return null;r.push([v,y])}var x=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return x?new It(r,x):null},It.prototype.outputDefined=function(){return this.result.outputDefined()},It.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var wr=function(e,t,r){this.type=e,this.index=t,this.input=r};wr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,$t),f=t.parse(e[2],2,Ki(t.expectedType||bn));return r&&f?new wr(f.type.itemType,r,f):null},wr.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Ya("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Ya("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Ya("Array index must be an integer, but found "+t+" instead.");return r[t]},wr.prototype.eachChild=function(e){e(this.index),e(this.input)},wr.prototype.outputDefined=function(){return!1},wr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var jr=function(e,t){this.type=on,this.needle=e,this.haystack=t};jr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,bn),f=t.parse(e[2],2,bn);return r&&f?Sa(r.type,[on,En,$t,Pn,bn])?new jr(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ni(r.type)+" instead"):null},jr.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!oi(t,["boolean","string","number","null"]))throw new Ya("Expected first argument to be of type boolean, string, number or null, but found "+Ni(Ea(t))+" instead.");if(!oi(r,["string","array"]))throw new Ya("Expected second argument to be of type array or string, but found "+Ni(Ea(r))+" instead.");return r.indexOf(t)>=0},jr.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},jr.prototype.outputDefined=function(){return!0},jr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Qn=function(e,t,r){this.type=$t,this.needle=e,this.haystack=t,this.fromIndex=r};Qn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,bn),f=t.parse(e[2],2,bn);if(!r||!f)return null;if(!Sa(r.type,[on,En,$t,Pn,bn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ni(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,$t);return v?new Qn(r,f,v):null}return new Qn(r,f)},Qn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!oi(t,["boolean","string","number","null"]))throw new Ya("Expected first argument to be of type boolean, string, number or null, but found "+Ni(Ea(t))+" instead.");if(!oi(r,["string","array"]))throw new Ya("Expected second argument to be of type array or string, but found "+Ni(Ea(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},Qn.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},Qn.prototype.outputDefined=function(){return!1},Qn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Mi=function(e,t,r,f,v,y){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=y};Mi.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},y=[],x=2;x<e.length-1;x+=2){var M=e[x],B=e[x+1];Array.isArray(M)||(M=[M]);var G=t.concat(x);if(M.length===0)return G.error("Expected at least one branch label.");for(var K=0,re=M;K<re.length;K+=1){var fe=re[K];if(typeof fe!="number"&&typeof fe!="string")return G.error("Branch labels must be numbers or strings.");if(typeof fe=="number"&&Math.abs(fe)>Number.MAX_SAFE_INTEGER)return G.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof fe=="number"&&Math.floor(fe)!==fe)return G.error("Numeric branch labels must be integer values.");if(r){if(G.checkSubtype(r,Ea(fe)))return null}else r=Ea(fe);if(v[String(fe)]!==void 0)return G.error("Branch labels must be unique.");v[String(fe)]=y.length}var ge=t.parse(B,x,f);if(!ge)return null;f=f||ge.type,y.push(ge)}var Ze=t.parse(e[1],1,bn);if(!Ze)return null;var Ge=t.parse(e[e.length-1],e.length-1,f);return Ge?Ze.type.kind!=="value"&&t.concat(1).checkSubtype(r,Ze.type)?null:new Mi(r,f,Ze,v,y,Ge):null},Mi.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(Ea(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Mi.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Mi.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Mi.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,y=Object.keys(this.cases).sort();v<y.length;v+=1){var x=y[v];(re=f[this.cases[x]])===void 0?(f[this.cases[x]]=r.length,r.push([this.cases[x],[x]])):r[re][1].push(x)}for(var M=function(ge){return e.inputType.kind==="number"?Number(ge):ge},B=0,G=r;B<G.length;B+=1){var K=G[B],re=K[0],fe=K[1];t.push(fe.length===1?M(fe[0]):fe.map(M)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var fi=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};fi.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var y=t.parse(e[v],v,on);if(!y)return null;var x=t.parse(e[v+1],v+1,r);if(!x)return null;f.push([y,x]),r=r||x.type}var M=t.parse(e[e.length-1],e.length-1,r);return M?new fi(r,f,M):null},fi.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},fi.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},fi.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},fi.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var qn=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function wa(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ka(e,t,r,f){return f.compare(t,r)===0}function Qi(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(y,x,M){this.type=on,this.lhs=y,this.rhs=x,this.collator=M,this.hasUntypedArgument=y.type.kind==="value"||x.type.kind==="value"}return v.parse=function(y,x){if(y.length!==3&&y.length!==4)return x.error("Expected two or three arguments.");var M=y[0],B=x.parse(y[1],1,bn);if(!B)return null;if(!wa(M,B.type))return x.concat(1).error('"'+M+`" comparisons are not supported for type '`+Ni(B.type)+"'.");var G=x.parse(y[2],2,bn);if(!G)return null;if(!wa(M,G.type))return x.concat(2).error('"'+M+`" comparisons are not supported for type '`+Ni(G.type)+"'.");if(B.type.kind!==G.type.kind&&B.type.kind!=="value"&&G.type.kind!=="value")return x.error("Cannot compare types '"+Ni(B.type)+"' and '"+Ni(G.type)+"'.");f&&(B.type.kind==="value"&&G.type.kind!=="value"?B=new Ui(G.type,[B]):B.type.kind!=="value"&&G.type.kind==="value"&&(G=new Ui(B.type,[G])));var K=null;if(y.length===4){if(B.type.kind!=="string"&&G.type.kind!=="string"&&B.type.kind!=="value"&&G.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(!(K=x.parse(y[3],3,Li)))return null}return new v(B,G,K)},v.prototype.evaluate=function(y){var x=this.lhs.evaluate(y),M=this.rhs.evaluate(y);if(f&&this.hasUntypedArgument){var B=Ea(x),G=Ea(M);if(B.kind!==G.kind||B.kind!=="string"&&B.kind!=="number")throw new Ya('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+B.kind+", "+G.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var K=Ea(x),re=Ea(M);if(K.kind!=="string"||re.kind!=="string")return t(y,x,M)}return this.collator?r(y,x,M,this.collator.evaluate(y)):t(y,x,M)},v.prototype.eachChild=function(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var y=[e];return this.eachChild(function(x){y.push(x.serialize())}),y},v}()}qn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,bn),f=t.parse(e[2],2,$t);if(!r||!f)return null;if(!Sa(r.type,[Ki(bn),En,bn]))return t.error("Expected first argument to be of type array or string, but found "+Ni(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,$t);return v?new qn(r.type,r,f,v):null}return new qn(r.type,r,f)},qn.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!oi(t,["string","array"]))throw new Ya("Expected first argument to be of type array or string, but found "+Ni(Ea(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},qn.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},qn.prototype.outputDefined=function(){return!1},qn.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var cs=Qi("==",function(e,t,r){return t===r},ka),xo=Qi("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!ka(0,t,r,f)}),Ts=Qi("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),au=Qi(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),Bs=Qi("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),rl=Qi(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),Ys=function(e,t,r,f,v){this.type=En,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};Ys.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,$t);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,En)))return null;var y=null;if(f.currency&&!(y=t.parse(f.currency,1,En)))return null;var x=null;if(f["min-fraction-digits"]&&!(x=t.parse(f["min-fraction-digits"],1,$t)))return null;var M=null;return f["max-fraction-digits"]&&!(M=t.parse(f["max-fraction-digits"],1,$t))?null:new Ys(r,v,y,x,M)},Ys.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Ys.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Ys.prototype.outputDefined=function(){return!1},Ys.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Ks=function(e){this.type=$t,this.input=e};Ks.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Ni(r.type)+" instead."):new Ks(r):null},Ks.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Ya("Expected value to be of type string or array, but found "+Ni(Ea(t))+" instead.")},Ks.prototype.eachChild=function(e){e(this.input)},Ks.prototype.outputDefined=function(){return!1},Ks.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var $s={"==":cs,"!=":xo,">":au,"<":Ts,">=":rl,"<=":Bs,array:Ui,at:wr,boolean:Ui,case:fi,coalesce:Lt,collator:ms,format:To,image:Lo,in:jr,"index-of":Qn,interpolate:Ie,"interpolate-hcl":Ie,"interpolate-lab":Ie,length:Ks,let:It,literal:Xa,match:Mi,number:Ui,"number-format":Ys,object:Ui,slice:qn,step:gs,string:Ui,"to-boolean":Ro,"to-color":Ro,"to-number":Ro,"to-string":Ro,var:Ei,within:ls};function ao(e,t){var r=t[0],f=t[1],v=t[2],y=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var x=y?y.evaluate(e):1,M=ga(r,f,v,x);if(M)throw new Ya(M);return new Gi(r/255*x,f/255*x,v/255*x,x)}function wu(e,t){return e in t}function nl(e,t){var r=t[e];return r===void 0?null:r}function fs(e){return{type:e}}function Gl(e){return{result:"success",value:e}}function ou(e){return{result:"error",value:e}}function Ns(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function uc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Cu(e){return!!e.expression&&e.expression.interpolated}function Ta(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Au(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Hl(e){return e}function Tu(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function lc(e,t,r,f,v){return Tu(typeof r===v?f[r]:void 0,e.default,t.default)}function cc(e,t,r){if(Ta(r)!=="number")return Tu(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=As(e.stops.map(function(y){return y[0]}),r);return e.stops[v][1]}function Rc(e,t,r){var f=e.base!==void 0?e.base:1;if(Ta(r)!=="number")return Tu(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var y=As(e.stops.map(function(re){return re[0]}),r),x=function(re,fe,ge,Ze){var Ge=Ze-ge,vt=re-ge;return Ge===0?0:fe===1?vt/Ge:(Math.pow(fe,vt)-1)/(Math.pow(fe,Ge)-1)}(r,f,e.stops[y][0],e.stops[y+1][0]),M=e.stops[y][1],B=e.stops[y+1][1],G=Po[t.type]||Hl;if(e.colorSpace&&e.colorSpace!=="rgb"){var K=ue[e.colorSpace];G=function(re,fe){return K.reverse(K.interpolate(K.forward(re),K.forward(fe),x))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var re=[],fe=arguments.length;fe--;)re[fe]=arguments[fe];var ge=M.evaluate.apply(void 0,re),Ze=B.evaluate.apply(void 0,re);if(ge!==void 0&&Ze!==void 0)return G(ge,Ze,x)}}:G(M,B,x)}function kc(e,t,r){return t.type==="color"?r=Gi.parse(r):t.type==="formatted"?r=ya.fromString(r.toString()):t.type==="resolvedImage"?r=yi.fromString(r.toString()):Ta(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),Tu(r,e.default,t.default)}Fa.register($s,{error:[{kind:"error"},[En],function(e,t){throw new Ya(t[0].evaluate(e))}],typeof:[En,[bn],function(e,t){return Ni(Ea(t[0].evaluate(e)))}],"to-rgba":[Ki($t,4),[ln],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[ln,[$t,$t,$t],ao],rgba:[ln,[$t,$t,$t,$t],ao],has:{type:on,overloads:[[[En],function(e,t){return wu(t[0].evaluate(e),e.properties())}],[[En,Ai],function(e,t){var r=t[1];return wu(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:bn,overloads:[[[En],function(e,t){return nl(t[0].evaluate(e),e.properties())}],[[En,Ai],function(e,t){var r=t[1];return nl(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[bn,[En],function(e,t){return nl(t[0].evaluate(e),e.featureState||{})}],properties:[Ai,[],function(e){return e.properties()}],"geometry-type":[En,[],function(e){return e.geometryType()}],id:[bn,[],function(e){return e.id()}],zoom:[$t,[],function(e){return e.globals.zoom}],"heatmap-density":[$t,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[$t,[],function(e){return e.globals.lineProgress||0}],accumulated:[bn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[$t,fs($t),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[$t,fs($t),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:$t,overloads:[[[$t,$t],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[$t],function(e,t){return-t[0].evaluate(e)}]]},"/":[$t,[$t,$t],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[$t,[$t,$t],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[$t,[],function(){return Math.LN2}],pi:[$t,[],function(){return Math.PI}],e:[$t,[],function(){return Math.E}],"^":[$t,[$t,$t],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[$t,[$t],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[$t,[$t],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[$t,[$t],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[$t,[$t],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[$t,[$t],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[$t,[$t],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[$t,[$t],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[$t,[$t],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[$t,[$t],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[$t,[$t],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[$t,fs($t),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[$t,fs($t),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[$t,[$t],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[$t,[$t],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[$t,[$t],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[$t,[$t],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[on,[En,bn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[on,[bn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[on,[En],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[on,[En,bn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v<y}],"filter-id-<":[on,[bn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[on,[En,bn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v>y}],"filter-id->":[on,[bn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[on,[En,bn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v<=y}],"filter-id-<=":[on,[bn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[on,[En,bn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v>=y}],"filter-id->=":[on,[bn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[on,[bn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[on,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[on,[Ki(En)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[on,[Ki(bn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[on,[En,Ki(bn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[on,[En,Ki(bn)],function(e,t){var r=t[0],f=t[1];return function(v,y,x,M){for(;x<=M;){var B=x+M>>1;if(y[B]===v)return!0;y[B]>v?M=B-1:x=B+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:on,overloads:[[[on,on],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[fs(on),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[fs(on),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[on,[on],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[on,[En],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[En,[En],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[En,[En],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[En,fs(bn),function(e,t){return t.map(function(r){return Ao(r.evaluate(e))}).join("")}],"resolved-locale":[En,[Li],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var Sl=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Ra,this._defaultValue=t?function(r){return r.type==="color"&&Au(r.default)?new Gi(0,0,0,0):r.type==="color"?Gi.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function gu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in $s}function il(e,t){var r=new Cs($s,[],t?function(v){var y={color:ln,string:En,number:$t,enum:En,boolean:on,formatted:Yi,resolvedImage:si};return v.type==="array"?Ki(y[v.value]||bn,v.length):y[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Gl(new Sl(f,t)):ou(r.errors)}Sl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)},Sl.prototype.evaluate=function(e,t,r,f,v,y){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=y||null;try{var x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Ya("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(x)+" instead.");return x}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var al=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Yo(t.expression)};al.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,y)},al.prototype.evaluate=function(e,t,r,f,v,y){return this._styleExpression.evaluate(e,t,r,f,v,y)};var Vu=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Yo(t.expression),this.interpolationType=f};function ol(e,t){if((e=il(e,t)).result==="error")return e;var r=e.value.expression,f=No(r);if(!f&&!Ns(t))return ou([new Rr("","data expressions not supported")]);var v=_o(r,["zoom"]);if(!v&&!uc(t))return ou([new Rr("","zoom expressions not supported")]);var y=function x(M){var B=null;if(M instanceof It)B=x(M.result);else if(M instanceof Lt)for(var G=0,K=M.args;G<K.length&&!(B=x(K[G]));G+=1);else(M instanceof gs||M instanceof Ie)&&M.input instanceof Fa&&M.input.name==="zoom"&&(B=M);return B instanceof Rr||M.eachChild(function(re){var fe=x(re);fe instanceof Rr?B=fe:!B&&fe?B=new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):B&&fe&&B!==fe&&(B=new Rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),B}(r);return y||v?y instanceof Rr?ou([y]):y instanceof Ie&&!Cu(t)?ou([new Rr("",'"interpolate" expressions cannot be used with this property')]):Gl(y?new Vu(f?"camera":"composite",e.value,y.labels,y instanceof Ie?y.interpolation:void 0):new al(f?"constant":"source",e.value)):ou([new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Vu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,y)},Vu.prototype.evaluate=function(e,t,r,f,v,y){return this._styleExpression.evaluate(e,t,r,f,v,y)},Vu.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?Ie.interpolationFactor(this.interpolationType,e,t,r):0};var Gu=function(e,t){this._parameters=e,this._specification=t,xr(this,function r(f,v){var y,x,M,B=v.type==="color",G=f.stops&&typeof f.stops[0][0]=="object",K=G||!(G||f.property!==void 0),re=f.type||(Cu(v)?"exponential":"interval");if(B&&((f=xr({},f)).stops&&(f.stops=f.stops.map(function(Ln){return[Ln[0],Gi.parse(Ln[1])]})),f.default=Gi.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!ue[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(re==="exponential")y=Rc;else if(re==="interval")y=cc;else if(re==="categorical"){y=lc,x=Object.create(null);for(var fe=0,ge=f.stops;fe<ge.length;fe+=1){var Ze=ge[fe];x[Ze[0]]=Ze[1]}M=typeof f.stops[0][0]}else{if(re!=="identity")throw new Error('Unknown function type "'+re+'"');y=kc}if(G){for(var Ge={},vt=[],qe=0;qe<f.stops.length;qe++){var Mt=f.stops[qe],Wt=Mt[0].zoom;Ge[Wt]===void 0&&(Ge[Wt]={zoom:Wt,type:f.type,property:f.property,default:f.default,stops:[]},vt.push(Wt)),Ge[Wt].stops.push([Mt[0].value,Mt[1]])}for(var lr=[],fr=0,Ir=vt;fr<Ir.length;fr+=1){var rn=Ir[fr];lr.push([Ge[rn].zoom,r(Ge[rn],v)])}var mn={name:"linear"};return{kind:"composite",interpolationType:mn,interpolationFactor:Ie.interpolationFactor.bind(void 0,mn),zoomStops:lr.map(function(Ln){return Ln[0]}),evaluate:function(Ln,ui){var Nn=Ln.zoom;return Rc({stops:lr,base:f.base},v,Nn).evaluate(Nn,ui)}}}if(K){var ei=re==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:ei,interpolationFactor:Ie.interpolationFactor.bind(void 0,ei),zoomStops:f.stops.map(function(Ln){return Ln[0]}),evaluate:function(Ln){return y(f,v,Ln.zoom,x,M)}}}return{kind:"source",evaluate:function(Ln,ui){var Nn=ui&&ui.properties?ui.properties[f.property]:void 0;return Nn===void 0?Tu(f.default,v.default):y(f,v,Nn,x,M)}}}(this._parameters,this._specification))};function zs(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},y=e.style,x=e.styleSpec,M=[],B=Ta(r);if(B!=="object")return[new Ce(t,r,"object expected, "+B+" found")];for(var G in r){var K=G.split(".")[0],re=f[K]||f["*"],fe=void 0;if(v[K])fe=v[K];else if(f[K])fe=ia;else if(v["*"])fe=v["*"];else{if(!f["*"]){M.push(new Ce(t,r[G],'unknown property "'+G+'"'));continue}fe=ia}M=M.concat(fe({key:(t&&t+".")+G,value:r[G],valueSpec:re,style:y,styleSpec:x,object:r,objectKey:G},r))}for(var ge in f)v[ge]||f[ge].required&&f[ge].default===void 0&&r[ge]===void 0&&M.push(new Ce(t,r,'missing required property "'+ge+'"'));return M}function fc(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,y=e.key,x=e.arrayElementValidator||ia;if(Ta(t)!=="array")return[new Ce(y,t,"array expected, "+Ta(t)+" found")];if(r.length&&t.length!==r.length)return[new Ce(y,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new Ce(y,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var M={type:r.value,values:r.values};v.$version<7&&(M.function=r.function),Ta(r.value)==="object"&&(M=r.value);for(var B=[],G=0;G<t.length;G++)B=B.concat(x({array:t,arrayIndex:G,value:t[G],valueSpec:M,style:f,styleSpec:v,key:y+"["+G+"]"}));return B}function hc(e){var t=e.key,r=e.value,f=e.valueSpec,v=Ta(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new Ce(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new Ce(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new Ce(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function Dc(e){var t,r,f,v=e.valueSpec,y=Ht(e.value.type),x={},M=y!=="categorical"&&e.value.property===void 0,B=!M,G=Ta(e.value.stops)==="array"&&Ta(e.value.stops[0])==="array"&&Ta(e.value.stops[0][0])==="object",K=zs({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(ge){if(y==="identity")return[new Ce(ge.key,ge.value,'identity function may not have a "stops" property')];var Ze=[],Ge=ge.value;return Ze=Ze.concat(fc({key:ge.key,value:Ge,valueSpec:ge.valueSpec,style:ge.style,styleSpec:ge.styleSpec,arrayElementValidator:re})),Ta(Ge)==="array"&&Ge.length===0&&Ze.push(new Ce(ge.key,Ge,"array must have at least one stop")),Ze},default:function(ge){return ia({key:ge.key,value:ge.value,valueSpec:v,style:ge.style,styleSpec:ge.styleSpec})}}});return y==="identity"&&M&&K.push(new Ce(e.key,e.value,'missing required property "property"')),y==="identity"||e.value.stops||K.push(new Ce(e.key,e.value,'missing required property "stops"')),y==="exponential"&&e.valueSpec.expression&&!Cu(e.valueSpec)&&K.push(new Ce(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(B&&!Ns(e.valueSpec)?K.push(new Ce(e.key,e.value,"property functions not supported")):M&&!uc(e.valueSpec)&&K.push(new Ce(e.key,e.value,"zoom functions not supported"))),y!=="categorical"&&!G||e.value.property!==void 0||K.push(new Ce(e.key,e.value,'"property" property is required')),K;function re(ge){var Ze=[],Ge=ge.value,vt=ge.key;if(Ta(Ge)!=="array")return[new Ce(vt,Ge,"array expected, "+Ta(Ge)+" found")];if(Ge.length!==2)return[new Ce(vt,Ge,"array length 2 expected, length "+Ge.length+" found")];if(G){if(Ta(Ge[0])!=="object")return[new Ce(vt,Ge,"object expected, "+Ta(Ge[0])+" found")];if(Ge[0].zoom===void 0)return[new Ce(vt,Ge,"object stop key must have zoom")];if(Ge[0].value===void 0)return[new Ce(vt,Ge,"object stop key must have value")];if(f&&f>Ht(Ge[0].zoom))return[new Ce(vt,Ge[0].zoom,"stop zoom values must appear in ascending order")];Ht(Ge[0].zoom)!==f&&(f=Ht(Ge[0].zoom),r=void 0,x={}),Ze=Ze.concat(zs({key:vt+"[0]",value:Ge[0],valueSpec:{zoom:{}},style:ge.style,styleSpec:ge.styleSpec,objectElementValidators:{zoom:hc,value:fe}}))}else Ze=Ze.concat(fe({key:vt+"[0]",value:Ge[0],valueSpec:{},style:ge.style,styleSpec:ge.styleSpec},Ge));return gu(Jt(Ge[1]))?Ze.concat([new Ce(vt+"[1]",Ge[1],"expressions are not allowed in function stops.")]):Ze.concat(ia({key:vt+"[1]",value:Ge[1],valueSpec:v,style:ge.style,styleSpec:ge.styleSpec}))}function fe(ge,Ze){var Ge=Ta(ge.value),vt=Ht(ge.value),qe=ge.value!==null?ge.value:Ze;if(t){if(Ge!==t)return[new Ce(ge.key,qe,Ge+" stop domain type must match previous stop domain type "+t)]}else t=Ge;if(Ge!=="number"&&Ge!=="string"&&Ge!=="boolean")return[new Ce(ge.key,qe,"stop domain value must be a number, string, or boolean")];if(Ge!=="number"&&y!=="categorical"){var Mt="number expected, "+Ge+" found";return Ns(v)&&y===void 0&&(Mt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ce(ge.key,qe,Mt)]}return y!=="categorical"||Ge!=="number"||isFinite(vt)&&Math.floor(vt)===vt?y!=="categorical"&&Ge==="number"&&r!==void 0&&vt<r?[new Ce(ge.key,qe,"stop domain values must appear in ascending order")]:(r=vt,y==="categorical"&&vt in x?[new Ce(ge.key,qe,"stop domain values must be unique")]:(x[vt]=!0,[])):[new Ce(ge.key,qe,"integer expected, found "+vt)]}}function Hu(e){var t=(e.expressionContext==="property"?ol:il)(Jt(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new Ce(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new Ce(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!Yo(r))return[new Ce(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!Yo(r))return[new Ce(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!_o(r,["zoom","feature-state"]))return[new Ce(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!No(r))return[new Ce(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function El(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Ht(r))===-1&&v.push(new Ce(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Ht(r))===-1&&v.push(new Ce(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function Wl(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!Wl(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}Gu.deserialize=function(e){return new Gu(e._parameters,e._specification)},Gu.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var pc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Wu(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Wl(e)||(e=Cl(e));var t=il(e,pc);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function wl(e,t){return e<t?-1:e>t?1:0}function Cl(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Pu(e[1],e[2],"=="):r==="!="?Mu(Pu(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Pu(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Cl))):r==="all"?["all"].concat(e.slice(1).map(Cl)):r==="none"?["all"].concat(e.slice(1).map(Cl).map(Mu)):r==="in"?Xl(e[1],e.slice(2)):r==="!in"?Mu(Xl(e[1],e.slice(2))):r==="has"?za(e[1]):r==="!has"?Mu(za(e[1])):r!=="within"||e}function Pu(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function Xl(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(wl)]]:["filter-in-small",e,["literal",t]]}}function za(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Mu(e){return["!",e]}function sl(e){return Wl(Jt(e.value))?Hu(xr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Ta(f)!=="array")return[new Ce(v,f,"array expected, "+Ta(f)+" found")];var y,x=r.styleSpec,M=[];if(f.length<1)return[new Ce(v,f,"filter array must have at least 1 element")];switch(M=M.concat(El({key:v+"[0]",value:f[0],valueSpec:x.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ht(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Ht(f[1])==="$type"&&M.push(new Ce(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&M.push(new Ce(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(y=Ta(f[1]))!=="string"&&M.push(new Ce(v+"[1]",f[1],"string expected, "+y+" found"));for(var B=2;B<f.length;B++)y=Ta(f[B]),Ht(f[1])==="$type"?M=M.concat(El({key:v+"["+B+"]",value:f[B],valueSpec:x.geometry_type,style:r.style,styleSpec:r.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&M.push(new Ce(v+"["+B+"]",f[B],"string, number, or boolean expected, "+y+" found"));break;case"any":case"all":case"none":for(var G=1;G<f.length;G++)M=M.concat(t({key:v+"["+G+"]",value:f[G],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":y=Ta(f[1]),f.length!==2?M.push(new Ce(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):y!=="string"&&M.push(new Ce(v+"[1]",f[1],"string expected, "+y+" found"));break;case"within":y=Ta(f[1]),f.length!==2?M.push(new Ce(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):y!=="object"&&M.push(new Ce(v+"[1]",f[1],"object expected, "+y+" found"))}return M}(e)}function Yl(e,t){var r=e.key,f=e.style,v=e.styleSpec,y=e.value,x=e.objectKey,M=v[t+"_"+e.layerType];if(!M)return[];var B=x.match(/^(.*)-transition$/);if(t==="paint"&&B&&M[B[1]]&&M[B[1]].transition)return ia({key:r,value:y,valueSpec:v.transition,style:f,styleSpec:v});var G,K=e.valueSpec||M[x];if(!K)return[new Ce(r,y,'unknown property "'+x+'"')];if(Ta(y)==="string"&&Ns(K)&&!K.tokens&&(G=/^{([^}]+)}$/.exec(y)))return[new Ce(r,y,'"'+x+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(G[1])+" }`.")];var re=[];return e.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&re.push(new Ce(r,y,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Au(Jt(y))&&Ht(y.type)==="identity"&&re.push(new Ce(r,y,'"text-font" does not support identity functions'))),re.concat(ia({key:e.key,value:y,valueSpec:K,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:x}))}function Kl(e){return Yl(e,"paint")}function Xu(e){return Yl(e,"layout")}function $c(e){var t=[],r=e.value,f=e.key,v=e.style,y=e.styleSpec;r.type||r.ref||t.push(new Ce(f,r,'either "type" or "ref" is required'));var x,M=Ht(r.type),B=Ht(r.ref);if(r.id)for(var G=Ht(r.id),K=0;K<e.arrayIndex;K++){var re=v.layers[K];Ht(re.id)===G&&t.push(new Ce(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+re.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Ze){Ze in r&&t.push(new Ce(f,r[Ze],'"'+Ze+'" is prohibited for ref layers'))}),v.layers.forEach(function(Ze){Ht(Ze.id)===B&&(x=Ze)}),x?x.ref?t.push(new Ce(f,r.ref,"ref cannot reference another ref layer")):M=Ht(x.type):t.push(new Ce(f,r.ref,'ref layer "'+B+'" not found'));else if(M!=="background")if(r.source){var fe=v.sources&&v.sources[r.source],ge=fe&&Ht(fe.type);fe?ge==="vector"&&M==="raster"?t.push(new Ce(f,r.source,'layer "'+r.id+'" requires a raster source')):ge==="raster"&&M!=="raster"?t.push(new Ce(f,r.source,'layer "'+r.id+'" requires a vector source')):ge!=="vector"||r["source-layer"]?ge==="raster-dem"&&M!=="hillshade"?t.push(new Ce(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!r.paint||!r.paint["line-gradient"]||ge==="geojson"&&fe.lineMetrics||t.push(new Ce(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Ce(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new Ce(f,r.source,'source "'+r.source+'" not found'))}else t.push(new Ce(f,r,'missing required property "source"'));return t=t.concat(zs({key:f,value:r,valueSpec:y.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ia({key:f+".type",value:r.type,valueSpec:y.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:sl,layout:function(Ze){return zs({layer:r,key:Ze.key,value:Ze.value,style:Ze.style,styleSpec:Ze.styleSpec,objectElementValidators:{"*":function(Ge){return Xu(xr({layerType:M},Ge))}}})},paint:function(Ze){return zs({layer:r,key:Ze.key,value:Ze.value,style:Ze.style,styleSpec:Ze.styleSpec,objectElementValidators:{"*":function(Ge){return Kl(xr({layerType:M},Ge))}}})}}}))}function ul(e){var t=e.value,r=e.key,f=Ta(t);return f!=="string"?[new Ce(r,t,"string expected, "+f+" found")]:[]}var $a={promoteId:function(e){var t=e.key,r=e.value;if(Ta(r)==="string")return ul({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,ul({key:t+"."+v,value:r[v]}));return f}};function ll(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new Ce(r,t,'"type" is required')];var y,x=Ht(t.type);switch(x){case"vector":case"raster":case"raster-dem":return zs({key:r,value:t,valueSpec:f["source_"+x.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:$a});case"geojson":if(y=zs({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:$a}),t.cluster)for(var M in t.clusterProperties){var B=t.clusterProperties[M],G=B[0],K=typeof G=="string"?[G,["accumulated"],["get",M]]:G;y.push.apply(y,Hu({key:r+"."+M+".map",value:B[1],expressionContext:"cluster-map"})),y.push.apply(y,Hu({key:r+"."+M+".reduce",value:K,expressionContext:"cluster-reduce"}))}return y;case"video":return zs({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return zs({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new Ce(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return El({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function Yu(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,y=[],x=Ta(t);if(t===void 0)return y;if(x!=="object")return y.concat([new Ce("light",t,"object expected, "+x+" found")]);for(var M in t){var B=M.match(/^(.*)-transition$/);y=y.concat(B&&f[B[1]]&&f[B[1]].transition?ia({key:M,value:t[M],valueSpec:r.transition,style:v,styleSpec:r}):f[M]?ia({key:M,value:t[M],valueSpec:f[M],style:v,styleSpec:r}):[new Ce(M,t[M],'unknown property "'+M+'"')])}return y}var Js={"*":function(){return[]},array:fc,boolean:function(e){var t=e.value,r=e.key,f=Ta(t);return f!=="boolean"?[new Ce(r,t,"boolean expected, "+f+" found")]:[]},number:hc,color:function(e){var t=e.key,r=e.value,f=Ta(r);return f!=="string"?[new Ce(t,r,"color expected, "+f+" found")]:ri(r)===null?[new Ce(t,r,'color expected, "'+r+'" found')]:[]},constants:ct,enum:El,filter:sl,function:Dc,layer:$c,object:zs,source:ll,light:Yu,string:ul,formatted:function(e){return ul(e).length===0?[]:Hu(e)},resolvedImage:function(e){return ul(e).length===0?[]:Hu(e)}};function ia(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&Au(Ht(t))?Dc(e):r.expression&&gu(Jt(t))?Hu(e):r.type&&Js[r.type]?Js[r.type](e):zs(xr({},e,{valueSpec:r.type?f[r.type]:r}))}function Ua(e){var t=e.value,r=e.key,f=ul(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new Ce(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new Ce(r,t,'"glyphs" url must include a "{range}" token'))),f}function _s(e,t){t===void 0&&(t=se);var r=[];return r=r.concat(ia({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Ua,"*":function(){return[]}}})),e.constants&&(r=r.concat(ct({key:"constants",value:e.constants,style:e,styleSpec:t}))),Al(r)}function Al(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function Iu(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return Al(e.apply(this,t))}}_s.source=Iu(ll),_s.light=Iu(Yu),_s.layer=Iu($c),_s.filter=Iu(sl),_s.paintProperty=Iu(Kl),_s.layoutProperty=Iu(Xu);var Tl=_s,Jc=Tl.light,Qc=Tl.paintProperty,Pl=Tl.layoutProperty;function $l(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new ve(new Error(v[f].message))),r=!0;return r}var Ou=ko;function ko(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var y=0;y<this.d*this.d;y++){var x=v[3+y],M=v[3+y+1];f.push(x===M?null:v.subarray(x,M))}var B=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],B),this.bboxes=v.subarray(B),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var G=0;G<this.d*this.d;G++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var K=r/t*e;this.min=-K,this.max=e+K}ko.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},ko.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ko.prototype._insertCell=function(e,t,r,f,v,y){this.cells[v].push(y)},ko.prototype.query=function(e,t,r,f,v){var y=this.min,x=this.max;if(e<=y&&t<=y&&x<=r&&x<=f&&!v)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(e,t,r,f,this._queryCell,M,{},v),M},ko.prototype._queryCell=function(e,t,r,f,v,y,x,M){var B=this.cells[v];if(B!==null)for(var G=this.keys,K=this.bboxes,re=0;re<B.length;re++){var fe=B[re];if(x[fe]===void 0){var ge=4*fe;(M?M(K[ge+0],K[ge+1],K[ge+2],K[ge+3]):e<=K[ge+2]&&t<=K[ge+3]&&r>=K[ge+0]&&f>=K[ge+1])?(x[fe]=!0,y.push(G[fe])):x[fe]=!1}}},ko.prototype._forEachCell=function(e,t,r,f,v,y,x,M){for(var B=this._convertToCellCoord(e),G=this._convertToCellCoord(t),K=this._convertToCellCoord(r),re=this._convertToCellCoord(f),fe=B;fe<=K;fe++)for(var ge=G;ge<=re;ge++){var Ze=this.d*ge+fe;if((!M||M(this._convertFromCellCoord(fe),this._convertFromCellCoord(ge),this._convertFromCellCoord(fe+1),this._convertFromCellCoord(ge+1)))&&v.call(this,e,t,r,f,Ze,y,x,M))return}},ko.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},ko.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},ko.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var y=t,x=0;x<e.length;x++){var M=e[x];v[3+x]=y,v.set(M,y),y+=M.length}return v[3+e.length]=y,v.set(this.keys,y),v[3+e.length+1]=y+=this.keys.length,v.set(this.bboxes,y),y+=this.bboxes.length,v.buffer};var Us=N.ImageData,cl=N.ImageBitmap,bo={};function Dn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),bo[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var fo in Dn("Object",Object),Ou.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Ou.deserialize=function(e){return new Ou(e.buffer)},Dn("Grid",Ou),Dn("Color",Gi),Dn("Error",Error),Dn("ResolvedImage",yi),Dn("StylePropertyFunction",Gu),Dn("StyleExpression",Sl,{omit:["_evaluator"]}),Dn("ZoomDependentExpression",Vu),Dn("ZoomConstantExpression",al),Dn("CompoundExpression",Fa,{omit:["_evaluate"]}),$s)$s[fo]._classRegistryKey||Dn("Expression_"+fo,$s[fo]);function Lu(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function fl(e){return cl&&e instanceof cl}function Qs(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Lu(e)||fl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof Us)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,y=e;v<y.length;v+=1)f.push(Qs(y[v],t));return f}if(typeof e=="object"){var x=e.constructor,M=x._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var B=x.serialize?x.serialize(e,t):{};if(!x.serialize){for(var G in e)if(e.hasOwnProperty(G)&&!(bo[M].omit.indexOf(G)>=0)){var K=e[G];B[G]=bo[M].shallow.indexOf(G)>=0?K:Qs(K,t)}e instanceof Error&&(B.message=e.message)}if(B.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(B.$name=M),B}throw new Error("can't serialize object of type "+typeof e)}function Ps(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Lu(e)||fl(e)||ArrayBuffer.isView(e)||e instanceof Us)return e;if(Array.isArray(e))return e.map(Ps);if(typeof e=="object"){var t=e.$name||"Object",r=bo[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,y=Object.keys(e);v<y.length;v+=1){var x=y[v];if(x!=="$name"){var M=e[x];f[x]=bo[t].shallow.indexOf(x)>=0?M:Ps(M)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var dc=function(){this.first=!0};dc.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var dn={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Jl(e){for(var t=0,r=e;t<r.length;t+=1)if(Ql(r[t].charCodeAt(0)))return!0;return!1}function Ql(e){return!(e!==746&&e!==747&&(e<4352||!(dn["Bopomofo Extended"](e)||dn.Bopomofo(e)||dn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||dn["CJK Compatibility Ideographs"](e)||dn["CJK Compatibility"](e)||dn["CJK Radicals Supplement"](e)||dn["CJK Strokes"](e)||!(!dn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||dn["CJK Unified Ideographs Extension A"](e)||dn["CJK Unified Ideographs"](e)||dn["Enclosed CJK Letters and Months"](e)||dn["Hangul Compatibility Jamo"](e)||dn["Hangul Jamo Extended-A"](e)||dn["Hangul Jamo Extended-B"](e)||dn["Hangul Jamo"](e)||dn["Hangul Syllables"](e)||dn.Hiragana(e)||dn["Ideographic Description Characters"](e)||dn.Kanbun(e)||dn["Kangxi Radicals"](e)||dn["Katakana Phonetic Extensions"](e)||dn.Katakana(e)&&e!==12540||!(!dn["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!dn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||dn["Unified Canadian Aboriginal Syllabics"](e)||dn["Unified Canadian Aboriginal Syllabics Extended"](e)||dn["Vertical Forms"](e)||dn["Yijing Hexagram Symbols"](e)||dn["Yi Syllables"](e)||dn["Yi Radicals"](e))))}function Ru(e){return!(Ql(e)||function(t){return!!(dn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||dn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||dn["Letterlike Symbols"](t)||dn["Number Forms"](t)||dn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||dn["Control Pictures"](t)&&t!==9251||dn["Optical Character Recognition"](t)||dn["Enclosed Alphanumerics"](t)||dn["Geometric Shapes"](t)||dn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||dn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||dn["CJK Symbols and Punctuation"](t)||dn.Katakana(t)||dn["Private Use Area"](t)||dn["CJK Compatibility Forms"](t)||dn["Small Form Variants"](t)||dn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function ja(e){return e>=1424&&e<=2303||dn["Arabic Presentation Forms-A"](e)||dn["Arabic Presentation Forms-B"](e)}function Ms(e,t){return!(!t&&ja(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||dn.Khmer(e))}function ql(e){for(var t=0,r=e;t<r.length;t+=1)if(ja(r[t].charCodeAt(0)))return!0;return!1}var _u=null,Is="unavailable",su=null,Fc=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Is="error"),_u&&_u(e)};function Ml(){vc.fire(new oe("pluginStateChange",{pluginStatus:Is,pluginURL:su}))}var vc=new Ae,Bc=function(){return Is},qs=function(){if(Is!=="deferred"||!su)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Is="loading",Ml(),su&&Di({url:su},function(e){e?Fc(e):(Is="loaded",Ml())})},Os={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Is==="loaded"||Os.applyArabicShaping!=null},isLoading:function(){return Is==="loading"},setState:function(e){Is=e.pluginStatus,su=e.pluginURL},isParsed:function(){return Os.applyArabicShaping!=null&&Os.processBidirectionalText!=null&&Os.processStyledBidirectionalText!=null},getPluginURL:function(){return su}},qi=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dc,this.transition={})};qi.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!Ms(v[f].charCodeAt(0),r))return!1;return!0}(e,Os.isLoaded())},qi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},qi.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var xu=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(Au(r))return new Gu(r,f);if(gu(r)){var v=ol(r,f);if(v.result==="error")throw new Error(v.value.map(function(x){return x.key+": "+x.message}).join(", "));return v.value}var y=r;return typeof r=="string"&&f.type==="color"&&(y=Gi.parse(r)),{kind:"constant",evaluate:function(){return y}}}(t===void 0?e.specification.default:t,e.specification)};xu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},xu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var Zs=function(e){this.property=e,this.value=new xu(e,void 0)};Zs.prototype.transitioned=function(e,t){return new hl(this.property,this.value,t,Gt({},e.transition,this.transition),e.now)},Zs.prototype.untransitioned=function(){return new hl(this.property,this.value,null,{},0)};var zo=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};zo.prototype.getValue=function(e){return Ke(this._values[e].value.value)},zo.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Zs(this._values[e].property)),this._values[e].value=new xu(this._values[e].property,t===null?void 0:Ke(t))},zo.prototype.getTransition=function(e){return Ke(this._values[e].transition)},zo.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Zs(this._values[e].property)),this._values[e].transition=Ke(t)||void 0},zo.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var y=this.getTransition(f);y!==void 0&&(e[f+"-transition"]=y)}return e},zo.prototype.transitioned=function(e,t){for(var r=new uu(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var y=v[f];r._values[y]=this._values[y].transitioned(e,t._values[y])}return r},zo.prototype.untransitioned=function(){for(var e=new uu(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var hl=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};hl.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),y=this.prior;if(y){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return y.possiblyEvaluate(e,t,r);var x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,t,r),v,function(M){if(M<=0)return 0;if(M>=1)return 1;var B=M*M,G=B*M;return 4*(M<.5?G:3*(M-B)+G-.75)}(x))}return v};var uu=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};uu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new ku(this._properties),v=0,y=Object.keys(this._values);v<y.length;v+=1){var x=y[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f},uu.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var lu=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};lu.prototype.getValue=function(e){return Ke(this._values[e].value)},lu.prototype.setValue=function(e,t){this._values[e]=new xu(this._values[e].property,t===null?void 0:Ke(t))},lu.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},lu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new ku(this._properties),v=0,y=Object.keys(this._values);v<y.length;v+=1){var x=y[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f};var So=function(e,t,r){this.property=e,this.value=t,this.parameters=r};So.prototype.isConstant=function(){return this.value.kind==="constant"},So.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},So.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var ku=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};ku.prototype.get=function(e){return this._values[e]};var ai=function(e){this.specification=e};ai.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},ai.prototype.interpolate=function(e,t,r){var f=Po[this.specification.type];return f?f(e,t,r):e};var Hn=function(e,t){this.specification=e,this.overrides=t};Hn.prototype.possiblyEvaluate=function(e,t,r,f){return new So(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},Hn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new So(this,{kind:"constant",value:void 0},e.parameters);var f=Po[this.specification.type];return f?new So(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},Hn.prototype.evaluate=function(e,t,r,f,v,y){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,y)};var Il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,y){if(r.value===void 0)return new So(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var x=r.expression.evaluate(f,null,{},v,y),M=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,B=this._calculate(M,M,M,f);return new So(this,{kind:"constant",value:B},f)}if(r.expression.kind==="camera"){var G=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new So(this,{kind:"constant",value:G},f)}return new So(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,y,x,M){if(r.kind==="source"){var B=r.evaluate(f,v,y,x,M);return this._calculate(B,B,B,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,y),r.evaluate({zoom:Math.floor(f.zoom)},v,y),r.evaluate({zoom:Math.floor(f.zoom)+1},v,y),f):r.value},t.prototype._calculate=function(r,f,v,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(Hn),ns=function(e){this.specification=e};ns.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new qi(Math.floor(t.zoom-1),t)),e.expression.evaluate(new qi(Math.floor(t.zoom),t)),e.expression.evaluate(new qi(Math.floor(t.zoom+1),t)),t)}},ns.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},ns.prototype.interpolate=function(e){return e};var eu=function(e){this.specification=e};eu.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},eu.prototype.interpolate=function(){return!1};var Ko=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new xu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new Zs(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};Dn("DataDrivenProperty",Hn),Dn("DataConstantProperty",ai),Dn("CrossFadedDataDrivenProperty",Il),Dn("CrossFadedProperty",ns),Dn("ColorRampProperty",eu);var cu=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new lu(f.layout)),f.paint)){for(var v in this._transitionablePaint=new zo(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var y in r.layout)this.setLayoutProperty(y,r.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ku(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(Pl,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return ee(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(Qc,"layers."+this.id+".paint."+r,r,f,v))return!1;if(ee(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var y=this._transitionablePaint._values[r],x=y.property.specification["property-type"]==="cross-faded-data-driven",M=y.value.isDataDriven(),B=y.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var G=this._transitionablePaint._values[r].value;return G.isDataDriven()||M||x||this._handleOverridablePaintPropertyUpdate(r,B,G)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Ct(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,y,x){return x===void 0&&(x={}),(!x||x.validate!==!1)&&$l(this,r.call(Tl,{key:f,layerType:this.type,objectKey:v,value:y,styleSpec:se,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof So&&Ns(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Ae),mc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ec=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Wi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Do(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var y=mc[v.type].BYTES_PER_ELEMENT,x=r=Nc(r,Math.max(t,y)),M=v.components||1;return f=Math.max(f,y),r+=y*M,{name:v.name,type:v.type,components:M,offset:x}}),size:Nc(r,Math.max(f,t)),alignment:t}}function Nc(e,t){return Math.ceil(e/t)*t}Wi.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Wi.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Wi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Wi.prototype.clear=function(){this.length=0},Wi.prototype.resize=function(e){this.reserve(e),this.length=e},Wi.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Wi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var xs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.int16[y+0]=f,this.int16[y+1]=v,r},t}(Wi);xs.prototype.bytesPerElement=4,Dn("StructArrayLayout2i4",xs);var tc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,x){var M=4*r;return this.int16[M+0]=f,this.int16[M+1]=v,this.int16[M+2]=y,this.int16[M+3]=x,r},t}(Wi);tc.prototype.bytesPerElement=8,Dn("StructArrayLayout4i8",tc);var bs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M){var B=this.length;return this.resize(B+1),this.emplace(B,r,f,v,y,x,M)},t.prototype.emplace=function(r,f,v,y,x,M,B){var G=6*r;return this.int16[G+0]=f,this.int16[G+1]=v,this.int16[G+2]=y,this.int16[G+3]=x,this.int16[G+4]=M,this.int16[G+5]=B,r},t}(Wi);bs.prototype.bytesPerElement=12,Dn("StructArrayLayout2i4i12",bs);var hs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M){var B=this.length;return this.resize(B+1),this.emplace(B,r,f,v,y,x,M)},t.prototype.emplace=function(r,f,v,y,x,M,B){var G=4*r,K=8*r;return this.int16[G+0]=f,this.int16[G+1]=v,this.uint8[K+4]=y,this.uint8[K+5]=x,this.uint8[K+6]=M,this.uint8[K+7]=B,r},t}(Wi);hs.prototype.bytesPerElement=8,Dn("StructArrayLayout2i4ub8",hs);var pl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.float32[y+0]=f,this.float32[y+1]=v,r},t}(Wi);pl.prototype.bytesPerElement=8,Dn("StructArrayLayout2f8",pl);var fu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M,B,G,K,re){var fe=this.length;return this.resize(fe+1),this.emplace(fe,r,f,v,y,x,M,B,G,K,re)},t.prototype.emplace=function(r,f,v,y,x,M,B,G,K,re,fe){var ge=10*r;return this.uint16[ge+0]=f,this.uint16[ge+1]=v,this.uint16[ge+2]=y,this.uint16[ge+3]=x,this.uint16[ge+4]=M,this.uint16[ge+5]=B,this.uint16[ge+6]=G,this.uint16[ge+7]=K,this.uint16[ge+8]=re,this.uint16[ge+9]=fe,r},t}(Wi);fu.prototype.bytesPerElement=20,Dn("StructArrayLayout10ui20",fu);var Ol=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M,B,G,K,re,fe,ge){var Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,r,f,v,y,x,M,B,G,K,re,fe,ge)},t.prototype.emplace=function(r,f,v,y,x,M,B,G,K,re,fe,ge,Ze){var Ge=12*r;return this.int16[Ge+0]=f,this.int16[Ge+1]=v,this.int16[Ge+2]=y,this.int16[Ge+3]=x,this.uint16[Ge+4]=M,this.uint16[Ge+5]=B,this.uint16[Ge+6]=G,this.uint16[Ge+7]=K,this.int16[Ge+8]=re,this.int16[Ge+9]=fe,this.int16[Ge+10]=ge,this.int16[Ge+11]=Ze,r},t}(Wi);Ol.prototype.bytesPerElement=24,Dn("StructArrayLayout4i4ui4i24",Ol);var Ku=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=3*r;return this.float32[x+0]=f,this.float32[x+1]=v,this.float32[x+2]=y,r},t}(Wi);Ku.prototype.bytesPerElement=12,Dn("StructArrayLayout3f12",Ku);var Ll=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(Wi);Ll.prototype.bytesPerElement=4,Dn("StructArrayLayout1ul4",Ll);var zc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M,B,G,K){var re=this.length;return this.resize(re+1),this.emplace(re,r,f,v,y,x,M,B,G,K)},t.prototype.emplace=function(r,f,v,y,x,M,B,G,K,re){var fe=10*r,ge=5*r;return this.int16[fe+0]=f,this.int16[fe+1]=v,this.int16[fe+2]=y,this.int16[fe+3]=x,this.int16[fe+4]=M,this.int16[fe+5]=B,this.uint32[ge+3]=G,this.uint16[fe+8]=K,this.uint16[fe+9]=re,r},t}(Wi);zc.prototype.bytesPerElement=20,Dn("StructArrayLayout6i1ul2ui20",zc);var Rl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M){var B=this.length;return this.resize(B+1),this.emplace(B,r,f,v,y,x,M)},t.prototype.emplace=function(r,f,v,y,x,M,B){var G=6*r;return this.int16[G+0]=f,this.int16[G+1]=v,this.int16[G+2]=y,this.int16[G+3]=x,this.int16[G+4]=M,this.int16[G+5]=B,r},t}(Wi);Rl.prototype.bytesPerElement=12,Dn("StructArrayLayout2i2i2i12",Rl);var dl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x){var M=this.length;return this.resize(M+1),this.emplace(M,r,f,v,y,x)},t.prototype.emplace=function(r,f,v,y,x,M){var B=4*r,G=8*r;return this.float32[B+0]=f,this.float32[B+1]=v,this.float32[B+2]=y,this.int16[G+6]=x,this.int16[G+7]=M,r},t}(Wi);dl.prototype.bytesPerElement=16,Dn("StructArrayLayout2f1f2i16",dl);var yc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,x){var M=12*r,B=3*r;return this.uint8[M+0]=f,this.uint8[M+1]=v,this.float32[B+1]=y,this.float32[B+2]=x,r},t}(Wi);yc.prototype.bytesPerElement=12,Dn("StructArrayLayout2ub2f12",yc);var Du=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=3*r;return this.uint16[x+0]=f,this.uint16[x+1]=v,this.uint16[x+2]=y,r},t}(Wi);Du.prototype.bytesPerElement=6,Dn("StructArrayLayout3ui6",Du);var Fu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M,B,G,K,re,fe,ge,Ze,Ge,vt,qe,Mt){var Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,r,f,v,y,x,M,B,G,K,re,fe,ge,Ze,Ge,vt,qe,Mt)},t.prototype.emplace=function(r,f,v,y,x,M,B,G,K,re,fe,ge,Ze,Ge,vt,qe,Mt,Wt){var lr=24*r,fr=12*r,Ir=48*r;return this.int16[lr+0]=f,this.int16[lr+1]=v,this.uint16[lr+2]=y,this.uint16[lr+3]=x,this.uint32[fr+2]=M,this.uint32[fr+3]=B,this.uint32[fr+4]=G,this.uint16[lr+10]=K,this.uint16[lr+11]=re,this.uint16[lr+12]=fe,this.float32[fr+7]=ge,this.float32[fr+8]=Ze,this.uint8[Ir+36]=Ge,this.uint8[Ir+37]=vt,this.uint8[Ir+38]=qe,this.uint32[fr+10]=Mt,this.int16[lr+22]=Wt,r},t}(Wi);Fu.prototype.bytesPerElement=48,Dn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Fu);var gc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M,B,G,K,re,fe,ge,Ze,Ge,vt,qe,Mt,Wt,lr,fr,Ir,rn,mn,ei,Ln,ui,Nn,na){var bi=this.length;return this.resize(bi+1),this.emplace(bi,r,f,v,y,x,M,B,G,K,re,fe,ge,Ze,Ge,vt,qe,Mt,Wt,lr,fr,Ir,rn,mn,ei,Ln,ui,Nn,na)},t.prototype.emplace=function(r,f,v,y,x,M,B,G,K,re,fe,ge,Ze,Ge,vt,qe,Mt,Wt,lr,fr,Ir,rn,mn,ei,Ln,ui,Nn,na,bi){var ti=34*r,la=17*r;return this.int16[ti+0]=f,this.int16[ti+1]=v,this.int16[ti+2]=y,this.int16[ti+3]=x,this.int16[ti+4]=M,this.int16[ti+5]=B,this.int16[ti+6]=G,this.int16[ti+7]=K,this.uint16[ti+8]=re,this.uint16[ti+9]=fe,this.uint16[ti+10]=ge,this.uint16[ti+11]=Ze,this.uint16[ti+12]=Ge,this.uint16[ti+13]=vt,this.uint16[ti+14]=qe,this.uint16[ti+15]=Mt,this.uint16[ti+16]=Wt,this.uint16[ti+17]=lr,this.uint16[ti+18]=fr,this.uint16[ti+19]=Ir,this.uint16[ti+20]=rn,this.uint16[ti+21]=mn,this.uint16[ti+22]=ei,this.uint32[la+12]=Ln,this.float32[la+13]=ui,this.float32[la+14]=Nn,this.float32[la+15]=na,this.float32[la+16]=bi,r},t}(Wi);gc.prototype.bytesPerElement=68,Dn("StructArrayLayout8i15ui1ul4f68",gc);var Bu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(Wi);Bu.prototype.bytesPerElement=4,Dn("StructArrayLayout1f4",Bu);var js=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=3*r;return this.int16[x+0]=f,this.int16[x+1]=v,this.int16[x+2]=y,r},t}(Wi);js.prototype.bytesPerElement=6,Dn("StructArrayLayout3i6",js);var _c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=4*r;return this.uint32[2*r+0]=f,this.uint16[x+2]=v,this.uint16[x+3]=y,r},t}(Wi);_c.prototype.bytesPerElement=8,Dn("StructArrayLayout1ul2ui8",_c);var Nu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.uint16[y+0]=f,this.uint16[y+1]=v,r},t}(Wi);Nu.prototype.bytesPerElement=4,Dn("StructArrayLayout2ui4",Nu);var kl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(Wi);kl.prototype.bytesPerElement=2,Dn("StructArrayLayout1ui2",kl);var $u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,x){var M=4*r;return this.float32[M+0]=f,this.float32[M+1]=v,this.float32[M+2]=y,this.float32[M+3]=x,r},t}(Wi);$u.prototype.bytesPerElement=16,Dn("StructArrayLayout4f16",$u);var n=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new W(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(ec);n.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new n(this,r)},t}(zc);Dn("CollisionBoxArray",u);var a=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(ec);a.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new a(this,r)},t}(Fu);Dn("PlacedSymbolArray",h);var g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(ec);g.prototype.size=68;var b=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new g(this,r)},t}(gc);Dn("SymbolInstanceArray",b);var P=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(Bu);Dn("GlyphOffsetArray",P);var D=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(js);Dn("SymbolLineVertexArray",D);var H=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(ec);H.prototype.size=8;var ae=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new H(this,r)},t}(_c);Dn("FeatureIndexArray",ae);var be=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,we=function(e){e===void 0&&(e=[]),this.segments=e};function Pe(e,t){return 256*(e=et(Math.floor(e),0,255))+et(Math.floor(t),0,255)}we.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>we.MAX_VERTEX_ARRAY_LENGTH&&Xe("Max vertices per segment is "+we.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>we.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},we.prototype.get=function(){return this.segments},we.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},we.simpleSegment=function(e,t,r,f){return new we([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dn("SegmentVector",we);var We=Do([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ve=A(function(e){e.exports=function(t,r){var f,v,y,x,M,B,G,K;for(v=t.length-(f=3&t.length),y=r,M=3432918353,B=461845907,K=0;K<v;)G=255&t.charCodeAt(K)|(255&t.charCodeAt(++K))<<8|(255&t.charCodeAt(++K))<<16|(255&t.charCodeAt(++K))<<24,++K,y=27492+(65535&(x=5*(65535&(y=(y^=G=(65535&(G=(G=(65535&G)*M+(((G>>>16)*M&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(G=0,f){case 3:G^=(255&t.charCodeAt(K+2))<<16;case 2:G^=(255&t.charCodeAt(K+1))<<8;case 1:y^=G=(65535&(G=(G=(65535&(G^=255&t.charCodeAt(K)))*M+(((G>>>16)*M&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295}return y^=t.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}}),nt=A(function(e){e.exports=function(t,r){for(var f,v=t.length,y=r^v,x=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24))+((1540483477*(f>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++x;switch(v){case 3:y^=(255&t.charCodeAt(x+2))<<16;case 2:y^=(255&t.charCodeAt(x+1))<<8;case 1:y=1540483477*(65535&(y^=255&t.charCodeAt(x)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}}),ze=Ve,ot=nt;ze.murmur3=Ve,ze.murmur2=ot;var bt=function(){this.ids=[],this.positions=[],this.indexed=!1};bt.prototype.add=function(e,t,r,f){this.ids.push(hr(e)),this.positions.push(t,r,f)},bt.prototype.getPositions=function(e){for(var t=hr(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var y=[];this.ids[r]===t;)y.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return y},bt.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(y,x,M,B){for(;M<B;){for(var G=y[M+B>>1],K=M-1,re=B+1;;){do K++;while(y[K]<G);do re--;while(y[re]>G);if(K>=re)break;ur(y,K,re),ur(x,3*K,3*re),ur(x,3*K+1,3*re+1),ur(x,3*K+2,3*re+2)}re-M<B-re?(v(y,x,M,re),M=re+1):(v(y,x,re+1,B),B=re)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},bt.deserialize=function(e){var t=new bt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Zt=Math.pow(2,53)-1;function hr(e){var t=+e;return!isNaN(t)&&t<=Zt?t:ze(String(e))}function ur(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}Dn("FeaturePositionMap",bt);var gr=function(e,t){this.gl=e.gl,this.location=t},Nr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(gr),an=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(gr),Hr=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(gr),In=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(gr),ni=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(gr),hi=function(e){function t(r,f){e.call(this,r,f),this.current=Gi.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(gr),ii=new Float32Array(16),ea=function(e){function t(r,f){e.call(this,r,f),this.current=ii}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(gr);function Bn(e){return[Pe(255*e.r,255*e.g),Pe(255*e.b,255*e.a)]}var _i=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};_i.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},_i.prototype.getBinding=function(e,t,r){return this.type==="color"?new hi(e,t):new an(e,t)};var te=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};te.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},te.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},te.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new ni(e,t):new an(e,t)};var q=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};q.prototype.populatePaintArray=function(e,t,r,f,v){var y=this.paintVertexArray.length,x=this.expression.evaluate(new qi(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)},q.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},q.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=Bn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var y=e;y<t;y++)this.paintVertexArray.emplace(y,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},q.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},q.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var R=function(e,t,r,f,v,y){this.expression=e,this.uniformNames=t.map(function(x){return"u_"+x+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(x){return{name:"a_"+x,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new y};R.prototype.populatePaintArray=function(e,t,r,f,v){var y=this.expression.evaluate(new qi(this.zoom),t,{},f,[],v),x=this.expression.evaluate(new qi(this.zoom+1),t,{},f,[],v),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,y,x)},R.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),y=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,y)},R.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=Bn(r),y=Bn(f),x=e;x<t;x++)this.paintVertexArray.emplace(x,v[0],v[1],y[0],y[1]);else{for(var M=e;M<t;M++)this.paintVertexArray.emplace(M,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},R.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},R.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},R.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=et(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},R.prototype.getBinding=function(e,t,r){return new an(e,t)};var F=function(e,t,r,f,v,y){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=y,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};F.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},F.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},F.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],y=f[r.mid],x=f[r.max];if(v&&y&&x)for(var M=e;M<t;M++)this.zoomInPaintVertexArray.emplace(M,y.tl[0],y.tl[1],y.br[0],y.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],y.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,y.tl[0],y.tl[1],y.br[0],y.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],y.pixelRatio,x.pixelRatio)}},F.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,We.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,We.members,this.expression.isStateDependent))},F.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ne=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var y=e.paint.get(v);if(y instanceof So&&Ns(y.property.specification)){var x=ht(v,e.type),M=y.value,B=y.property.specification.type,G=y.property.useIntegerZoom,K=y.property.specification["property-type"],re=K==="cross-faded"||K==="cross-faded-data-driven";if(M.kind==="constant")this.binders[v]=re?new te(M.value,x):new _i(M.value,x,B),f.push("/u_"+v);else if(M.kind==="source"||re){var fe=wt(v,B,"source");this.binders[v]=re?new F(M,B,G,t,fe,e.id):new q(M,x,B,fe),f.push("/a_"+v)}else{var ge=wt(v,B,"composite");this.binders[v]=new R(M,x,B,G,t,ge),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};ne.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof q||t instanceof R?t.maxValue:0},ne.prototype.populatePaintArrays=function(e,t,r,f,v){for(var y in this.binders){var x=this.binders[y];(x instanceof q||x instanceof R||x instanceof F)&&x.populatePaintArray(e,t,r,f,v)}},ne.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof te&&f.setConstantPatternPositions(e,t)}},ne.prototype.updatePaintArrays=function(e,t,r,f,v){var y=!1;for(var x in e)for(var M=0,B=t.getPositions(x);M<B.length;M+=1){var G=B[M],K=r.feature(G.index);for(var re in this.binders){var fe=this.binders[re];if((fe instanceof q||fe instanceof R||fe instanceof F)&&fe.expression.isStateDependent===!0){var ge=f.paint.get(re);fe.expression=ge.value,fe.updatePaintArray(G.start,G.end,K,e[x],v),y=!0}}}return y},ne.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof _i||r instanceof te)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},ne.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof q||r instanceof R)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof F)for(var v=0;v<We.members.length;v++)e.push(We.members[v].name)}return e},ne.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof _i||r instanceof te||r instanceof R)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},ne.prototype.getPaintVertexBuffers=function(){return this._buffers},ne.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof _i||v instanceof te||v instanceof R)for(var y=0,x=v.uniformNames;y<x.length;y+=1){var M=x[y];if(t[M]){var B=v.getBinding(e,t[M],M);r.push({name:M,property:f,binding:B})}}}return r},ne.prototype.setUniforms=function(e,t,r,f){for(var v=0,y=t;v<y.length;v+=1){var x=y[v],M=x.name,B=x.property;this.binders[B].setUniform(x.binding,f,r.get(B),M)}},ne.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof F){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof q||r instanceof R)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},ne.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof q||r instanceof R||r instanceof F)&&r.upload(e)}this.updatePaintBuffers()},ne.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof q||t instanceof R||t instanceof F)&&t.destroy()}};var pe=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var y=v[f];this.programConfigurations[y.id]=new ne(y,t,r)}this.needsUpload=!1,this._featureMap=new bt,this._bufferOffset=0};function ht(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function wt(e,t,r){var f={color:{source:pl,composite:$u},number:{source:Bu,composite:pl}},v=function(y){return{"line-pattern":{source:fu,composite:fu},"fill-pattern":{source:fu,composite:fu},"fill-extrusion-pattern":{source:fu,composite:fu}}[y]}(e);return v&&v[r]||f[t][r]}pe.prototype.populatePaintArrays=function(e,t,r,f,v,y){for(var x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,f,v,y);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},pe.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,y=r;v<y.length;v+=1){var x=y[v];this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,t,x,f)||this.needsUpload}},pe.prototype.get=function(e){return this.programConfigurations[e]},pe.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},pe.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Dn("ConstantBinder",_i),Dn("CrossFadedConstantBinder",te),Dn("SourceExpressionBinder",q),Dn("CrossFadedCompositeBinder",F),Dn("CompositeExpressionBinder",R),Dn("ProgramConfiguration",ne,{omit:["_buffers"]}),Dn("ProgramConfigurationSet",pe);var At=Math.pow(2,14)-1,qt=-At-1;function Pr(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],y=0;y<v.length;y++){var x=v[y],M=Math.round(x.x*t),B=Math.round(x.y*t);x.x=et(M,qt,At),x.y=et(B,qt,At),(M<x.x||M>x.x+1||B<x.y||B>x.y+1)&&Xe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function vn(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Pr(e):[]}}function zn(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var $n=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new xs,this.indexArray=new Du,this.segments=new we,this.programConfigurations=new pe(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function xi(e,t){for(var r=0;r<e.length;r++)if(ta(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(ta(e,t[f]))return!0;return!!ba(e,t)}function li(e,t,r){return!!ta(e,t)||!!Ia(t,e,r)}function Zi(e,t){if(e.length===1)return Va(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(ta(e,f[v]))return!0;for(var y=0;y<e.length;y++)if(Va(t,e[y]))return!0;for(var x=0;x<t.length;x++)if(ba(e,t[x]))return!0;return!1}function $i(e,t,r){if(e.length>1){if(ba(e,t))return!0;for(var f=0;f<t.length;f++)if(Ia(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(Ia(e[v],t,r))return!0;return!1}function ba(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],y=0;y<t.length-1;y++)if(oo(f,v,t[y],t[y+1]))return!0;return!1}function oo(e,t,r,f){return Ut(e,r,f)!==Ut(t,r,f)&&Ut(e,t,r)!==Ut(e,t,f)}function Ia(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(ho(e,t[v-1],t[v])<f)return!0;return!1}function ho(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function Va(e,t){for(var r,f,v,y=!1,x=0;x<e.length;x++)for(var M=0,B=(r=e[x]).length-1;M<r.length;B=M++)(f=r[M]).y>t.y!=(v=r[B]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(y=!y);return y}function ta(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var y=e[f],x=e[v];y.y>t.y!=x.y>t.y&&t.x<(x.x-y.x)*(t.y-y.y)/(x.y-y.y)+y.x&&(r=!r)}return r}function da(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var y=Ut(e,t,r[0]);return y!==Ut(e,t,r[1])||y!==Ut(e,t,r[2])||y!==Ut(e,t,r[3])}function Na(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function ha(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Pa(e,t,r,f,v){if(!t[0]&&!t[1])return e;var y=W.convert(t)._mult(v);r==="viewport"&&y._rotate(-f);for(var x=[],M=0;M<e.length;M++)x.push(e[M].sub(y));return x}$n.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(var x=0,M=e;x<M.length;x+=1){var B=M[x],G=B.feature,K=B.id,re=B.index,fe=B.sourceLayerIndex,ge=this.layers[0]._featureFilter.needGeometry,Ze=vn(G,ge);if(this.layers[0]._featureFilter.filter(new qi(this.zoom),Ze,r)){var Ge=y?y.evaluate(Ze,{},r):void 0,vt={id:K,properties:G.properties,type:G.type,sourceLayerIndex:fe,index:re,geometry:ge?Ze.geometry:Pr(G),patterns:{},sortKey:Ge};v.push(vt)}}y&&v.sort(function(mn,ei){return mn.sortKey-ei.sortKey});for(var qe=0,Mt=v;qe<Mt.length;qe+=1){var Wt=Mt[qe],lr=Wt.geometry,fr=Wt.index,Ir=Wt.sourceLayerIndex,rn=e[fr].feature;this.addFeature(Wt,lr,fr,r),t.featureIndex.insert(rn,lr,fr,Ir,this.index)}},$n.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},$n.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},$n.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$n.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,be),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},$n.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},$n.prototype.addFeature=function(e,t,r,f){for(var v=0,y=t;v<y.length;v+=1)for(var x=0,M=y[v];x<M.length;x+=1){var B=M[x],G=B.x,K=B.y;if(!(G<0||G>=8192||K<0||K>=8192)){var re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),fe=re.vertexLength;zn(this.layoutVertexArray,G,K,-1,-1),zn(this.layoutVertexArray,G,K,1,-1),zn(this.layoutVertexArray,G,K,1,1),zn(this.layoutVertexArray,G,K,-1,1),this.indexArray.emplaceBack(fe,fe+1,fe+2),this.indexArray.emplaceBack(fe,fe+3,fe+2),re.vertexLength+=4,re.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},Dn("CircleBucket",$n,{omit:["layers"]});var Eo=new Ko({"circle-sort-key":new Hn(se.layout_circle["circle-sort-key"])}),Fo={paint:new Ko({"circle-radius":new Hn(se.paint_circle["circle-radius"]),"circle-color":new Hn(se.paint_circle["circle-color"]),"circle-blur":new Hn(se.paint_circle["circle-blur"]),"circle-opacity":new Hn(se.paint_circle["circle-opacity"]),"circle-translate":new ai(se.paint_circle["circle-translate"]),"circle-translate-anchor":new ai(se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ai(se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ai(se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Hn(se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Hn(se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Hn(se.paint_circle["circle-stroke-opacity"])}),layout:Eo},oa=typeof Float32Array!="undefined"?Float32Array:Array;function Uo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function po(e,t,r){var f=t[0],v=t[1],y=t[2],x=t[3],M=t[4],B=t[5],G=t[6],K=t[7],re=t[8],fe=t[9],ge=t[10],Ze=t[11],Ge=t[12],vt=t[13],qe=t[14],Mt=t[15],Wt=r[0],lr=r[1],fr=r[2],Ir=r[3];return e[0]=Wt*f+lr*M+fr*re+Ir*Ge,e[1]=Wt*v+lr*B+fr*fe+Ir*vt,e[2]=Wt*y+lr*G+fr*ge+Ir*qe,e[3]=Wt*x+lr*K+fr*Ze+Ir*Mt,e[4]=(Wt=r[4])*f+(lr=r[5])*M+(fr=r[6])*re+(Ir=r[7])*Ge,e[5]=Wt*v+lr*B+fr*fe+Ir*vt,e[6]=Wt*y+lr*G+fr*ge+Ir*qe,e[7]=Wt*x+lr*K+fr*Ze+Ir*Mt,e[8]=(Wt=r[8])*f+(lr=r[9])*M+(fr=r[10])*re+(Ir=r[11])*Ge,e[9]=Wt*v+lr*B+fr*fe+Ir*vt,e[10]=Wt*y+lr*G+fr*ge+Ir*qe,e[11]=Wt*x+lr*K+fr*Ze+Ir*Mt,e[12]=(Wt=r[12])*f+(lr=r[13])*M+(fr=r[14])*re+(Ir=r[15])*Ge,e[13]=Wt*v+lr*B+fr*fe+Ir*vt,e[14]=Wt*y+lr*G+fr*ge+Ir*qe,e[15]=Wt*x+lr*K+fr*Ze+Ir*Mt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var tu,xc=po;function Dl(e,t,r){var f=t[0],v=t[1],y=t[2],x=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*y+r[12]*x,e[1]=r[1]*f+r[5]*v+r[9]*y+r[13]*x,e[2]=r[2]*f+r[6]*v+r[10]*y+r[14]*x,e[3]=r[3]*f+r[7]*v+r[11]*y+r[15]*x,e}tu=new oa(3),oa!=Float32Array&&(tu[0]=0,tu[1]=0,tu[2]=0),function(){var e=new oa(4);oa!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Ju=(function(){var e=new oa(2);oa!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,Fo)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new $n(r)},t.prototype.queryRadius=function(r){var f=r;return Na("circle-radius",this,f)+Na("circle-stroke-width",this,f)+ha(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,M,B,G){for(var K=Pa(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,B),re=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),fe=this.paint.get("circle-pitch-alignment")==="map",ge=fe?K:function(rn,mn){return rn.map(function(ei){return hu(ei,mn)})}(K,G),Ze=fe?re*B:re,Ge=0,vt=y;Ge<vt.length;Ge+=1)for(var qe=0,Mt=vt[Ge];qe<Mt.length;qe+=1){var Wt=Mt[qe],lr=fe?Wt:hu(Wt,G),fr=Ze,Ir=Dl([],[Wt.x,Wt.y,0,1],G);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?fr*=Ir[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(fr*=M.cameraToCenterDistance/Ir[3]),li(ge,lr,fr))return!0}return!1},t}(cu));function hu(e,t){var r=Dl([],[e.x,e.y,0,1],t);return new W(r[0]/r[3],r[1]/r[3])}var Fl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}($n);function Vs(e,t,r,f){var v=t.width,y=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*y*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*y*r);return e.width=v,e.height=y,e.data=f,e}function vl(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var y=Vs({},{width:f,height:v},r);ml(e,y,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=y.data}}function ml(e,t,r,f,v,y){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var x=e.data,M=t.data,B=0;B<v.height;B++)for(var G=((r.y+B)*e.width+r.x)*y,K=((f.y+B)*t.width+f.x)*y,re=0;re<v.width*y;re++)M[K+re]=x[G+re];return t}Dn("HeatmapBucket",Fl,{omit:["layers"]});var pu=function(e,t){Vs(this,e,1,t)};pu.prototype.resize=function(e){vl(this,e,1)},pu.prototype.clone=function(){return new pu({width:this.width,height:this.height},new Uint8Array(this.data))},pu.copy=function(e,t,r,f,v){ml(e,t,r,f,v,1)};var Mo=function(e,t){Vs(this,e,4,t)};Mo.prototype.resize=function(e){vl(this,e,4)},Mo.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Mo.prototype.clone=function(){return new Mo({width:this.width,height:this.height},new Uint8Array(this.data))},Mo.copy=function(e,t,r,f,v){ml(e,t,r,f,v,4)},Dn("AlphaImage",pu),Dn("RGBAImage",Mo);var qc={paint:new Ko({"heatmap-radius":new Hn(se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Hn(se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ai(se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new eu(se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ai(se.paint_heatmap["heatmap-opacity"])})};function ef(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new Mo({width:r,height:f}),y=function(Ze,Ge,vt){t[e.evaluationKey]=vt;var qe=e.expression.evaluate(t);v.data[Ze+Ge+0]=Math.floor(255*qe.r/qe.a),v.data[Ze+Ge+1]=Math.floor(255*qe.g/qe.a),v.data[Ze+Ge+2]=Math.floor(255*qe.b/qe.a),v.data[Ze+Ge+3]=Math.floor(255*qe.a)};if(e.clips)for(var x=0,M=0;x<f;++x,M+=4*r)for(var B=0,G=0;B<r;B++,G+=4){var K=B/(r-1),re=e.clips[x];y(M,G,re.start*(1-K)+re.end*K)}else for(var fe=0,ge=0;fe<r;fe++,ge+=4)y(0,ge,fe/(r-1));return v}var pf=function(e){function t(r){e.call(this,r,qc),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Fl(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=ef({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(cu),Rf={paint:new Ko({"hillshade-illumination-direction":new ai(se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ai(se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ai(se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ai(se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ai(se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ai(se.paint_hillshade["hillshade-accent-color"])})},ru=function(e){function t(r){e.call(this,r,Rf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(cu),tf=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,bc=Bl,_p=Bl;function Bl(e,t,r){r=r||2;var f,v,y,x,M,B,G,K=t&&t.length,re=K?t[0]*r:e.length,fe=nh(e,0,re,r,!0),ge=[];if(!fe||fe.next===fe.prev)return ge;if(K&&(fe=function(Ge,vt,qe,Mt){var Wt,lr,fr,Ir=[];for(Wt=0,lr=vt.length;Wt<lr;Wt++)(fr=nh(Ge,vt[Wt]*Mt,Wt<lr-1?vt[Wt+1]*Mt:Ge.length,Mt,!1))===fr.next&&(fr.steiner=!0),Ir.push(Bh(fr));for(Ir.sort(xp),Wt=0;Wt<Ir.length;Wt++)ih(Ir[Wt],qe),qe=Sc(qe,qe.next);return qe}(e,t,fe,r)),e.length>80*r){f=y=e[0],v=x=e[1];for(var Ze=r;Ze<re;Ze+=r)(M=e[Ze])<f&&(f=M),(B=e[Ze+1])<v&&(v=B),M>y&&(y=M),B>x&&(x=B);G=(G=Math.max(y-f,x-v))!==0?1/G:0}return df(fe,ge,r,f,v,G),ge}function nh(e,t,r,f,v){var y,x;if(v===af(e,t,r,f)>0)for(y=t;y<r;y+=f)x=Bf(y,e[y],e[y+1],x);else for(y=r-f;y>=t;y-=f)x=Bf(y,e[y],e[y+1],x);return x&&Df(x,x.next)&&(yl(x),x=x.next),x}function Sc(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!Df(f,f.next)&&is(f.prev,f,f.next)!==0)f=f.next;else{if(yl(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function df(e,t,r,f,v,y,x){if(e){!x&&y&&function(K,re,fe,ge){var Ze=K;do Ze.z===null&&(Ze.z=kf(Ze.x,Ze.y,re,fe,ge)),Ze.prevZ=Ze.prev,Ze.nextZ=Ze.next,Ze=Ze.next;while(Ze!==K);Ze.prevZ.nextZ=null,Ze.prevZ=null,function(Ge){var vt,qe,Mt,Wt,lr,fr,Ir,rn,mn=1;do{for(qe=Ge,Ge=null,lr=null,fr=0;qe;){for(fr++,Mt=qe,Ir=0,vt=0;vt<mn&&(Ir++,Mt=Mt.nextZ);vt++);for(rn=mn;Ir>0||rn>0&&Mt;)Ir!==0&&(rn===0||!Mt||qe.z<=Mt.z)?(Wt=qe,qe=qe.nextZ,Ir--):(Wt=Mt,Mt=Mt.nextZ,rn--),lr?lr.nextZ=Wt:Ge=Wt,Wt.prevZ=lr,lr=Wt;qe=Mt}lr.nextZ=null,mn*=2}while(fr>1)}(Ze)}(e,f,v,y);for(var M,B,G=e;e.prev!==e.next;)if(M=e.prev,B=e.next,y?vf(e,f,v,y):Vp(e))t.push(M.i/r),t.push(e.i/r),t.push(B.i/r),yl(e),e=B.next,G=B.next;else if((e=B)===G){x?x===1?df(e=Dh(Sc(e),t,r),t,r,f,v,y,2):x===2&&Gp(e,t,r,f,v,y):df(Sc(e),t,r,f,v,y,1);break}}}function Vp(e){var t=e.prev,r=e,f=e.next;if(is(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(rf(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&is(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function vf(e,t,r,f){var v=e.prev,y=e,x=e.next;if(is(v,y,x)>=0)return!1;for(var M=v.x>y.x?v.x>x.x?v.x:x.x:y.x>x.x?y.x:x.x,B=v.y>y.y?v.y>x.y?v.y:x.y:y.y>x.y?y.y:x.y,G=kf(v.x<y.x?v.x<x.x?v.x:x.x:y.x<x.x?y.x:x.x,v.y<y.y?v.y<x.y?v.y:x.y:y.y<x.y?y.y:x.y,t,r,f),K=kf(M,B,t,r,f),re=e.prevZ,fe=e.nextZ;re&&re.z>=G&&fe&&fe.z<=K;){if(re!==e.prev&&re!==e.next&&rf(v.x,v.y,y.x,y.y,x.x,x.y,re.x,re.y)&&is(re.prev,re,re.next)>=0||(re=re.prevZ,fe!==e.prev&&fe!==e.next&&rf(v.x,v.y,y.x,y.y,x.x,x.y,fe.x,fe.y)&&is(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;re&&re.z>=G;){if(re!==e.prev&&re!==e.next&&rf(v.x,v.y,y.x,y.y,x.x,x.y,re.x,re.y)&&is(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;fe&&fe.z<=K;){if(fe!==e.prev&&fe!==e.next&&rf(v.x,v.y,y.x,y.y,x.x,x.y,fe.x,fe.y)&&is(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function Dh(e,t,r){var f=e;do{var v=f.prev,y=f.next.next;!Df(v,y)&&zh(v,f,f.next,y)&&nf(v,y)&&nf(y,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(y.i/r),yl(f),yl(f.next),f=e=y),f=f.next}while(f!==e);return Sc(f)}function Gp(e,t,r,f,v,y){var x=e;do{for(var M=x.next.next;M!==x.prev;){if(x.i!==M.i&&Nh(x,M)){var B=Ff(x,M);return x=Sc(x,x.next),B=Sc(B,B.next),df(x,t,r,f,v,y),void df(B,t,r,f,v,y)}M=M.next}x=x.next}while(x!==e)}function xp(e,t){return e.x-t.x}function ih(e,t){if(t=function(f,v){var y,x=v,M=f.x,B=f.y,G=-1/0;do{if(B<=x.y&&B>=x.next.y&&x.next.y!==x.y){var K=x.x+(B-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(K<=M&&K>G){if(G=K,K===M){if(B===x.y)return x;if(B===x.next.y)return x.next}y=x.x<x.next.x?x:x.next}}x=x.next}while(x!==v);if(!y)return null;if(M===G)return y;var re,fe=y,ge=y.x,Ze=y.y,Ge=1/0;x=y;do M>=x.x&&x.x>=ge&&M!==x.x&&rf(B<Ze?M:G,B,ge,Ze,B<Ze?G:M,B,x.x,x.y)&&(re=Math.abs(B-x.y)/(M-x.x),nf(x,f)&&(re<Ge||re===Ge&&(x.x>y.x||x.x===y.x&&Fh(y,x)))&&(y=x,Ge=re)),x=x.next;while(x!==fe);return y}(e,t)){var r=Ff(t,e);Sc(t,t.next),Sc(r,r.next)}}function Fh(e,t){return is(e.prev,e,t.prev)<0&&is(t.next,e,e.next)<0}function kf(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Bh(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function rf(e,t,r,f,v,y,x,M){return(v-x)*(t-M)-(e-x)*(y-M)>=0&&(e-x)*(f-M)-(r-x)*(t-M)>=0&&(r-x)*(y-M)-(v-x)*(f-M)>=0}function Nh(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&zh(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(nf(e,t)&&nf(t,e)&&function(r,f){var v=r,y=!1,x=(r.x+f.x)/2,M=(r.y+f.y)/2;do v.y>M!=v.next.y>M&&v.next.y!==v.y&&x<(v.next.x-v.x)*(M-v.y)/(v.next.y-v.y)+v.x&&(y=!y),v=v.next;while(v!==r);return y}(e,t)&&(is(e.prev,e,t.prev)||is(e,t.prev,t))||Df(e,t)&&is(e.prev,e,e.next)>0&&is(t.prev,t,t.next)>0)}function is(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Df(e,t){return e.x===t.x&&e.y===t.y}function zh(e,t,r,f){var v=oh(is(e,t,r)),y=oh(is(e,t,f)),x=oh(is(r,f,e)),M=oh(is(r,f,t));return v!==y&&x!==M||!(v!==0||!ah(e,r,t))||!(y!==0||!ah(e,f,t))||!(x!==0||!ah(r,e,f))||!(M!==0||!ah(r,t,f))}function ah(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function oh(e){return e>0?1:e<0?-1:0}function nf(e,t){return is(e.prev,e,e.next)<0?is(e,t,e.next)>=0&&is(e,e.prev,t)>=0:is(e,t,e.prev)<0||is(e,e.next,t)<0}function Ff(e,t){var r=new Nf(e.i,e.x,e.y),f=new Nf(t.i,t.x,t.y),v=e.next,y=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,y.next=f,f.prev=y,f}function Bf(e,t,r,f){var v=new Nf(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function yl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Nf(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function af(e,t,r,f){for(var v=0,y=t,x=r-f;y<r;y+=f)v+=(e[x]-e[y])*(e[y+1]+e[x+1]),x=y;return v}function sh(e,t,r,f,v){(function y(x,M,B,G,K){for(;G>B;){if(G-B>600){var re=G-B+1,fe=M-B+1,ge=Math.log(re),Ze=.5*Math.exp(2*ge/3),Ge=.5*Math.sqrt(ge*Ze*(re-Ze)/re)*(fe-re/2<0?-1:1);y(x,M,Math.max(B,Math.floor(M-fe*Ze/re+Ge)),Math.min(G,Math.floor(M+(re-fe)*Ze/re+Ge)),K)}var vt=x[M],qe=B,Mt=G;for(Ec(x,B,M),K(x[G],vt)>0&&Ec(x,B,G);qe<Mt;){for(Ec(x,qe,Mt),qe++,Mt--;K(x[qe],vt)<0;)qe++;for(;K(x[Mt],vt)>0;)Mt--}K(x[B],vt)===0?Ec(x,B,Mt):Ec(x,++Mt,G),Mt<=M&&(B=Mt+1),M<=Mt&&(G=Mt-1)}})(e,t,r||0,f||e.length-1,v||Uh)}function Ec(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function Uh(e,t){return e<t?-1:e>t?1:0}function mf(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,y=[],x=0;x<r;x++){var M=_r(e[x]);M!==0&&(e[x].area=Math.abs(M),v===void 0&&(v=M<0),v===M<0?(f&&y.push(f),f=[e[x]]):f.push(e[x]))}if(f&&y.push(f),t>1)for(var B=0;B<y.length;B++)y[B].length<=t||(sh(y[B],t,1,y[B].length-1,yf),y[B]=y[B].slice(0,t));return y}function yf(e,t){return t.area-e.area}function gf(e,t,r){for(var f=r.patternDependencies,v=!1,y=0,x=t;y<x.length;y+=1){var M=x[y].paint.get(e+"-pattern");M.isConstant()||(v=!0);var B=M.constantOr(null);B&&(v=!0,f[B.to]=!0,f[B.from]=!0)}return v}function Nl(e,t,r,f,v){for(var y=v.patternDependencies,x=0,M=t;x<M.length;x+=1){var B=M[x],G=B.paint.get(e+"-pattern").value;if(G.kind!=="constant"){var K=G.evaluate({zoom:f-1},r,{},v.availableImages),re=G.evaluate({zoom:f},r,{},v.availableImages),fe=G.evaluate({zoom:f+1},r,{},v.availableImages);re=re&&re.name?re.name:re,fe=fe&&fe.name?fe.name:fe,y[K=K&&K.name?K.name:K]=!0,y[re]=!0,y[fe]=!0,r.patterns[B.id]={min:K,mid:re,max:fe}}}return r}Bl.deviation=function(e,t,r,f){var v=t&&t.length,y=Math.abs(af(e,0,v?t[0]*r:e.length,r));if(v)for(var x=0,M=t.length;x<M;x++)y-=Math.abs(af(e,t[x]*r,x<M-1?t[x+1]*r:e.length,r));var B=0;for(x=0;x<f.length;x+=3){var G=f[x]*r,K=f[x+1]*r,re=f[x+2]*r;B+=Math.abs((e[G]-e[re])*(e[K+1]-e[G+1])-(e[G]-e[K])*(e[re+1]-e[G+1]))}return y===0&&B===0?0:Math.abs((B-y)/y)},Bl.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var y=0;y<e[v].length;y++)for(var x=0;x<t;x++)r.vertices.push(e[v][y][x]);v>0&&r.holes.push(f+=e[v-1].length)}return r},bc.default=_p;var bu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xs,this.indexArray=new Du,this.indexArray2=new Nu,this.programConfigurations=new pe(e.layers,e.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};bu.prototype.populate=function(e,t,r){this.hasPattern=gf("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],y=0,x=e;y<x.length;y+=1){var M=x[y],B=M.feature,G=M.id,K=M.index,re=M.sourceLayerIndex,fe=this.layers[0]._featureFilter.needGeometry,ge=vn(B,fe);if(this.layers[0]._featureFilter.filter(new qi(this.zoom),ge,r)){var Ze=f?f.evaluate(ge,{},r,t.availableImages):void 0,Ge={id:G,properties:B.properties,type:B.type,sourceLayerIndex:re,index:K,geometry:fe?ge.geometry:Pr(B),patterns:{},sortKey:Ze};v.push(Ge)}}f&&v.sort(function(rn,mn){return rn.sortKey-mn.sortKey});for(var vt=0,qe=v;vt<qe.length;vt+=1){var Mt=qe[vt],Wt=Mt.geometry,lr=Mt.index,fr=Mt.sourceLayerIndex;if(this.hasPattern){var Ir=Nl("fill",this.layers,Mt,this.zoom,t);this.patternFeatures.push(Ir)}else this.addFeature(Mt,Wt,lr,r,{});t.featureIndex.insert(e[lr].feature,Wt,lr,fr,this.index)}},bu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},bu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},bu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},bu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},bu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},bu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},bu.prototype.addFeature=function(e,t,r,f,v){for(var y=0,x=mf(t,500);y<x.length;y+=1){for(var M=x[y],B=0,G=0,K=M;G<K.length;G+=1)B+=K[G].length;for(var re=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray),fe=re.vertexLength,ge=[],Ze=[],Ge=0,vt=M;Ge<vt.length;Ge+=1){var qe=vt[Ge];if(qe.length!==0){qe!==M[0]&&Ze.push(ge.length/2);var Mt=this.segments2.prepareSegment(qe.length,this.layoutVertexArray,this.indexArray2),Wt=Mt.vertexLength;this.layoutVertexArray.emplaceBack(qe[0].x,qe[0].y),this.indexArray2.emplaceBack(Wt+qe.length-1,Wt),ge.push(qe[0].x),ge.push(qe[0].y);for(var lr=1;lr<qe.length;lr++)this.layoutVertexArray.emplaceBack(qe[lr].x,qe[lr].y),this.indexArray2.emplaceBack(Wt+lr-1,Wt+lr),ge.push(qe[lr].x),ge.push(qe[lr].y);Mt.vertexLength+=qe.length,Mt.primitiveLength+=qe.length}}for(var fr=bc(ge,Ze),Ir=0;Ir<fr.length;Ir+=3)this.indexArray.emplaceBack(fe+fr[Ir],fe+fr[Ir+1],fe+fr[Ir+2]);re.vertexLength+=B,re.primitiveLength+=fr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Dn("FillBucket",bu,{omit:["layers","patternFeatures"]});var _f=new Ko({"fill-sort-key":new Hn(se.layout_fill["fill-sort-key"])}),zf={paint:new Ko({"fill-antialias":new ai(se.paint_fill["fill-antialias"]),"fill-opacity":new Hn(se.paint_fill["fill-opacity"]),"fill-color":new Hn(se.paint_fill["fill-color"]),"fill-outline-color":new Hn(se.paint_fill["fill-outline-color"]),"fill-translate":new ai(se.paint_fill["fill-translate"]),"fill-translate-anchor":new ai(se.paint_fill["fill-translate-anchor"]),"fill-pattern":new Il(se.paint_fill["fill-pattern"])}),layout:_f},xf=function(e){function t(r){e.call(this,r,zf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new bu(r)},t.prototype.queryRadius=function(){return ha(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,M,B){return Zi(Pa(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,B),y)},t.prototype.isTileClipped=function(){return!0},t}(cu),Zh=Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,bf=gl;function gl(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(uh,this,t)}function uh(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var y=f.readVarint()+f.pos;f.pos<y;){var x=v._keys[f.readVarint()],M=v._values[f.readVarint()];v.properties[x]=M}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Uf(e){for(var t,r,f=0,v=0,y=e.length,x=y-1;v<y;x=v++)f+=((r=e[x]).x-(t=e[v]).x)*(t.y+r.y);return f}gl.types=["Unknown","Point","LineString","Polygon"],gl.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,y=0,x=0,M=[];e.pos<r;){if(v<=0){var B=e.readVarint();f=7&B,v=B>>3}if(v--,f===1||f===2)y+=e.readSVarint(),x+=e.readSVarint(),f===1&&(t&&M.push(t),t=[]),t.push(new W(y,x));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&M.push(t),M},gl.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,y=0,x=1/0,M=-1/0,B=1/0,G=-1/0;e.pos<t;){if(f<=0){var K=e.readVarint();r=7&K,f=K>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<x&&(x=v),v>M&&(M=v),(y+=e.readSVarint())<B&&(B=y),y>G&&(G=y);else if(r!==7)throw new Error("unknown command "+r)}return[x,B,M,G]},gl.prototype.toGeoJSON=function(e,t,r){var f,v,y=this.extent*Math.pow(2,r),x=this.extent*e,M=this.extent*t,B=this.loadGeometry(),G=gl.types[this.type];function K(ge){for(var Ze=0;Ze<ge.length;Ze++){var Ge=ge[Ze];ge[Ze]=[360*(Ge.x+x)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ge.y+M)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var re=[];for(f=0;f<B.length;f++)re[f]=B[f][0];K(B=re);break;case 2:for(f=0;f<B.length;f++)K(B[f]);break;case 3:for(B=function(ge){var Ze=ge.length;if(Ze<=1)return[ge];for(var Ge,vt,qe=[],Mt=0;Mt<Ze;Mt++){var Wt=Uf(ge[Mt]);Wt!==0&&(vt===void 0&&(vt=Wt<0),vt===Wt<0?(Ge&&qe.push(Ge),Ge=[ge[Mt]]):Ge.push(ge[Mt]))}return Ge&&qe.push(Ge),qe}(B),f=0;f<B.length;f++)for(v=0;v<B[f].length;v++)K(B[f][v])}B.length===1?B=B[0]:G="Multi"+G;var fe={type:"Feature",geometry:{type:G,coordinates:B},properties:this.properties};return"id"in this&&(fe.id=this.id),fe};var jh=lh;function lh(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(bp,this,t),this.length=this._features.length}function bp(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,y=f.readVarint()+f.pos;f.pos<y;){var x=f.readVarint()>>3;v=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return v}(r))}function wc(e,t,r){if(e===3){var f=new jh(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}lh.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new bf(this._pbf,t,this.extent,this._keys,this._values)};var Uc={VectorTile:function(e,t){this.layers=e.readFields(wc,{},t)},VectorTileFeature:bf,VectorTileLayer:jh},Vh=Uc.VectorTileFeature.types,Sf=Math.pow(2,13);function of(e,t,r,f,v,y,x,M){e.emplaceBack(t,r,2*Math.floor(f*Sf)+x,v*Sf*2,y*Sf*2,Math.round(M))}var zu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new bs,this.indexArray=new Du,this.programConfigurations=new pe(e.layers,e.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Sp(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}zu.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=gf("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var y=v[f],x=y.feature,M=y.id,B=y.index,G=y.sourceLayerIndex,K=this.layers[0]._featureFilter.needGeometry,re=vn(x,K);if(this.layers[0]._featureFilter.filter(new qi(this.zoom),re,r)){var fe={id:M,sourceLayerIndex:G,index:B,geometry:K?re.geometry:Pr(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(Nl("fill-extrusion",this.layers,fe,this.zoom,t)):this.addFeature(fe,fe.geometry,B,r,{}),t.featureIndex.insert(x,fe.geometry,B,G,this.index,!0)}}},zu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},zu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},zu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},zu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zu.prototype.addFeature=function(e,t,r,f,v){for(var y=0,x=mf(t,500);y<x.length;y+=1){for(var M=x[y],B=0,G=0,K=M;G<K.length;G+=1)B+=K[G].length;for(var re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),fe=0,ge=M;fe<ge.length;fe+=1){var Ze=ge[fe];if(Ze.length!==0&&!((la=Ze).every(function(Xi){return Xi.x<0})||la.every(function(Xi){return Xi.x>8192})||la.every(function(Xi){return Xi.y<0})||la.every(function(Xi){return Xi.y>8192})))for(var Ge=0,vt=0;vt<Ze.length;vt++){var qe=Ze[vt];if(vt>=1){var Mt=Ze[vt-1];if(!Sp(qe,Mt)){re.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Wt=qe.sub(Mt)._perp()._unit(),lr=Mt.dist(qe);Ge+lr>32768&&(Ge=0),of(this.layoutVertexArray,qe.x,qe.y,Wt.x,Wt.y,0,0,Ge),of(this.layoutVertexArray,qe.x,qe.y,Wt.x,Wt.y,0,1,Ge),of(this.layoutVertexArray,Mt.x,Mt.y,Wt.x,Wt.y,0,0,Ge+=lr),of(this.layoutVertexArray,Mt.x,Mt.y,Wt.x,Wt.y,0,1,Ge);var fr=re.vertexLength;this.indexArray.emplaceBack(fr,fr+2,fr+1),this.indexArray.emplaceBack(fr+1,fr+2,fr+3),re.vertexLength+=4,re.primitiveLength+=2}}}}if(re.vertexLength+B>we.MAX_VERTEX_ARRAY_LENGTH&&(re=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray)),Vh[e.type]==="Polygon"){for(var Ir=[],rn=[],mn=re.vertexLength,ei=0,Ln=M;ei<Ln.length;ei+=1){var ui=Ln[ei];if(ui.length!==0){ui!==M[0]&&rn.push(Ir.length/2);for(var Nn=0;Nn<ui.length;Nn++){var na=ui[Nn];of(this.layoutVertexArray,na.x,na.y,0,0,1,1,0),Ir.push(na.x),Ir.push(na.y)}}}for(var bi=bc(Ir,rn),ti=0;ti<bi.length;ti+=3)this.indexArray.emplaceBack(mn+bi[ti],mn+bi[ti+2],mn+bi[ti+1]);re.primitiveLength+=bi.length/3,re.vertexLength+=B}}var la;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Dn("FillExtrusionBucket",zu,{omit:["layers","features"]});var zl={paint:new Ko({"fill-extrusion-opacity":new ai(se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Hn(se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ai(se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ai(se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Il(se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Hn(se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Hn(se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ai(se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Gh=function(e){function t(r){e.call(this,r,zl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new zu(r)},t.prototype.queryRadius=function(){return ha(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,M,B,G){var K=Pa(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,B),re=this.paint.get("fill-extrusion-height").evaluate(f,v),fe=this.paint.get("fill-extrusion-base").evaluate(f,v),ge=function(Ge,vt,qe,Mt){for(var Wt=[],lr=0,fr=Ge;lr<fr.length;lr+=1){var Ir=fr[lr],rn=[Ir.x,Ir.y,0,1];Dl(rn,rn,vt),Wt.push(new W(rn[0]/rn[3],rn[1]/rn[3]))}return Wt}(K,G),Ze=function(Ge,vt,qe,Mt){for(var Wt=[],lr=[],fr=Mt[8]*vt,Ir=Mt[9]*vt,rn=Mt[10]*vt,mn=Mt[11]*vt,ei=Mt[8]*qe,Ln=Mt[9]*qe,ui=Mt[10]*qe,Nn=Mt[11]*qe,na=0,bi=Ge;na<bi.length;na+=1){for(var ti=[],la=[],Xi=0,Ca=bi[na];Xi<Ca.length;Xi+=1){var mi=Ca[Xi],Da=mi.x,Io=mi.y,Qo=Mt[0]*Da+Mt[4]*Io+Mt[12],Go=Mt[1]*Da+Mt[5]*Io+Mt[13],yo=Mt[2]*Da+Mt[6]*Io+Mt[14],Oo=Mt[3]*Da+Mt[7]*Io+Mt[15],Rs=yo+rn,vs=Oo+mn,nu=Qo+ei,Ds=Go+Ln,Gs=yo+ui,qo=Oo+Nn,Fs=new W((Qo+fr)/vs,(Go+Ir)/vs);Fs.z=Rs/vs,ti.push(Fs);var fa=new W(nu/qo,Ds/qo);fa.z=Gs/qo,la.push(fa)}Wt.push(ti),lr.push(la)}return[Wt,lr]}(y,fe,re,G);return function(Ge,vt,qe){var Mt=1/0;Zi(qe,vt)&&(Mt=rc(qe,vt[0]));for(var Wt=0;Wt<vt.length;Wt++)for(var lr=vt[Wt],fr=Ge[Wt],Ir=0;Ir<lr.length-1;Ir++){var rn=lr[Ir],mn=[rn,lr[Ir+1],fr[Ir+1],fr[Ir],rn];xi(qe,mn)&&(Mt=Math.min(Mt,rc(qe,mn)))}return Mt!==1/0&&Mt}(Ze[0],Ze[1],ge)},t}(cu);function _l(e,t){return e.x*t.x+e.y*t.y}function rc(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var y=t[f],x=e[0],M=r.sub(v),B=y.sub(v),G=x.sub(v),K=_l(M,M),re=_l(M,B),fe=_l(B,B),ge=_l(G,M),Ze=_l(G,B),Ge=K*fe-re*re,vt=(fe*ge-re*Ze)/Ge,qe=(K*Ze-re*ge)/Ge,Mt=v.z*(1-vt-qe)+r.z*vt+y.z*qe;if(isFinite(Mt))return Mt}return 1/0}for(var Wt=1/0,lr=0,fr=t;lr<fr.length;lr+=1)Wt=Math.min(Wt,fr[lr].z);return Wt}var Hh=Do([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,ch=Do([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Ef=Uc.VectorTileFeature.types,fh=Math.cos(Math.PI/180*37.5),ps=Math.pow(2,14)/.5,Zo=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new hs,this.layoutVertexArray2=new pl,this.indexArray=new Du,this.programConfigurations=new pe(e.layers,e.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Zo.prototype.populate=function(e,t,r){this.hasPattern=gf("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],y=0,x=e;y<x.length;y+=1){var M=x[y],B=M.feature,G=M.id,K=M.index,re=M.sourceLayerIndex,fe=this.layers[0]._featureFilter.needGeometry,ge=vn(B,fe);if(this.layers[0]._featureFilter.filter(new qi(this.zoom),ge,r)){var Ze=f?f.evaluate(ge,{},r):void 0,Ge={id:G,properties:B.properties,type:B.type,sourceLayerIndex:re,index:K,geometry:fe?ge.geometry:Pr(B),patterns:{},sortKey:Ze};v.push(Ge)}}f&&v.sort(function(rn,mn){return rn.sortKey-mn.sortKey});for(var vt=0,qe=v;vt<qe.length;vt+=1){var Mt=qe[vt],Wt=Mt.geometry,lr=Mt.index,fr=Mt.sourceLayerIndex;if(this.hasPattern){var Ir=Nl("line",this.layers,Mt,this.zoom,t);this.patternFeatures.push(Ir)}else this.addFeature(Mt,Wt,lr,r,{});t.featureIndex.insert(e[lr].feature,Wt,lr,fr,this.index)}},Zo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Zo.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},Zo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Zo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Zo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ch)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Zo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Zo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Zo.prototype.addFeature=function(e,t,r,f,v){var y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),M=y.get("line-cap"),B=y.get("line-miter-limit"),G=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var K=0,re=t;K<re.length;K+=1)this.addLine(re[K],e,x,M,B,G);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Zo.prototype.addLine=function(e,t,r,f,v,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var x=0;x<e.length-1;x++)this.totalDistance+=e[x].dist(e[x+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Ef[t.type]==="Polygon",B=e.length;B>=2&&e[B-1].equals(e[B-2]);)B--;for(var G=0;G<B-1&&e[G].equals(e[G+1]);)G++;if(!(B<(M?3:2))){r==="bevel"&&(v=1.05);var K,re=this.overscaling<=16?122880/(512*this.overscaling):0,fe=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray),ge=void 0,Ze=void 0,Ge=void 0,vt=void 0;this.e1=this.e2=-1,M&&(vt=e[G].sub(K=e[B-2])._unit()._perp());for(var qe=G;qe<B;qe++)if(!(Ze=qe===B-1?M?e[G+1]:void 0:e[qe+1])||!e[qe].equals(Ze)){vt&&(Ge=vt),K&&(ge=K),K=e[qe],vt=Ze?Ze.sub(K)._unit()._perp():Ge;var Mt=(Ge=Ge||vt).add(vt);Mt.x===0&&Mt.y===0||Mt._unit();var Wt=Ge.x*vt.x+Ge.y*vt.y,lr=Mt.x*vt.x+Mt.y*vt.y,fr=lr!==0?1/lr:1/0,Ir=2*Math.sqrt(2-2*lr),rn=lr<fh&&ge&&Ze,mn=Ge.x*vt.y-Ge.y*vt.x>0;if(rn&&qe>G){var ei=K.dist(ge);if(ei>2*re){var Ln=K.sub(K.sub(ge)._mult(re/ei)._round());this.updateDistance(ge,Ln),this.addCurrentVertex(Ln,Ge,0,0,fe),ge=Ln}}var ui=ge&&Ze,Nn=ui?r:M?"butt":f;if(ui&&Nn==="round"&&(fr<y?Nn="miter":fr<=2&&(Nn="fakeround")),Nn==="miter"&&fr>v&&(Nn="bevel"),Nn==="bevel"&&(fr>2&&(Nn="flipbevel"),fr<v&&(Nn="miter")),ge&&this.updateDistance(ge,K),Nn==="miter")Mt._mult(fr),this.addCurrentVertex(K,Mt,0,0,fe);else if(Nn==="flipbevel"){if(fr>100)Mt=vt.mult(-1);else{var na=fr*Ge.add(vt).mag()/Ge.sub(vt).mag();Mt._perp()._mult(na*(mn?-1:1))}this.addCurrentVertex(K,Mt,0,0,fe),this.addCurrentVertex(K,Mt.mult(-1),0,0,fe)}else if(Nn==="bevel"||Nn==="fakeround"){var bi=-Math.sqrt(fr*fr-1),ti=mn?bi:0,la=mn?0:bi;if(ge&&this.addCurrentVertex(K,Ge,ti,la,fe),Nn==="fakeround")for(var Xi=Math.round(180*Ir/Math.PI/20),Ca=1;Ca<Xi;Ca++){var mi=Ca/Xi;if(mi!==.5){var Da=mi-.5;mi+=mi*Da*(mi-1)*((1.0904+Wt*(Wt*(3.55645-1.43519*Wt)-3.2452))*Da*Da+(.848013+Wt*(.215638*Wt-1.06021)))}var Io=vt.sub(Ge)._mult(mi)._add(Ge)._unit()._mult(mn?-1:1);this.addHalfVertex(K,Io.x,Io.y,!1,mn,0,fe)}Ze&&this.addCurrentVertex(K,vt,-ti,-la,fe)}else if(Nn==="butt")this.addCurrentVertex(K,Mt,0,0,fe);else if(Nn==="square"){var Qo=ge?1:-1;this.addCurrentVertex(K,Mt,Qo,Qo,fe)}else Nn==="round"&&(ge&&(this.addCurrentVertex(K,Ge,0,0,fe),this.addCurrentVertex(K,Ge,1,1,fe,!0)),Ze&&(this.addCurrentVertex(K,vt,-1,-1,fe,!0),this.addCurrentVertex(K,vt,0,0,fe)));if(rn&&qe<B-1){var Go=K.dist(Ze);if(Go>2*re){var yo=K.add(Ze.sub(K)._mult(re/Go)._round());this.updateDistance(K,yo),this.addCurrentVertex(yo,vt,0,0,fe),K=yo}}}}},Zo.prototype.addCurrentVertex=function(e,t,r,f,v,y){y===void 0&&(y=!1);var x=t.y*f-t.x,M=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,y,!1,r,v),this.addHalfVertex(e,x,M,y,!0,-f,v),this.distance>ps/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,y))},Zo.prototype.addHalfVertex=function(e,t,r,f,v,y,x){var M=.5*(this.lineClips?this.scaledDistance*(ps-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(y===0?0:y<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var B=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),x.primitiveLength++),v?this.e2=B:this.e1=B},Zo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Zo.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Dn("LineBucket",Zo,{omit:["layers","patternFeatures"]});var as=new Ko({"line-cap":new ai(se.layout_line["line-cap"]),"line-join":new Hn(se.layout_line["line-join"]),"line-miter-limit":new ai(se.layout_line["line-miter-limit"]),"line-round-limit":new ai(se.layout_line["line-round-limit"]),"line-sort-key":new Hn(se.layout_line["line-sort-key"])}),du={paint:new Ko({"line-opacity":new Hn(se.paint_line["line-opacity"]),"line-color":new Hn(se.paint_line["line-color"]),"line-translate":new ai(se.paint_line["line-translate"]),"line-translate-anchor":new ai(se.paint_line["line-translate-anchor"]),"line-width":new Hn(se.paint_line["line-width"]),"line-gap-width":new Hn(se.paint_line["line-gap-width"]),"line-offset":new Hn(se.paint_line["line-offset"]),"line-blur":new Hn(se.paint_line["line-blur"]),"line-dasharray":new ns(se.paint_line["line-dasharray"]),"line-pattern":new Il(se.paint_line["line-pattern"]),"line-gradient":new eu(se.paint_line["line-gradient"])}),layout:as},hh=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new qi(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,y){return f=Gt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,y)},t}(Hn))(du.paint.properties["line-width"].specification);hh.useIntegerZoom=!0;var Wh=function(e){function t(r){e.call(this,r,du),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof gs,this.gradientVersion=(this.gradientVersion+1)%Be)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=hh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new Zo(r)},t.prototype.queryRadius=function(r){var f=r,v=Xh(Na("line-width",this,f),Na("line-gap-width",this,f)),y=Na("line-offset",this,f);return v/2+Math.abs(y)+ha(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,M,B){var G=Pa(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,B),K=B/2*Xh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),re=this.paint.get("line-offset").evaluate(f,v);return re&&(y=function(fe,ge){for(var Ze=[],Ge=new W(0,0),vt=0;vt<fe.length;vt++){for(var qe=fe[vt],Mt=[],Wt=0;Wt<qe.length;Wt++){var lr=qe[Wt],fr=qe[Wt+1],Ir=Wt===0?Ge:lr.sub(qe[Wt-1])._unit()._perp(),rn=Wt===qe.length-1?Ge:fr.sub(lr)._unit()._perp(),mn=Ir._add(rn)._unit();mn._mult(1/(mn.x*rn.x+mn.y*rn.y)),Mt.push(mn._mult(ge)._add(lr))}Ze.push(Mt)}return Ze}(y,re*B)),function(fe,ge,Ze){for(var Ge=0;Ge<ge.length;Ge++){var vt=ge[Ge];if(fe.length>=3){for(var qe=0;qe<vt.length;qe++)if(ta(fe,vt[qe]))return!0}if($i(fe,vt,Ze))return!0}return!1}(G,y,K)},t.prototype.isTileClipped=function(){return!0},t}(cu);function Xh(e,t){return t>0?t+2*e:e}var Yh=Do([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ph=Do([{name:"a_projected_pos",components:3,type:"Float32"}],4),Kh=(Do([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Do([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),$h=(Do([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ep=Do([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function wp(e,t,r){return e.sections.forEach(function(f){f.text=function(v,y,x){var M=y.layout.get("text-transform").evaluate(x,{});return M==="uppercase"?v=v.toLocaleUpperCase():M==="lowercase"&&(v=v.toLocaleLowerCase()),Os.applyArabicShaping&&(v=Os.applyArabicShaping(v)),v}(f.text,t,r)}),e}Do([{name:"triangle",components:3,type:"Uint16"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Do([{type:"Float32",name:"offsetX"}]),Do([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var wf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Jh=function(e,t,r,f,v){var y,x,M=8*v-f-1,B=(1<<M)-1,G=B>>1,K=-7,re=r?v-1:0,fe=r?-1:1,ge=e[t+re];for(re+=fe,y=ge&(1<<-K)-1,ge>>=-K,K+=M;K>0;y=256*y+e[t+re],re+=fe,K-=8);for(x=y&(1<<-K)-1,y>>=-K,K+=f;K>0;x=256*x+e[t+re],re+=fe,K-=8);if(y===0)y=1-G;else{if(y===B)return x?NaN:1/0*(ge?-1:1);x+=Math.pow(2,f),y-=G}return(ge?-1:1)*x*Math.pow(2,y-f)},Cc=function(e,t,r,f,v,y){var x,M,B,G=8*y-v-1,K=(1<<G)-1,re=K>>1,fe=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,ge=f?0:y-1,Ze=f?1:-1,Ge=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(M=isNaN(t)?1:0,x=K):(x=Math.floor(Math.log(t)/Math.LN2),t*(B=Math.pow(2,-x))<1&&(x--,B*=2),(t+=x+re>=1?fe/B:fe*Math.pow(2,1-re))*B>=2&&(x++,B/=2),x+re>=K?(M=0,x=K):x+re>=1?(M=(t*B-1)*Math.pow(2,v),x+=re):(M=t*Math.pow(2,re-1)*Math.pow(2,v),x=0));v>=8;e[r+ge]=255&M,ge+=Ze,M/=256,v-=8);for(x=x<<v|M,G+=v;G>0;e[r+ge]=255&x,ge+=Ze,x/=256,G-=8);e[r+ge-Ze]|=128*Ge},Cf=Ja;function Ja(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ja.Varint=0,Ja.Fixed64=1,Ja.Bytes=2,Ja.Fixed32=5;var Qh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function nc(e){return e.type===Ja.Bytes?e.readVarint()+e.pos:e.pos+1}function Ac(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function dh(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function V(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Me(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function $e(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function ar(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Mr(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function rr(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Er(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Fr(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Gr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Kr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Qr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function tn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function pn(e,t,r){e===1&&r.readMessage(Wr,t)}function Wr(e,t,r){if(e===3){var f=r.readMessage(en,{}),v=f.width,y=f.height,x=f.left,M=f.top,B=f.advance;t.push({id:f.id,bitmap:new pu({width:v+6,height:y+6},f.bitmap),metrics:{width:v,height:y,left:x,top:M,advance:B}})}}function en(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Ot(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var y=v[f];t+=y.w*y.h,r=Math.max(r,y.w)}e.sort(function(Ge,vt){return vt.h-Ge.h});for(var x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],M=0,B=0,G=0,K=e;G<K.length;G+=1)for(var re=K[G],fe=x.length-1;fe>=0;fe--){var ge=x[fe];if(!(re.w>ge.w||re.h>ge.h)){if(re.x=ge.x,re.y=ge.y,B=Math.max(B,re.y+re.h),M=Math.max(M,re.x+re.w),re.w===ge.w&&re.h===ge.h){var Ze=x.pop();fe<x.length&&(x[fe]=Ze)}else re.h===ge.h?(ge.x+=re.w,ge.w-=re.w):re.w===ge.w?(ge.y+=re.h,ge.h-=re.h):(x.push({x:ge.x+re.w,y:ge.y,w:ge.w-re.w,h:re.h}),ge.y+=re.h,ge.h-=re.h);break}}return{w:M,h:B,fill:t/(M*B)||0}}Ja.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,y=this.pos;this.type=7&f,e(v,t,this),this.pos===y&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Kr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=tn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Kr(this.buf,this.pos)+4294967296*Kr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=Kr(this.buf,this.pos)+4294967296*tn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Jh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Jh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,y,x){var M,B,G=x.buf;if(M=(112&(B=G[x.pos++]))>>4,B<128||(M|=(127&(B=G[x.pos++]))<<3,B<128)||(M|=(127&(B=G[x.pos++]))<<10,B<128)||(M|=(127&(B=G[x.pos++]))<<17,B<128)||(M|=(127&(B=G[x.pos++]))<<24,B<128)||(M|=(1&(B=G[x.pos++]))<<31,B<128))return Ac(v,M,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Qh?function(r,f,v){return Qh.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var y="",x=f;x<v;){var M,B,G,K=r[x],re=null,fe=K>239?4:K>223?3:K>191?2:1;if(x+fe>v)break;fe===1?K<128&&(re=K):fe===2?(192&(M=r[x+1]))==128&&(re=(31&K)<<6|63&M)<=127&&(re=null):fe===3?(B=r[x+2],(192&(M=r[x+1]))==128&&(192&B)==128&&((re=(15&K)<<12|(63&M)<<6|63&B)<=2047||re>=55296&&re<=57343)&&(re=null)):fe===4&&(B=r[x+2],G=r[x+3],(192&(M=r[x+1]))==128&&(192&B)==128&&(192&G)==128&&((re=(15&K)<<18|(63&M)<<12|(63&B)<<6|63&G)<=65535||re>=1114112)&&(re=null)),re===null?(re=65533,fe=1):re>65535&&(re-=65536,y+=String.fromCharCode(re>>>10&1023|55296),re=56320|1023&re),y+=String.fromCharCode(re),x+=fe}return y}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Ja.Bytes)return e.push(this.readVarint(t));var r=nc(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Ja.Bytes)return e.push(this.readSVarint());var t=nc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Ja.Bytes)return e.push(this.readBoolean());var t=nc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Ja.Bytes)return e.push(this.readFloat());var t=nc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Ja.Bytes)return e.push(this.readDouble());var t=nc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Ja.Bytes)return e.push(this.readFixed32());var t=nc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Ja.Bytes)return e.push(this.readSFixed32());var t=nc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Ja.Bytes)return e.push(this.readFixed64());var t=nc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Ja.Bytes)return e.push(this.readSFixed64());var t=nc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Ja.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ja.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ja.Fixed32)this.pos+=4;else{if(t!==Ja.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Qr(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Qr(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Qr(this.buf,-1&e,this.pos),Qr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Qr(this.buf,-1&e,this.pos),Qr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(y,x,M){M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,M.buf[M.pos]=127&(y>>>=7)}(f,0,r),function(y,x){var M=(7&y)<<4;x.buf[x.pos++]|=M|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,y){for(var x,M,B=0;B<v.length;B++){if((x=v.charCodeAt(B))>55295&&x<57344){if(!M){x>56319||B+1===v.length?(f[y++]=239,f[y++]=191,f[y++]=189):M=x;continue}if(x<56320){f[y++]=239,f[y++]=191,f[y++]=189,M=x;continue}x=M-55296<<10|x-56320|65536,M=null}else M&&(f[y++]=239,f[y++]=191,f[y++]=189,M=null);x<128?f[y++]=x:(x<2048?f[y++]=x>>6|192:(x<65536?f[y++]=x>>12|224:(f[y++]=x>>18|240,f[y++]=x>>12&63|128),f[y++]=x>>6&63|128),f[y++]=63&x|128)}return y}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&dh(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),Cc(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Cc(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&dh(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,Ja.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,V,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Me,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Mr,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,$e,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ar,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,rr,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Er,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Fr,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Gr,t)},writeBytesField:function(e,t){this.writeTag(e,Ja.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ja.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ja.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ja.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ja.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ja.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ja.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ja.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ja.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ja.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var pr=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,y=t.stretchY,x=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=y,this.content=x,this.version=f},Yr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Yr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Yr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Yr.tlbr.get=function(){return this.tl.concat(this.br)},Yr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(pr.prototype,Yr);var Cn=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var y=Ot(v),x=new Mo({width:y.w||1,height:y.h||1});for(var M in e){var B=e[M],G=r[M].paddedRect;Mo.copy(B.data,x,{x:0,y:0},{x:G.x+1,y:G.y+1},B.data)}for(var K in t){var re=t[K],fe=f[K].paddedRect,ge=fe.x+1,Ze=fe.y+1,Ge=re.data.width,vt=re.data.height;Mo.copy(re.data,x,{x:0,y:0},{x:ge,y:Ze},re.data),Mo.copy(re.data,x,{x:0,y:vt-1},{x:ge,y:Ze-1},{width:Ge,height:1}),Mo.copy(re.data,x,{x:0,y:0},{x:ge,y:Ze+vt},{width:Ge,height:1}),Mo.copy(re.data,x,{x:Ge-1,y:0},{x:ge-1,y:Ze},{width:1,height:vt}),Mo.copy(re.data,x,{x:0,y:0},{x:ge+Ge,y:Ze},{width:1,height:vt})}this.image=x,this.iconPositions=r,this.patternPositions=f};Cn.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],y={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(y),t[f]=new pr(y,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},Cn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Cn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},Dn("ImagePosition",pr),Dn("ImageAtlas",Cn);var Ar={horizontal:1,vertical:2,horizontalOnly:3},wn=function(){this.scale=1,this.fontStack="",this.imageName=null};wn.forText=function(e,t){var r=new wn;return r.scale=e||1,r.fontStack=t,r},wn.forImage=function(e){var t=new wn;return t.imageName=e,t};var qr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function ci(e,t,r,f,v,y,x,M,B,G,K,re,fe,ge,Ze,Ge){var vt,qe=qr.fromFeature(e,v);re===Ar.vertical&&qe.verticalizePunctuation();var Mt=Os.processBidirectionalText,Wt=Os.processStyledBidirectionalText;if(Mt&&qe.sections.length===1){vt=[];for(var lr=0,fr=Mt(qe.toString(),Sn(qe,G,y,t,f,ge,Ze));lr<fr.length;lr+=1){var Ir=fr[lr],rn=new qr;rn.text=Ir,rn.sections=qe.sections;for(var mn=0;mn<Ir.length;mn++)rn.sectionIndex.push(0);vt.push(rn)}}else if(Wt){vt=[];for(var ei=0,Ln=Wt(qe.text,qe.sectionIndex,Sn(qe,G,y,t,f,ge,Ze));ei<Ln.length;ei+=1){var ui=Ln[ei],Nn=new qr;Nn.text=ui[0],Nn.sectionIndex=ui[1],Nn.sections=qe.sections,vt.push(Nn)}}else vt=function(ti,la){for(var Xi=[],Ca=ti.text,mi=0,Da=0,Io=la;Da<Io.length;Da+=1){var Qo=Io[Da];Xi.push(ti.substring(mi,Qo)),mi=Qo}return mi<Ca.length&&Xi.push(ti.substring(mi,Ca.length)),Xi}(qe,Sn(qe,G,y,t,f,ge,Ze));var na=[],bi={positionedLines:na,text:qe.toString(),top:K[1],bottom:K[1],left:K[0],right:K[0],writingMode:re,iconsInText:!1,verticalizable:!1};return function(ti,la,Xi,Ca,mi,Da,Io,Qo,Go,yo,Oo,Rs){for(var vs=0,nu=-17,Ds=0,Gs=0,qo=Qo==="right"?1:Qo==="left"?0:.5,Fs=0,fa=0,no=mi;fa<no.length;fa+=1){var qa=no[fa];qa.trim();var va=qa.getMaxScale(),vu=24*(va-1),iu={positionedGlyphs:[],lineOffset:0};ti.positionedLines[Fs]=iu;var Za=iu.positionedGlyphs,es=0;if(qa.length()){for(var ws=0;ws<qa.length();ws++){var La=qa.getSection(ws),Mc=qa.getSectionIndex(ws),Hs=qa.getCharCode(ws),Ic=0,ts=null,Vc=null,ic=null,yh=24,Gf=!(Go===Ar.horizontal||!Oo&&!Ql(Hs)||Oo&&(Tr[Hs]||(lf=Hs,dn.Arabic(lf)||dn["Arabic Supplement"](lf)||dn["Arabic Extended-A"](lf)||dn["Arabic Presentation Forms-A"](lf)||dn["Arabic Presentation Forms-B"](lf))));if(La.imageName){var gh=Ca[La.imageName];if(!gh)continue;ic=La.imageName,ti.iconsInText=ti.iconsInText||!0,Vc=gh.paddedRect;var sf=gh.displaySize;La.scale=24*La.scale/Rs,Ic=vu+(24-sf[1]*La.scale),yh=(ts={width:sf[0],height:sf[1],left:1,top:-3,advance:Gf?sf[1]:sf[0]}).advance;var _h=Gf?sf[0]*La.scale-24*va:sf[1]*La.scale-24*va;_h>0&&_h>es&&(es=_h)}else{var xh=Xi[La.fontStack],Tf=xh&&xh[Hs];if(Tf&&Tf.rect)Vc=Tf.rect,ts=Tf.metrics;else{var ep=la[La.fontStack],Hf=ep&&ep[Hs];if(!Hf)continue;ts=Hf.metrics}Ic=24*(va-La.scale)}Gf?(ti.verticalizable=!0,Za.push({glyph:Hs,imageName:ic,x:vs,y:nu+Ic,vertical:Gf,scale:La.scale,fontStack:La.fontStack,sectionIndex:Mc,metrics:ts,rect:Vc}),vs+=yh*La.scale+yo):(Za.push({glyph:Hs,imageName:ic,x:vs,y:nu+Ic,vertical:Gf,scale:La.scale,fontStack:La.fontStack,sectionIndex:Mc,metrics:ts,rect:Vc}),vs+=ts.advance*La.scale+yo)}Za.length!==0&&(Ds=Math.max(vs-yo,Ds),Ii(Za,0,Za.length-1,qo,es)),vs=0;var uf=Da*va+es;iu.lineOffset=Math.max(es,vu),nu+=uf,Gs=Math.max(uf,Gs),++Fs}else nu+=Da,++Fs}var lf,Pf=nu- -17,cf=Ri(Io),Ul=cf.horizontalAlign,Wf=cf.verticalAlign;(function(bh,ks,Sh,Eh,Wa,wh,Gc,Hc,tp){var Xf,rp=(ks-Sh)*Wa;Xf=wh!==Gc?-Hc*Eh- -17:(-Eh*tp+.5)*Gc;for(var Yf=0,Ch=bh;Yf<Ch.length;Yf+=1)for(var ff=0,Kf=Ch[Yf].positionedGlyphs;ff<Kf.length;ff+=1){var $f=Kf[ff];$f.x+=rp,$f.y+=Xf}})(ti.positionedLines,qo,Ul,Wf,Ds,Gs,Da,Pf,mi.length),ti.top+=-Wf*Pf,ti.bottom=ti.top+Pf,ti.left+=-Ul*Ds,ti.right=ti.left+Ds}(bi,t,r,f,vt,x,M,B,re,G,fe,Ge),!function(ti){for(var la=0,Xi=ti;la<Xi.length;la+=1)if(Xi[la].positionedGlyphs.length!==0)return!1;return!0}(na)&&bi}qr.fromFeature=function(e,t){for(var r=new qr,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},qr.prototype.length=function(){return this.text.length},qr.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},qr.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},qr.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},qr.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&Ru(f)&&!wf[e[r+1]]||v&&Ru(v)&&!wf[e[r-1]]||!wf[e[r]]?e[r]:wf[e[r]]}return t}(this.text)},qr.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Tr[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&Tr[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},qr.prototype.substring=function(e,t){var r=new qr;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},qr.prototype.toString=function(){return this.text},qr.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},qr.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(wn.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},qr.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(wn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Xe("Reached maximum number of images 6401")}else Xe("Can't add FormattedSection with an empty image.")},qr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Tr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},br={};function Wn(e,t,r,f,v,y){if(t.imageName){var x=f[t.imageName];return x?x.displaySize[0]*t.scale*24/y+v:0}var M=r[t.fontStack],B=M&&M[e];return B?B.metrics.advance*t.scale+v:0}function hn(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function $r(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function gn(e,t,r,f,v,y){for(var x=null,M=hn(t,r,v,y),B=0,G=f;B<G.length;B+=1){var K=G[B],re=hn(t-K.x,r,v,y)+K.badness;re<=M&&(x=K,M=re)}return{index:e,x:t,priorBreak:x,badness:M}}function Sn(e,t,r,f,v,y,x){if(y!=="point")return[];if(!e)return[];for(var M,B=[],G=function(vt,qe,Mt,Wt,lr,fr){for(var Ir=0,rn=0;rn<vt.length();rn++){var mn=vt.getSection(rn);Ir+=Wn(vt.getCharCode(rn),mn,Wt,lr,qe,fr)}return Ir/Math.max(1,Math.ceil(Ir/Mt))}(e,t,r,f,v,x),K=e.text.indexOf("\u200B")>=0,re=0,fe=0;fe<e.length();fe++){var ge=e.getSection(fe),Ze=e.getCharCode(fe);if(Tr[Ze]||(re+=Wn(Ze,ge,f,v,t,x)),fe<e.length()-1){var Ge=!((M=Ze)<11904||!(dn["Bopomofo Extended"](M)||dn.Bopomofo(M)||dn["CJK Compatibility Forms"](M)||dn["CJK Compatibility Ideographs"](M)||dn["CJK Compatibility"](M)||dn["CJK Radicals Supplement"](M)||dn["CJK Strokes"](M)||dn["CJK Symbols and Punctuation"](M)||dn["CJK Unified Ideographs Extension A"](M)||dn["CJK Unified Ideographs"](M)||dn["Enclosed CJK Letters and Months"](M)||dn["Halfwidth and Fullwidth Forms"](M)||dn.Hiragana(M)||dn["Ideographic Description Characters"](M)||dn["Kangxi Radicals"](M)||dn["Katakana Phonetic Extensions"](M)||dn.Katakana(M)||dn["Vertical Forms"](M)||dn["Yi Radicals"](M)||dn["Yi Syllables"](M)));(br[Ze]||Ge||ge.imageName)&&B.push(gn(fe+1,re,G,B,$r(Ze,e.getCharCode(fe+1),Ge&&K),!1))}}return function vt(qe){return qe?vt(qe.priorBreak).concat(qe.index):[]}(gn(e.length(),re,G,B,0,!0))}function Ri(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Ii(e,t,r,f,v){if(f||v)for(var y=e[r],x=(e[r].x+y.metrics.advance*y.scale)*f,M=t;M<=r;M++)e[M].x-=x,e[M].y+=v}function Tn(e,t,r,f,v,y){var x,M=e.image;if(M.content){var B=M.content,G=M.pixelRatio||1;x=[B[0]/G,B[1]/G,M.displaySize[0]-B[2]/G,M.displaySize[1]-B[3]/G]}var K,re,fe,ge,Ze=t.left*y,Ge=t.right*y;r==="width"||r==="both"?(ge=v[0]+Ze-f[3],re=v[0]+Ge+f[1]):re=(ge=v[0]+(Ze+Ge-M.displaySize[0])/2)+M.displaySize[0];var vt=t.top*y,qe=t.bottom*y;return r==="height"||r==="both"?(K=v[1]+vt-f[0],fe=v[1]+qe+f[2]):fe=(K=v[1]+(vt+qe-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:K,right:re,bottom:fe,left:ge,collisionPadding:x}}br[10]=!0,br[32]=!0,br[38]=!0,br[40]=!0,br[41]=!0,br[43]=!0,br[45]=!0,br[47]=!0,br[173]=!0,br[183]=!0,br[8203]=!0,br[8208]=!0,br[8211]=!0,br[8231]=!0;var An=function(e){function t(r,f,v,y){e.call(this,r,f),this.angle=v,y!==void 0&&(this.segment=y)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(W);function wi(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new qi(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,y=0;y<f.length&&f[y]<=e;)y++;for(var x=y=Math.max(0,y-1);x<f.length&&f[x]<e+1;)x++;x=Math.min(f.length-1,x);var M=f[y],B=f[x];return r.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:B,interpolationType:v}:{kind:"camera",minZoom:M,maxZoom:B,minSize:r.evaluate(new qi(M)),maxSize:r.evaluate(new qi(B)),interpolationType:v}}function Bi(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?Aa(v/128,r.upperSize/128,t.uSizeT):f}function Fi(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,y=v?et(Ie.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=Aa(e.minSize,e.maxSize,y):r=y}return{uSizeT:r,uSize:f}}Dn("Anchor",An);var vo=Object.freeze({__proto__:null,getSizeData:wi,evaluateSizeForFeature:Bi,evaluateSizeForZoom:Fi,SIZE_PACK_FACTOR:128});function wo(e,t,r,f,v){if(t.segment===void 0)return!0;for(var y=t,x=t.segment+1,M=0;M>-r/2;){if(--x<0)return!1;M-=e[x].dist(y),y=e[x]}M+=e[x].dist(e[x+1]),x++;for(var B=[],G=0;M<r/2;){var K=e[x],re=e[x+1];if(!re)return!1;var fe=e[x-1].angleTo(K)-K.angleTo(re);for(fe=Math.abs((fe+3*Math.PI)%(2*Math.PI)-Math.PI),B.push({distance:M,angleDelta:fe}),G+=fe;M-B[0].distance>f;)G-=B.shift().angleDelta;if(G>v)return!1;x++,M+=K.dist(re)}return!0}function ra(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Ls(e,t,r){return e?.6*t*r:0}function so(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function ds(e,t,r,f,v,y){for(var x=Ls(r,v,y),M=so(r,f)*y,B=0,G=ra(e)/2,K=0;K<e.length-1;K++){var re=e[K],fe=e[K+1],ge=re.dist(fe);if(B+ge>G){var Ze=(G-B)/ge,Ge=Aa(re.x,fe.x,Ze),vt=Aa(re.y,fe.y,Ze),qe=new An(Ge,vt,fe.angleTo(re),K);return qe._round(),!x||wo(e,qe,M,x,t)?qe:void 0}B+=ge}}function jo(e,t,r,f,v,y,x,M,B){var G=Ls(f,y,x),K=so(f,v),re=K*x,fe=e[0].x===0||e[0].x===B||e[0].y===0||e[0].y===B;return t-re<t/4&&(t=re+t/4),function ge(Ze,Ge,vt,qe,Mt,Wt,lr,fr,Ir){for(var rn=Wt/2,mn=ra(Ze),ei=0,Ln=Ge-vt,ui=[],Nn=0;Nn<Ze.length-1;Nn++){for(var na=Ze[Nn],bi=Ze[Nn+1],ti=na.dist(bi),la=bi.angleTo(na);Ln+vt<ei+ti;){var Xi=((Ln+=vt)-ei)/ti,Ca=Aa(na.x,bi.x,Xi),mi=Aa(na.y,bi.y,Xi);if(Ca>=0&&Ca<Ir&&mi>=0&&mi<Ir&&Ln-rn>=0&&Ln+rn<=mn){var Da=new An(Ca,mi,la,Nn);Da._round(),qe&&!wo(Ze,Da,Wt,qe,Mt)||ui.push(Da)}}ei+=ti}return fr||ui.length||lr||(ui=ge(Ze,ei/2,vt,qe,Mt,Wt,lr,!0,Ir)),ui}(e,fe?t/2*M%t:(K/2+2*y)*x*M%t,t,G,r,re,fe,!1,B)}function os(e,t,r,f,v){for(var y=[],x=0;x<e.length;x++)for(var M=e[x],B=void 0,G=0;G<M.length-1;G++){var K=M[G],re=M[G+1];K.x<t&&re.x<t||(K.x<t?K=new W(t,K.y+(t-K.x)/(re.x-K.x)*(re.y-K.y))._round():re.x<t&&(re=new W(t,K.y+(t-K.x)/(re.x-K.x)*(re.y-K.y))._round()),K.y<r&&re.y<r||(K.y<r?K=new W(K.x+(r-K.y)/(re.y-K.y)*(re.x-K.x),r)._round():re.y<r&&(re=new W(K.x+(r-K.y)/(re.y-K.y)*(re.x-K.x),r)._round()),K.x>=f&&re.x>=f||(K.x>=f?K=new W(f,K.y+(f-K.x)/(re.x-K.x)*(re.y-K.y))._round():re.x>=f&&(re=new W(f,K.y+(f-K.x)/(re.x-K.x)*(re.y-K.y))._round()),K.y>=v&&re.y>=v||(K.y>=v?K=new W(K.x+(v-K.y)/(re.y-K.y)*(re.x-K.x),v)._round():re.y>=v&&(re=new W(K.x+(v-K.y)/(re.y-K.y)*(re.x-K.x),v)._round()),B&&K.equals(B[B.length-1])||y.push(B=[K]),B.push(re)))))}return y}function $o(e,t,r,f){var v=[],y=e.image,x=y.pixelRatio,M=y.paddedRect.w-2,B=y.paddedRect.h-2,G=e.right-e.left,K=e.bottom-e.top,re=y.stretchX||[[0,M]],fe=y.stretchY||[[0,B]],ge=function(Ca,mi){return Ca+mi[1]-mi[0]},Ze=re.reduce(ge,0),Ge=fe.reduce(ge,0),vt=M-Ze,qe=B-Ge,Mt=0,Wt=Ze,lr=0,fr=Ge,Ir=0,rn=vt,mn=0,ei=qe;if(y.content&&f){var Ln=y.content;Mt=Co(re,0,Ln[0]),lr=Co(fe,0,Ln[1]),Wt=Co(re,Ln[0],Ln[2]),fr=Co(fe,Ln[1],Ln[3]),Ir=Ln[0]-Mt,mn=Ln[1]-lr,rn=Ln[2]-Ln[0]-Wt,ei=Ln[3]-Ln[1]-fr}var ui=function(Ca,mi,Da,Io){var Qo=ji(Ca.stretch-Mt,Wt,G,e.left),Go=Jo(Ca.fixed-Ir,rn,Ca.stretch,Ze),yo=ji(mi.stretch-lr,fr,K,e.top),Oo=Jo(mi.fixed-mn,ei,mi.stretch,Ge),Rs=ji(Da.stretch-Mt,Wt,G,e.left),vs=Jo(Da.fixed-Ir,rn,Da.stretch,Ze),nu=ji(Io.stretch-lr,fr,K,e.top),Ds=Jo(Io.fixed-mn,ei,Io.stretch,Ge),Gs=new W(Qo,yo),qo=new W(Rs,yo),Fs=new W(Rs,nu),fa=new W(Qo,nu),no=new W(Go/x,Oo/x),qa=new W(vs/x,Ds/x),va=t*Math.PI/180;if(va){var vu=Math.sin(va),iu=Math.cos(va),Za=[iu,-vu,vu,iu];Gs._matMult(Za),qo._matMult(Za),fa._matMult(Za),Fs._matMult(Za)}var es=Ca.stretch+Ca.fixed,ws=mi.stretch+mi.fixed;return{tl:Gs,tr:qo,bl:fa,br:Fs,tex:{x:y.paddedRect.x+1+es,y:y.paddedRect.y+1+ws,w:Da.stretch+Da.fixed-es,h:Io.stretch+Io.fixed-ws},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:no,pixelOffsetBR:qa,minFontScaleX:rn/x/G,minFontScaleY:ei/x/K,isSDF:r}};if(f&&(y.stretchX||y.stretchY))for(var Nn=Vo(re,vt,Ze),na=Vo(fe,qe,Ge),bi=0;bi<Nn.length-1;bi++)for(var ti=Nn[bi],la=Nn[bi+1],Xi=0;Xi<na.length-1;Xi++)v.push(ui(ti,na[Xi],la,na[Xi+1]));else v.push(ui({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:B+1}));return v}function Co(e,t,r){for(var f=0,v=0,y=e;v<y.length;v+=1){var x=y[v];f+=Math.max(t,Math.min(r,x[1]))-Math.max(t,Math.min(r,x[0]))}return f}function Vo(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,y=e;v<y.length;v+=1){var x=y[v],M=x[0],B=x[1],G=f[f.length-1];f.push({fixed:M-G.stretch,stretch:G.stretch}),f.push({fixed:M-G.stretch,stretch:G.stretch+(B-M)})}return f.push({fixed:t+1,stretch:r}),f}function ji(e,t,r,f){return e/t*r+f}function Jo(e,t,r,f){return e-t*r/f}var xa=function(e,t,r,f,v,y,x,M,B,G){if(this.boxStartIndex=e.length,B){var K=y.top,re=y.bottom,fe=y.collisionPadding;fe&&(K-=fe[1],re+=fe[3]);var ge=re-K;ge>0&&(ge=Math.max(10,ge),this.circleDiameter=ge)}else{var Ze=y.top*x-M,Ge=y.bottom*x+M,vt=y.left*x-M,qe=y.right*x+M,Mt=y.collisionPadding;if(Mt&&(vt-=Mt[0]*x,Ze-=Mt[1]*x,qe+=Mt[2]*x,Ge+=Mt[3]*x),G){var Wt=new W(vt,Ze),lr=new W(qe,Ze),fr=new W(vt,Ge),Ir=new W(qe,Ge),rn=G*Math.PI/180;Wt._rotate(rn),lr._rotate(rn),fr._rotate(rn),Ir._rotate(rn),vt=Math.min(Wt.x,lr.x,fr.x,Ir.x),qe=Math.max(Wt.x,lr.x,fr.x,Ir.x),Ze=Math.min(Wt.y,lr.y,fr.y,Ir.y),Ge=Math.max(Wt.y,lr.y,fr.y,Ir.y)}e.emplaceBack(t.x,t.y,vt,Ze,qe,Ge,r,f,v)}this.boxEndIndex=e.length},ro=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=vi),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function vi(e,t){return e<t?-1:e>t?1:0}function sa(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,y=-1/0,x=-1/0,M=e[0],B=0;B<M.length;B++){var G=M[B];(!B||G.x<f)&&(f=G.x),(!B||G.y<v)&&(v=G.y),(!B||G.x>y)&&(y=G.x),(!B||G.y>x)&&(x=G.y)}var K=Math.min(y-f,x-v),re=K/2,fe=new ro([],Ga);if(K===0)return new W(f,v);for(var ge=f;ge<y;ge+=K)for(var Ze=v;Ze<x;Ze+=K)fe.push(new uo(ge+re,Ze+re,re,e));for(var Ge=function(Mt){for(var Wt=0,lr=0,fr=0,Ir=Mt[0],rn=0,mn=Ir.length,ei=mn-1;rn<mn;ei=rn++){var Ln=Ir[rn],ui=Ir[ei],Nn=Ln.x*ui.y-ui.x*Ln.y;lr+=(Ln.x+ui.x)*Nn,fr+=(Ln.y+ui.y)*Nn,Wt+=3*Nn}return new uo(lr/Wt,fr/Wt,0,Mt)}(e),vt=fe.length;fe.length;){var qe=fe.pop();(qe.d>Ge.d||!Ge.d)&&(Ge=qe,r&&console.log("found best %d after %d probes",Math.round(1e4*qe.d)/1e4,vt)),qe.max-Ge.d<=t||(fe.push(new uo(qe.p.x-(re=qe.h/2),qe.p.y-re,re,e)),fe.push(new uo(qe.p.x+re,qe.p.y-re,re,e)),fe.push(new uo(qe.p.x-re,qe.p.y+re,re,e)),fe.push(new uo(qe.p.x+re,qe.p.y+re,re,e)),vt+=4)}return r&&(console.log("num probes: "+vt),console.log("best distance: "+Ge.d)),Ge.p}function Ga(e,t){return t.max-e.max}function uo(e,t,r,f){this.p=new W(e,t),this.h=r,this.d=function(v,y){for(var x=!1,M=1/0,B=0;B<y.length;B++)for(var G=y[B],K=0,re=G.length,fe=re-1;K<re;fe=K++){var ge=G[K],Ze=G[fe];ge.y>v.y!=Ze.y>v.y&&v.x<(Ze.x-ge.x)*(v.y-ge.y)/(Ze.y-ge.y)+ge.x&&(x=!x),M=Math.min(M,ho(v,ge,Ze))}return(x?1:-1)*Math.sqrt(M)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}ro.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},ro.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},ro.prototype.peek=function(){return this.data[0]},ro.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,y=t[v];if(r(f,y)>=0)break;t[e]=y,e=v}t[e]=f},ro.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var y=1+(e<<1),x=t[y],M=y+1;if(M<this.length&&r(t[M],x)<0&&(y=M,x=t[M]),r(x,v)>=0)break;t[e]=x,e=y}t[e]=v};var Qu=Number.POSITIVE_INFINITY;function He(e,t){return t[1]!==Qu?function(r,f,v){var y=0,x=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":x=v-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-v}switch(r){case"top-right":case"bottom-right":case"right":y=-f;break;case"top-left":case"bottom-left":case"left":y=f}return[y,x]}(e,t[0],t[1]):function(r,f){var v=0,y=0;f<0&&(f=0);var x=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":y=x-7;break;case"bottom-right":case"bottom-left":y=7-x;break;case"bottom":y=7-f;break;case"top":y=f-7}switch(r){case"top-right":case"bottom-right":v=-x;break;case"top-left":case"bottom-left":v=x;break;case"left":v=f;break;case"right":v=-f}return[v,y]}(e,t[0])}function cr(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Kt(e,t,r,f,v,y,x,M,B,G,K,re,fe,ge,Ze){var Ge=function(lr,fr,Ir,rn,mn,ei,Ln,ui){for(var Nn=rn.layout.get("text-rotate").evaluate(ei,{})*Math.PI/180,na=[],bi=0,ti=fr.positionedLines;bi<ti.length;bi+=1)for(var la=ti[bi],Xi=0,Ca=la.positionedGlyphs;Xi<Ca.length;Xi+=1){var mi=Ca[Xi];if(mi.rect){var Da=mi.rect||{},Io=4,Qo=!0,Go=1,yo=0,Oo=(mn||ui)&&mi.vertical,Rs=mi.metrics.advance*mi.scale/2;if(ui&&fr.verticalizable&&(yo=la.lineOffset/2-(mi.imageName?-(24-mi.metrics.width*mi.scale)/2:24*(mi.scale-1))),mi.imageName){var vs=Ln[mi.imageName];Qo=vs.sdf,Io=1/(Go=vs.pixelRatio)}var nu=mn?[mi.x+Rs,mi.y]:[0,0],Ds=mn?[0,0]:[mi.x+Rs+Ir[0],mi.y+Ir[1]-yo],Gs=[0,0];Oo&&(Gs=Ds,Ds=[0,0]);var qo=(mi.metrics.left-Io)*mi.scale-Rs+Ds[0],Fs=(-mi.metrics.top-Io)*mi.scale+Ds[1],fa=qo+Da.w*mi.scale/Go,no=Fs+Da.h*mi.scale/Go,qa=new W(qo,Fs),va=new W(fa,Fs),vu=new W(qo,no),iu=new W(fa,no);if(Oo){var Za=new W(-Rs,Rs- -17),es=-Math.PI/2,ws=12-Rs,La=new W(22-ws,-(mi.imageName?ws:0)),Mc=new(Function.prototype.bind.apply(W,[null].concat(Gs)));qa._rotateAround(es,Za)._add(La)._add(Mc),va._rotateAround(es,Za)._add(La)._add(Mc),vu._rotateAround(es,Za)._add(La)._add(Mc),iu._rotateAround(es,Za)._add(La)._add(Mc)}if(Nn){var Hs=Math.sin(Nn),Ic=Math.cos(Nn),ts=[Ic,-Hs,Hs,Ic];qa._matMult(ts),va._matMult(ts),vu._matMult(ts),iu._matMult(ts)}var Vc=new W(0,0),ic=new W(0,0);na.push({tl:qa,tr:va,bl:vu,br:iu,tex:Da,writingMode:fr.writingMode,glyphOffset:nu,sectionIndex:mi.sectionIndex,isSDF:Qo,pixelOffsetTL:Vc,pixelOffsetBR:ic,minFontScaleX:0,minFontScaleY:0})}}return na}(0,r,M,v,y,x,f,e.allowVerticalPlacement),vt=e.textSizeData,qe=null;vt.kind==="source"?(qe=[128*v.layout.get("text-size").evaluate(x,{})])[0]>32640&&Xe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):vt.kind==="composite"&&((qe=[128*ge.compositeTextSizes[0].evaluate(x,{},Ze),128*ge.compositeTextSizes[1].evaluate(x,{},Ze)])[0]>32640||qe[1]>32640)&&Xe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,Ge,qe,M,y,x,G,t,B.lineStartIndex,B.lineLength,fe,Ze);for(var Mt=0,Wt=K;Mt<Wt.length;Mt+=1)re[Wt[Mt]]=e.text.placedSymbolArray.length-1;return 4*Ge.length}function Fn(e){for(var t in e)return e[t];return null}function ua(e,t,r,f){var v=e.compareText;if(t in v){for(var y=v[t],x=y.length-1;x>=0;x--)if(f.dist(y[x])<r)return!0}else v[t]=[];return v[t].push(f),!1}var De=Uc.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function it(e,t,r,f,v,y,x,M,B,G,K,re,fe){var ge=M?Math.min(32640,Math.round(M[0])):0,Ze=M?Math.min(32640,Math.round(M[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),y,x,(ge<<1)+(B?1:0),Ze,16*G,16*K,256*re,256*fe)}function Tt(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function nr(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(ql(r[t].text))return!0;return!1}var dt=function(e){this.layoutVertexArray=new Ol,this.indexArray=new Du,this.programConfigurations=e,this.segments=new we,this.dynamicLayoutVertexArray=new Ku,this.opacityVertexArray=new Ll,this.placedSymbolArray=new h};dt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},dt.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ph.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},dt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Dn("SymbolBuffers",dt);var lt=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new we,this.collisionVertexArray=new yc};lt.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Kh.members,!0)},lt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Dn("CollisionBuffers",lt);var at=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(y){return y.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Uo([]),this.placementViewportMatrix=Uo([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wi(this.zoom,t["text-size"]),this.iconSizeData=wi(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(y){return Ar[y]})),this.stateDependentLayerIds=this.layers.filter(function(y){return y.isStateDependent()}).map(function(y){return y.id}),this.sourceID=e.sourceID};at.prototype.createArrays=function(){this.text=new dt(new pe(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new dt(new pe(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new P,this.lineVertexArray=new D,this.symbolInstances=new b},at.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var y=0;y<e.length;y++)if(t[e.charCodeAt(y)]=!0,(r||f)&&v){var x=wf[e.charAt(y)];x&&(t[x.charCodeAt(0)]=!0)}},at.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,y=v.get("text-font"),x=v.get("text-field"),M=v.get("icon-image"),B=(x.value.kind!=="constant"||x.value.value instanceof ya&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),G=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,K=v.get("symbol-sort-key");if(this.features=[],B||G){for(var re=t.iconDependencies,fe=t.glyphDependencies,ge=t.availableImages,Ze=new qi(this.zoom),Ge=0,vt=e;Ge<vt.length;Ge+=1){var qe=vt[Ge],Mt=qe.feature,Wt=qe.id,lr=qe.index,fr=qe.sourceLayerIndex,Ir=f._featureFilter.needGeometry,rn=vn(Mt,Ir);if(f._featureFilter.filter(Ze,rn,r)){Ir||(rn.geometry=Pr(Mt));var mn=void 0;if(B){var ei=f.getValueAndResolveTokens("text-field",rn,r,ge),Ln=ya.factory(ei);nr(Ln)&&(this.hasRTLText=!0),(!this.hasRTLText||Bc()==="unavailable"||this.hasRTLText&&Os.isParsed())&&(mn=wp(Ln,f,rn))}var ui=void 0;if(G){var Nn=f.getValueAndResolveTokens("icon-image",rn,r,ge);ui=Nn instanceof yi?Nn:yi.fromString(Nn)}if(mn||ui){var na=this.sortFeaturesByKey?K.evaluate(rn,{},r):void 0;if(this.features.push({id:Wt,text:mn,icon:ui,index:lr,sourceLayerIndex:fr,geometry:rn.geometry,properties:Mt.properties,type:De[Mt.type],sortKey:na}),ui&&(re[ui.name]=!0),mn){var bi=y.evaluate(rn,{},r).join(","),ti=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ar.vertical)>=0;for(var la=0,Xi=mn.sections;la<Xi.length;la+=1){var Ca=Xi[la];if(Ca.image)re[Ca.image.name]=!0;else{var mi=Jl(mn.toString()),Da=Ca.fontStack||bi,Io=fe[Da]=fe[Da]||{};this.calculateGlyphDependencies(Ca.text,Io,ti,this.allowVerticalPlacement,mi)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(Qo){var Go={},yo={},Oo=[],Rs=0;function vs(Za){Oo.push(Qo[Za]),Rs++}function nu(Za,es,ws){var La=yo[Za];return delete yo[Za],yo[es]=La,Oo[La].geometry[0].pop(),Oo[La].geometry[0]=Oo[La].geometry[0].concat(ws[0]),La}function Ds(Za,es,ws){var La=Go[es];return delete Go[es],Go[Za]=La,Oo[La].geometry[0].shift(),Oo[La].geometry[0]=ws[0].concat(Oo[La].geometry[0]),La}function Gs(Za,es,ws){var La=ws?es[0][es[0].length-1]:es[0][0];return Za+":"+La.x+":"+La.y}for(var qo=0;qo<Qo.length;qo++){var Fs=Qo[qo],fa=Fs.geometry,no=Fs.text?Fs.text.toString():null;if(no){var qa=Gs(no,fa),va=Gs(no,fa,!0);if(qa in yo&&va in Go&&yo[qa]!==Go[va]){var vu=Ds(qa,va,fa),iu=nu(qa,va,Oo[vu].geometry);delete Go[qa],delete yo[va],yo[Gs(no,Oo[iu].geometry,!0)]=iu,Oo[vu].geometry=null}else qa in yo?nu(qa,va,fa):va in Go?Ds(qa,va,fa):(vs(qo),Go[qa]=Rs-1,yo[va]=Rs-1)}else vs(qo)}return Oo.filter(function(Za){return Za.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Qo,Go){return Qo.sortKey-Go.sortKey})}},at.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},at.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},at.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},at.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},at.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},at.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},at.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),y={},x=e.segment+1;x<t.length;x++)y[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:f},x<t.length-1&&(f+=t[x+1].dist(t[x]));for(var M=e.segment||0;M>=0;M--)y[M]={x:t[M].x,y:t[M].y,tileUnitDistanceFromAnchor:v},M>0&&(v+=t[M-1].dist(t[M]));for(var B=0;B<t.length;B++){var G=y[B];this.lineVertexArray.emplaceBack(G.x,G.y,G.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},at.prototype.addSymbols=function(e,t,r,f,v,y,x,M,B,G,K,re){for(var fe=e.indexArray,ge=e.layoutVertexArray,Ze=e.segments.prepareSegment(4*t.length,ge,fe,this.canOverlap?y.sortKey:void 0),Ge=this.glyphOffsetArray.length,vt=Ze.vertexLength,qe=this.allowVerticalPlacement&&x===Ar.vertical?Math.PI/2:0,Mt=y.text&&y.text.sections,Wt=0;Wt<t.length;Wt++){var lr=t[Wt],fr=lr.tl,Ir=lr.tr,rn=lr.bl,mn=lr.br,ei=lr.tex,Ln=lr.pixelOffsetTL,ui=lr.pixelOffsetBR,Nn=lr.minFontScaleX,na=lr.minFontScaleY,bi=lr.glyphOffset,ti=lr.isSDF,la=lr.sectionIndex,Xi=Ze.vertexLength,Ca=bi[1];it(ge,M.x,M.y,fr.x,Ca+fr.y,ei.x,ei.y,r,ti,Ln.x,Ln.y,Nn,na),it(ge,M.x,M.y,Ir.x,Ca+Ir.y,ei.x+ei.w,ei.y,r,ti,ui.x,Ln.y,Nn,na),it(ge,M.x,M.y,rn.x,Ca+rn.y,ei.x,ei.y+ei.h,r,ti,Ln.x,ui.y,Nn,na),it(ge,M.x,M.y,mn.x,Ca+mn.y,ei.x+ei.w,ei.y+ei.h,r,ti,ui.x,ui.y,Nn,na),Tt(e.dynamicLayoutVertexArray,M,qe),fe.emplaceBack(Xi,Xi+1,Xi+2),fe.emplaceBack(Xi+1,Xi+2,Xi+3),Ze.vertexLength+=4,Ze.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bi[0]),Wt!==t.length-1&&la===t[Wt+1].sectionIndex||e.programConfigurations.populatePaintArrays(ge.length,y,y.index,{},re,Mt&&Mt[la])}e.placedSymbolArray.emplaceBack(M.x,M.y,Ge,this.glyphOffsetArray.length-Ge,vt,B,G,M.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],x,0,!1,0,K)},at.prototype._addCollisionDebugVertex=function(e,t,r,f,v,y){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(y.x),Math.round(y.y))},at.prototype.addCollisionDebugVertices=function(e,t,r,f,v,y,x){var M=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),B=M.vertexLength,G=v.layoutVertexArray,K=v.collisionVertexArray,re=x.anchorX,fe=x.anchorY;this._addCollisionDebugVertex(G,K,y,re,fe,new W(e,t)),this._addCollisionDebugVertex(G,K,y,re,fe,new W(r,t)),this._addCollisionDebugVertex(G,K,y,re,fe,new W(r,f)),this._addCollisionDebugVertex(G,K,y,re,fe,new W(e,f)),M.vertexLength+=4;var ge=v.indexArray;ge.emplaceBack(B,B+1),ge.emplaceBack(B+1,B+2),ge.emplaceBack(B+2,B+3),ge.emplaceBack(B+3,B),M.primitiveLength+=4},at.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var y=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,f?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,r)}},at.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lt(Rl,$h.members,Nu),this.iconCollisionBox=new lt(Rl,$h.members,Nu);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},at.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,y,x,M,B){for(var G={},K=t;K<r;K++){var re=e.get(K);G.textBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},G.textFeatureIndex=re.featureIndex;break}for(var fe=f;fe<v;fe++){var ge=e.get(fe);G.verticalTextBox={x1:ge.x1,y1:ge.y1,x2:ge.x2,y2:ge.y2,anchorPointX:ge.anchorPointX,anchorPointY:ge.anchorPointY},G.verticalTextFeatureIndex=ge.featureIndex;break}for(var Ze=y;Ze<x;Ze++){var Ge=e.get(Ze);G.iconBox={x1:Ge.x1,y1:Ge.y1,x2:Ge.x2,y2:Ge.y2,anchorPointX:Ge.anchorPointX,anchorPointY:Ge.anchorPointY},G.iconFeatureIndex=Ge.featureIndex;break}for(var vt=M;vt<B;vt++){var qe=e.get(vt);G.verticalIconBox={x1:qe.x1,y1:qe.y1,x2:qe.x2,y2:qe.y2,anchorPointX:qe.anchorPointX,anchorPointY:qe.anchorPointY},G.verticalIconFeatureIndex=qe.featureIndex;break}return G},at.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},at.prototype.hasTextData=function(){return this.text.segments.get().length>0},at.prototype.hasIconData=function(){return this.icon.segments.get().length>0},at.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},at.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},at.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},at.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},at.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],y=[],x=0;x<this.symbolInstances.length;++x){y.push(x);var M=this.symbolInstances.get(x);f.push(0|Math.round(t*M.anchorX+r*M.anchorY)),v.push(M.featureIndex)}return y.sort(function(B,G){return f[B]-f[G]||v[G]-v[B]}),y},at.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},at.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(y,x,M){y>=0&&M.indexOf(y)===x&&t.addIndicesForPlacedSymbol(t.text,y)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Dn("SymbolBucket",at,{omit:["layers","collisionBoxArray","features","compareText"]}),at.MAX_GLYPHS=65535,at.addDynamicAttributes=Tt;var Oe=new Ko({"symbol-placement":new ai(se.layout_symbol["symbol-placement"]),"symbol-spacing":new ai(se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ai(se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Hn(se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ai(se.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ai(se.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ai(se.layout_symbol["icon-ignore-placement"]),"icon-optional":new ai(se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ai(se.layout_symbol["icon-rotation-alignment"]),"icon-size":new Hn(se.layout_symbol["icon-size"]),"icon-text-fit":new ai(se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ai(se.layout_symbol["icon-text-fit-padding"]),"icon-image":new Hn(se.layout_symbol["icon-image"]),"icon-rotate":new Hn(se.layout_symbol["icon-rotate"]),"icon-padding":new ai(se.layout_symbol["icon-padding"]),"icon-keep-upright":new ai(se.layout_symbol["icon-keep-upright"]),"icon-offset":new Hn(se.layout_symbol["icon-offset"]),"icon-anchor":new Hn(se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ai(se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ai(se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ai(se.layout_symbol["text-rotation-alignment"]),"text-field":new Hn(se.layout_symbol["text-field"]),"text-font":new Hn(se.layout_symbol["text-font"]),"text-size":new Hn(se.layout_symbol["text-size"]),"text-max-width":new Hn(se.layout_symbol["text-max-width"]),"text-line-height":new ai(se.layout_symbol["text-line-height"]),"text-letter-spacing":new Hn(se.layout_symbol["text-letter-spacing"]),"text-justify":new Hn(se.layout_symbol["text-justify"]),"text-radial-offset":new Hn(se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ai(se.layout_symbol["text-variable-anchor"]),"text-anchor":new Hn(se.layout_symbol["text-anchor"]),"text-max-angle":new ai(se.layout_symbol["text-max-angle"]),"text-writing-mode":new ai(se.layout_symbol["text-writing-mode"]),"text-rotate":new Hn(se.layout_symbol["text-rotate"]),"text-padding":new ai(se.layout_symbol["text-padding"]),"text-keep-upright":new ai(se.layout_symbol["text-keep-upright"]),"text-transform":new Hn(se.layout_symbol["text-transform"]),"text-offset":new Hn(se.layout_symbol["text-offset"]),"text-allow-overlap":new ai(se.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ai(se.layout_symbol["text-ignore-placement"]),"text-optional":new ai(se.layout_symbol["text-optional"])}),tt={paint:new Ko({"icon-opacity":new Hn(se.paint_symbol["icon-opacity"]),"icon-color":new Hn(se.paint_symbol["icon-color"]),"icon-halo-color":new Hn(se.paint_symbol["icon-halo-color"]),"icon-halo-width":new Hn(se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Hn(se.paint_symbol["icon-halo-blur"]),"icon-translate":new ai(se.paint_symbol["icon-translate"]),"icon-translate-anchor":new ai(se.paint_symbol["icon-translate-anchor"]),"text-opacity":new Hn(se.paint_symbol["text-opacity"]),"text-color":new Hn(se.paint_symbol["text-color"],{runtimeType:ln,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Hn(se.paint_symbol["text-halo-color"]),"text-halo-width":new Hn(se.paint_symbol["text-halo-width"]),"text-halo-blur":new Hn(se.paint_symbol["text-halo-blur"]),"text-translate":new ai(se.paint_symbol["text-translate"]),"text-translate-anchor":new ai(se.paint_symbol["text-translate-anchor"])}),layout:Oe},Fe=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Pn,this.defaultValue=e};Fe.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Fe.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Fe.prototype.outputDefined=function(){return!1},Fe.prototype.serialize=function(){return null},Dn("FormatSectionOverride",Fe,{omit:["defaultValue"]});var Dt=function(e){function t(r){e.call(this,r,tt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var y=[],x=0,M=v;x<M.length;x+=1){var B=M[x];y.indexOf(B)<0&&y.push(B)}this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,y){var x=this.layout.get(r).evaluate(f,{},v,y),M=this._unevaluatedLayout._values[r];return M.isDataDriven()||gu(M.value)||!x?x:function(B,G){return G.replace(/{([^{}]+)}/g,function(K,re){return re in B?String(B[re]):""})}(f.properties,x)},t.prototype.createBucket=function(r){return new at(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=tt.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var y,x=this.paint.get(v),M=new Fe(x),B=new Sl(M,x.property.specification);y=x.value.kind==="constant"||x.value.kind==="source"?new al("source",B):new Vu("composite",B,x.value.zoomStops,x.value._interpolationType),this.paint._values[v]=new So(x.property,y,x.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),y=tt.paint.properties[f],x=!1,M=function(K){for(var re=0,fe=K;re<fe.length;re+=1)if(y.overrides&&y.overrides.hasOverride(fe[re]))return void(x=!0)};if(v.value.kind==="constant"&&v.value.value instanceof ya)M(v.value.value.sections);else if(v.value.kind==="source"){var B=function(K){x||(K instanceof Xa&&Ea(K.value)===Yi?M(K.value.sections):K instanceof To?M(K.sections):K.eachChild(B))},G=v.value;G._styleExpression&&B(G._styleExpression.expression)}return x},t}(cu),Vt={paint:new Ko({"background-color":new ai(se.paint_background["background-color"]),"background-pattern":new ns(se.paint_background["background-pattern"]),"background-opacity":new ai(se.paint_background["background-opacity"])})},Dr=function(e){function t(r){e.call(this,r,Vt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(cu),fn={paint:new Ko({"raster-opacity":new ai(se.paint_raster["raster-opacity"]),"raster-hue-rotate":new ai(se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ai(se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ai(se.paint_raster["raster-brightness-max"]),"raster-saturation":new ai(se.paint_raster["raster-saturation"]),"raster-contrast":new ai(se.paint_raster["raster-contrast"]),"raster-resampling":new ai(se.paint_raster["raster-resampling"]),"raster-fade-duration":new ai(se.paint_raster["raster-fade-duration"])})},sn=function(e){function t(r){e.call(this,r,fn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(cu),_n=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(cu),un={circle:Ju,heatmap:pf,hillshade:ru,fill:xf,"fill-extrusion":Gh,line:Wh,symbol:Dt,background:Dr,raster:sn},Yn=N.HTMLImageElement,On=N.HTMLCanvasElement,jn=N.HTMLVideoElement,Vn=N.ImageData,Gn=N.ImageBitmap,pi=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};pi.prototype.update=function(e,t,r){var f=e.width,v=e.height,y=!(this.size&&this.size[0]===f&&this.size[1]===v||r),x=this.context,M=x.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!t||t.premultiply!==!1)),y)this.size=[f,v],e instanceof Yn||e instanceof On||e instanceof jn||e instanceof Vn||Gn&&e instanceof Gn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,e):M.texImage2D(M.TEXTURE_2D,0,this.format,f,v,0,this.format,M.UNSIGNED_BYTE,e.data);else{var B=r||{x:0,y:0},G=B.x,K=B.y;e instanceof Yn||e instanceof On||e instanceof jn||e instanceof Vn||Gn&&e instanceof Gn?M.texSubImage2D(M.TEXTURE_2D,0,G,K,M.RGBA,M.UNSIGNED_BYTE,e):M.texSubImage2D(M.TEXTURE_2D,0,G,K,f,v,M.RGBA,M.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},pi.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},pi.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},pi.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ha=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Ha.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Ha.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Bo=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},yr(["receive","process"],this),this.invoker=new Ha(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=or()?e:N};function xl(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}Bo.prototype.send=function(e,t,r,f,v){var y=this;v===void 0&&(v=!1);var x=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[x]=r);var M=Re(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:Qs(t,M)},M),{cancel:function(){r&&delete y.callbacks[x],y.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:y.mapId})}}},Bo.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else or()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},Bo.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Bo.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(Ps(t.error)):f(null,Ps(t.data)))}else{var v=!1,y=Re(this.globalScope)?void 0:[],x=t.hasCallback?function(K,re){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:K?Qs(K):null,data:Qs(re,y)},y)}:function(K){v=!0},M=null,B=Ps(t.data);if(this.parent[t.type])M=this.parent[t.type](t.sourceMapId,B,x);else if(this.parent.getWorkerSource){var G=t.type.split(".");M=this.parent.getWorkerSource(t.sourceMapId,G[0],B.source)[G[1]](B,x)}else x(new Error("Could not find function "+t.type));!v&&M&&M.cancel&&(this.cancelCallbacks[e]=M.cancel)}},Bo.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Qa=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Qa.prototype.setNorthEast=function(e){return this._ne=e instanceof Oa?new Oa(e.lng,e.lat):Oa.convert(e),this},Qa.prototype.setSouthWest=function(e){return this._sw=e instanceof Oa?new Oa(e.lng,e.lat):Oa.convert(e),this},Qa.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof Oa)t=e,r=e;else{if(!(e instanceof Qa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Qa.convert(e)):this.extend(Oa.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new Oa(t.lng,t.lat),this._ne=new Oa(r.lng,r.lat)),this},Qa.prototype.getCenter=function(){return new Oa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Qa.prototype.getSouthWest=function(){return this._sw},Qa.prototype.getNorthEast=function(){return this._ne},Qa.prototype.getNorthWest=function(){return new Oa(this.getWest(),this.getNorth())},Qa.prototype.getSouthEast=function(){return new Oa(this.getEast(),this.getSouth())},Qa.prototype.getWest=function(){return this._sw.lng},Qa.prototype.getSouth=function(){return this._sw.lat},Qa.prototype.getEast=function(){return this._ne.lng},Qa.prototype.getNorth=function(){return this._ne.lat},Qa.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Qa.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Qa.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Qa.prototype.contains=function(e){var t=Oa.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},Qa.convert=function(e){return!e||e instanceof Qa?e:new Qa(e)};var Oa=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Oa.prototype.wrap=function(){return new Oa(Yt(this.lng,-180,180),this.lat)},Oa.prototype.toArray=function(){return[this.lng,this.lat]},Oa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Oa.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},Oa.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Qa(new Oa(this.lng-r,this.lat-t),new Oa(this.lng+r,this.lat+t))},Oa.convert=function(e){if(e instanceof Oa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Oa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Oa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ss=2*Math.PI*63710088e-1;function Uu(e){return Ss*Math.cos(e*Math.PI/180)}function Su(e){return(180+e)/360}function vh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function qu(e,t){return e/Uu(t)}function Zf(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Af=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Af.fromLngLat=function(e,t){t===void 0&&(t=0);var r=Oa.convert(e);return new Af(Su(r.lng),vh(r.lat),qu(t,r.lat))},Af.prototype.toLngLat=function(){return new Oa(360*this.x-180,Zf(this.y))},Af.prototype.toAltitude=function(){return this.z*Uu(Zf(this.y))},Af.prototype.meterInMercatorCoordinateUnits=function(){return 1/Ss*(e=Zf(this.y),1/Math.cos(e*Math.PI/180));var e};var Tc=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=jf(0,e,e,t,r)};Tc.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Tc.prototype.url=function(e,t){var r,f,v,y,x,M=(f=this.y,v=this.z,y=xl(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),x=xl(256*(r+1),256*(f+1),v),y[0]+","+y[1]+","+x[0]+","+x[1]),B=function(G,K,re){for(var fe,ge="",Ze=G;Ze>0;Ze--)ge+=(K&(fe=1<<Ze-1)?1:0)+(re&fe?2:0);return ge}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",B).replace("{bbox-epsg-3857}",M)},Tc.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new W(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Tc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Cp=function(e,t){this.wrap=e,this.canonical=t,this.key=jf(e,t.z,t.z,t.x,t.y)},ss=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new Tc(r,+f,+v),this.key=jf(t,e,r,f,v)};function jf(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var y=1<<r;return(y*y*e+y*v+f).toString(36)+r.toString(36)+t.toString(36)}ss.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},ss.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new ss(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ss(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},ss.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?jf(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):jf(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},ss.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},ss.prototype.children=function(e){if(this.overscaledZ>=e)return[new ss(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new ss(t,this.wrap,t,r,f),new ss(t,this.wrap,t,r+1,f),new ss(t,this.wrap,t,r,f+1),new ss(t,this.wrap,t,r+1,f+1)]},ss.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},ss.prototype.wrapped=function(){return new ss(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ss.prototype.unwrapTo=function(e){return new ss(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},ss.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ss.prototype.toUnwrapped=function(){return new Cp(this.wrap,this.canonical)},ss.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ss.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Af(e.x-this.wrap,e.y))},Dn("CanonicalTileID",Tc),Dn("OverscaledTileID",ss,{omit:["posMatrix"]});var Pc=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Xe('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};Pc.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},Pc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Pc.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Pc.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Pc.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Pc.prototype.getPixels=function(){return new Mo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Pc.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,y=r*this.dim,x=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:y=x-1;break;case 1:x=y+1}for(var M=-t*this.dim,B=-r*this.dim,G=y;G<x;G++)for(var K=f;K<v;K++)this.data[this._idx(K,G)]=e.data[this._idx(K+M,G+B)]},Dn("DEMData",Pc);var mh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};mh.prototype.encode=function(e){return this._stringToNumber[e]},mh.prototype.decode=function(e){return this._numberToString[e]};var qh=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},Ap={geometry:{configurable:!0}};Ap.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Ap.geometry.set=function(e){this._geometry=e},qh.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(qh.prototype,Ap);var Vf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Vf.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Gt(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var y in this.deletedStates[e][f]={},this.state[e][f])r[y]||(this.deletedStates[e][f][y]=null);else for(var x in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][x]===null&&delete this.deletedStates[e][f][x]},Vf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},Vf.prototype.getState=function(e,t){var r=String(t),f=Gt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var y in v)delete f[y]}return f},Vf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Vf.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),Gt(this.state[f][y],this.stateChanges[f][y]),v[y]=this.state[f][y];r[f]=v}for(var x in this.deletedStates){this.state[x]=this.state[x]||{};var M={};if(this.deletedStates[x]===null)for(var B in this.state[x])M[B]={},this.state[x][B]={};else for(var G in this.deletedStates[x]){if(this.deletedStates[x][G]===null)this.state[x][G]={};else for(var K=0,re=Object.keys(this.deletedStates[x][G]);K<re.length;K+=1)delete this.state[x][G][re[K]];M[G]=this.state[x][G]}r[x]=r[x]||{},Gt(r[x],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var fe in e)e[fe].setFeatureState(r,t)};var Zc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ou(8192,16,0),this.grid3D=new Ou(8192,16,0),this.featureIndexArray=new ae,this.promoteId=t};function Hp(e,t,r,f,v){return vr(e,function(y,x){var M=t instanceof ku?t.get(x):null;return M&&M.evaluate?M.evaluate(r,f,v):M})}function Tp(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,y=0,x=e;y<x.length;y+=1){var M=x[y];t=Math.min(t,M.x),r=Math.min(r,M.y),f=Math.max(f,M.x),v=Math.max(v,M.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function wd(e,t){return t-e}Zc.prototype.insert=function(e,t,r,f,v,y){var x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var M=y?this.grid3D:this.grid,B=0;B<t.length;B++){for(var G=t[B],K=[1/0,1/0,-1/0,-1/0],re=0;re<G.length;re++){var fe=G[re];K[0]=Math.min(K[0],fe.x),K[1]=Math.min(K[1],fe.y),K[2]=Math.max(K[2],fe.x),K[3]=Math.max(K[3],fe.y)}K[0]<8192&&K[1]<8192&&K[2]>=0&&K[3]>=0&&M.insert(x,K[0],K[1],K[2],K[3])}},Zc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Uc.VectorTile(new Cf(this.rawTileData)).layers,this.sourceLayerCoder=new mh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Zc.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var y=e.params||{},x=8192/e.tileSize/e.scale,M=Wu(y.filter),B=e.queryGeometry,G=e.queryPadding*x,K=Tp(B),re=this.grid.query(K.minX-G,K.minY-G,K.maxX+G,K.maxY+G),fe=Tp(e.cameraQueryGeometry),ge=this.grid3D.query(fe.minX-G,fe.minY-G,fe.maxX+G,fe.maxY+G,function(lr,fr,Ir,rn){return function(mn,ei,Ln,ui,Nn){for(var na=0,bi=mn;na<bi.length;na+=1){var ti=bi[na];if(ei<=ti.x&&Ln<=ti.y&&ui>=ti.x&&Nn>=ti.y)return!0}var la=[new W(ei,Ln),new W(ei,Nn),new W(ui,Nn),new W(ui,Ln)];if(mn.length>2){for(var Xi=0,Ca=la;Xi<Ca.length;Xi+=1)if(ta(mn,Ca[Xi]))return!0}for(var mi=0;mi<mn.length-1;mi++)if(da(mn[mi],mn[mi+1],la))return!0;return!1}(e.cameraQueryGeometry,lr-G,fr-G,Ir+G,rn+G)}),Ze=0,Ge=ge;Ze<Ge.length;Ze+=1)re.push(Ge[Ze]);re.sort(wd);for(var vt,qe={},Mt=function(lr){var fr=re[lr];if(fr!==vt){vt=fr;var Ir=v.featureIndexArray.get(fr),rn=null;v.loadMatchingFeature(qe,Ir.bucketIndex,Ir.sourceLayerIndex,Ir.featureIndex,M,y.layers,y.availableImages,t,r,f,function(mn,ei,Ln){return rn||(rn=Pr(mn)),ei.queryIntersectsFeature(B,mn,Ln,rn,v.z,e.transform,x,e.pixelPosMatrix)})}},Wt=0;Wt<re.length;Wt++)Mt(Wt);return qe},Zc.prototype.loadMatchingFeature=function(e,t,r,f,v,y,x,M,B,G,K){var re=this.bucketLayerIDs[t];if(!y||function(mn,ei){for(var Ln=0;Ln<mn.length;Ln++)if(ei.indexOf(mn[Ln])>=0)return!0;return!1}(y,re)){var fe=this.sourceLayerCoder.decode(r),ge=this.vtLayers[fe].feature(f);if(v.needGeometry){var Ze=vn(ge,!0);if(!v.filter(new qi(this.tileID.overscaledZ),Ze,this.tileID.canonical))return}else if(!v.filter(new qi(this.tileID.overscaledZ),ge))return;for(var Ge=this.getId(ge,fe),vt=0;vt<re.length;vt++){var qe=re[vt];if(!(y&&y.indexOf(qe)<0)){var Mt=M[qe];if(Mt){var Wt={};Ge!==void 0&&G&&(Wt=G.getState(Mt.sourceLayer||"_geojsonTileLayer",Ge));var lr=Gt({},B[qe]);lr.paint=Hp(lr.paint,Mt.paint,ge,Wt,x),lr.layout=Hp(lr.layout,Mt.layout,ge,Wt,x);var fr=!K||K(ge,Mt,Wt);if(fr){var Ir=new qh(ge,this.z,this.x,this.y,Ge);Ir.layer=lr;var rn=e[qe];rn===void 0&&(rn=e[qe]=[]),rn.push({featureIndex:f,feature:Ir,intersectionZ:fr})}}}}}},Zc.prototype.lookupSymbolFeatures=function(e,t,r,f,v,y,x,M){var B={};this.loadVTLayers();for(var G=Wu(v),K=0,re=e;K<re.length;K+=1)this.loadMatchingFeature(B,r,f,re[K],G,y,x,M,t);return B},Zc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},Zc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Dn("FeatureIndex",Zc,{omit:["rawTileData","sourceLayerCoder"]});var Es=function(e,t){this.tileID=e,this.uid=zt(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Es.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<Vi.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Es.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Es.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(G,K){var re={};if(!K)return re;for(var fe=function(){var Ge=Ze[ge],vt=Ge.layerIds.map(function(Wt){return K.getLayer(Wt)}).filter(Boolean);if(vt.length!==0){Ge.layers=vt,Ge.stateDependentLayerIds&&(Ge.stateDependentLayers=Ge.stateDependentLayerIds.map(function(Wt){return vt.filter(function(lr){return lr.id===Wt})[0]}));for(var qe=0,Mt=vt;qe<Mt.length;qe+=1)re[Mt[qe].id]=Ge}},ge=0,Ze=G;ge<Ze.length;ge+=1)fe();return re}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof at){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var y in this.buckets){var x=this.buckets[y];if(x instanceof at&&x.hasRTLText){this.hasRTLText=!0,Os.isLoading()||Os.isLoaded()||Bc()!=="deferred"||qs();break}}for(var M in this.queryPadding=0,this.buckets){var B=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(M).queryRadius(B))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},Es.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Es.prototype.getBucket=function(e){return this.buckets[e.id]},Es.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pi(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pi(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},Es.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Es.prototype.queryRenderedFeatures=function(e,t,r,f,v,y,x,M,B,G){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:y,tileSize:this.tileSize,pixelPosMatrix:G,transform:M,params:x,queryPadding:this.queryPadding*B},e,t,r):{}},Es.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",y=f._geojsonTileLayer||f[v];if(y)for(var x=Wu(t&&t.filter),M=this.tileID.canonical,B=M.z,G=M.x,K=M.y,re={z:B,x:G,y:K},fe=0;fe<y.length;fe++){var ge=y.feature(fe);if(x.needGeometry){var Ze=vn(ge,!0);if(!x.filter(new qi(this.tileID.overscaledZ),Ze,this.tileID.canonical))continue}else if(!x.filter(new qi(this.tileID.overscaledZ),ge))continue;var Ge=r.getId(ge,v),vt=new qh(ge,B,G,K,Ge);vt.tile=re,e.push(vt)}}},Es.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Es.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Es.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=zr(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var y=this.expirationTime-t;y?this.expirationTime=f+Math.max(y,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Es.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Es.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],y=v.layers[0].sourceLayer||"_geojsonTileLayer",x=r[y],M=e[y];if(x&&M&&Object.keys(M).length!==0){v.update(M,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});var B=t&&t.style&&t.style.getLayer(f);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(v)))}}}},Es.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Es.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vi.now()},Es.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Es.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=Vi.now()+e},Es.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},Es.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var y=0,x=t;y<x.length;y+=1)if(v[x[y]])return!0}}return!1};var jc=N.performance,Pp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},jc.mark(this._marks.start)};Pp.prototype.finish=function(){jc.mark(this._marks.end);var e=jc.getEntriesByName(this._marks.measure);return e.length===0&&(jc.measure(this._marks.measure,this._marks.start,this._marks.end),e=jc.getEntriesByName(this._marks.measure),jc.clearMarks(this._marks.start),jc.clearMarks(this._marks.end),jc.clearMeasures(this._marks.measure)),e},p.Actor=Bo,p.AlphaImage=pu,p.CanonicalTileID=Tc,p.CollisionBoxArray=u,p.Color=Gi,p.DEMData=Pc,p.DataConstantProperty=ai,p.DictionaryCoder=mh,p.EXTENT=8192,p.ErrorEvent=ve,p.EvaluationParameters=qi,p.Event=oe,p.Evented=Ae,p.FeatureIndex=Zc,p.FillBucket=bu,p.FillExtrusionBucket=zu,p.ImageAtlas=Cn,p.ImagePosition=pr,p.LineBucket=Zo,p.LngLat=Oa,p.LngLatBounds=Qa,p.MercatorCoordinate=Af,p.ONE_EM=24,p.OverscaledTileID=ss,p.Point=W,p.Point$1=W,p.Properties=Ko,p.Protobuf=Cf,p.RGBAImage=Mo,p.RequestManager=er,p.RequestPerformance=Pp,p.ResourceType=Cr,p.SegmentVector=we,p.SourceFeatureState=Vf,p.StructArrayLayout1ui2=kl,p.StructArrayLayout2f1f2i16=dl,p.StructArrayLayout2i4=xs,p.StructArrayLayout3ui6=Du,p.StructArrayLayout4i8=tc,p.SymbolBucket=at,p.Texture=pi,p.Tile=Es,p.Transitionable=zo,p.Uniform1f=an,p.Uniform1i=Nr,p.Uniform2f=Hr,p.Uniform3f=In,p.Uniform4f=ni,p.UniformColor=hi,p.UniformMatrix4f=ea,p.UnwrappedTileID=Cp,p.ValidationError=Ce,p.WritingMode=Ar,p.ZoomHistory=dc,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Tt,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),y=null;e.forEach(function(x,M){t(x,function(B,G){B&&(y=B),v[M]=G,--f==0&&r(y,v)})})},p.bezier=Ye,p.bindAll=yr,p.browser=Vi,p.cacheEntryPossiblyAdded=function(e){++nn>pt&&(e.getActor().send("enforceCacheSizeLimit",gt),nn=0)},p.clamp=et,p.clearTileCache=function(e){var t=N.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=os,p.clone=function(e){var t=new oa(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=Ke,p.clone$2=function(e){var t=new oa(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=Ep,p.config=ir,p.create=function(){var e=new oa(16);return oa!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new oa(9);return oa!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new oa(4);return oa!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=A,p.createExpression=il,p.createLayout=Do,p.createStyleLayer=function(e){return e.type==="custom"?new _n(e):new un[e.type](e)},p.cross=function(e,t,r){var f=t[0],v=t[1],y=t[2],x=r[0],M=r[1],B=r[2];return e[0]=v*B-y*M,e[1]=y*x-f*B,e[2]=f*M-v*x,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=Je,p.emitValidationErrors=$l,p.endsWith=ee,p.enforceCacheSizeLimit=function(e){dr(),Et&&Et.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},p.evaluateSizeForFeature=Bi,p.evaluateSizeForZoom=Fi,p.evaluateVariableOffset=He,p.evented=vc,p.extend=Gt,p.featureFilter=Wu,p.filterObject=Ct,p.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Ri,p.getAnchorJustification=cr,p.getArrayBuffer=Di,p.getImage=ce,p.getJSON=function(e,t){return Ji(Gt(e,{type:"json"}),t)},p.getRTLTextPluginStatus=Bc,p.getReferrer=Zn,p.getVideo=function(e,t){var r,f,v=N.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var y=0;y<e.length;y++){var x=N.document.createElement("source");r=e[y],f=void 0,(f=N.document.createElement("a")).href=r,(f.protocol!==N.document.location.protocol||f.host!==N.document.location.host)&&(v.crossOrigin="Anonymous"),x.src=e[y],v.appendChild(x)}return{cancel:function(){}}},p.identity=Uo,p.invert=function(e,t){var r=t[0],f=t[1],v=t[2],y=t[3],x=t[4],M=t[5],B=t[6],G=t[7],K=t[8],re=t[9],fe=t[10],ge=t[11],Ze=t[12],Ge=t[13],vt=t[14],qe=t[15],Mt=r*M-f*x,Wt=r*B-v*x,lr=r*G-y*x,fr=f*B-v*M,Ir=f*G-y*M,rn=v*G-y*B,mn=K*Ge-re*Ze,ei=K*vt-fe*Ze,Ln=K*qe-ge*Ze,ui=re*vt-fe*Ge,Nn=re*qe-ge*Ge,na=fe*qe-ge*vt,bi=Mt*na-Wt*Nn+lr*ui+fr*Ln-Ir*ei+rn*mn;return bi?(e[0]=(M*na-B*Nn+G*ui)*(bi=1/bi),e[1]=(v*Nn-f*na-y*ui)*bi,e[2]=(Ge*rn-vt*Ir+qe*fr)*bi,e[3]=(fe*Ir-re*rn-ge*fr)*bi,e[4]=(B*Ln-x*na-G*ei)*bi,e[5]=(r*na-v*Ln+y*ei)*bi,e[6]=(vt*lr-Ze*rn-qe*Wt)*bi,e[7]=(K*rn-fe*lr+ge*Wt)*bi,e[8]=(x*Nn-M*Ln+G*mn)*bi,e[9]=(f*Ln-r*Nn-y*mn)*bi,e[10]=(Ze*Ir-Ge*lr+qe*Mt)*bi,e[11]=(re*lr-K*Ir-ge*Mt)*bi,e[12]=(M*ei-x*ui-B*mn)*bi,e[13]=(r*ui-f*ei+v*mn)*bi,e[14]=(Ge*Wt-Ze*fr-vt*Mt)*bi,e[15]=(K*fr-re*Wt+fe*Mt)*bi,e):null},p.isChar=dn,p.isMapboxURL=w,p.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},p.makeRequest=Ji,p.mapObject=vr,p.mercatorXfromLng=Su,p.mercatorYfromLat=vh,p.mercatorZfromAltitude=qu,p.mul=xc,p.multiply=po,p.mvt=Uc,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],y=r*r+f*f+v*v;return y>0&&(y=1/Math.sqrt(y)),e[0]=t[0]*y,e[1]=t[1]*y,e[2]=t[2]*y,e},p.number=Aa,p.offscreenCanvasSupported=Jr,p.ortho=function(e,t,r,f,v,y,x){var M=1/(t-r),B=1/(f-v),G=1/(y-x);return e[0]=-2*M,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*B,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*G,e[11]=0,e[12]=(t+r)*M,e[13]=(v+f)*B,e[14]=(x+y)*G,e[15]=1,e},p.parseGlyphPBF=function(e){return new Cf(e).readFields(pn,[])},p.pbf=Cf,p.performSymbolLayout=function(e,t,r,f,v,y,x){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var M=e.layers[0].layout,B=e.layers[0]._unevaluatedLayout._values,G={};if(e.textSizeData.kind==="composite"){var K=e.textSizeData,re=K.maxZoom;G.compositeTextSizes=[B["text-size"].possiblyEvaluate(new qi(K.minZoom),x),B["text-size"].possiblyEvaluate(new qi(re),x)]}if(e.iconSizeData.kind==="composite"){var fe=e.iconSizeData,ge=fe.maxZoom;G.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new qi(fe.minZoom),x),B["icon-size"].possiblyEvaluate(new qi(ge),x)]}G.layoutTextSize=B["text-size"].possiblyEvaluate(new qi(e.zoom+1),x),G.layoutIconSize=B["icon-size"].possiblyEvaluate(new qi(e.zoom+1),x),G.textMaxSize=B["text-size"].possiblyEvaluate(new qi(18));for(var Ze=24*M.get("text-line-height"),Ge=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",vt=M.get("text-keep-upright"),qe=M.get("text-size"),Mt=function(){var fr=lr[Wt],Ir=M.get("text-font").evaluate(fr,{},x).join(","),rn=qe.evaluate(fr,{},x),mn=G.layoutTextSize.evaluate(fr,{},x),ei=G.layoutIconSize.evaluate(fr,{},x),Ln={horizontal:{},vertical:void 0},ui=fr.text,Nn=[0,0];if(ui){var na=ui.toString(),bi=24*M.get("text-letter-spacing").evaluate(fr,{},x),ti=function(fa){for(var no=0,qa=fa;no<qa.length;no+=1)if(va=qa[no].charCodeAt(0),dn.Arabic(va)||dn["Arabic Supplement"](va)||dn["Arabic Extended-A"](va)||dn["Arabic Presentation Forms-A"](va)||dn["Arabic Presentation Forms-B"](va))return!1;var va;return!0}(na)?bi:0,la=M.get("text-anchor").evaluate(fr,{},x),Xi=M.get("text-variable-anchor");if(!Xi){var Ca=M.get("text-radial-offset").evaluate(fr,{},x);Nn=Ca?He(la,[24*Ca,Qu]):M.get("text-offset").evaluate(fr,{},x).map(function(fa){return 24*fa})}var mi=Ge?"center":M.get("text-justify").evaluate(fr,{},x),Da=M.get("symbol-placement"),Io=Da==="point"?24*M.get("text-max-width").evaluate(fr,{},x):0,Qo=function(){e.allowVerticalPlacement&&Jl(na)&&(Ln.vertical=ci(ui,t,r,v,Ir,Io,Ze,la,"left",ti,Nn,Ar.vertical,!0,Da,mn,rn))};if(!Ge&&Xi){for(var Go=mi==="auto"?Xi.map(function(fa){return cr(fa)}):[mi],yo=!1,Oo=0;Oo<Go.length;Oo++){var Rs=Go[Oo];if(!Ln.horizontal[Rs])if(yo)Ln.horizontal[Rs]=Ln.horizontal[0];else{var vs=ci(ui,t,r,v,Ir,Io,Ze,"center",Rs,ti,Nn,Ar.horizontal,!1,Da,mn,rn);vs&&(Ln.horizontal[Rs]=vs,yo=vs.positionedLines.length===1)}}Qo()}else{mi==="auto"&&(mi=cr(la));var nu=ci(ui,t,r,v,Ir,Io,Ze,la,mi,ti,Nn,Ar.horizontal,!1,Da,mn,rn);nu&&(Ln.horizontal[mi]=nu),Qo(),Jl(na)&&Ge&&vt&&(Ln.vertical=ci(ui,t,r,v,Ir,Io,Ze,la,mi,ti,Nn,Ar.vertical,!1,Da,mn,rn))}}var Ds=void 0,Gs=!1;if(fr.icon&&fr.icon.name){var qo=f[fr.icon.name];qo&&(Ds=function(fa,no,qa){var va=Ri(qa),vu=no[0]-fa.displaySize[0]*va.horizontalAlign,iu=no[1]-fa.displaySize[1]*va.verticalAlign;return{image:fa,top:iu,bottom:iu+fa.displaySize[1],left:vu,right:vu+fa.displaySize[0]}}(v[fr.icon.name],M.get("icon-offset").evaluate(fr,{},x),M.get("icon-anchor").evaluate(fr,{},x)),Gs=qo.sdf,e.sdfIcons===void 0?e.sdfIcons=qo.sdf:e.sdfIcons!==qo.sdf&&Xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(qo.pixelRatio!==e.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Fs=Fn(Ln.horizontal)||Ln.vertical;e.iconsInText=!!Fs&&Fs.iconsInText,(Fs||Ds)&&function(fa,no,qa,va,vu,iu,Za,es,ws,La,Mc){var Hs=iu.textMaxSize.evaluate(no,{});Hs===void 0&&(Hs=Za);var Ic,ts=fa.layers[0].layout,Vc=ts.get("icon-offset").evaluate(no,{},Mc),ic=Fn(qa.horizontal),yh=Za/24,Gf=fa.tilePixelRatio*yh,gh=fa.tilePixelRatio*Hs/24,sf=fa.tilePixelRatio*es,_h=fa.tilePixelRatio*ts.get("symbol-spacing"),xh=ts.get("text-padding")*fa.tilePixelRatio,Tf=ts.get("icon-padding")*fa.tilePixelRatio,ep=ts.get("text-max-angle")/180*Math.PI,Hf=ts.get("text-rotation-alignment")==="map"&&ts.get("symbol-placement")!=="point",uf=ts.get("icon-rotation-alignment")==="map"&&ts.get("symbol-placement")!=="point",lf=ts.get("symbol-placement"),Pf=_h/2,cf=ts.get("icon-text-fit");va&&cf!=="none"&&(fa.allowVerticalPlacement&&qa.vertical&&(Ic=Tn(va,qa.vertical,cf,ts.get("icon-text-fit-padding"),Vc,yh)),ic&&(va=Tn(va,ic,cf,ts.get("icon-text-fit-padding"),Vc,yh)));var Ul=function(Cd,Ah){Ah.x<0||Ah.x>=8192||Ah.y<0||Ah.y>=8192||function(rs,ac,Ad,hf,Ip,Op,ap,Oc,op,Jf,sp,up,Lp,Yp,Th,Kp,Rp,$p,Jp,Qp,el,lp,qp,Lc,Td){var kp,Mf,Qf,qf,If,eh=rs.addToLineVertexArray(ac,Ad),ed=0,td=0,rd=0,nd=0,Dp=-1,cp=-1,Wc={},id=ze(""),Fp=0,Bp=0;if(Oc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Fp=(kp=Oc.layout.get("text-offset").evaluate(el,{},Lc).map(function(rh){return 24*rh}))[0],Bp=kp[1]):(Fp=24*Oc.layout.get("text-radial-offset").evaluate(el,{},Lc),Bp=Qu),rs.allowVerticalPlacement&&hf.vertical){var ad=Oc.layout.get("text-rotate").evaluate(el,{},Lc)+90;qf=new xa(op,ac,Jf,sp,up,hf.vertical,Lp,Yp,Th,ad),ap&&(If=new xa(op,ac,Jf,sp,up,ap,Rp,$p,Th,ad))}if(Ip){var Np=Oc.layout.get("icon-rotate").evaluate(el,{}),od=Oc.layout.get("icon-text-fit")!=="none",sd=$o(Ip,Np,qp,od),fp=ap?$o(ap,Np,qp,od):void 0;Qf=new xa(op,ac,Jf,sp,up,Ip,Rp,$p,!1,Np),ed=4*sd.length;var zp=rs.iconSizeData,th=null;zp.kind==="source"?(th=[128*Oc.layout.get("icon-size").evaluate(el,{})])[0]>32640&&Xe(rs.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):zp.kind==="composite"&&((th=[128*lp.compositeIconSizes[0].evaluate(el,{},Lc),128*lp.compositeIconSizes[1].evaluate(el,{},Lc)])[0]>32640||th[1]>32640)&&Xe(rs.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),rs.addSymbols(rs.icon,sd,th,Qp,Jp,el,!1,ac,eh.lineStartIndex,eh.lineLength,-1,Lc),Dp=rs.icon.placedSymbolArray.length-1,fp&&(td=4*fp.length,rs.addSymbols(rs.icon,fp,th,Qp,Jp,el,Ar.vertical,ac,eh.lineStartIndex,eh.lineLength,-1,Lc),cp=rs.icon.placedSymbolArray.length-1)}for(var Of in hf.horizontal){var Ph=hf.horizontal[Of];if(!Mf){id=ze(Ph.text);var Pd=Oc.layout.get("text-rotate").evaluate(el,{},Lc);Mf=new xa(op,ac,Jf,sp,up,Ph,Lp,Yp,Th,Pd)}var ud=Ph.positionedLines.length===1;if(rd+=Kt(rs,ac,Ph,Op,Oc,Th,el,Kp,eh,hf.vertical?Ar.horizontal:Ar.horizontalOnly,ud?Object.keys(hf.horizontal):[Of],Wc,Dp,lp,Lc),ud)break}hf.vertical&&(nd+=Kt(rs,ac,hf.vertical,Op,Oc,Th,el,Kp,eh,Ar.vertical,["vertical"],Wc,cp,lp,Lc));var Md=Mf?Mf.boxStartIndex:rs.collisionBoxArray.length,Id=Mf?Mf.boxEndIndex:rs.collisionBoxArray.length,Mh=qf?qf.boxStartIndex:rs.collisionBoxArray.length,Ih=qf?qf.boxEndIndex:rs.collisionBoxArray.length,Oh=Qf?Qf.boxStartIndex:rs.collisionBoxArray.length,Lh=Qf?Qf.boxEndIndex:rs.collisionBoxArray.length,Od=If?If.boxStartIndex:rs.collisionBoxArray.length,ld=If?If.boxEndIndex:rs.collisionBoxArray.length,Zl=-1,hp=function(rh,fd){return rh&&rh.circleDiameter?Math.max(rh.circleDiameter,fd):fd};Zl=hp(Mf,Zl),Zl=hp(qf,Zl),Zl=hp(Qf,Zl);var cd=(Zl=hp(If,Zl))>-1?1:0;cd&&(Zl*=Td/24),rs.glyphOffsetArray.length>=at.MAX_GLYPHS&&Xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),el.sortKey!==void 0&&rs.addToSortKeyRanges(rs.symbolInstances.length,el.sortKey),rs.symbolInstances.emplaceBack(ac.x,ac.y,Wc.right>=0?Wc.right:-1,Wc.center>=0?Wc.center:-1,Wc.left>=0?Wc.left:-1,Wc.vertical||-1,Dp,cp,id,Md,Id,Mh,Ih,Oh,Lh,Od,ld,Jf,rd,nd,ed,td,cd,0,Lp,Fp,Bp,Zl)}(fa,Ah,Cd,qa,va,vu,Ic,fa.layers[0],fa.collisionBoxArray,no.index,no.sourceLayerIndex,fa.index,Gf,xh,Hf,ws,sf,Tf,uf,Vc,no,iu,La,Mc,Za)};if(lf==="line")for(var Wf=0,bh=os(no.geometry,0,0,8192,8192);Wf<bh.length;Wf+=1)for(var ks=bh[Wf],Sh=0,Eh=jo(ks,_h,ep,qa.vertical||ic,va,24,gh,fa.overscaling,8192);Sh<Eh.length;Sh+=1){var Wa=Eh[Sh];ic&&ua(fa,ic.text,Pf,Wa)||Ul(ks,Wa)}else if(lf==="line-center")for(var wh=0,Gc=no.geometry;wh<Gc.length;wh+=1){var Hc=Gc[wh];if(Hc.length>1){var tp=ds(Hc,ep,qa.vertical||ic,va,24,gh);tp&&Ul(Hc,tp)}}else if(no.type==="Polygon")for(var Xf=0,rp=mf(no.geometry,0);Xf<rp.length;Xf+=1){var Yf=rp[Xf],Ch=sa(Yf,16);Ul(Yf[0],new An(Ch.x,Ch.y,0))}else if(no.type==="LineString")for(var ff=0,Kf=no.geometry;ff<Kf.length;ff+=1){var $f=Kf[ff];Ul($f,new An($f[0].x,$f[0].y,0))}else if(no.type==="Point")for(var Mp=0,Wp=no.geometry;Mp<Wp.length;Mp+=1)for(var np=0,Xp=Wp[Mp];np<Xp.length;np+=1){var ip=Xp[np];Ul([ip],new An(ip.x,ip.y,0))}}(e,fr,Ln,Ds,f,G,mn,ei,Nn,Gs,x)},Wt=0,lr=e.features;Wt<lr.length;Wt+=1)Mt();y&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,f,v){var y,x=1/Math.tan(t/2);return e[0]=x/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(y=1/(f-v)),e[14]=2*v*f*y):(e[10]=-1,e[14]=-2*f),e},p.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},p.plugin=Os,p.polygonIntersectsPolygon=xi,p.postMapLoadEvent=rt,p.postTurnstileEvent=Br,p.potpack=Ot,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=Dn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Is,pluginURL:su}),vc.on("pluginStateChange",e),e},p.renderColorRamp=ef,p.rotate=function(e,t,r){var f=t[0],v=t[1],y=t[2],x=t[3],M=Math.sin(r),B=Math.cos(r);return e[0]=f*B+y*M,e[1]=v*B+x*M,e[2]=f*-M+y*B,e[3]=v*-M+x*B,e},p.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),y=t[4],x=t[5],M=t[6],B=t[7],G=t[8],K=t[9],re=t[10],fe=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=y*v+G*f,e[5]=x*v+K*f,e[6]=M*v+re*f,e[7]=B*v+fe*f,e[8]=G*v-y*f,e[9]=K*v-x*f,e[10]=re*v-M*f,e[11]=fe*v-B*f,e},p.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),y=t[0],x=t[1],M=t[2],B=t[3],G=t[4],K=t[5],re=t[6],fe=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=y*v+G*f,e[1]=x*v+K*f,e[2]=M*v+re*f,e[3]=B*v+fe*f,e[4]=G*v-y*f,e[5]=K*v-x*f,e[6]=re*v-M*f,e[7]=fe*v-B*f,e},p.scale=function(e,t,r){var f=r[0],v=r[1],y=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*y,e[9]=t[9]*y,e[10]=t[10]*y,e[11]=t[11]*y,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){gt=e,pt=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Is==="deferred"||Is==="loading"||Is==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");su=Vi.resolveURL(e),Is="deferred",_u=t,Ml(),r||qs()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=se,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=vo,p.transformMat3=function(e,t,r){var f=t[0],v=t[1],y=t[2];return e[0]=f*r[0]+v*r[3]+y*r[6],e[1]=f*r[1]+v*r[4]+y*r[7],e[2]=f*r[2]+v*r[5]+y*r[8],e},p.transformMat4=Dl,p.translate=function(e,t,r){var f,v,y,x,M,B,G,K,re,fe,ge,Ze,Ge=r[0],vt=r[1],qe=r[2];return t===e?(e[12]=t[0]*Ge+t[4]*vt+t[8]*qe+t[12],e[13]=t[1]*Ge+t[5]*vt+t[9]*qe+t[13],e[14]=t[2]*Ge+t[6]*vt+t[10]*qe+t[14],e[15]=t[3]*Ge+t[7]*vt+t[11]*qe+t[15]):(v=t[1],y=t[2],x=t[3],M=t[4],B=t[5],G=t[6],K=t[7],re=t[8],fe=t[9],ge=t[10],Ze=t[11],e[0]=f=t[0],e[1]=v,e[2]=y,e[3]=x,e[4]=M,e[5]=B,e[6]=G,e[7]=K,e[8]=re,e[9]=fe,e[10]=ge,e[11]=Ze,e[12]=f*Ge+M*vt+re*qe+t[12],e[13]=v*Ge+B*vt+fe*qe+t[13],e[14]=y*Ge+G*vt+ge*qe+t[14],e[15]=x*Ge+K*vt+Ze*qe+t[15]),e},p.triggerPluginCompletionEvent=Fc,p.uniqueId=zt,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=Jc,p.validateStyle=Tl,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=Uc,p.version="1.13.1",p.warnOnce=Xe,p.webpSupported=de,p.window=N,p.wrap=Yt}),C(["./shared"],function(p){"use strict";function A(X){var ce=typeof X;if(ce==="number"||ce==="boolean"||ce==="string"||X==null)return JSON.stringify(X);if(Array.isArray(X)){for(var me="[",z=0,oe=X;z<oe.length;z+=1)me+=A(oe[z])+",";return me+"]"}for(var ve=Object.keys(X).sort(),Ae="{",se=0;se<ve.length;se++)Ae+=JSON.stringify(ve[se])+":"+A(X[ve[se]])+",";return Ae+"}"}function Q(X){for(var ce="",me=0,z=p.refProperties;me<z.length;me+=1)ce+="/"+A(X[z[me]]);return ce}var Y=function(X){this.keyCache={},X&&this.replace(X)};Y.prototype.replace=function(X){this._layerConfigs={},this._layers={},this.update(X,[])},Y.prototype.update=function(X,ce){for(var me=this,z=0,oe=X;z<oe.length;z+=1){var ve=oe[z];this._layerConfigs[ve.id]=ve;var Ae=this._layers[ve.id]=p.createStyleLayer(ve);Ae._featureFilter=p.featureFilter(Ae.filter),this.keyCache[ve.id]&&delete this.keyCache[ve.id]}for(var se=0,Ce=ce;se<Ce.length;se+=1){var ct=Ce[se];delete this.keyCache[ct],delete this._layerConfigs[ct],delete this._layers[ct]}this.familiesBySource={};for(var xr=0,Ht=function(on,ln){for(var Ai={},bn=0;bn<on.length;bn++){var Li=ln&&ln[on[bn].id]||Q(on[bn]);ln&&(ln[on[bn].id]=Li);var Yi=Ai[Li];Yi||(Yi=Ai[Li]=[]),Yi.push(on[bn])}var si=[];for(var Ki in Ai)si.push(Ai[Ki]);return si}(p.values(this._layerConfigs),this.keyCache);xr<Ht.length;xr+=1){var Jt=Ht[xr].map(function(on){return me._layers[on.id]}),Rr=Jt[0];if(Rr.visibility!=="none"){var Mn=Rr.source||"",Pn=this.familiesBySource[Mn];Pn||(Pn=this.familiesBySource[Mn]={});var $t=Rr.sourceLayer||"_geojsonTileLayer",En=Pn[$t];En||(En=Pn[$t]=[]),En.push(Jt)}}};var W=function(X){var ce={},me=[];for(var z in X){var oe=X[z],ve=ce[z]={};for(var Ae in oe){var se=oe[+Ae];if(se&&se.bitmap.width!==0&&se.bitmap.height!==0){var Ce={x:0,y:0,w:se.bitmap.width+2,h:se.bitmap.height+2};me.push(Ce),ve[Ae]={rect:Ce,metrics:se.metrics}}}}var ct=p.potpack(me),xr=new p.AlphaImage({width:ct.w||1,height:ct.h||1});for(var Ht in X){var Jt=X[Ht];for(var Rr in Jt){var Mn=Jt[+Rr];if(Mn&&Mn.bitmap.width!==0&&Mn.bitmap.height!==0){var Pn=ce[Ht][Rr].rect;p.AlphaImage.copy(Mn.bitmap,xr,{x:0,y:0},{x:Pn.x+1,y:Pn.y+1},Mn.bitmap)}}}this.image=xr,this.positions=ce};p.register("GlyphAtlas",W);var L=function(X){this.tileID=new p.OverscaledTileID(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId};function N(X,ce,me){for(var z=new p.EvaluationParameters(ce),oe=0,ve=X;oe<ve.length;oe+=1)ve[oe].recalculate(z,me)}function Be(X,ce){var me=p.getArrayBuffer(X.request,function(z,oe,ve,Ae){z?ce(z):oe&&ce(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(oe)),rawData:oe,cacheControl:ve,expires:Ae})});return function(){me.cancel(),ce()}}L.prototype.parse=function(X,ce,me,z,oe){var ve=this;this.status="parsing",this.data=X,this.collisionBoxArray=new p.CollisionBoxArray;var Ae=new p.DictionaryCoder(Object.keys(X.layers).sort()),se=new p.FeatureIndex(this.tileID,this.promoteId);se.bucketLayerIDs=[];var Ce,ct,xr,Ht,Jt={},Rr={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},Mn=ce.familiesBySource[this.source];for(var Pn in Mn){var $t=X.layers[Pn];if($t){$t.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+Pn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var En=Ae.encode(Pn),on=[],ln=0;ln<$t.length;ln++){var Ai=$t.feature(ln),bn=se.getId(Ai,Pn);on.push({feature:Ai,id:bn,index:ln,sourceLayerIndex:En})}for(var Li=0,Yi=Mn[Pn];Li<Yi.length;Li+=1){var si=Yi[Li],Ki=si[0];Ki.minzoom&&this.zoom<Math.floor(Ki.minzoom)||Ki.maxzoom&&this.zoom>=Ki.maxzoom||Ki.visibility!=="none"&&(N(si,this.zoom,me),(Jt[Ki.id]=Ki.createBucket({index:se.bucketLayerIDs.length,layers:si,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:En,sourceID:this.source})).populate(on,Rr,this.tileID.canonical),se.bucketLayerIDs.push(si.map(function(oi){return oi.id})))}}}var Ni=p.mapObject(Rr.glyphDependencies,function(oi){return Object.keys(oi).map(Number)});Object.keys(Ni).length?z.send("getGlyphs",{uid:this.uid,stacks:Ni},function(oi,ri){Ce||(Ce=oi,ct=ri,Sa.call(ve))}):ct={};var Ti=Object.keys(Rr.iconDependencies);Ti.length?z.send("getImages",{icons:Ti,source:this.source,tileID:this.tileID,type:"icons"},function(oi,ri){Ce||(Ce=oi,xr=ri,Sa.call(ve))}):xr={};var ca=Object.keys(Rr.patternDependencies);function Sa(){if(Ce)return oe(Ce);if(ct&&xr&&Ht){var oi=new W(ct),ri=new p.ImageAtlas(xr,Ht);for(var Gi in Jt){var pa=Jt[Gi];pa instanceof p.SymbolBucket?(N(pa.layers,this.zoom,me),p.performSymbolLayout(pa,ct,oi.positions,xr,ri.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):pa.hasPattern&&(pa instanceof p.LineBucket||pa instanceof p.FillBucket||pa instanceof p.FillExtrusionBucket)&&(N(pa.layers,this.zoom,me),pa.addFeatures(Rr,this.tileID.canonical,ri.patternPositions))}this.status="done",oe(null,{buckets:p.values(Jt).filter(function(Ho){return!Ho.isEmpty()}),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:oi.image,imageAtlas:ri,glyphMap:this.returnDependencies?ct:null,iconMap:this.returnDependencies?xr:null,glyphPositions:this.returnDependencies?oi.positions:null})}}ca.length?z.send("getImages",{icons:ca,source:this.source,tileID:this.tileID,type:"patterns"},function(oi,ri){Ce||(Ce=oi,Ht=ri,Sa.call(ve))}):Ht={},Sa.call(this)};var Ye=function(X,ce,me,z){this.actor=X,this.layerIndex=ce,this.availableImages=me,this.loadVectorData=z||Be,this.loading={},this.loaded={}};Ye.prototype.loadTile=function(X,ce){var me=this,z=X.uid;this.loading||(this.loading={});var oe=!!(X&&X.request&&X.request.collectResourceTiming)&&new p.RequestPerformance(X.request),ve=this.loading[z]=new L(X);ve.abort=this.loadVectorData(X,function(Ae,se){if(delete me.loading[z],Ae||!se)return ve.status="done",me.loaded[z]=ve,ce(Ae);var Ce=se.rawData,ct={};se.expires&&(ct.expires=se.expires),se.cacheControl&&(ct.cacheControl=se.cacheControl);var xr={};if(oe){var Ht=oe.finish();Ht&&(xr.resourceTiming=JSON.parse(JSON.stringify(Ht)))}ve.vectorTile=se.vectorTile,ve.parse(se.vectorTile,me.layerIndex,me.availableImages,me.actor,function(Jt,Rr){if(Jt||!Rr)return ce(Jt);ce(null,p.extend({rawTileData:Ce.slice(0)},Rr,ct,xr))}),me.loaded=me.loaded||{},me.loaded[z]=ve})},Ye.prototype.reloadTile=function(X,ce){var me=this,z=this.loaded,oe=X.uid,ve=this;if(z&&z[oe]){var Ae=z[oe];Ae.showCollisionBoxes=X.showCollisionBoxes;var se=function(Ce,ct){var xr=Ae.reloadCallback;xr&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,ve.layerIndex,me.availableImages,ve.actor,xr)),ce(Ce,ct)};Ae.status==="parsing"?Ae.reloadCallback=se:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,se):se())}},Ye.prototype.abortTile=function(X,ce){var me=this.loading,z=X.uid;me&&me[z]&&me[z].abort&&(me[z].abort(),delete me[z]),ce()},Ye.prototype.removeTile=function(X,ce){var me=this.loaded,z=X.uid;me&&me[z]&&delete me[z],ce()};var Je=p.window.ImageBitmap,et=function(){this.loaded={}};function Yt(X,ce){if(X.length!==0){Gt(X[0],ce);for(var me=1;me<X.length;me++)Gt(X[me],!ce)}}function Gt(X,ce){for(var me=0,z=0,oe=X.length,ve=oe-1;z<oe;ve=z++)me+=(X[z][0]-X[ve][0])*(X[ve][1]+X[z][1]);me>=0!=!!ce&&X.reverse()}et.prototype.loadTile=function(X,ce){var me=X.uid,z=X.encoding,oe=X.rawImageData,ve=Je&&oe instanceof Je?this.getImageData(oe):oe,Ae=new p.DEMData(me,ve,z);this.loaded=this.loaded||{},this.loaded[me]=Ae,ce(null,Ae)},et.prototype.getImageData=function(X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);var ce=this.offscreenCanvasContext.getImageData(-1,-1,X.width+2,X.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:ce.width,height:ce.height},ce.data)},et.prototype.removeTile=function(X){var ce=this.loaded,me=X.uid;ce&&ce[me]&&delete ce[me]};var tr=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,zt=function(X){this._feature=X,this.extent=p.EXTENT,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))};zt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var X=[],ce=0,me=this._feature.geometry;ce<me.length;ce+=1){var z=me[ce];X.push([new p.Point$1(z[0],z[1])])}return X}for(var oe=[],ve=0,Ae=this._feature.geometry;ve<Ae.length;ve+=1){for(var se=[],Ce=0,ct=Ae[ve];Ce<ct.length;Ce+=1){var xr=ct[Ce];se.push(new p.Point$1(xr[0],xr[1]))}oe.push(se)}return oe},zt.prototype.toGeoJSON=function(X,ce,me){return tr.call(this,X,ce,me)};var Pt=function(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=X.length,this._features=X};Pt.prototype.feature=function(X){return new zt(this._features[X])};var xt=p.vectorTile.VectorTileFeature,yr=ee;function ee(X,ce){this.options=ce||{},this.features=X,this.length=X.length}function vr(X,ce){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=ce||4096}ee.prototype.feature=function(X){return new vr(this.features[X],this.options.extent)},vr.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var ce=0;ce<X.length;ce++){for(var me=X[ce],z=[],oe=0;oe<me.length;oe++)z.push(new p.Point$1(me[oe][0],me[oe][1]));this.geometry.push(z)}return this.geometry},vr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,ce=1/0,me=-1/0,z=1/0,oe=-1/0,ve=0;ve<X.length;ve++)for(var Ae=X[ve],se=0;se<Ae.length;se++){var Ce=Ae[se];ce=Math.min(ce,Ce.x),me=Math.max(me,Ce.x),z=Math.min(z,Ce.y),oe=Math.max(oe,Ce.y)}return[ce,z,me,oe]},vr.prototype.toGeoJSON=xt.prototype.toGeoJSON;var Ct=Rt,Ke=yr;function Rt(X){var ce=new p.pbf;return function(me,z){for(var oe in me.layers)z.writeMessage(3,Xe,me.layers[oe])}(X,ce),ce.finish()}function Xe(X,ce){var me;ce.writeVarintField(15,X.version||1),ce.writeStringField(1,X.name||""),ce.writeVarintField(5,X.extent||4096);var z={keys:[],values:[],keycache:{},valuecache:{}};for(me=0;me<X.length;me++)z.feature=X.feature(me),ce.writeMessage(2,Ut,z);var oe=z.keys;for(me=0;me<oe.length;me++)ce.writeStringField(3,oe[me]);var ve=z.values;for(me=0;me<ve.length;me++)ce.writeMessage(4,Re,ve[me])}function Ut(X,ce){var me=X.feature;me.id!==void 0&&ce.writeVarintField(1,me.id),ce.writeMessage(2,_r,X),ce.writeVarintField(3,me.type),ce.writeMessage(4,he,me)}function _r(X,ce){var me=X.feature,z=X.keys,oe=X.values,ve=X.keycache,Ae=X.valuecache;for(var se in me.properties){var Ce=ve[se];Ce===void 0&&(z.push(se),ve[se]=Ce=z.length-1),ce.writeVarint(Ce);var ct=me.properties[se],xr=typeof ct;xr!=="string"&&xr!=="boolean"&&xr!=="number"&&(ct=JSON.stringify(ct));var Ht=xr+":"+ct,Jt=Ae[Ht];Jt===void 0&&(oe.push(ct),Ae[Ht]=Jt=oe.length-1),ce.writeVarint(Jt)}}function or(X,ce){return(ce<<3)+(7&X)}function zr(X){return X<<1^X>>31}function he(X,ce){for(var me=X.loadGeometry(),z=X.type,oe=0,ve=0,Ae=me.length,se=0;se<Ae;se++){var Ce=me[se],ct=1;z===1&&(ct=Ce.length),ce.writeVarint(or(1,ct));for(var xr=z===3?Ce.length-1:Ce.length,Ht=0;Ht<xr;Ht++){Ht===1&&z!==1&&ce.writeVarint(or(2,xr-1));var Jt=Ce[Ht].x-oe,Rr=Ce[Ht].y-ve;ce.writeVarint(zr(Jt)),ce.writeVarint(zr(Rr)),oe+=Jt,ve+=Rr}z===3&&ce.writeVarint(or(7,1))}}function Re(X,ce){var me=typeof X;me==="string"?ce.writeStringField(1,X):me==="boolean"?ce.writeBooleanField(7,X):me==="number"&&(X%1!=0?ce.writeDoubleField(3,X):X<0?ce.writeSVarintField(6,X):ce.writeVarintField(5,X))}function ye(X,ce,me,z){_t(X,me,z),_t(ce,2*me,2*z),_t(ce,2*me+1,2*z+1)}function _t(X,ce,me){var z=X[ce];X[ce]=X[me],X[me]=z}function ft(X,ce,me,z){var oe=X-me,ve=ce-z;return oe*oe+ve*ve}Ct.fromVectorTileJs=Rt,Ct.fromGeojsonVt=function(X,ce){ce=ce||{};var me={};for(var z in X)me[z]=new yr(X[z].features,ce),me[z].name=z,me[z].version=ce.version,me[z].extent=ce.extent;return Rt({layers:me})},Ct.GeoJSONWrapper=Ke;var Nt=function(X){return X[0]},Ft=function(X){return X[1]},kr=function(X,ce,me,z,oe){ce===void 0&&(ce=Nt),me===void 0&&(me=Ft),z===void 0&&(z=64),oe===void 0&&(oe=Float64Array),this.nodeSize=z,this.points=X;for(var ve=X.length<65536?Uint16Array:Uint32Array,Ae=this.ids=new ve(X.length),se=this.coords=new oe(2*X.length),Ce=0;Ce<X.length;Ce++)Ae[Ce]=Ce,se[2*Ce]=ce(X[Ce]),se[2*Ce+1]=me(X[Ce]);(function ct(xr,Ht,Jt,Rr,Mn,Pn){if(!(Mn-Rr<=Jt)){var $t=Rr+Mn>>1;(function En(on,ln,Ai,bn,Li,Yi){for(;Li>bn;){if(Li-bn>600){var si=Li-bn+1,Ki=Ai-bn+1,Ni=Math.log(si),Ti=.5*Math.exp(2*Ni/3),ca=.5*Math.sqrt(Ni*Ti*(si-Ti)/si)*(Ki-si/2<0?-1:1);En(on,ln,Ai,Math.max(bn,Math.floor(Ai-Ki*Ti/si+ca)),Math.min(Li,Math.floor(Ai+(si-Ki)*Ti/si+ca)),Yi)}var Sa=ln[2*Ai+Yi],oi=bn,ri=Li;for(ye(on,ln,bn,Ai),ln[2*Li+Yi]>Sa&&ye(on,ln,bn,Li);oi<ri;){for(ye(on,ln,oi,ri),oi++,ri--;ln[2*oi+Yi]<Sa;)oi++;for(;ln[2*ri+Yi]>Sa;)ri--}ln[2*bn+Yi]===Sa?ye(on,ln,bn,ri):ye(on,ln,++ri,Li),ri<=Ai&&(bn=ri+1),Ai<=ri&&(Li=ri-1)}})(xr,Ht,$t,Rr,Mn,Pn%2),ct(xr,Ht,Jt,Rr,$t-1,Pn+1),ct(xr,Ht,Jt,$t+1,Mn,Pn+1)}})(Ae,se,z,0,Ae.length-1,0)};kr.prototype.range=function(X,ce,me,z){return function(oe,ve,Ae,se,Ce,ct,xr){for(var Ht,Jt,Rr=[0,oe.length-1,0],Mn=[];Rr.length;){var Pn=Rr.pop(),$t=Rr.pop(),En=Rr.pop();if($t-En<=xr)for(var on=En;on<=$t;on++)Jt=ve[2*on+1],(Ht=ve[2*on])>=Ae&&Ht<=Ce&&Jt>=se&&Jt<=ct&&Mn.push(oe[on]);else{var ln=Math.floor((En+$t)/2);Jt=ve[2*ln+1],(Ht=ve[2*ln])>=Ae&&Ht<=Ce&&Jt>=se&&Jt<=ct&&Mn.push(oe[ln]);var Ai=(Pn+1)%2;(Pn===0?Ae<=Ht:se<=Jt)&&(Rr.push(En),Rr.push(ln-1),Rr.push(Ai)),(Pn===0?Ce>=Ht:ct>=Jt)&&(Rr.push(ln+1),Rr.push($t),Rr.push(Ai))}}return Mn}(this.ids,this.coords,X,ce,me,z,this.nodeSize)},kr.prototype.within=function(X,ce,me){return function(z,oe,ve,Ae,se,Ce){for(var ct=[0,z.length-1,0],xr=[],Ht=se*se;ct.length;){var Jt=ct.pop(),Rr=ct.pop(),Mn=ct.pop();if(Rr-Mn<=Ce)for(var Pn=Mn;Pn<=Rr;Pn++)ft(oe[2*Pn],oe[2*Pn+1],ve,Ae)<=Ht&&xr.push(z[Pn]);else{var $t=Math.floor((Mn+Rr)/2),En=oe[2*$t],on=oe[2*$t+1];ft(En,on,ve,Ae)<=Ht&&xr.push(z[$t]);var ln=(Jt+1)%2;(Jt===0?ve-se<=En:Ae-se<=on)&&(ct.push(Mn),ct.push($t-1),ct.push(ln)),(Jt===0?ve+se>=En:Ae+se>=on)&&(ct.push($t+1),ct.push(Rr),ct.push(ln))}}return xr}(this.ids,this.coords,X,ce,me,this.nodeSize)};var cn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(X){return X}},yn=function(X){this.options=kt(Object.create(cn),X),this.trees=new Array(this.options.maxZoom+1)};function Vi(X,ce,me,z,oe){return{x:X,y:ce,zoom:1/0,id:me,parentId:-1,numPoints:z,properties:oe}}function ir(X,ce){var me=X.geometry.coordinates,z=me[1];return{x:Ue(me[0]),y:Le(z),zoom:1/0,index:ce,parentId:-1}}function de(X){return{type:"Feature",id:X.id,properties:Te(X),geometry:{type:"Point",coordinates:[(z=X.x,360*(z-.5)),(ce=X.y,me=(180-360*ce)*Math.PI/180,360*Math.atan(Math.exp(me))/Math.PI-90)]}};var ce,me,z}function Te(X){var ce=X.numPoints,me=ce>=1e4?Math.round(ce/1e3)+"k":ce>=1e3?Math.round(ce/100)/10+"k":ce;return kt(kt({},X.properties),{cluster:!0,cluster_id:X.id,point_count:ce,point_count_abbreviated:me})}function Ue(X){return X/360+.5}function Le(X){var ce=Math.sin(X*Math.PI/180),me=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return me<0?0:me>1?1:me}function kt(X,ce){for(var me in ce)X[me]=ce[me];return X}function er(X){return X.x}function w(X){return X.y}function Z(X,ce,me,z,oe,ve){var Ae=oe-me,se=ve-z;if(Ae!==0||se!==0){var Ce=((X-me)*Ae+(ce-z)*se)/(Ae*Ae+se*se);Ce>1?(me=oe,z=ve):Ce>0&&(me+=Ae*Ce,z+=se*Ce)}return(Ae=X-me)*Ae+(se=ce-z)*se}function Ee(X,ce,me,z){var oe={id:X===void 0?null:X,type:ce,geometry:me,tags:z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ve){var Ae=ve.geometry,se=ve.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")je(ve,Ae);else if(se==="Polygon"||se==="MultiLineString")for(var Ce=0;Ce<Ae.length;Ce++)je(ve,Ae[Ce]);else if(se==="MultiPolygon")for(Ce=0;Ce<Ae.length;Ce++)for(var ct=0;ct<Ae[Ce].length;ct++)je(ve,Ae[Ce][ct])}(oe),oe}function je(X,ce){for(var me=0;me<ce.length;me+=3)X.minX=Math.min(X.minX,ce[me]),X.minY=Math.min(X.minY,ce[me+1]),X.maxX=Math.max(X.maxX,ce[me]),X.maxY=Math.max(X.maxY,ce[me+1])}function Qe(X,ce,me,z){if(ce.geometry){var oe=ce.geometry.coordinates,ve=ce.geometry.type,Ae=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2),se=[],Ce=ce.id;if(me.promoteId?Ce=ce.properties[me.promoteId]:me.generateId&&(Ce=z||0),ve==="Point")yt(oe,se);else if(ve==="MultiPoint")for(var ct=0;ct<oe.length;ct++)yt(oe[ct],se);else if(ve==="LineString")St(oe,se,Ae,!1);else if(ve==="MultiLineString"){if(me.lineMetrics){for(ct=0;ct<oe.length;ct++)St(oe[ct],se=[],Ae,!1),X.push(Ee(Ce,"LineString",se,ce.properties));return}jt(oe,se,Ae,!1)}else if(ve==="Polygon")jt(oe,se,Ae,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(ct=0;ct<ce.geometry.geometries.length;ct++)Qe(X,{id:Ce,geometry:ce.geometry.geometries[ct],properties:ce.properties},me,z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<oe.length;ct++){var xr=[];jt(oe[ct],xr,Ae,!0),se.push(xr)}}X.push(Ee(Ce,ve,se,ce.properties))}}function yt(X,ce){ce.push(Et(X[0])),ce.push(Qt(X[1])),ce.push(0)}function St(X,ce,me,z){for(var oe,ve,Ae=0,se=0;se<X.length;se++){var Ce=Et(X[se][0]),ct=Qt(X[se][1]);ce.push(Ce),ce.push(ct),ce.push(0),se>0&&(Ae+=z?(oe*ct-Ce*ve)/2:Math.sqrt(Math.pow(Ce-oe,2)+Math.pow(ct-ve,2))),oe=Ce,ve=ct}var xr=ce.length-3;ce[2]=1,function Ht(Jt,Rr,Mn,Pn){for(var $t,En=Pn,on=Mn-Rr>>1,ln=Mn-Rr,Ai=Jt[Rr],bn=Jt[Rr+1],Li=Jt[Mn],Yi=Jt[Mn+1],si=Rr+3;si<Mn;si+=3){var Ki=Z(Jt[si],Jt[si+1],Ai,bn,Li,Yi);if(Ki>En)$t=si,En=Ki;else if(Ki===En){var Ni=Math.abs(si-on);Ni<ln&&($t=si,ln=Ni)}}En>Pn&&($t-Rr>3&&Ht(Jt,Rr,$t,Pn),Jt[$t+2]=En,Mn-$t>3&&Ht(Jt,$t,Mn,Pn))}(ce,0,xr,me),ce[xr+2]=1,ce.size=Math.abs(Ae),ce.start=0,ce.end=ce.size}function jt(X,ce,me,z){for(var oe=0;oe<X.length;oe++){var ve=[];St(X[oe],ve,me,z),ce.push(ve)}}function Et(X){return X/360+.5}function Qt(X){var ce=Math.sin(X*Math.PI/180),me=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return me<0?0:me>1?1:me}function ie(X,ce,me,z,oe,ve,Ae,se){if(z/=ce,ve>=(me/=ce)&&Ae<z)return X;if(Ae<me||ve>=z)return null;for(var Ce=[],ct=0;ct<X.length;ct++){var xr=X[ct],Ht=xr.geometry,Jt=xr.type,Rr=oe===0?xr.minX:xr.minY,Mn=oe===0?xr.maxX:xr.maxY;if(Rr>=me&&Mn<z)Ce.push(xr);else if(!(Mn<me||Rr>=z)){var Pn=[];if(Jt==="Point"||Jt==="MultiPoint")sr(Ht,Pn,me,z,oe);else if(Jt==="LineString")Br(Ht,Pn,me,z,oe,!1,se.lineMetrics);else if(Jt==="MultiLineString")rt(Ht,Pn,me,z,oe,!1);else if(Jt==="Polygon")rt(Ht,Pn,me,z,oe,!0);else if(Jt==="MultiPolygon")for(var $t=0;$t<Ht.length;$t++){var En=[];rt(Ht[$t],En,me,z,oe,!0),En.length&&Pn.push(En)}if(Pn.length){if(se.lineMetrics&&Jt==="LineString"){for($t=0;$t<Pn.length;$t++)Ce.push(Ee(xr.id,Jt,Pn[$t],xr.tags));continue}Jt!=="LineString"&&Jt!=="MultiLineString"||(Pn.length===1?(Jt="LineString",Pn=Pn[0]):Jt="MultiLineString"),Jt!=="Point"&&Jt!=="MultiPoint"||(Jt=Pn.length===3?"Point":"MultiPoint"),Ce.push(Ee(xr.id,Jt,Pn,xr.tags))}}}return Ce.length?Ce:null}function sr(X,ce,me,z,oe){for(var ve=0;ve<X.length;ve+=3){var Ae=X[ve+oe];Ae>=me&&Ae<=z&&(ce.push(X[ve]),ce.push(X[ve+1]),ce.push(X[ve+2]))}}function Br(X,ce,me,z,oe,ve,Ae){for(var se,Ce,ct=Lr(X),xr=oe===0?pt:dr,Ht=X.start,Jt=0;Jt<X.length-3;Jt+=3){var Rr=X[Jt],Mn=X[Jt+1],Pn=X[Jt+2],$t=X[Jt+3],En=X[Jt+4],on=oe===0?Rr:Mn,ln=oe===0?$t:En,Ai=!1;Ae&&(se=Math.sqrt(Math.pow(Rr-$t,2)+Math.pow(Mn-En,2))),on<me?ln>me&&(Ce=xr(ct,Rr,Mn,$t,En,me),Ae&&(ct.start=Ht+se*Ce)):on>z?ln<z&&(Ce=xr(ct,Rr,Mn,$t,En,z),Ae&&(ct.start=Ht+se*Ce)):gt(ct,Rr,Mn,Pn),ln<me&&on>=me&&(Ce=xr(ct,Rr,Mn,$t,En,me),Ai=!0),ln>z&&on<=z&&(Ce=xr(ct,Rr,Mn,$t,En,z),Ai=!0),!ve&&Ai&&(Ae&&(ct.end=Ht+se*Ce),ce.push(ct),ct=Lr(X)),Ae&&(Ht+=se)}var bn=X.length-3;Rr=X[bn],Mn=X[bn+1],Pn=X[bn+2],(on=oe===0?Rr:Mn)>=me&&on<=z&&gt(ct,Rr,Mn,Pn),bn=ct.length-3,ve&&bn>=3&&(ct[bn]!==ct[0]||ct[bn+1]!==ct[1])&&gt(ct,ct[0],ct[1],ct[2]),ct.length&&ce.push(ct)}function Lr(X){var ce=[];return ce.size=X.size,ce.start=X.start,ce.end=X.end,ce}function rt(X,ce,me,z,oe,ve){for(var Ae=0;Ae<X.length;Ae++)Br(X[Ae],ce,me,z,oe,ve,!1)}function gt(X,ce,me,z){X.push(ce),X.push(me),X.push(z)}function pt(X,ce,me,z,oe,ve){var Ae=(ve-ce)/(z-ce);return X.push(ve),X.push(me+(oe-me)*Ae),X.push(1),Ae}function dr(X,ce,me,z,oe,ve){var Ae=(ve-me)/(oe-me);return X.push(ce+(z-ce)*Ae),X.push(ve),X.push(1),Ae}function Vr(X,ce){for(var me=[],z=0;z<X.length;z++){var oe,ve=X[z],Ae=ve.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")oe=Ur(ve.geometry,ce);else if(Ae==="MultiLineString"||Ae==="Polygon"){oe=[];for(var se=0;se<ve.geometry.length;se++)oe.push(Ur(ve.geometry[se],ce))}else if(Ae==="MultiPolygon")for(oe=[],se=0;se<ve.geometry.length;se++){for(var Ce=[],ct=0;ct<ve.geometry[se].length;ct++)Ce.push(Ur(ve.geometry[se][ct],ce));oe.push(Ce)}me.push(Ee(ve.id,Ae,oe,ve.tags))}return me}function Ur(X,ce){var me=[];me.size=X.size,X.start!==void 0&&(me.start=X.start,me.end=X.end);for(var z=0;z<X.length;z+=3)me.push(X[z]+ce,X[z+1],X[z+2]);return me}function nn(X,ce){if(X.transformed)return X;var me,z,oe,ve=1<<X.z,Ae=X.x,se=X.y;for(me=0;me<X.features.length;me++){var Ce=X.features[me],ct=Ce.geometry,xr=Ce.type;if(Ce.geometry=[],xr===1)for(z=0;z<ct.length;z+=2)Ce.geometry.push(Jr(ct[z],ct[z+1],ce,ve,Ae,se));else for(z=0;z<ct.length;z++){var Ht=[];for(oe=0;oe<ct[z].length;oe+=2)Ht.push(Jr(ct[z][oe],ct[z][oe+1],ce,ve,Ae,se));Ce.geometry.push(Ht)}}return X.transformed=!0,X}function Jr(X,ce,me,z,oe,ve){return[Math.round(me*(X*z-oe)),Math.round(me*(ce*z-ve))]}function Cr(X,ce,me,z,oe){for(var ve=ce===oe.maxZoom?0:oe.tolerance/((1<<ce)*oe.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:me,y:z,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},se=0;se<X.length;se++){Ae.numFeatures++,kn(Ae,X[se],ve,oe);var Ce=X[se].minX,ct=X[se].minY,xr=X[se].maxX,Ht=X[se].maxY;Ce<Ae.minX&&(Ae.minX=Ce),ct<Ae.minY&&(Ae.minY=ct),xr>Ae.maxX&&(Ae.maxX=xr),Ht>Ae.maxY&&(Ae.maxY=Ht)}return Ae}function kn(X,ce,me,z){var oe=ce.geometry,ve=ce.type,Ae=[];if(ve==="Point"||ve==="MultiPoint")for(var se=0;se<oe.length;se+=3)Ae.push(oe[se]),Ae.push(oe[se+1]),X.numPoints++,X.numSimplified++;else if(ve==="LineString")Zn(Ae,oe,X,me,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(se=0;se<oe.length;se++)Zn(Ae,oe[se],X,me,ve==="Polygon",se===0);else if(ve==="MultiPolygon")for(var Ce=0;Ce<oe.length;Ce++){var ct=oe[Ce];for(se=0;se<ct.length;se++)Zn(Ae,ct[se],X,me,!0,se===0)}if(Ae.length){var xr=ce.tags||null;if(ve==="LineString"&&z.lineMetrics){for(var Ht in xr={},ce.tags)xr[Ht]=ce.tags[Ht];xr.mapbox_clip_start=oe.start/oe.size,xr.mapbox_clip_end=oe.end/oe.size}var Jt={geometry:Ae,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:xr};ce.id!==null&&(Jt.id=ce.id),X.features.push(Jt)}}function Zn(X,ce,me,z,oe,ve){var Ae=z*z;if(z>0&&ce.size<(oe?Ae:z))me.numPoints+=ce.length/3;else{for(var se=[],Ce=0;Ce<ce.length;Ce+=3)(z===0||ce[Ce+2]>Ae)&&(me.numSimplified++,se.push(ce[Ce]),se.push(ce[Ce+1])),me.numPoints++;oe&&function(ct,xr){for(var Ht=0,Jt=0,Rr=ct.length,Mn=Rr-2;Jt<Rr;Mn=Jt,Jt+=2)Ht+=(ct[Jt]-ct[Mn])*(ct[Jt+1]+ct[Mn+1]);if(Ht>0===xr)for(Jt=0,Rr=ct.length;Jt<Rr/2;Jt+=2){var Pn=ct[Jt],$t=ct[Jt+1];ct[Jt]=ct[Rr-2-Jt],ct[Jt+1]=ct[Rr-1-Jt],ct[Rr-2-Jt]=Pn,ct[Rr-1-Jt]=$t}}(se,ve),X.push(se)}}function Si(X,ce){var me=(ce=this.options=function(oe,ve){for(var Ae in ve)oe[Ae]=ve[Ae];return oe}(Object.create(this.options),ce)).debug;if(me&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");var z=function(oe,ve){var Ae=[];if(oe.type==="FeatureCollection")for(var se=0;se<oe.features.length;se++)Qe(Ae,oe.features[se],ve,se);else Qe(Ae,oe.type==="Feature"?oe:{geometry:oe},ve);return Ae}(X,ce);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(z=function(oe,ve){var Ae=ve.buffer/ve.extent,se=oe,Ce=ie(oe,1,-1-Ae,Ae,0,-1,2,ve),ct=ie(oe,1,1-Ae,2+Ae,0,-1,2,ve);return(Ce||ct)&&(se=ie(oe,1,-Ae,1+Ae,0,-1,2,ve)||[],Ce&&(se=Vr(Ce,1).concat(se)),ct&&(se=se.concat(Vr(ct,-1)))),se}(z,ce)).length&&this.splitTile(z,0,0,0),me&&(z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function zi(X,ce,me){return 32*((1<<X)*me+ce)+X}function Ji(X,ce){var me=X.tileID.canonical;if(!this._geoJSONIndex)return ce(null,null);var z=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!z)return ce(null,null);var oe=new Pt(z.features),ve=Ct(oe);ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),ce(null,{vectorTile:oe,rawData:ve.buffer})}yn.prototype.load=function(X){var ce=this.options,me=ce.log,z=ce.minZoom,oe=ce.maxZoom,ve=ce.nodeSize;me&&console.time("total time");var Ae="prepare "+X.length+" points";me&&console.time(Ae),this.points=X;for(var se=[],Ce=0;Ce<X.length;Ce++)X[Ce].geometry&&se.push(ir(X[Ce],Ce));this.trees[oe+1]=new kr(se,er,w,ve,Float32Array),me&&console.timeEnd(Ae);for(var ct=oe;ct>=z;ct--){var xr=+Date.now();se=this._cluster(se,ct),this.trees[ct]=new kr(se,er,w,ve,Float32Array),me&&console.log("z%d: %d clusters in %dms",ct,se.length,+Date.now()-xr)}return me&&console.timeEnd("total time"),this},yn.prototype.getClusters=function(X,ce){var me=((X[0]+180)%360+360)%360-180,z=Math.max(-90,Math.min(90,X[1])),oe=X[2]===180?180:((X[2]+180)%360+360)%360-180,ve=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)me=-180,oe=180;else if(me>oe){var Ae=this.getClusters([me,z,180,ve],ce),se=this.getClusters([-180,z,oe,ve],ce);return Ae.concat(se)}for(var Ce=this.trees[this._limitZoom(ce)],ct=[],xr=0,Ht=Ce.range(Ue(me),Le(ve),Ue(oe),Le(z));xr<Ht.length;xr+=1){var Jt=Ce.points[Ht[xr]];ct.push(Jt.numPoints?de(Jt):this.points[Jt.index])}return ct},yn.prototype.getChildren=function(X){var ce=this._getOriginId(X),me=this._getOriginZoom(X),z="No cluster with the specified id.",oe=this.trees[me];if(!oe)throw new Error(z);var ve=oe.points[ce];if(!ve)throw new Error(z);for(var Ae=this.options.radius/(this.options.extent*Math.pow(2,me-1)),se=[],Ce=0,ct=oe.within(ve.x,ve.y,Ae);Ce<ct.length;Ce+=1){var xr=oe.points[ct[Ce]];xr.parentId===X&&se.push(xr.numPoints?de(xr):this.points[xr.index])}if(se.length===0)throw new Error(z);return se},yn.prototype.getLeaves=function(X,ce,me){var z=[];return this._appendLeaves(z,X,ce=ce||10,me=me||0,0),z},yn.prototype.getTile=function(X,ce,me){var z=this.trees[this._limitZoom(X)],oe=Math.pow(2,X),ve=this.options,Ae=ve.radius/ve.extent,se=(me-Ae)/oe,Ce=(me+1+Ae)/oe,ct={features:[]};return this._addTileFeatures(z.range((ce-Ae)/oe,se,(ce+1+Ae)/oe,Ce),z.points,ce,me,oe,ct),ce===0&&this._addTileFeatures(z.range(1-Ae/oe,se,1,Ce),z.points,oe,me,oe,ct),ce===oe-1&&this._addTileFeatures(z.range(0,se,Ae/oe,Ce),z.points,-1,me,oe,ct),ct.features.length?ct:null},yn.prototype.getClusterExpansionZoom=function(X){for(var ce=this._getOriginZoom(X)-1;ce<=this.options.maxZoom;){var me=this.getChildren(X);if(ce++,me.length!==1)break;X=me[0].properties.cluster_id}return ce},yn.prototype._appendLeaves=function(X,ce,me,z,oe){for(var ve=0,Ae=this.getChildren(ce);ve<Ae.length;ve+=1){var se=Ae[ve],Ce=se.properties;if(Ce&&Ce.cluster?oe+Ce.point_count<=z?oe+=Ce.point_count:oe=this._appendLeaves(X,Ce.cluster_id,me,z,oe):oe<z?oe++:X.push(se),X.length===me)break}return oe},yn.prototype._addTileFeatures=function(X,ce,me,z,oe,ve){for(var Ae=0,se=X;Ae<se.length;Ae+=1){var Ce=ce[se[Ae]],ct=Ce.numPoints,xr={type:1,geometry:[[Math.round(this.options.extent*(Ce.x*oe-me)),Math.round(this.options.extent*(Ce.y*oe-z))]],tags:ct?Te(Ce):this.points[Ce.index].properties},Ht=void 0;ct?Ht=Ce.id:this.options.generateId?Ht=Ce.index:this.points[Ce.index].id&&(Ht=this.points[Ce.index].id),Ht!==void 0&&(xr.id=Ht),ve.features.push(xr)}},yn.prototype._limitZoom=function(X){return Math.max(this.options.minZoom,Math.min(+X,this.options.maxZoom+1))},yn.prototype._cluster=function(X,ce){for(var me=[],z=this.options,oe=z.reduce,ve=z.minPoints,Ae=z.radius/(z.extent*Math.pow(2,ce)),se=0;se<X.length;se++){var Ce=X[se];if(!(Ce.zoom<=ce)){Ce.zoom=ce;for(var ct=this.trees[ce+1],xr=ct.within(Ce.x,Ce.y,Ae),Ht=Ce.numPoints||1,Jt=Ht,Rr=0,Mn=xr;Rr<Mn.length;Rr+=1){var Pn=ct.points[Mn[Rr]];Pn.zoom>ce&&(Jt+=Pn.numPoints||1)}if(Jt>=ve){for(var $t=Ce.x*Ht,En=Ce.y*Ht,on=oe&&Ht>1?this._map(Ce,!0):null,ln=(se<<5)+(ce+1)+this.points.length,Ai=0,bn=xr;Ai<bn.length;Ai+=1){var Li=ct.points[bn[Ai]];if(!(Li.zoom<=ce)){Li.zoom=ce;var Yi=Li.numPoints||1;$t+=Li.x*Yi,En+=Li.y*Yi,Li.parentId=ln,oe&&(on||(on=this._map(Ce,!0)),oe(on,this._map(Li)))}}Ce.parentId=ln,me.push(Vi($t/Jt,En/Jt,ln,Jt,on))}else if(me.push(Ce),Jt>1)for(var si=0,Ki=xr;si<Ki.length;si+=1){var Ni=ct.points[Ki[si]];Ni.zoom<=ce||(Ni.zoom=ce,me.push(Ni))}}}return me},yn.prototype._getOriginId=function(X){return X-this.points.length>>5},yn.prototype._getOriginZoom=function(X){return(X-this.points.length)%32},yn.prototype._map=function(X,ce){if(X.numPoints)return ce?kt({},X.properties):X.properties;var me=this.points[X.index].properties,z=this.options.map(me);return ce&&z===me?kt({},z):z},Si.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Si.prototype.splitTile=function(X,ce,me,z,oe,ve,Ae){for(var se=[X,ce,me,z],Ce=this.options,ct=Ce.debug;se.length;){z=se.pop(),me=se.pop(),ce=se.pop(),X=se.pop();var xr=1<<ce,Ht=zi(ce,me,z),Jt=this.tiles[Ht];if(!Jt&&(ct>1&&console.time("creation"),Jt=this.tiles[Ht]=Cr(X,ce,me,z,Ce),this.tileCoords.push({z:ce,x:me,y:z}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,me,z,Jt.numFeatures,Jt.numPoints,Jt.numSimplified),console.timeEnd("creation"));var Rr="z"+ce;this.stats[Rr]=(this.stats[Rr]||0)+1,this.total++}if(Jt.source=X,oe){if(ce===Ce.maxZoom||ce===oe)continue;var Mn=1<<oe-ce;if(me!==Math.floor(ve/Mn)||z!==Math.floor(Ae/Mn))continue}else if(ce===Ce.indexMaxZoom||Jt.numPoints<=Ce.indexMaxPoints)continue;if(Jt.source=null,X.length!==0){ct>1&&console.time("clipping");var Pn,$t,En,on,ln,Ai,bn=.5*Ce.buffer/Ce.extent,Li=.5-bn,Yi=.5+bn,si=1+bn;Pn=$t=En=on=null,ln=ie(X,xr,me-bn,me+Yi,0,Jt.minX,Jt.maxX,Ce),Ai=ie(X,xr,me+Li,me+si,0,Jt.minX,Jt.maxX,Ce),X=null,ln&&(Pn=ie(ln,xr,z-bn,z+Yi,1,Jt.minY,Jt.maxY,Ce),$t=ie(ln,xr,z+Li,z+si,1,Jt.minY,Jt.maxY,Ce),ln=null),Ai&&(En=ie(Ai,xr,z-bn,z+Yi,1,Jt.minY,Jt.maxY,Ce),on=ie(Ai,xr,z+Li,z+si,1,Jt.minY,Jt.maxY,Ce),Ai=null),ct>1&&console.timeEnd("clipping"),se.push(Pn||[],ce+1,2*me,2*z),se.push($t||[],ce+1,2*me,2*z+1),se.push(En||[],ce+1,2*me+1,2*z),se.push(on||[],ce+1,2*me+1,2*z+1)}}},Si.prototype.getTile=function(X,ce,me){var z=this.options,oe=z.extent,ve=z.debug;if(X<0||X>24)return null;var Ae=1<<X,se=zi(X,ce=(ce%Ae+Ae)%Ae,me);if(this.tiles[se])return nn(this.tiles[se],oe);ve>1&&console.log("drilling down to z%d-%d-%d",X,ce,me);for(var Ce,ct=X,xr=ce,Ht=me;!Ce&&ct>0;)ct--,xr=Math.floor(xr/2),Ht=Math.floor(Ht/2),Ce=this.tiles[zi(ct,xr,Ht)];return Ce&&Ce.source?(ve>1&&console.log("found parent tile z%d-%d-%d",ct,xr,Ht),ve>1&&console.time("drilling down"),this.splitTile(Ce.source,ct,xr,Ht,X,ce,me),ve>1&&console.timeEnd("drilling down"),this.tiles[se]?nn(this.tiles[se],oe):null):null};var Di=function(X){function ce(me,z,oe,ve){X.call(this,me,z,oe,Ji),ve&&(this.loadGeoJSON=ve)}return X&&(ce.__proto__=X),(ce.prototype=Object.create(X&&X.prototype)).constructor=ce,ce.prototype.loadData=function(me,z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=z,this._pendingLoadDataParams=me,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ce.prototype._loadData=function(){var me=this;if(this._pendingCallback&&this._pendingLoadDataParams){var z=this._pendingCallback,oe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var ve=!!(oe&&oe.request&&oe.request.collectResourceTiming)&&new p.RequestPerformance(oe.request);this.loadGeoJSON(oe,function(Ae,se){if(Ae||!se)return z(Ae);if(typeof se!="object")return z(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."));(function Jt(Rr,Mn){var Pn,$t=Rr&&Rr.type;if($t==="FeatureCollection")for(Pn=0;Pn<Rr.features.length;Pn++)Jt(Rr.features[Pn],Mn);else if($t==="GeometryCollection")for(Pn=0;Pn<Rr.geometries.length;Pn++)Jt(Rr.geometries[Pn],Mn);else if($t==="Feature")Jt(Rr.geometry,Mn);else if($t==="Polygon")Yt(Rr.coordinates,Mn);else if($t==="MultiPolygon")for(Pn=0;Pn<Rr.coordinates.length;Pn++)Yt(Rr.coordinates[Pn],Mn);return Rr})(se,!0);try{if(oe.filter){var Ce=p.createExpression(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ce.result==="error")throw new Error(Ce.value.map(function(Jt){return Jt.key+": "+Jt.message}).join(", "));var ct=se.features.filter(function(Jt){return Ce.value.evaluate({zoom:0},Jt)});se={type:"FeatureCollection",features:ct}}me._geoJSONIndex=oe.cluster?new yn(function(Jt){var Rr=Jt.superclusterOptions,Mn=Jt.clusterProperties;if(!Mn||!Rr)return Rr;for(var Pn={},$t={},En={accumulated:null,zoom:0},on={properties:null},ln=Object.keys(Mn),Ai=0,bn=ln;Ai<bn.length;Ai+=1){var Li=bn[Ai],Yi=Mn[Li],si=Yi[0],Ki=p.createExpression(Yi[1]),Ni=p.createExpression(typeof si=="string"?[si,["accumulated"],["get",Li]]:si);Pn[Li]=Ki.value,$t[Li]=Ni.value}return Rr.map=function(Ti){on.properties=Ti;for(var ca={},Sa=0,oi=ln;Sa<oi.length;Sa+=1){var ri=oi[Sa];ca[ri]=Pn[ri].evaluate(En,on)}return ca},Rr.reduce=function(Ti,ca){on.properties=ca;for(var Sa=0,oi=ln;Sa<oi.length;Sa+=1){var ri=oi[Sa];En.accumulated=Ti[ri],Ti[ri]=$t[ri].evaluate(En,on)}},Rr}(oe)).load(se.features):function(Jt,Rr){return new Si(Jt,Rr)}(se,oe.geojsonVtOptions)}catch(Jt){return z(Jt)}me.loaded={};var xr={};if(ve){var Ht=ve.finish();Ht&&(xr.resourceTiming={},xr.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Ht)))}z(null,xr)})}},ce.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ce.prototype.reloadTile=function(me,z){var oe=this.loaded;return oe&&oe[me.uid]?X.prototype.reloadTile.call(this,me,z):this.loadTile(me,z)},ce.prototype.loadGeoJSON=function(me,z){if(me.request)p.getJSON(me.request,z);else{if(typeof me.data!="string")return z(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."));try{return z(null,JSON.parse(me.data))}catch(oe){return z(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."))}}},ce.prototype.removeSource=function(me,z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),z()},ce.prototype.getClusterExpansionZoom=function(me,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(oe){z(oe)}},ce.prototype.getClusterChildren=function(me,z){try{z(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(oe){z(oe)}},ce.prototype.getClusterLeaves=function(me,z){try{z(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(oe){z(oe)}},ce}(Ye),Oi=function(X){var ce=this;this.self=X,this.actor=new p.Actor(X,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ye,geojson:Di},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(me,z){if(ce.workerSourceTypes[me])throw new Error('Worker source with name "'+me+'" already registered.');ce.workerSourceTypes[me]=z},this.self.registerRTLTextPlugin=function(me){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=me.applyArabicShaping,p.plugin.processBidirectionalText=me.processBidirectionalText,p.plugin.processStyledBidirectionalText=me.processStyledBidirectionalText}};return Oi.prototype.setReferrer=function(X,ce){this.referrer=ce},Oi.prototype.setImages=function(X,ce,me){for(var z in this.availableImages[X]=ce,this.workerSources[X]){var oe=this.workerSources[X][z];for(var ve in oe)oe[ve].availableImages=ce}me()},Oi.prototype.setLayers=function(X,ce,me){this.getLayerIndex(X).replace(ce),me()},Oi.prototype.updateLayers=function(X,ce,me){this.getLayerIndex(X).update(ce.layers,ce.removedIds),me()},Oi.prototype.loadTile=function(X,ce,me){this.getWorkerSource(X,ce.type,ce.source).loadTile(ce,me)},Oi.prototype.loadDEMTile=function(X,ce,me){this.getDEMWorkerSource(X,ce.source).loadTile(ce,me)},Oi.prototype.reloadTile=function(X,ce,me){this.getWorkerSource(X,ce.type,ce.source).reloadTile(ce,me)},Oi.prototype.abortTile=function(X,ce,me){this.getWorkerSource(X,ce.type,ce.source).abortTile(ce,me)},Oi.prototype.removeTile=function(X,ce,me){this.getWorkerSource(X,ce.type,ce.source).removeTile(ce,me)},Oi.prototype.removeDEMTile=function(X,ce){this.getDEMWorkerSource(X,ce.source).removeTile(ce)},Oi.prototype.removeSource=function(X,ce,me){if(this.workerSources[X]&&this.workerSources[X][ce.type]&&this.workerSources[X][ce.type][ce.source]){var z=this.workerSources[X][ce.type][ce.source];delete this.workerSources[X][ce.type][ce.source],z.removeSource!==void 0?z.removeSource(ce,me):me()}},Oi.prototype.loadWorkerSource=function(X,ce,me){try{this.self.importScripts(ce.url),me()}catch(z){me(z.toString())}},Oi.prototype.syncRTLPluginState=function(X,ce,me){try{p.plugin.setState(ce);var z=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&z!=null){this.self.importScripts(z);var oe=p.plugin.isParsed();me(oe?void 0:new Error("RTL Text Plugin failed to import scripts from "+z),oe)}}catch(ve){me(ve.toString())}},Oi.prototype.getAvailableImages=function(X){var ce=this.availableImages[X];return ce||(ce=[]),ce},Oi.prototype.getLayerIndex=function(X){var ce=this.layerIndexes[X];return ce||(ce=this.layerIndexes[X]=new Y),ce},Oi.prototype.getWorkerSource=function(X,ce,me){var z=this;return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][ce]||(this.workerSources[X][ce]={}),this.workerSources[X][ce][me]||(this.workerSources[X][ce][me]=new this.workerSourceTypes[ce]({send:function(oe,ve,Ae){z.actor.send(oe,ve,Ae,X)}},this.getLayerIndex(X),this.getAvailableImages(X))),this.workerSources[X][ce][me]},Oi.prototype.getDEMWorkerSource=function(X,ce){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][ce]||(this.demWorkerSources[X][ce]=new et),this.demWorkerSources[X][ce]},Oi.prototype.enforceCacheSizeLimit=function(X,ce){p.enforceCacheSizeLimit(ce)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Oi(self)),Oi}),C(["./shared"],function(p){"use strict";var A=p.createCommonjsModule(function(n){function u(g){return!a(g)}function a(g){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,D,H=new Blob([""],{type:"text/javascript"}),ae=URL.createObjectURL(H);try{D=new Worker(ae),P=!0}catch(be){P=!1}return D&&D.terminate(),URL.revokeObjectURL(ae),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var D=P.getContext("2d");if(!D)return!1;var H=D.getImageData(0,0,1,1);return H&&H.width===P.width}()?(h[b=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[b]=function(P){var D=function(ae){var be=document.createElement("canvas"),we=Object.create(u.webGLContextAttributes);return we.failIfMajorPerformanceCaveat=ae,be.probablySupportsContext?be.probablySupportsContext("webgl",we)||be.probablySupportsContext("experimental-webgl",we):be.supportsContext?be.supportsContext("webgl",we)||be.supportsContext("experimental-webgl",we):be.getContext("webgl",we)||be.getContext("experimental-webgl",we)}(P);if(!D)return!1;var H=D.createShader(D.VERTEX_SHADER);return!(!H||D.isContextLost())&&(D.shaderSource(H,"void main() {}"),D.compileShader(H),D.getShaderParameter(H,D.COMPILE_STATUS)===!0)}(b)),h[b]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var b}n.exports?n.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=a);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Q={create:function(n,u,a){var h=p.window.document.createElement(n);return u!==void 0&&(h.className=u),a&&a.appendChild(h),h},createNS:function(n,u){return p.window.document.createElementNS(n,u)}},Y=p.window.document&&p.window.document.documentElement.style;function W(n){if(!Y)return n[0];for(var u=0;u<n.length;u++)if(n[u]in Y)return n[u];return n[0]}var L,N=W(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Q.disableDrag=function(){Y&&N&&(L=Y[N],Y[N]="none")},Q.enableDrag=function(){Y&&N&&(Y[N]=L)};var Be=W(["transform","WebkitTransform"]);Q.setTransform=function(n,u){n.style[Be]=u};var Ye=!1;try{var Je=Object.defineProperty({},"passive",{get:function(){Ye=!0}});p.window.addEventListener("test",Je,Je),p.window.removeEventListener("test",Je,Je)}catch(n){Ye=!1}Q.addEventListener=function(n,u,a,h){h===void 0&&(h={}),n.addEventListener(u,a,"passive"in h&&Ye?h:h.capture)},Q.removeEventListener=function(n,u,a,h){h===void 0&&(h={}),n.removeEventListener(u,a,"passive"in h&&Ye?h:h.capture)};var et=function(n){n.preventDefault(),n.stopPropagation(),p.window.removeEventListener("click",et,!0)};function Yt(n){var u=n.userImage;return!!(u&&u.render&&u.render())&&(n.data.replace(new Uint8Array(u.data.buffer)),!0)}Q.suppressClick=function(){p.window.addEventListener("click",et,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",et,!0)},0)},Q.mousePos=function(n,u){var a=n.getBoundingClientRect();return new p.Point(u.clientX-a.left-n.clientLeft,u.clientY-a.top-n.clientTop)},Q.touchPos=function(n,u){for(var a=n.getBoundingClientRect(),h=[],g=0;g<u.length;g++)h.push(new p.Point(u[g].clientX-a.left-n.clientLeft,u[g].clientY-a.top-n.clientTop));return h},Q.mouseButton=function(n){return p.window.InstallTrigger!==void 0&&n.button===2&&n.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button},Q.remove=function(n){n.parentNode&&n.parentNode.removeChild(n)};var Gt=function(n){function u(){n.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(a){if(this.loaded!==a&&(this.loaded=a,a)){for(var h=0,g=this.requestors;h<g.length;h+=1){var b=g[h];this._notify(b.ids,b.callback)}this.requestors=[]}},u.prototype.getImage=function(a){return this.images[a]},u.prototype.addImage=function(a,h){this._validate(a,h)&&(this.images[a]=h)},u.prototype._validate=function(a,h){var g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchX" value'))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchY" value'))),g=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "content" value'))),g=!1),g},u.prototype._validateStretch=function(a,h){if(!a)return!0;for(var g=0,b=0,P=a;b<P.length;b+=1){var D=P[b];if(D[0]<g||D[1]<D[0]||h<D[1])return!1;g=D[1]}return!0},u.prototype._validateContent=function(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))},u.prototype.updateImage=function(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0},u.prototype.removeImage=function(a){var h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(a,h){var g=!0;if(!this.isLoaded())for(var b=0,P=a;b<P.length;b+=1)this.images[P[b]]||(g=!1);this.isLoaded()||g?this._notify(a,h):this.requestors.push({ids:a,callback:h})},u.prototype._notify=function(a,h){for(var g={},b=0,P=a;b<P.length;b+=1){var D=P[b];this.images[D]||this.fire(new p.Event("styleimagemissing",{id:D}));var H=this.images[D];H?g[D]={data:H.data.clone(),pixelRatio:H.pixelRatio,sdf:H.sdf,version:H.version,stretchX:H.stretchX,stretchY:H.stretchY,content:H.content,hasRenderCallback:Boolean(H.userImage&&H.userImage.render)}:p.warnOnce('Image "'+D+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,g)},u.prototype.getPixelSize=function(){var a=this.atlasImage;return{width:a.width,height:a.height}},u.prototype.getPattern=function(a){var h=this.patterns[a],g=this.getImage(a);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{var b={w:g.data.width+2,h:g.data.height+2,x:0,y:0},P=new p.ImagePosition(b,g);this.patterns[a]={bin:b,position:P}}return this._updatePatternAtlas(),this.patterns[a].position},u.prototype.bind=function(a){var h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var a=[];for(var h in this.patterns)a.push(this.patterns[h].bin);var g=p.potpack(a),b=g.w,P=g.h,D=this.atlasImage;for(var H in D.resize({width:b||1,height:P||1}),this.patterns){var ae=this.patterns[H].bin,be=ae.x+1,we=ae.y+1,Pe=this.images[H].data,We=Pe.width,Ve=Pe.height;p.RGBAImage.copy(Pe,D,{x:0,y:0},{x:be,y:we},{width:We,height:Ve}),p.RGBAImage.copy(Pe,D,{x:0,y:Ve-1},{x:be,y:we-1},{width:We,height:1}),p.RGBAImage.copy(Pe,D,{x:0,y:0},{x:be,y:we+Ve},{width:We,height:1}),p.RGBAImage.copy(Pe,D,{x:We-1,y:0},{x:be-1,y:we},{width:1,height:Ve}),p.RGBAImage.copy(Pe,D,{x:0,y:0},{x:be+We,y:we},{width:1,height:Ve})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(a){for(var h=0,g=a;h<g.length;h+=1){var b=g[h];if(!this.callbackDispatchedThisFrame[b]){this.callbackDispatchedThisFrame[b]=!0;var P=this.images[b];Yt(P)&&this.updateImage(b,P)}}},u}(p.Evented),tr=xt,zt=xt,Pt=1e20;function xt(n,u,a,h,g,b){this.fontSize=n||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=g||"sans-serif",this.fontWeight=b||"normal",this.radius=a||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function yr(n,u,a,h,g,b,P){for(var D=0;D<u;D++){for(var H=0;H<a;H++)h[H]=n[H*u+D];for(ee(h,g,b,P,a),H=0;H<a;H++)n[H*u+D]=g[H]}for(H=0;H<a;H++){for(D=0;D<u;D++)h[D]=n[H*u+D];for(ee(h,g,b,P,u),D=0;D<u;D++)n[H*u+D]=Math.sqrt(g[D])}}function ee(n,u,a,h,g){a[0]=0,h[0]=-Pt,h[1]=+Pt;for(var b=1,P=0;b<g;b++){for(var D=(n[b]+b*b-(n[a[P]]+a[P]*a[P]))/(2*b-2*a[P]);D<=h[P];)P--,D=(n[b]+b*b-(n[a[P]]+a[P]*a[P]))/(2*b-2*a[P]);a[++P]=b,h[P]=D,h[P+1]=+Pt}for(b=0,P=0;b<g;b++){for(;h[P+1]<b;)P++;u[b]=(b-a[P])*(b-a[P])+n[a[P]]}}xt.prototype.draw=function(n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(n,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),a=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var g=u.data[4*h+3]/255;this.gridOuter[h]=g===1?0:g===0?Pt:Math.pow(Math.max(0,.5-g),2),this.gridInner[h]=g===1?Pt:g===0?0:Math.pow(Math.max(0,g-.5),2)}for(yr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),yr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)a[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return a},tr.default=zt;var vr=function(n,u){this.requestManager=n,this.localIdeographFontFamily=u,this.entries={}};vr.prototype.setURL=function(n){this.url=n},vr.prototype.getGlyphs=function(n,u){var a=this,h=[];for(var g in n)for(var b=0,P=n[g];b<P.length;b+=1)h.push({stack:g,id:P[b]});p.asyncAll(h,function(D,H){var ae=D.stack,be=D.id,we=a.entries[ae];we||(we=a.entries[ae]={glyphs:{},requests:{},ranges:{}});var Pe=we.glyphs[be];if(Pe===void 0){if(Pe=a._tinySDF(we,ae,be))return we.glyphs[be]=Pe,void H(null,{stack:ae,id:be,glyph:Pe});var We=Math.floor(be/256);if(256*We>65535)H(new Error("glyphs > 65535 not supported"));else if(we.ranges[We])H(null,{stack:ae,id:be,glyph:Pe});else{var Ve=we.requests[We];Ve||(Ve=we.requests[We]=[],vr.loadGlyphRange(ae,We,a.url,a.requestManager,function(nt,ze){if(ze){for(var ot in ze)a._doesCharSupportLocalGlyph(+ot)||(we.glyphs[+ot]=ze[+ot]);we.ranges[We]=!0}for(var bt=0,Zt=Ve;bt<Zt.length;bt+=1)(0,Zt[bt])(nt,ze);delete we.requests[We]})),Ve.push(function(nt,ze){nt?H(nt):ze&&H(null,{stack:ae,id:be,glyph:ze[be]||null})})}}else H(null,{stack:ae,id:be,glyph:Pe})},function(D,H){if(D)u(D);else if(H){for(var ae={},be=0,we=H;be<we.length;be+=1){var Pe=we[be],We=Pe.stack,Ve=Pe.id,nt=Pe.glyph;(ae[We]||(ae[We]={}))[Ve]=nt&&{id:nt.id,bitmap:nt.bitmap.clone(),metrics:nt.metrics}}u(null,ae)}})},vr.prototype._doesCharSupportLocalGlyph=function(n){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](n)||p.isChar["Hangul Syllables"](n)||p.isChar.Hiragana(n)||p.isChar.Katakana(n))},vr.prototype._tinySDF=function(n,u,a){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(a)){var g=n.tinySDF;if(!g){var b="400";/bold/i.test(u)?b="900":/medium/i.test(u)?b="500":/light/i.test(u)&&(b="200"),g=n.tinySDF=new vr.TinySDF(24,3,8,.25,h,b)}return{id:a,bitmap:new p.AlphaImage({width:30,height:30},g.draw(String.fromCharCode(a))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},vr.loadGlyphRange=function(n,u,a,h,g){var b=256*u,P=b+255,D=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",n).replace("{range}",b+"-"+P),p.ResourceType.Glyphs);p.getArrayBuffer(D,function(H,ae){if(H)g(H);else if(ae){for(var be={},we=0,Pe=p.parseGlyphPBF(ae);we<Pe.length;we+=1){var We=Pe[we];be[We.id]=We}g(null,be)}})},vr.TinySDF=tr;var Ct=function(){this.specification=p.styleSpec.light.position};Ct.prototype.possiblyEvaluate=function(n,u){return p.sphericalToCartesian(n.expression.evaluate(u))},Ct.prototype.interpolate=function(n,u,a){return{x:p.number(n.x,u.x,a),y:p.number(n.y,u.y,a),z:p.number(n.z,u.z,a)}};var Ke=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new Ct,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),Rt=function(n){function u(a){n.call(this),this._transitionable=new p.Transitionable(Ke),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(a,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,a,h))for(var g in a){var b=a[g];p.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-"-transition".length),b):this._transitionable.setValue(g,b)}},u.prototype.updateTransitions=function(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(a){this.properties=this._transitioning.possiblyEvaluate(a)},u.prototype._validate=function(a,h,g){return(!g||g.validate!==!1)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},u}(p.Evented),Xe=function(n,u){this.width=n,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Xe.prototype.getDash=function(n,u){var a=n.join(",")+String(u);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(n,u)),this.dashEntry[a]},Xe.prototype.getDashRanges=function(n,u,a){var h=[],g=n.length%2==1?-n[n.length-1]*a:0,b=n[0]*a,P=!0;h.push({left:g,right:b,isDash:P,zeroLength:n[0]===0});for(var D=n[0],H=1;H<n.length;H++){var ae=n[H];h.push({left:g=D*a,right:b=(D+=ae)*a,isDash:P=!P,zeroLength:ae===0})}return h},Xe.prototype.addRoundDash=function(n,u,a){for(var h=u/2,g=-a;g<=a;g++)for(var b=this.width*(this.nextRow+a+g),P=0,D=n[P],H=0;H<this.width;H++){H/D.right>1&&(D=n[++P]);var ae=Math.abs(H-D.left),be=Math.abs(H-D.right),we=Math.min(ae,be),Pe=void 0,We=g/a*(h+1);if(D.isDash){var Ve=h-Math.abs(We);Pe=Math.sqrt(we*we+Ve*Ve)}else Pe=h-Math.sqrt(we*we+We*We);this.data[b+H]=Math.max(0,Math.min(255,Pe+128))}},Xe.prototype.addRegularDash=function(n){for(var u=n.length-1;u>=0;--u){var a=n[u],h=n[u+1];a.zeroLength?n.splice(u,1):h&&h.isDash===a.isDash&&(h.left=a.left,n.splice(u,1))}var g=n[0],b=n[n.length-1];g.isDash===b.isDash&&(g.left=b.left-this.width,b.right=g.right+this.width);for(var P=this.width*this.nextRow,D=0,H=n[D],ae=0;ae<this.width;ae++){ae/H.right>1&&(H=n[++D]);var be=Math.abs(ae-H.left),we=Math.abs(ae-H.right),Pe=Math.min(be,we);this.data[P+ae]=Math.max(0,Math.min(255,(H.isDash?Pe:-Pe)+128))}},Xe.prototype.addDash=function(n,u){var a=u?7:0,h=2*a+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var g=0,b=0;b<n.length;b++)g+=n[b];if(g!==0){var P=this.width/g,D=this.getDashRanges(n,this.width,P);u?this.addRoundDash(D,P,a):this.addRegularDash(D)}var H={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:g};return this.nextRow+=h,this.dirty=!0,H},Xe.prototype.bind=function(n){var u=n.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Ut=function n(u,a){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),g=0;g<h.length;g++){var b=new n.Actor(h[g],a,this.id);b.name="Worker "+g,this.actors.push(b)}};function _r(n,u,a){var h=function(g,b){if(g)return a(g);if(b){var P=p.pick(p.extend(b,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(P.vectorLayers=b.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(D){return D.id})),P.tiles=u.canonicalizeTileset(P,n.url),a(null,P)}};return n.url?p.getJSON(u.transformRequest(u.normalizeSourceURL(n.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,n)})}Ut.prototype.broadcast=function(n,u,a){p.asyncAll(this.actors,function(h,g){h.send(n,u,g)},a=a||function(){})},Ut.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ut.prototype.remove=function(){this.actors.forEach(function(n){n.remove()}),this.actors=[],this.workerPool.release(this.id)},Ut.Actor=p.Actor;var or=function(n,u,a){this.bounds=p.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=u||0,this.maxzoom=a||24};or.prototype.validateBounds=function(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]},or.prototype.contains=function(n){var u=Math.pow(2,n.z),a=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),g=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),b=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return n.x>=a&&n.x<g&&n.y>=h&&n.y<b};var zr=function(n){function u(a,h,g,b){if(n.call(this),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_r(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new or(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles,a.map._requestManager._customAccessToken),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken,a.map._requestManager._customAccessToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setSourceProperty=function(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(a){var h=this;return this.setSourceProperty(function(){h._options.tiles=a}),this},u.prototype.setUrl=function(a){var h=this;return this.setSourceProperty(function(){h.url=a,h._options.url=a}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(D,H){return delete a.request,a.aborted?h(null):D&&D.status!==404?h(D):(H&&H.resourceTiming&&(a.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&a.setExpiryData(H),a.loadVectorData(H,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}b.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",b,P.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",b,P.bind(this)))},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(p.Evented),he=function(n){function u(a,h,g,b){n.call(this),this.id=a,this.dispatcher=g,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_r(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new or(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.loadTile=function(a,h){var g=this,b=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);a.request=p.getImage(this.map._requestManager.transformRequest(b,p.ResourceType.Tile),function(P,D){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(P)a.state="errored",h(P);else if(D){g.map._refreshExpiredTiles&&a.setExpiryData(D),delete D.cacheControl,delete D.expires;var H=g.map.painter.context,ae=H.gl;a.texture=g.map.painter.getTileTexture(D.width),a.texture?a.texture.update(D,{useMipmap:!0}):(a.texture=new p.Texture(H,D,ae.RGBA,{useMipmap:!0}),a.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE,ae.LINEAR_MIPMAP_NEAREST),H.extTextureFilterAnisotropic&&ae.texParameterf(ae.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax)),a.state="loaded",p.cacheEntryPossiblyAdded(g.dispatcher),h(null)}})},u.prototype.abortTile=function(a,h){a.request&&(a.request.cancel(),delete a.request),h()},u.prototype.unloadTile=function(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Re=function(n){function u(a,h,g,b){n.call(this,a,h,g,b),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function b(P,D){P&&(a.state="errored",h(P)),D&&(a.dem=D,a.needsHillshadePrepare=!0,a.state="loaded",h(null))}a.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(P,D){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(P)a.state="errored",h(P);else if(D){this.map._refreshExpiredTiles&&a.setExpiryData(D),delete D.cacheControl,delete D.expires;var H=p.window.ImageBitmap&&D instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?D:p.browser.getImageData(D,1),ae={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:H,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",ae,b.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)},u.prototype._getNeighboringTiles=function(a){var h=a.canonical,g=Math.pow(2,h.z),b=(h.x-1+g)%g,P=h.x===0?a.wrap-1:a.wrap,D=(h.x+1+g)%g,H=h.x+1===g?a.wrap+1:a.wrap,ae={};return ae[new p.OverscaledTileID(a.overscaledZ,P,h.z,b,h.y).key]={backfilled:!1},ae[new p.OverscaledTileID(a.overscaledZ,H,h.z,D,h.y).key]={backfilled:!1},h.y>0&&(ae[new p.OverscaledTileID(a.overscaledZ,P,h.z,b,h.y-1).key]={backfilled:!1},ae[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},ae[new p.OverscaledTileID(a.overscaledZ,H,h.z,D,h.y-1).key]={backfilled:!1}),h.y+1<g&&(ae[new p.OverscaledTileID(a.overscaledZ,P,h.z,b,h.y+1).key]={backfilled:!1},ae[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},ae[new p.OverscaledTileID(a.overscaledZ,H,h.z,D,h.y+1).key]={backfilled:!1}),ae},u.prototype.unloadTile=function(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})},u}(he),ye=function(n){function u(a,h,g,b){n.call(this),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(b),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var P=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*P,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*P,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*P,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)a.fire(new p.ErrorEvent(h));else{var g={dataType:"source",sourceDataType:"metadata"};a._collectResourceTiming&&a._resourceTiming&&a._resourceTiming.length>0&&(g.resourceTiming=a._resourceTiming,a._resourceTiming=[]),a.fire(new p.Event("data",g))}})},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setData=function(a){var h=this;return this._data=a,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new p.ErrorEvent(g));else{var b={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(b.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",b))}}),this},u.prototype.getClusterExpansionZoom=function(a,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},h),this},u.prototype.getClusterChildren=function(a,h){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},h),this},u.prototype.getClusterLeaves=function(a,h,g,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:h,offset:g},b),this},u.prototype._updateWorkerData=function(a){var h=this;this._loaded=!1;var g=p.extend({},this.workerOptions),b=this._data;typeof b=="string"?(g.request=this.map._requestManager.transformRequest(p.browser.resolveURL(b),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(b),this.actor.send(this.type+".loadData",g,function(P,D){h._removed||D&&D.abandoned||(h._loaded=!0,D&&D.resourceTiming&&D.resourceTiming[h.id]&&(h._resourceTiming=D.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:g.source},null),a(P))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(a,h){var g=this,b=a.actor?"reloadTile":"loadTile";a.actor=this.actor,a.request=this.actor.send(b,{type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,D){return delete a.request,a.unloadVectorData(),a.aborted?h(null):P?h(P):(a.loadVectorData(D,g.map.painter,b==="reloadTile"),h(null))})},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0},u.prototype.unloadTile=function(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(p.Evented),_t=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ft=function(n){function u(a,h,g,b){n.call(this),this.id=a,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(a,h){var g=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(b,P){g._loaded=!0,b?g.fire(new p.ErrorEvent(b)):P&&(g.image=P,a&&(g.coordinates=a),h&&h(),g._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(a){var h=this;return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setCoordinates=function(a){var h=this;this.coordinates=a;var g=a.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var D=1/0,H=1/0,ae=-1/0,be=-1/0,we=0,Pe=P;we<Pe.length;we+=1){var We=Pe[we];D=Math.min(D,We.x),H=Math.min(H,We.y),ae=Math.max(ae,We.x),be=Math.max(be,We.y)}var Ve=Math.max(ae-D,be-H),nt=Math.max(0,Math.floor(-Math.log(Ve)/Math.LN2)),ze=Math.pow(2,nt);return new p.CanonicalTileID(nt,Math.floor((D+ae)/2*ze),Math.floor((H+be)/2*ze))}(g),this.minzoom=this.maxzoom=this.tileID.z;var b=g.map(function(P){return h.tileID.getTilePoint(P)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(b[0].x,b[0].y,0,0),this._boundsArray.emplaceBack(b[1].x,b[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(b[3].x,b[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(b[2].x,b[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.loadTile=function(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Nt=function(n){function u(a,h,g,b){n.call(this,a,h,g,b),this.roundZoom=!0,this.type="video",this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1;var h=this.options;this.urls=[];for(var g=0,b=h.urls;g<b.length;g+=1)this.urls.push(this.map._requestManager.transformRequest(b[g],p.ResourceType.Source).url);p.getVideo(this.urls,function(P,D){a._loaded=!0,P?a.fire(new p.ErrorEvent(P)):D&&(a.video=D,a.video.loop=!0,a.video.addEventListener("playing",function(){a.map.triggerRepaint()}),a.map&&a.video.play(),a._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(a){if(this.video){var h=this.video.seekable;a<h.start(0)||a>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=a}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(a,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(ft),Ft=function(n){function u(a,h,g,b){n.call(this,a,h,g,b),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(D){return typeof D!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,g=h.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,g.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[b];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var a=0,h=[this.canvas.width,this.canvas.height];a<h.length;a+=1){var g=h[a];if(isNaN(g)||g<=0)return!0}return!1},u}(ft),kr={vector:zr,raster:he,"raster-dem":Re,geojson:ye,video:Nt,image:ft,canvas:Ft};function cn(n,u){var a=p.identity([]);return p.translate(a,a,[1,1,0]),p.scale(a,a,[.5*n.width,.5*n.height,1]),p.multiply(a,a,n.calculatePosMatrix(u.toUnwrapped()))}function yn(n,u,a,h,g,b){var P=function(nt,ze,ot){if(nt)for(var bt=0,Zt=nt;bt<Zt.length;bt+=1){var hr=ze[Zt[bt]];if(hr&&hr.source===ot&&hr.type==="fill-extrusion")return!0}else for(var ur in ze){var gr=ze[ur];if(gr.source===ot&&gr.type==="fill-extrusion")return!0}return!1}(g&&g.layers,u,n.id),D=b.maxPitchScaleFactor(),H=n.tilesIn(h,D,P);H.sort(Vi);for(var ae=[],be=0,we=H;be<we.length;be+=1){var Pe=we[be];ae.push({wrappedTileID:Pe.tileID.wrapped().key,queryResults:Pe.tile.queryRenderedFeatures(u,a,n._state,Pe.queryGeometry,Pe.cameraQueryGeometry,Pe.scale,g,b,D,cn(n.transform,Pe.tileID))})}var We=function(nt){for(var ze={},ot={},bt=0,Zt=nt;bt<Zt.length;bt+=1){var hr=Zt[bt],ur=hr.queryResults,gr=hr.wrappedTileID,Nr=ot[gr]=ot[gr]||{};for(var an in ur)for(var Hr=ur[an],In=Nr[an]=Nr[an]||{},ni=ze[an]=ze[an]||[],hi=0,ii=Hr;hi<ii.length;hi+=1){var ea=ii[hi];In[ea.featureIndex]||(In[ea.featureIndex]=!0,ni.push(ea))}}return ze}(ae);for(var Ve in We)We[Ve].forEach(function(nt){var ze=nt.feature,ot=n.getFeatureState(ze.layer["source-layer"],ze.id);ze.source=ze.layer.source,ze.layer["source-layer"]&&(ze.sourceLayer=ze.layer["source-layer"]),ze.state=ot});return We}function Vi(n,u){var a=n.tileID,h=u.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}var ir=function(n,u){this.max=n,this.onRemove=u,this.reset()};ir.prototype.reset=function(){for(var n in this.data)for(var u=0,a=this.data[n];u<a.length;u+=1){var h=a[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},ir.prototype.add=function(n,u,a){var h=this,g=n.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);var b={value:u,timeout:void 0};if(a!==void 0&&(b.timeout=setTimeout(function(){h.remove(n,b)},a)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},ir.prototype.has=function(n){return n.wrapped().key in this.data},ir.prototype.getAndRemove=function(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null},ir.prototype._getAndRemoveByKey=function(n){var u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value},ir.prototype.getByKey=function(n){var u=this.data[n];return u?u[0].value:null},ir.prototype.get=function(n){return this.has(n)?this.data[n.wrapped().key][0].value:null},ir.prototype.remove=function(n,u){if(!this.has(n))return this;var a=n.wrapped().key,h=u===void 0?0:this.data[a].indexOf(u),g=this.data[a][h];return this.data[a].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(g.value),this.order.splice(this.order.indexOf(a),1),this},ir.prototype.setMaxSize=function(n){for(this.max=n;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},ir.prototype.filter=function(n){var u=[];for(var a in this.data)for(var h=0,g=this.data[a];h<g.length;h+=1){var b=g[h];n(b.value)||u.push(b)}for(var P=0,D=u;P<D.length;P+=1){var H=D[P];this.remove(H.value.tileID,H)}};var de=function(n,u,a){this.context=n;var h=n.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};de.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},de.prototype.updateData=function(n){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)},de.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Te={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ue=function(n,u,a,h){this.length=u.length,this.attributes=a,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=n;var g=n.gl;this.buffer=g.createBuffer(),n.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Ue.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ue.prototype.updateData=function(n){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)},Ue.prototype.enableAttributes=function(n,u){for(var a=0;a<this.attributes.length;a++){var h=u.attributes[this.attributes[a].name];h!==void 0&&n.enableVertexAttribArray(h)}},Ue.prototype.setVertexAttribPointers=function(n,u,a){for(var h=0;h<this.attributes.length;h++){var g=this.attributes[h],b=u.attributes[g.name];b!==void 0&&n.vertexAttribPointer(b,g.components,n[Te[g.type]],!1,this.itemSize,g.offset+this.itemSize*(a||0))}},Ue.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Le=function(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Le.prototype.get=function(){return this.current},Le.prototype.set=function(n){},Le.prototype.getDefault=function(){return this.default},Le.prototype.setDefault=function(){this.set(this.default)};var kt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(Le),er=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)},u}(Le),w=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)},u}(Le),Z=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(Le),Ee=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)},u}(Le),je=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)},u}(Le),Qe=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(a){var h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)},u}(Le),yt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)},u}(Le),St=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}},u}(Le),jt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)},u}(Le),Et=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}},u}(Le),Qt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)},u}(Le),ie=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}},u}(Le),sr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.ONE,a.ZERO]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)},u}(Le),Br=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(Le),Lr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)},u}(Le),rt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}},u}(Le),gt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)},u}(Le),pt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)},u}(Le),dr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)},u}(Le),Vr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)},u}(Le),Ur=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(Le),nn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}},u}(Le),Jr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(Le),Cr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}},u}(Le),kn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}},u}(Le),Zn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1},u}(Le),Si=function(n){function u(a){n.call(this,a),this.vao=a.extVertexArrayObject}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)},u}(Le),zi=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}},u}(Le),Ji=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}},u}(Le),Di=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}},u}(Le),Oi=function(n){function u(a,h){n.call(this,a),this.context=a,this.parent=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Le),X=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}},u}(Oi),ce=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(Oi),me=function(n,u,a,h){this.context=n,this.width=u,this.height=a;var g=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new X(n,g),h&&(this.depthAttachment=new ce(n,g))};me.prototype.destroy=function(){var n=this.context.gl,u=this.colorAttachment.get();if(u&&n.deleteTexture(u),this.depthAttachment){var a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}n.deleteFramebuffer(this.framebuffer)};var z=function(n,u,a){this.func=n,this.mask=u,this.range=a};z.ReadOnly=!1,z.ReadWrite=!0,z.disabled=new z(519,z.ReadOnly,[0,1]);var oe=function(n,u,a,h,g,b){this.test=n,this.ref=u,this.mask=a,this.fail=h,this.depthFail=g,this.pass=b};oe.disabled=new oe({func:519,mask:0},0,0,7680,7680,7680);var ve=function(n,u,a){this.blendFunction=n,this.blendColor=u,this.mask=a};ve.disabled=new ve(ve.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),ve.unblended=new ve(ve.Replace,p.Color.transparent,[!0,!0,!0,!0]),ve.alphaBlended=new ve([1,771],p.Color.transparent,[!0,!0,!0,!0]);var Ae=function(n,u,a){this.enable=n,this.mode=u,this.frontFace=a};Ae.disabled=new Ae(!1,1029,2305),Ae.backCCW=new Ae(!0,1029,2305);var se=function(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new kt(this),this.clearDepth=new er(this),this.clearStencil=new w(this),this.colorMask=new Z(this),this.depthMask=new Ee(this),this.stencilMask=new je(this),this.stencilFunc=new Qe(this),this.stencilOp=new yt(this),this.stencilTest=new St(this),this.depthRange=new jt(this),this.depthTest=new Et(this),this.depthFunc=new Qt(this),this.blend=new ie(this),this.blendFunc=new sr(this),this.blendColor=new Br(this),this.blendEquation=new Lr(this),this.cullFace=new rt(this),this.cullFaceSide=new gt(this),this.frontFace=new pt(this),this.program=new dr(this),this.activeTexture=new Vr(this),this.viewport=new Ur(this),this.bindFramebuffer=new nn(this),this.bindRenderbuffer=new Jr(this),this.bindTexture=new Cr(this),this.bindVertexBuffer=new kn(this),this.bindElementBuffer=new Zn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Si(this),this.pixelStoreUnpack=new zi(this),this.pixelStoreUnpackPremultiplyAlpha=new Ji(this),this.pixelStoreUnpackFlipY=new Di(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)};se.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},se.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},se.prototype.createIndexBuffer=function(n,u){return new de(this,n,u)},se.prototype.createVertexBuffer=function(n,u,a){return new Ue(this,n,u,a)},se.prototype.createRenderbuffer=function(n,u,a){var h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,n,u,a),this.bindRenderbuffer.set(null),g},se.prototype.createFramebuffer=function(n,u,a){return new me(this,n,u,a)},se.prototype.clear=function(n){var u=n.color,a=n.depth,h=this.gl,g=0;u&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h.clear(g)},se.prototype.setCullFace=function(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))},se.prototype.setDepthMode=function(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)},se.prototype.setStencilMode=function(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)},se.prototype.setColorMode=function(n){p.deepEqual(n.blendFunction,ve.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)},se.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ce=function(n){function u(a,h,g){var b=this;n.call(this),this.id=a,this.dispatcher=g,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(b._sourceLoaded=!0),b._sourceLoaded&&!b._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(b.reload(),b.transform&&b.update(b.transform))}),this.on("error",function(){b._sourceErrored=!0}),this._source=function(P,D,H,ae){var be=new kr[D.type](P,D,H,ae);if(be.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+be.id);return p.bindAll(["load","abort","unload","serialize","prepare"],be),be}(a,h,g,this),this._tiles={},this._cache=new ir(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)},u.prototype.onRemove=function(a){this._source&&this._source.onRemove&&this._source.onRemove(a)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var a in this._tiles){var h=this._tiles[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(a,h){return this._source.loadTile(a,h)},u.prototype._unloadTile=function(a){if(this._source.unloadTile)return this._source.unloadTile(a,function(){})},u.prototype._abortTile=function(a){if(this._source.abortTile)return this._source.abortTile(a,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(a){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var g=this._tiles[h];g.upload(a),g.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return p.values(this._tiles).map(function(a){return a.tileID}).sort(ct).map(function(a){return a.key})},u.prototype.getRenderableIds=function(a){var h=this,g=[];for(var b in this._tiles)this._isIdRenderable(b,a)&&g.push(this._tiles[b]);return a?g.sort(function(P,D){var H=P.tileID,ae=D.tileID,be=new p.Point(H.canonical.x,H.canonical.y)._rotate(h.transform.angle),we=new p.Point(ae.canonical.x,ae.canonical.y)._rotate(h.transform.angle);return H.overscaledZ-ae.overscaledZ||we.y-be.y||we.x-be.x}).map(function(P){return P.tileID.key}):g.map(function(P){return P.tileID}).sort(ct).map(function(P){return P.key})},u.prototype.hasRenderableParent=function(a){var h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(a,h){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var a in this._cache.reset(),this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")},u.prototype._reloadTile=function(a,h){var g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,a,h)))},u.prototype._tileLoaded=function(a,h,g,b){if(b)return a.state="errored",void(b.status!==404?this._source.fire(new p.ErrorEvent(b,{tile:a})):this.update(this.transform));a.timeAdded=p.browser.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:a,coord:a.tileID}))},u.prototype._backfillDEM=function(a){for(var h=this.getRenderableIds(),g=0;g<h.length;g++){var b=h[g];if(a.neighboringTiles&&a.neighboringTiles[b]){var P=this.getTileByID(b);D(a,P),D(P,a)}}function D(H,ae){H.needsHillshadePrepare=!0;var be=ae.tileID.canonical.x-H.tileID.canonical.x,we=ae.tileID.canonical.y-H.tileID.canonical.y,Pe=Math.pow(2,H.tileID.canonical.z),We=ae.tileID.key;be===0&&we===0||Math.abs(we)>1||(Math.abs(be)>1&&(Math.abs(be+Pe)===1?be+=Pe:Math.abs(be-Pe)===1&&(be-=Pe)),ae.dem&&H.dem&&(H.dem.backfillBorder(ae.dem,be,we),H.neighboringTiles&&H.neighboringTiles[We]&&(H.neighboringTiles[We].backfilled=!0)))}},u.prototype.getTile=function(a){return this.getTileByID(a.key)},u.prototype.getTileByID=function(a){return this._tiles[a]},u.prototype._retainLoadedChildren=function(a,h,g,b){for(var P in this._tiles){var D=this._tiles[P];if(!(b[P]||!D.hasData()||D.tileID.overscaledZ<=h||D.tileID.overscaledZ>g)){for(var H=D.tileID;D&&D.tileID.overscaledZ>h+1;){var ae=D.tileID.scaledTo(D.tileID.overscaledZ-1);(D=this._tiles[ae.key])&&D.hasData()&&(H=ae)}for(var be=H;be.overscaledZ>h;)if(a[(be=be.scaledTo(be.overscaledZ-1)).key]){b[H.key]=H;break}}}},u.prototype.findLoadedParent=function(a,h){if(a.key in this._loadedParentTiles){var g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=h?g:null}for(var b=a.overscaledZ-1;b>=h;b--){var P=a.scaledTo(b),D=this._getLoadedTile(P);if(D)return D}},u.prototype._getLoadedTile=function(a){var h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(a.wrapped().key)},u.prototype.updateCacheSize=function(a){var h=Math.ceil(a.width/this._source.tileSize)+1,g=Math.ceil(a.height/this._source.tileSize)+1,b=Math.floor(h*g*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(P)},u.prototype.handleWrapJump=function(a){var h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){var g={};for(var b in this._tiles){var P=this._tiles[b];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),g[P.tileID.key]=P}for(var D in this._tiles=g,this._timers)clearTimeout(this._timers[D]),delete this._timers[D];for(var H in this._tiles)this._setTileReloadTimer(H,this._tiles[H])}},u.prototype.update=function(a){var h=this;if(this.transform=a,this._sourceLoaded&&!this._paused){var g;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?g=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Nr){return new p.OverscaledTileID(Nr.canonical.z,Nr.wrap,Nr.canonical.z,Nr.canonical.x,Nr.canonical.y)}):(g=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(g=g.filter(function(Nr){return h._source.hasTile(Nr)}))):g=[];var b=a.coveringZoomLevel(this._source),P=Math.max(b-u.maxOverzooming,this._source.minzoom),D=Math.max(b+u.maxUnderzooming,this._source.minzoom),H=this._updateRetainedTiles(g,b);if(xr(this._source.type)){for(var ae={},be={},we=0,Pe=Object.keys(H);we<Pe.length;we+=1){var We=Pe[we],Ve=H[We],nt=this._tiles[We];if(nt&&!(nt.fadeEndTime&&nt.fadeEndTime<=p.browser.now())){var ze=this.findLoadedParent(Ve,P);ze&&(this._addTile(ze.tileID),ae[ze.tileID.key]=ze.tileID),be[We]=Ve}}for(var ot in this._retainLoadedChildren(be,b,D,H),ae)H[ot]||(this._coveredTiles[ot]=!0,H[ot]=ae[ot])}for(var bt in H)this._tiles[bt].clearFadeHold();for(var Zt=0,hr=p.keysDifference(this._tiles,H);Zt<hr.length;Zt+=1){var ur=hr[Zt],gr=this._tiles[ur];gr.hasSymbolBuckets&&!gr.holdingForFade()?gr.setHoldDuration(this.map._fadeDuration):gr.hasSymbolBuckets&&!gr.symbolFadeFinished()||this._removeTile(ur)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)},u.prototype._updateRetainedTiles=function(a,h){for(var g={},b={},P=Math.max(h-u.maxOverzooming,this._source.minzoom),D=Math.max(h+u.maxUnderzooming,this._source.minzoom),H={},ae=0,be=a;ae<be.length;ae+=1){var we=be[ae],Pe=this._addTile(we);g[we.key]=we,Pe.hasData()||h<this._source.maxzoom&&(H[we.key]=we)}this._retainLoadedChildren(H,h,D,g);for(var We=0,Ve=a;We<Ve.length;We+=1){var nt=Ve[We],ze=this._tiles[nt.key];if(!ze.hasData()){if(h+1>this._source.maxzoom){var ot=nt.children(this._source.maxzoom)[0],bt=this.getTile(ot);if(bt&&bt.hasData()){g[ot.key]=ot;continue}}else{var Zt=nt.children(this._source.maxzoom);if(g[Zt[0].key]&&g[Zt[1].key]&&g[Zt[2].key]&&g[Zt[3].key])continue}for(var hr=ze.wasRequested(),ur=nt.overscaledZ-1;ur>=P;--ur){var gr=nt.scaledTo(ur);if(b[gr.key]||(b[gr.key]=!0,!(ze=this.getTile(gr))&&hr&&(ze=this._addTile(gr)),ze&&(g[gr.key]=gr,hr=ze.wasRequested(),ze.hasData())))break}}}return g},u.prototype._updateLoadedParentTileCache=function(){for(var a in this._loadedParentTiles={},this._tiles){for(var h=[],g=void 0,b=this._tiles[a].tileID;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){g=this._loadedParentTiles[b.key];break}h.push(b.key);var P=b.scaledTo(b.overscaledZ-1);if(g=this._getLoadedTile(P))break;b=P}for(var D=0,H=h;D<H.length;D+=1)this._loadedParentTiles[H[D]]=g}},u.prototype._addTile=function(a){var h=this._tiles[a.key];if(h)return h;(h=this._cache.getAndRemove(a))&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));var g=Boolean(h);return g||(h=new p.Tile(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))),h?(h.uses++,this._tiles[a.key]=h,g||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(a,h){var g=this;a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);var b=h.getExpiryTimeout();b&&(this._timers[a]=setTimeout(function(){g._reloadTile(a,"expired"),delete g._timers[a]},b))},u.prototype._removeTile=function(a){var h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var a in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(a);this._cache.reset()},u.prototype.tilesIn=function(a,h,g){var b=this,P=[],D=this.transform;if(!D)return P;for(var H=g?D.getCameraQueryGeometry(a):a,ae=a.map(function(ur){return D.pointCoordinate(ur)}),be=H.map(function(ur){return D.pointCoordinate(ur)}),we=this.getIds(),Pe=1/0,We=1/0,Ve=-1/0,nt=-1/0,ze=0,ot=be;ze<ot.length;ze+=1){var bt=ot[ze];Pe=Math.min(Pe,bt.x),We=Math.min(We,bt.y),Ve=Math.max(Ve,bt.x),nt=Math.max(nt,bt.y)}for(var Zt=function(ur){var gr=b._tiles[we[ur]];if(!gr.holdingForFade()){var Nr=gr.tileID,an=Math.pow(2,D.zoom-gr.tileID.overscaledZ),Hr=h*gr.queryPadding*p.EXTENT/gr.tileSize/an,In=[Nr.getTilePoint(new p.MercatorCoordinate(Pe,We)),Nr.getTilePoint(new p.MercatorCoordinate(Ve,nt))];if(In[0].x-Hr<p.EXTENT&&In[0].y-Hr<p.EXTENT&&In[1].x+Hr>=0&&In[1].y+Hr>=0){var ni=ae.map(function(ii){return Nr.getTilePoint(ii)}),hi=be.map(function(ii){return Nr.getTilePoint(ii)});P.push({tile:gr,tileID:Nr,queryGeometry:ni,cameraQueryGeometry:hi,scale:an})}}},hr=0;hr<we.length;hr++)Zt(hr);return P},u.prototype.getVisibleCoordinates=function(a){for(var h=this,g=this.getRenderableIds(a).map(function(H){return h._tiles[H].tileID}),b=0,P=g;b<P.length;b+=1){var D=P[b];D.posMatrix=this.transform.calculatePosMatrix(D.toUnwrapped())}return g},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(xr(this._source.type))for(var a in this._tiles){var h=this._tiles[a];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},u.prototype.setFeatureState=function(a,h,g){this._state.updateState(a=a||"_geojsonTileLayer",h,g)},u.prototype.removeFeatureState=function(a,h,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,g)},u.prototype.getFeatureState=function(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(a,h,g){var b=this._tiles[a];b&&b.setDependencies(h,g)},u.prototype.reloadTilesForDependencies=function(a,h){for(var g in this._tiles)this._tiles[g].hasDependency(a,h)&&this._reloadTile(g,"reloading");this._cache.filter(function(b){return!b.hasDependency(a,h)})},u}(p.Evented);function ct(n,u){var a=Math.abs(2*n.wrap)-+(n.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return n.overscaledZ-u.overscaledZ||h-a||u.canonical.y-n.canonical.y||u.canonical.x-n.canonical.x}function xr(n){return n==="raster"||n==="image"||n==="video"}function Ht(){return new p.window.Worker($u.workerUrl)}Ce.maxOverzooming=10,Ce.maxUnderzooming=3;var Jt="mapboxgl_preloaded_worker_pool",Rr=function(){this.active={}};Rr.prototype.acquire=function(n){if(!this.workers)for(this.workers=[];this.workers.length<Rr.workerCount;)this.workers.push(new Ht);return this.active[n]=!0,this.workers.slice()},Rr.prototype.release=function(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Rr.prototype.isPreloaded=function(){return!!this.active[Jt]},Rr.prototype.numActive=function(){return Object.keys(this.active).length};var Mn,Pn=Math.floor(p.browser.hardwareConcurrency/2);function $t(){return Mn||(Mn=new Rr),Mn}function En(n,u){var a={};for(var h in n)h!=="ref"&&(a[h]=n[h]);return p.refProperties.forEach(function(g){g in u&&(a[g]=u[g])}),a}function on(n){n=n.slice();for(var u=Object.create(null),a=0;a<n.length;a++)u[n[a].id]=n[a];for(var h=0;h<n.length;h++)"ref"in n[h]&&(n[h]=En(n[h],u[n[h].ref]));return n}Rr.workerCount=Math.max(Math.min(Pn,6),1);var ln={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ai(n,u,a){a.push({command:ln.addSource,args:[n,u[n]]})}function bn(n,u,a){u.push({command:ln.removeSource,args:[n]}),a[n]=!0}function Li(n,u,a,h){bn(n,a,h),Ai(n,u,a)}function Yi(n,u,a){var h;for(h in n[a])if(n[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],u[a][h]))return!1;for(h in u[a])if(u[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],u[a][h]))return!1;return!0}function si(n,u,a,h,g,b){var P;for(P in u=u||{},n=n||{})n.hasOwnProperty(P)&&(p.deepEqual(n[P],u[P])||a.push({command:b,args:[h,P,u[P],g]}));for(P in u)u.hasOwnProperty(P)&&!n.hasOwnProperty(P)&&(p.deepEqual(n[P],u[P])||a.push({command:b,args:[h,P,u[P],g]}))}function Ki(n){return n.id}function Ni(n,u){return n[u.id]=u,n}var Ti=function(n,u){this.reset(n,u)};Ti.prototype.reset=function(n,u){this.points=n||[],this._distances=[0];for(var a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Ti.prototype.lerp=function(n){if(this.points.length===1)return this.points[0];n=p.clamp(n,0,1);for(var u=1,a=this._distances[u],h=n*this.paddedLength+this.padding;a<h&&u<this._distances.length;)a=this._distances[++u];var g=u-1,b=this._distances[g],P=a-b,D=P>0?(h-b)/P:0;return this.points[g].mult(1-D).add(this.points[u].mult(D))};var ca=function(n,u,a){var h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(n/a),this.yCellCount=Math.ceil(u/a);for(var b=0;b<this.xCellCount*this.yCellCount;b++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Sa(n,u,a,h,g){var b=p.create();return u?(p.scale(b,b,[1/g,1/g,1]),a||p.rotateZ(b,b,h.angle)):p.multiply(b,h.labelPlaneMatrix,n),b}function oi(n,u,a,h,g){if(u){var b=p.clone(n);return p.scale(b,b,[g,g,1]),a||p.rotateZ(b,b,-h.angle),b}return h.glCoordMatrix}function ri(n,u){var a=[n.x,n.y,0,1];Ya(a,a,u);var h=a[3];return{point:new p.Point(a[0]/h,a[1]/h),signedDistanceFromCamera:h}}function Gi(n,u){return .5+n/u*.5}function pa(n,u){var a=n[0]/n[3],h=n[1]/n[3];return a>=-u[0]&&a<=u[0]&&h>=-u[1]&&h<=u[1]}function Ho(n,u,a,h,g,b,P,D){var H=h?n.textSizeData:n.iconSizeData,ae=p.evaluateSizeForZoom(H,a.transform.zoom),be=[256/a.width*2+1,256/a.height*2+1],we=h?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;we.clear();for(var Pe=n.lineVertexArray,We=h?n.text.placedSymbolArray:n.icon.placedSymbolArray,Ve=a.transform.width/a.transform.height,nt=!1,ze=0;ze<We.length;ze++){var ot=We.get(ze);if(ot.hidden||ot.writingMode===p.WritingMode.vertical&&!nt)Xa(ot.numGlyphs,we);else{nt=!1;var bt=[ot.anchorX,ot.anchorY,0,1];if(p.transformMat4(bt,bt,u),pa(bt,be)){var Zt=Gi(a.transform.cameraToCenterDistance,bt[3]),hr=p.evaluateSizeForFeature(H,ae,ot),ur=P?hr/Zt:hr*Zt,gr=new p.Point(ot.anchorX,ot.anchorY),Nr=ri(gr,g).point,an={},Hr=ga(ot,ur,!1,D,u,g,b,n.glyphOffsetArray,Pe,we,Nr,gr,an,Ve);nt=Hr.useVertical,(Hr.notEnoughRoom||nt||Hr.needsFlipping&&ga(ot,ur,!0,D,u,g,b,n.glyphOffsetArray,Pe,we,Nr,gr,an,Ve).notEnoughRoom)&&Xa(ot.numGlyphs,we)}else Xa(ot.numGlyphs,we)}}h?n.text.dynamicLayoutVertexBuffer.updateData(we):n.icon.dynamicLayoutVertexBuffer.updateData(we)}function ya(n,u,a,h,g,b,P,D,H,ae,be){var we=D.glyphStartIndex+D.numGlyphs,Pe=D.lineStartIndex,We=D.lineStartIndex+D.lineLength,Ve=u.getoffsetX(D.glyphStartIndex),nt=u.getoffsetX(we-1),ze=Ea(n*Ve,a,h,g,b,P,D.segment,Pe,We,H,ae,be);if(!ze)return null;var ot=Ea(n*nt,a,h,g,b,P,D.segment,Pe,We,H,ae,be);return ot?{first:ze,last:ot}:null}function yi(n,u,a,h){return n===p.WritingMode.horizontal&&Math.abs(a.y-u.y)>Math.abs(a.x-u.x)*h?{useVertical:!0}:(n===p.WritingMode.vertical?u.y<a.y:u.x>a.x)?{needsFlipping:!0}:null}function ga(n,u,a,h,g,b,P,D,H,ae,be,we,Pe,We){var Ve,nt=u/24,ze=n.lineOffsetX*nt,ot=n.lineOffsetY*nt;if(n.numGlyphs>1){var bt=n.glyphStartIndex+n.numGlyphs,Zt=n.lineStartIndex,hr=n.lineStartIndex+n.lineLength,ur=ya(nt,D,ze,ot,a,be,we,n,H,b,Pe);if(!ur)return{notEnoughRoom:!0};var gr=ri(ur.first.point,P).point,Nr=ri(ur.last.point,P).point;if(h&&!a){var an=yi(n.writingMode,gr,Nr,We);if(an)return an}Ve=[ur.first];for(var Hr=n.glyphStartIndex+1;Hr<bt-1;Hr++)Ve.push(Ea(nt*D.getoffsetX(Hr),ze,ot,a,be,we,n.segment,Zt,hr,H,b,Pe));Ve.push(ur.last)}else{if(h&&!a){var In=ri(we,g).point,ni=n.lineStartIndex+n.segment+1,hi=new p.Point(H.getx(ni),H.gety(ni)),ii=ri(hi,g),ea=ii.signedDistanceFromCamera>0?ii.point:Ws(we,hi,In,1,g),Bn=yi(n.writingMode,In,ea,We);if(Bn)return Bn}var _i=Ea(nt*D.getoffsetX(n.glyphStartIndex),ze,ot,a,be,we,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,H,b,Pe);if(!_i)return{notEnoughRoom:!0};Ve=[_i]}for(var te=0,q=Ve;te<q.length;te+=1){var R=q[te];p.addDynamicAttributes(ae,R.point,R.angle)}return{}}function Ws(n,u,a,h,g){var b=ri(n.add(n.sub(u)._unit()),g).point,P=a.sub(b);return a.add(P._mult(h/P.mag()))}function Ea(n,u,a,h,g,b,P,D,H,ae,be,we){var Pe=h?n-u:n+u,We=Pe>0?1:-1,Ve=0;h&&(We*=-1,Ve=Math.PI),We<0&&(Ve+=Math.PI);for(var nt=We>0?D+P:D+P+1,ze=g,ot=g,bt=0,Zt=0,hr=Math.abs(Pe),ur=[];bt+Zt<=hr;){if((nt+=We)<D||nt>=H)return null;if(ot=ze,ur.push(ze),(ze=we[nt])===void 0){var gr=new p.Point(ae.getx(nt),ae.gety(nt)),Nr=ri(gr,be);if(Nr.signedDistanceFromCamera>0)ze=we[nt]=Nr.point;else{var an=nt-We;ze=Ws(bt===0?b:new p.Point(ae.getx(an),ae.gety(an)),gr,ot,hr-bt+1,be)}}bt+=Zt,Zt=ot.dist(ze)}var Hr=(hr-bt)/Zt,In=ze.sub(ot),ni=In.mult(Hr)._add(ot);ni._add(In._unit()._perp()._mult(a*We));var hi=Ve+Math.atan2(ze.y-ot.y,ze.x-ot.x);return ur.push(ni),{point:ni,angle:hi,path:ur}}ca.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ca.prototype.insert=function(n,u,a,h,g){this._forEachCell(u,a,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)},ca.prototype.insertCircle=function(n,u,a,h){this._forEachCell(u-h,a-h,u+h,a+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(a),this.circles.push(h)},ca.prototype._insertBoxCell=function(n,u,a,h,g,b){this.boxCells[g].push(b)},ca.prototype._insertCircleCell=function(n,u,a,h,g,b){this.circleCells[g].push(b)},ca.prototype._query=function(n,u,a,h,g,b){if(a<0||n>this.width||h<0||u>this.height)return!g&&[];var P=[];if(n<=0&&u<=0&&this.width<=a&&this.height<=h){if(g)return!0;for(var D=0;D<this.boxKeys.length;D++)P.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(var H=0;H<this.circleKeys.length;H++){var ae=this.circles[3*H],be=this.circles[3*H+1],we=this.circles[3*H+2];P.push({key:this.circleKeys[H],x1:ae-we,y1:be-we,x2:ae+we,y2:be+we})}return b?P.filter(b):P}return this._forEachCell(n,u,a,h,this._queryCell,P,{hitTest:g,seenUids:{box:{},circle:{}}},b),g?P.length>0:P},ca.prototype._queryCircle=function(n,u,a,h,g){var b=n-a,P=n+a,D=u-a,H=u+a;if(P<0||b>this.width||H<0||D>this.height)return!h&&[];var ae=[];return this._forEachCell(b,D,P,H,this._queryCellCircle,ae,{hitTest:h,circle:{x:n,y:u,radius:a},seenUids:{box:{},circle:{}}},g),h?ae.length>0:ae},ca.prototype.query=function(n,u,a,h,g){return this._query(n,u,a,h,!1,g)},ca.prototype.hitTest=function(n,u,a,h,g){return this._query(n,u,a,h,!0,g)},ca.prototype.hitTestCircle=function(n,u,a,h){return this._queryCircle(n,u,a,!0,h)},ca.prototype._queryCell=function(n,u,a,h,g,b,P,D){var H=P.seenUids,ae=this.boxCells[g];if(ae!==null)for(var be=this.bboxes,we=0,Pe=ae;we<Pe.length;we+=1){var We=Pe[we];if(!H.box[We]){H.box[We]=!0;var Ve=4*We;if(n<=be[Ve+2]&&u<=be[Ve+3]&&a>=be[Ve+0]&&h>=be[Ve+1]&&(!D||D(this.boxKeys[We]))){if(P.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[We],x1:be[Ve],y1:be[Ve+1],x2:be[Ve+2],y2:be[Ve+3]})}}}var nt=this.circleCells[g];if(nt!==null)for(var ze=this.circles,ot=0,bt=nt;ot<bt.length;ot+=1){var Zt=bt[ot];if(!H.circle[Zt]){H.circle[Zt]=!0;var hr=3*Zt;if(this._circleAndRectCollide(ze[hr],ze[hr+1],ze[hr+2],n,u,a,h)&&(!D||D(this.circleKeys[Zt]))){if(P.hitTest)return b.push(!0),!0;var ur=ze[hr],gr=ze[hr+1],Nr=ze[hr+2];b.push({key:this.circleKeys[Zt],x1:ur-Nr,y1:gr-Nr,x2:ur+Nr,y2:gr+Nr})}}}},ca.prototype._queryCellCircle=function(n,u,a,h,g,b,P,D){var H=P.circle,ae=P.seenUids,be=this.boxCells[g];if(be!==null)for(var we=this.bboxes,Pe=0,We=be;Pe<We.length;Pe+=1){var Ve=We[Pe];if(!ae.box[Ve]){ae.box[Ve]=!0;var nt=4*Ve;if(this._circleAndRectCollide(H.x,H.y,H.radius,we[nt+0],we[nt+1],we[nt+2],we[nt+3])&&(!D||D(this.boxKeys[Ve])))return b.push(!0),!0}}var ze=this.circleCells[g];if(ze!==null)for(var ot=this.circles,bt=0,Zt=ze;bt<Zt.length;bt+=1){var hr=Zt[bt];if(!ae.circle[hr]){ae.circle[hr]=!0;var ur=3*hr;if(this._circlesCollide(ot[ur],ot[ur+1],ot[ur+2],H.x,H.y,H.radius)&&(!D||D(this.circleKeys[hr])))return b.push(!0),!0}}},ca.prototype._forEachCell=function(n,u,a,h,g,b,P,D){for(var H=this._convertToXCellCoord(n),ae=this._convertToYCellCoord(u),be=this._convertToXCellCoord(a),we=this._convertToYCellCoord(h),Pe=H;Pe<=be;Pe++)for(var We=ae;We<=we;We++)if(g.call(this,n,u,a,h,this.xCellCount*We+Pe,b,P,D))return},ca.prototype._convertToXCellCoord=function(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))},ca.prototype._convertToYCellCoord=function(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))},ca.prototype._circlesCollide=function(n,u,a,h,g,b){var P=h-n,D=g-u,H=a+b;return H*H>P*P+D*D},ca.prototype._circleAndRectCollide=function(n,u,a,h,g,b,P){var D=(b-h)/2,H=Math.abs(n-(h+D));if(H>D+a)return!1;var ae=(P-g)/2,be=Math.abs(u-(g+ae));if(be>ae+a)return!1;if(H<=D||be<=ae)return!0;var we=H-D,Pe=be-ae;return we*we+Pe*Pe<=a*a};var Ao=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Xa(n,u){for(var a=0;a<n;a++){var h=u.length;u.resize(h+4),u.float32.set(Ao,3*h)}}function Ya(n,u,a){var h=u[0],g=u[1];return n[0]=a[0]*h+a[4]*g+a[12],n[1]=a[1]*h+a[5]*g+a[13],n[3]=a[3]*h+a[7]*g+a[15],n}var Wo=function(n,u,a){u===void 0&&(u=new ca(n.width+200,n.height+200,25)),a===void 0&&(a=new ca(n.width+200,n.height+200,25)),this.transform=n,this.grid=u,this.ignoredGrid=a,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+100,this.screenBottomBoundary=n.height+100,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200};function Ui(n,u,a){return u*(p.EXTENT/(n.tileSize*Math.pow(2,a-n.tileID.overscaledZ)))}Wo.prototype.placeCollisionBox=function(n,u,a,h,g){var b=this.projectAndGetPerspectiveRatio(h,n.anchorPointX,n.anchorPointY),P=a*b.perspectiveRatio,D=n.x1*P+b.point.x,H=n.y1*P+b.point.y,ae=n.x2*P+b.point.x,be=n.y2*P+b.point.y;return!this.isInsideGrid(D,H,ae,be)||!u&&this.grid.hitTest(D,H,ae,be,g)?{box:[],offscreen:!1}:{box:[D,H,ae,be],offscreen:this.isOffscreen(D,H,ae,be)}},Wo.prototype.placeCollisionCircles=function(n,u,a,h,g,b,P,D,H,ae,be,we,Pe){var We=[],Ve=new p.Point(u.anchorX,u.anchorY),nt=ri(Ve,b),ze=Gi(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),ot=(ae?g/ze:g*ze)/p.ONE_EM,bt=ri(Ve,P).point,Zt=ya(ot,h,u.lineOffsetX*ot,u.lineOffsetY*ot,!1,bt,Ve,u,a,P,{}),hr=!1,ur=!1,gr=!0;if(Zt){for(var Nr=.5*we*ze+Pe,an=new p.Point(-100,-100),Hr=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),In=new Ti,ni=Zt.first,hi=Zt.last,ii=[],ea=ni.path.length-1;ea>=1;ea--)ii.push(ni.path[ea]);for(var Bn=1;Bn<hi.path.length;Bn++)ii.push(hi.path[Bn]);var _i=2.5*Nr;if(D){var te=ii.map(function($i){return ri($i,D)});ii=te.some(function($i){return $i.signedDistanceFromCamera<=0})?[]:te.map(function($i){return $i.point})}var q=[];if(ii.length>0){for(var R=ii[0].clone(),F=ii[0].clone(),ne=1;ne<ii.length;ne++)R.x=Math.min(R.x,ii[ne].x),R.y=Math.min(R.y,ii[ne].y),F.x=Math.max(F.x,ii[ne].x),F.y=Math.max(F.y,ii[ne].y);q=R.x>=an.x&&F.x<=Hr.x&&R.y>=an.y&&F.y<=Hr.y?[ii]:F.x<an.x||R.x>Hr.x||F.y<an.y||R.y>Hr.y?[]:p.clipLine([ii],an.x,an.y,Hr.x,Hr.y)}for(var pe=0,ht=q;pe<ht.length;pe+=1){var wt;In.reset(ht[pe],.25*Nr),wt=In.length<=.5*Nr?1:Math.ceil(In.paddedLength/_i)+1;for(var At=0;At<wt;At++){var qt=At/Math.max(wt-1,1),Pr=In.lerp(qt),vn=Pr.x+100,zn=Pr.y+100;We.push(vn,zn,Nr,0);var $n=vn-Nr,xi=zn-Nr,li=vn+Nr,Zi=zn+Nr;if(gr=gr&&this.isOffscreen($n,xi,li,Zi),ur=ur||this.isInsideGrid($n,xi,li,Zi),!n&&this.grid.hitTestCircle(vn,zn,Nr,be)&&(hr=!0,!H))return{circles:[],offscreen:!1,collisionDetected:hr}}}}return{circles:!H&&hr||!ur?[]:We,offscreen:gr,collisionDetected:hr}},Wo.prototype.queryRenderedSymbols=function(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],a=1/0,h=1/0,g=-1/0,b=-1/0,P=0,D=n;P<D.length;P+=1){var H=D[P],ae=new p.Point(H.x+100,H.y+100);a=Math.min(a,ae.x),h=Math.min(h,ae.y),g=Math.max(g,ae.x),b=Math.max(b,ae.y),u.push(ae)}for(var be={},we={},Pe=0,We=this.grid.query(a,h,g,b).concat(this.ignoredGrid.query(a,h,g,b));Pe<We.length;Pe+=1){var Ve=We[Pe],nt=Ve.key;if(be[nt.bucketInstanceId]===void 0&&(be[nt.bucketInstanceId]={}),!be[nt.bucketInstanceId][nt.featureIndex]){var ze=[new p.Point(Ve.x1,Ve.y1),new p.Point(Ve.x2,Ve.y1),new p.Point(Ve.x2,Ve.y2),new p.Point(Ve.x1,Ve.y2)];p.polygonIntersectsPolygon(u,ze)&&(be[nt.bucketInstanceId][nt.featureIndex]=!0,we[nt.bucketInstanceId]===void 0&&(we[nt.bucketInstanceId]=[]),we[nt.bucketInstanceId].push(nt.featureIndex))}}return we},Wo.prototype.insertCollisionBox=function(n,u,a,h,g){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:h,collisionGroupID:g},n[0],n[1],n[2],n[3])},Wo.prototype.insertCollisionCircles=function(n,u,a,h,g){for(var b=u?this.ignoredGrid:this.grid,P={bucketInstanceId:a,featureIndex:h,collisionGroupID:g},D=0;D<n.length;D+=4)b.insertCircle(P,n[D],n[D+1],n[D+2])},Wo.prototype.projectAndGetPerspectiveRatio=function(n,u,a){var h=[u,a,0,1];return Ya(h,h,n),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Wo.prototype.isOffscreen=function(n,u,a,h){return a<100||n>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Wo.prototype.isInsideGrid=function(n,u,a,h){return a>=0&&n<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Wo.prototype.getViewportMatrix=function(){var n=p.identity([]);return p.translate(n,n,[-100,-100,0]),n};var To=function(n,u,a,h){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):h&&a?1:0,this.placed=a};To.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Lo=function(n,u,a,h,g){this.text=new To(n?n.text:null,u,a,g),this.icon=new To(n?n.icon:null,u,h,g)};Lo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var lo=function(n,u,a){this.text=n,this.icon=u,this.skipFade=a},Ro=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},Hi=function(n,u,a,h,g){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=a,this.bucketIndex=h,this.tileID=g},Ra=function(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}};function Fa(n,u,a,h,g){var b=p.getAnchorAlignment(n),P=-(b.horizontalAlign-.5)*u,D=-(b.verticalAlign-.5)*a,H=p.evaluateVariableOffset(n,h);return new p.Point(P+H[0]*g,D+H[1]*g)}function ms(n,u,a,h,g,b){var P=n.x1,D=n.x2,H=n.y1,ae=n.y2,be=n.anchorPointX,we=n.anchorPointY,Pe=new p.Point(u,a);return h&&Pe._rotate(g?b:-b),{x1:P+Pe.x,y1:H+Pe.y,x2:D+Pe.x,y2:ae+Pe.y,anchorPointX:be,anchorPointY:we}}Ra.prototype.get=function(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){var u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:function(a){return a.collisionGroupID===u}}}return this.collisionGroups[n]};var _a=function(n,u,a,h){this.transform=n.clone(),this.collisionIndex=new Wo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ra(a),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function xe(n,u,a,h,g){n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0)}_a.prototype.getBucketParts=function(n,u,a,h){var g=a.getBucket(u),b=a.latestFeatureIndex;if(g&&b&&u.id===g.layerIds[0]){var P=a.collisionBoxArray,D=g.layers[0].layout,H=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),ae=a.tileSize/p.EXTENT,be=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),we=D.get("text-pitch-alignment")==="map",Pe=D.get("text-rotation-alignment")==="map",We=Ui(a,1,this.transform.zoom),Ve=Sa(be,we,Pe,this.transform,We),nt=null;if(we){var ze=oi(be,we,Pe,this.transform,We);nt=p.multiply([],this.transform.labelPlaneMatrix,ze)}this.retainedQueryData[g.bucketInstanceId]=new Hi(g.bucketInstanceId,b,g.sourceLayerIndex,g.index,a.tileID);var ot={bucket:g,layout:D,posMatrix:be,textLabelPlaneMatrix:Ve,labelToScreenMatrix:nt,scale:H,textPixelRatio:ae,holdingForFade:a.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(var bt=0,Zt=g.sortKeyRanges;bt<Zt.length;bt+=1){var hr=Zt[bt];n.push({sortKey:hr.sortKey,symbolInstanceStart:hr.symbolInstanceStart,symbolInstanceEnd:hr.symbolInstanceEnd,parameters:ot})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ot})}},_a.prototype.attemptAnchorPlacement=function(n,u,a,h,g,b,P,D,H,ae,be,we,Pe,We,Ve){var nt,ze=[we.textOffset0,we.textOffset1],ot=Fa(n,a,h,ze,g),bt=this.collisionIndex.placeCollisionBox(ms(u,ot.x,ot.y,b,P,this.transform.angle),be,D,H,ae.predicate);if(!Ve||this.collisionIndex.placeCollisionBox(ms(Ve,ot.x,ot.y,b,P,this.transform.angle),be,D,H,ae.predicate).box.length!==0)return bt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[we.crossTileID].anchor),this.variableOffsets[we.crossTileID]={textOffset:ze,width:a,height:h,anchor:n,textBoxScale:g,prevAnchor:nt},this.markUsedJustification(Pe,n,we,We),Pe.allowVerticalPlacement&&(this.markUsedOrientation(Pe,We,we),this.placedOrientations[we.crossTileID]=We),{shift:ot,placedGlyphBoxes:bt}):void 0},_a.prototype.placeLayerBucketPart=function(n,u,a){var h=this,g=n.parameters,b=g.bucket,P=g.layout,D=g.posMatrix,H=g.textLabelPlaneMatrix,ae=g.labelToScreenMatrix,be=g.textPixelRatio,we=g.holdingForFade,Pe=g.collisionBoxArray,We=g.partiallyEvaluatedTextSize,Ve=g.collisionGroup,nt=P.get("text-optional"),ze=P.get("icon-optional"),ot=P.get("text-allow-overlap"),bt=P.get("icon-allow-overlap"),Zt=P.get("text-rotation-alignment")==="map",hr=P.get("text-pitch-alignment")==="map",ur=P.get("icon-text-fit")!=="none",gr=P.get("symbol-z-order")==="viewport-y",Nr=ot&&(bt||!b.hasIconData()||ze),an=bt&&(ot||!b.hasTextData()||nt);!b.collisionArrays&&Pe&&b.deserializeCollisionBoxes(Pe);var Hr=function(Bn,_i){if(!u[Bn.crossTileID])if(we)h.placements[Bn.crossTileID]=new lo(!1,!1,!1);else{var te,q=!1,R=!1,F=!0,ne=null,pe={box:null,offscreen:null},ht={box:null,offscreen:null},wt=null,At=null,qt=0,Pr=0,vn=0;_i.textFeatureIndex?qt=_i.textFeatureIndex:Bn.useRuntimeCollisionCircles&&(qt=Bn.featureIndex),_i.verticalTextFeatureIndex&&(Pr=_i.verticalTextFeatureIndex);var zn=_i.textBox;if(zn){var $n=function(oa){var Uo=p.WritingMode.horizontal;if(b.allowVerticalPlacement&&!oa&&h.prevPlacement){var po=h.prevPlacement.placedOrientations[Bn.crossTileID];po&&(h.placedOrientations[Bn.crossTileID]=po,h.markUsedOrientation(b,Uo=po,Bn))}return Uo},xi=function(oa,Uo){if(b.allowVerticalPlacement&&Bn.numVerticalGlyphVertices>0&&_i.verticalTextBox)for(var po=0,tu=b.writingModes;po<tu.length&&(tu[po]===p.WritingMode.vertical?(pe=Uo(),ht=pe):pe=oa(),!(pe&&pe.box&&pe.box.length));po+=1);else pe=oa()};if(P.get("text-variable-anchor")){var li=P.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Bn.crossTileID]){var Zi=h.prevPlacement.variableOffsets[Bn.crossTileID];li.indexOf(Zi.anchor)>0&&(li=li.filter(function(oa){return oa!==Zi.anchor})).unshift(Zi.anchor)}var $i=function(oa,Uo,po){for(var tu=oa.x2-oa.x1,xc=oa.y2-oa.y1,Dl=Bn.textBoxScale,Ju=ur&&!bt?Uo:null,hu={box:[],offscreen:!1},Fl=ot?2*li.length:li.length,Vs=0;Vs<Fl;++Vs){var vl=h.attemptAnchorPlacement(li[Vs%li.length],oa,tu,xc,Dl,Zt,hr,be,D,Ve,Vs>=li.length,Bn,b,po,Ju);if(vl&&(hu=vl.placedGlyphBoxes)&&hu.box&&hu.box.length){q=!0,ne=vl.shift;break}}return hu};xi(function(){return $i(zn,_i.iconBox,p.WritingMode.horizontal)},function(){var oa=_i.verticalTextBox;return b.allowVerticalPlacement&&!(pe&&pe.box&&pe.box.length)&&Bn.numVerticalGlyphVertices>0&&oa?$i(oa,_i.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),pe&&(q=pe.box,F=pe.offscreen);var ba=$n(pe&&pe.box);if(!q&&h.prevPlacement){var oo=h.prevPlacement.variableOffsets[Bn.crossTileID];oo&&(h.variableOffsets[Bn.crossTileID]=oo,h.markUsedJustification(b,oo.anchor,Bn,ba))}}else{var Ia=function(oa,Uo){var po=h.collisionIndex.placeCollisionBox(oa,ot,be,D,Ve.predicate);return po&&po.box&&po.box.length&&(h.markUsedOrientation(b,Uo,Bn),h.placedOrientations[Bn.crossTileID]=Uo),po};xi(function(){return Ia(zn,p.WritingMode.horizontal)},function(){var oa=_i.verticalTextBox;return b.allowVerticalPlacement&&Bn.numVerticalGlyphVertices>0&&oa?Ia(oa,p.WritingMode.vertical):{box:null,offscreen:null}}),$n(pe&&pe.box&&pe.box.length)}}if(q=(te=pe)&&te.box&&te.box.length>0,F=te&&te.offscreen,Bn.useRuntimeCollisionCircles){var ho=b.text.placedSymbolArray.get(Bn.centerJustifiedTextSymbolIndex),Va=p.evaluateSizeForFeature(b.textSizeData,We,ho),ta=P.get("text-padding");wt=h.collisionIndex.placeCollisionCircles(ot,ho,b.lineVertexArray,b.glyphOffsetArray,Va,D,H,ae,a,hr,Ve.predicate,Bn.collisionCircleDiameter,ta),q=ot||wt.circles.length>0&&!wt.collisionDetected,F=F&&wt.offscreen}if(_i.iconFeatureIndex&&(vn=_i.iconFeatureIndex),_i.iconBox){var da=function(oa){var Uo=ur&&ne?ms(oa,ne.x,ne.y,Zt,hr,h.transform.angle):oa;return h.collisionIndex.placeCollisionBox(Uo,bt,be,D,Ve.predicate)};R=ht&&ht.box&&ht.box.length&&_i.verticalIconBox?(At=da(_i.verticalIconBox)).box.length>0:(At=da(_i.iconBox)).box.length>0,F=F&&At.offscreen}var Na=nt||Bn.numHorizontalGlyphVertices===0&&Bn.numVerticalGlyphVertices===0,ha=ze||Bn.numIconVertices===0;if(Na||ha?ha?Na||(R=R&&q):q=R&&q:R=q=R&&q,q&&te&&te.box&&h.collisionIndex.insertCollisionBox(te.box,P.get("text-ignore-placement"),b.bucketInstanceId,ht&&ht.box&&Pr?Pr:qt,Ve.ID),R&&At&&h.collisionIndex.insertCollisionBox(At.box,P.get("icon-ignore-placement"),b.bucketInstanceId,vn,Ve.ID),wt&&(q&&h.collisionIndex.insertCollisionCircles(wt.circles,P.get("text-ignore-placement"),b.bucketInstanceId,qt,Ve.ID),a)){var Pa=b.bucketInstanceId,Eo=h.collisionCircleArrays[Pa];Eo===void 0&&(Eo=h.collisionCircleArrays[Pa]=new Ro);for(var Fo=0;Fo<wt.circles.length;Fo+=4)Eo.circles.push(wt.circles[Fo+0]),Eo.circles.push(wt.circles[Fo+1]),Eo.circles.push(wt.circles[Fo+2]),Eo.circles.push(wt.collisionDetected?1:0)}h.placements[Bn.crossTileID]=new lo(q||Nr,R||an,F||b.justReloaded),u[Bn.crossTileID]=!0}};if(gr)for(var In=b.getSortedSymbolIndexes(this.transform.angle),ni=In.length-1;ni>=0;--ni){var hi=In[ni];Hr(b.symbolInstances.get(hi),b.collisionArrays[hi])}else for(var ii=n.symbolInstanceStart;ii<n.symbolInstanceEnd;ii++)Hr(b.symbolInstances.get(ii),b.collisionArrays[ii]);if(a&&b.bucketInstanceId in this.collisionCircleArrays){var ea=this.collisionCircleArrays[b.bucketInstanceId];p.invert(ea.invProjMatrix,D),ea.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1},_a.prototype.markUsedJustification=function(n,u,a,h){var g;g=h===p.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];for(var b=0,P=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];b<P.length;b+=1){var D=P[b];D>=0&&(n.text.placedSymbolArray.get(D).crossTileID=g>=0&&D!==g?0:a.crossTileID)}},_a.prototype.markUsedOrientation=function(n,u,a){for(var h=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,g=u===p.WritingMode.vertical?u:0,b=0,P=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];b<P.length;b+=1)n.text.placedSymbolArray.get(P[b]).placedOrientation=h;a.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=g)},_a.prototype.commit=function(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,a=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(n):1,g=u?u.opacities:{},b=u?u.variableOffsets:{},P=u?u.placedOrientations:{};for(var D in this.placements){var H=this.placements[D],ae=g[D];ae?(this.opacities[D]=new Lo(ae,h,H.text,H.icon),a=a||H.text!==ae.text.placed||H.icon!==ae.icon.placed):(this.opacities[D]=new Lo(null,h,H.text,H.icon,H.skipFade),a=a||H.text||H.icon)}for(var be in g){var we=g[be];if(!this.opacities[be]){var Pe=new Lo(we,h,!1,!1);Pe.isHidden()||(this.opacities[be]=Pe,a=a||we.text.placed||we.icon.placed)}}for(var We in b)this.variableOffsets[We]||!this.opacities[We]||this.opacities[We].isHidden()||(this.variableOffsets[We]=b[We]);for(var Ve in P)this.placedOrientations[Ve]||!this.opacities[Ve]||this.opacities[Ve].isHidden()||(this.placedOrientations[Ve]=P[Ve]);a?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)},_a.prototype.updateLayerOpacities=function(n,u){for(var a={},h=0,g=u;h<g.length;h+=1){var b=g[h],P=b.getBucket(n);P&&b.latestFeatureIndex&&n.id===P.layerIds[0]&&this.updateBucketOpacities(P,a,b.collisionBoxArray)}},_a.prototype.updateBucketOpacities=function(n,u,a){var h=this;n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();var g=n.layers[0].layout,b=new Lo(null,0,!1,!1,!0),P=g.get("text-allow-overlap"),D=g.get("icon-allow-overlap"),H=g.get("text-variable-anchor"),ae=g.get("text-rotation-alignment")==="map",be=g.get("text-pitch-alignment")==="map",we=g.get("icon-text-fit")!=="none",Pe=new Lo(null,0,P&&(D||!n.hasIconData()||g.get("icon-optional")),D&&(P||!n.hasTextData()||g.get("text-optional")),!0);!n.collisionArrays&&a&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(a);for(var We=function(ot,bt,Zt){for(var hr=0;hr<bt/4;hr++)ot.opacityVertexArray.emplaceBack(Zt)},Ve=function(ot){var bt=n.symbolInstances.get(ot),Zt=bt.numHorizontalGlyphVertices,hr=bt.numVerticalGlyphVertices,ur=bt.crossTileID,gr=h.opacities[ur];u[ur]?gr=b:gr||(h.opacities[ur]=gr=Pe),u[ur]=!0;var Nr=bt.numIconVertices>0,an=h.placedOrientations[bt.crossTileID],Hr=an===p.WritingMode.vertical,In=an===p.WritingMode.horizontal||an===p.WritingMode.horizontalOnly;if(Zt>0||hr>0){var ni=Ka(gr.text);We(n.text,Zt,Hr?co:ni),We(n.text,hr,In?co:ni);var hi=gr.text.isHidden();[bt.rightJustifiedTextSymbolIndex,bt.centerJustifiedTextSymbolIndex,bt.leftJustifiedTextSymbolIndex].forEach(function(pe){pe>=0&&(n.text.placedSymbolArray.get(pe).hidden=hi||Hr?1:0)}),bt.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(bt.verticalPlacedTextSymbolIndex).hidden=hi||In?1:0);var ii=h.variableOffsets[bt.crossTileID];ii&&h.markUsedJustification(n,ii.anchor,bt,an);var ea=h.placedOrientations[bt.crossTileID];ea&&(h.markUsedJustification(n,"left",bt,ea),h.markUsedOrientation(n,ea,bt))}if(Nr){var Bn=Ka(gr.icon),_i=!(we&&bt.verticalPlacedIconSymbolIndex&&Hr);bt.placedIconSymbolIndex>=0&&(We(n.icon,bt.numIconVertices,_i?Bn:co),n.icon.placedSymbolArray.get(bt.placedIconSymbolIndex).hidden=gr.icon.isHidden()),bt.verticalPlacedIconSymbolIndex>=0&&(We(n.icon,bt.numVerticalIconVertices,_i?co:Bn),n.icon.placedSymbolArray.get(bt.verticalPlacedIconSymbolIndex).hidden=gr.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){var te=n.collisionArrays[ot];if(te){var q=new p.Point(0,0);if(te.textBox||te.verticalTextBox){var R=!0;if(H){var F=h.variableOffsets[ur];F?(q=Fa(F.anchor,F.width,F.height,F.textOffset,F.textBoxScale),ae&&q._rotate(be?h.transform.angle:-h.transform.angle)):R=!1}te.textBox&&xe(n.textCollisionBox.collisionVertexArray,gr.text.placed,!R||Hr,q.x,q.y),te.verticalTextBox&&xe(n.textCollisionBox.collisionVertexArray,gr.text.placed,!R||In,q.x,q.y)}var ne=Boolean(!In&&te.verticalIconBox);te.iconBox&&xe(n.iconCollisionBox.collisionVertexArray,gr.icon.placed,ne,we?q.x:0,we?q.y:0),te.verticalIconBox&&xe(n.iconCollisionBox.collisionVertexArray,gr.icon.placed,!ne,we?q.x:0,we?q.y:0)}}},nt=0;nt<n.symbolInstances.length;nt++)Ve(nt);if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){var ze=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ze.invProjMatrix,n.placementViewportMatrix=ze.viewportMatrix,n.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}},_a.prototype.symbolFadeChange=function(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},_a.prototype.zoomAdjustment=function(n){return Math.max(0,(this.transform.zoom-n)/1.5)},_a.prototype.hasTransitions=function(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration},_a.prototype.stillRecent=function(n,u){var a=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*a>n},_a.prototype.setStale=function(){this.stale=!0};var ke=Math.pow(2,25),ut=Math.pow(2,24),Xt=Math.pow(2,17),Xr=Math.pow(2,16),Kn=Math.pow(2,9),gi=Math.pow(2,8),io=Math.pow(2,1);function Ka(n){if(n.opacity===0&&!n.placed)return 0;if(n.opacity===1&&n.placed)return 4294967295;var u=n.placed?1:0,a=Math.floor(127*n.opacity);return a*ke+u*ut+a*Xt+u*Xr+a*Kn+u*gi+a*io+u}var co=0,Xo=function(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Xo.prototype.continuePlacement=function(n,u,a,h,g){for(var b=this._bucketParts;this._currentTileIndex<n.length;)if(u.getBucketParts(b,h,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort(function(P,D){return P.sortKey-D.sortKey}));this._currentPartIndex<b.length;)if(u.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,g())return!0;return!1};var Xs=function(n,u,a,h,g,b,P){this.placement=new _a(n,g,b,P),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=h,this._done=!1};Xs.prototype.isDone=function(){return this._done},Xs.prototype.continuePlacement=function(n,u,a){for(var h=this,g=p.browser.now(),b=function(){var H=p.browser.now()-g;return!h._forceFullPlacement&&H>2};this._currentPlacementIndex>=0;){var P=u[n[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=D)&&(!P.maxzoom||P.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new Xo(P)),this._inProgressLayer.continuePlacement(a[P.source],this.placement,this._showCollisionBoxes,P,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Xs.prototype.commit=function(n){return this.placement.commit(n),this.placement};var ys=512/p.EXTENT/2,mo=function(n,u,a){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(var h=0;h<u.length;h++){var g=u.get(h),b=g.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,n)})}};mo.prototype.getScaledCoordinates=function(n,u){var a=ys/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+n.anchorX)*a),y:Math.floor((u.canonical.y*p.EXTENT+n.anchorY)*a)}},mo.prototype.findMatches=function(n,u,a){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),g=0;g<n.length;g++){var b=n.get(g);if(!b.crossTileID){var P=this.indexedSymbolInstances[b.key];if(P)for(var D=this.getScaledCoordinates(b,u),H=0,ae=P;H<ae.length;H+=1){var be=ae[H];if(Math.abs(be.coord.x-D.x)<=h&&Math.abs(be.coord.y-D.y)<=h&&!a[be.crossTileID]){a[be.crossTileID]=!0,b.crossTileID=be.crossTileID;break}}}}};var ls=function(){this.maxCrossTileID=0};ls.prototype.generate=function(){return++this.maxCrossTileID};var No=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};No.prototype.handleWrapJump=function(n){var u=Math.round((n-this.lng)/360);if(u!==0)for(var a in this.indexes){var h=this.indexes[a],g={};for(var b in h){var P=h[b];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+u),g[P.tileID.key]=P}this.indexes[a]=g}this.lng=n},No.prototype.addBucket=function(n,u,a){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});var g=this.usedCrossTileIDs[n.overscaledZ];for(var b in this.indexes){var P=this.indexes[b];if(Number(b)>n.overscaledZ)for(var D in P){var H=P[D];H.tileID.isChildOf(n)&&H.findMatches(u.symbolInstances,n,g)}else{var ae=P[n.scaledTo(Number(b)).key];ae&&ae.findMatches(u.symbolInstances,n,g)}}for(var be=0;be<u.symbolInstances.length;be++){var we=u.symbolInstances.get(be);we.crossTileID||(we.crossTileID=a.generate(),g[we.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new mo(n,u.symbolInstances,u.bucketInstanceId),!0},No.prototype.removeBucketCrossTileIDs=function(n,u){for(var a in u.indexedSymbolInstances)for(var h=0,g=u.indexedSymbolInstances[a];h<g.length;h+=1)delete this.usedCrossTileIDs[n][g[h].crossTileID]},No.prototype.removeStaleBuckets=function(n){var u=!1;for(var a in this.indexes){var h=this.indexes[a];for(var g in h)n[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,h[g]),delete h[g],u=!0)}return u};var Yo=function(){this.layerIndexes={},this.crossTileIDs=new ls,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Yo.prototype.addLayer=function(n,u,a){var h=this.layerIndexes[n.id];h===void 0&&(h=this.layerIndexes[n.id]=new No);var g=!1,b={};h.handleWrapJump(a);for(var P=0,D=u;P<D.length;P+=1){var H=D[P],ae=H.getBucket(n);ae&&n.id===ae.layerIds[0]&&(ae.bucketInstanceId||(ae.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(H.tileID,ae,this.crossTileIDs)&&(g=!0),b[ae.bucketInstanceId]=!0)}return h.removeStaleBuckets(b)&&(g=!0),g},Yo.prototype.pruneUnusedLayers=function(n){var u={};for(var a in n.forEach(function(h){u[h]=!0}),this.layerIndexes)u[a]||delete this.layerIndexes[a]};var _o=function(n,u){return p.emitValidationErrors(n,u&&u.filter(function(a){return a.identifier!=="source.canvas"}))},Ei=p.pick(ln,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Cs=p.pick(ln,["setCenter","setZoom","setBearing","setPitch"]),As=function(){var n={},u=p.styleSpec.$version;for(var a in p.styleSpec.$root){var h,g=p.styleSpec.$root[a];g.required&&(h=a==="version"?u:g.type==="array"?[]:{})!=null&&(n[a]=h)}return n}(),gs=function(n){function u(a,h){var g=this;h===void 0&&(h={}),n.call(this),this.map=a,this.dispatcher=new Ut($t(),this),this.imageManager=new Gt,this.imageManager.setEventedParent(this),this.glyphManager=new vr(a._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Xe(256,512),this.crossTileSymbolIndex=new Yo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var b=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(P){b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(D,H){if(p.triggerPluginCompletionEvent(D),H&&H.every(function(be){return be}))for(var ae in b.sourceCaches)b.sourceCaches[ae].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var D=g.sourceCaches[P.sourceId];if(D){var H=D.getSource();if(H&&H.vectorLayerIds)for(var ae in g._layers){var be=g._layers[ae];be.source===H.id&&g._validateLayer(be)}}}})}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.loadURL=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var b=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);var P=this.map._requestManager.transformRequest(a,p.ResourceType.Style);this._request=p.getJSON(P,function(D,H){g._request=null,D?g.fire(new p.ErrorEvent(D)):H&&g._load(H,b)})},u.prototype.loadJSON=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){g._request=null,g._load(a,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(As,!1)},u.prototype._load=function(a,h){if(!h||!_o(this,p.validateStyle(a))){for(var g in this._loaded=!0,this.stylesheet=a,a.sources)this.addSource(g,a.sources[g],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);var b=on(this.stylesheet.layers);this._order=b.map(function(ae){return ae.id}),this._layers={},this._serializedLayers={};for(var P=0,D=b;P<D.length;P+=1){var H=D[P];(H=p.createStyleLayer(H)).setEventedParent(this,{layer:{id:H.id}}),this._layers[H.id]=H,this._serializedLayers[H.id]=H.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Rt(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},u.prototype._loadSprite=function(a){var h=this;this._spriteRequest=function(g,b,P){var D,H,ae,be=p.browser.devicePixelRatio>1?"@2x":"",we=p.getJSON(b.transformRequest(b.normalizeSpriteURL(g,be,".json"),p.ResourceType.SpriteJSON),function(Ve,nt){we=null,ae||(ae=Ve,D=nt,We())}),Pe=p.getImage(b.transformRequest(b.normalizeSpriteURL(g,be,".png"),p.ResourceType.SpriteImage),function(Ve,nt){Pe=null,ae||(ae=Ve,H=nt,We())});function We(){if(ae)P(ae);else if(D&&H){var Ve=p.browser.getImageData(H),nt={};for(var ze in D){var ot=D[ze],bt=ot.width,Zt=ot.height,hr=ot.x,ur=ot.y,gr=ot.sdf,Nr=ot.pixelRatio,an=ot.stretchX,Hr=ot.stretchY,In=ot.content,ni=new p.RGBAImage({width:bt,height:Zt});p.RGBAImage.copy(Ve,ni,{x:hr,y:ur},{x:0,y:0},{width:bt,height:Zt}),nt[ze]={data:ni,pixelRatio:Nr,sdf:gr,stretchX:an,stretchY:Hr,content:In}}P(null,nt)}}return{cancel:function(){we&&(we.cancel(),we=null),Pe&&(Pe.cancel(),Pe=null)}}}(a,this.map._requestManager,function(g,b){if(h._spriteRequest=null,g)h.fire(new p.ErrorEvent(g));else if(b)for(var P in b)h.imageManager.addImage(P,b[P]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(a){var h=this.sourceCaches[a.source];if(h){var g=a.sourceLayer;if(g){var b=h.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(g)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+g+'" does not exist on source "'+b.id+'" as specified by style layer "'+a.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(a){for(var h=[],g=0,b=a;g<b.length;g+=1){var P=this._layers[b[g]];P.type!=="custom"&&h.push(P.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(a){if(this._loaded){var h=this._changed;if(this._changed){var g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);for(var P in(g.length||b.length)&&this._updateWorkerLayers(g,b),this._updatedSources){var D=this._updatedSources[P];D==="reload"?this._reloadSource(P):D==="clear"&&this._clearSource(P)}for(var H in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[H].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}var ae={};for(var be in this.sourceCaches){var we=this.sourceCaches[be];ae[be]=we.used,we.used=!1}for(var Pe=0,We=this._order;Pe<We.length;Pe+=1){var Ve=this._layers[We[Pe]];Ve.recalculate(a,this._availableImages),!Ve.isHidden(a.zoom)&&Ve.source&&(this.sourceCaches[Ve.source].used=!0)}for(var nt in ae){var ze=this.sourceCaches[nt];ae[nt]!==ze.used&&ze.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(a),this.z=a.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var a=Object.keys(this._changedImages);if(a.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}},u.prototype._updateWorkerLayers=function(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(a){var h=this;if(this._checkLoaded(),_o(this,p.validateStyle(a)))return!1;(a=p.clone$1(a)).layers=on(a.layers);var g=function(P,D){if(!P)return[{command:ln.setStyle,args:[D]}];var H=[];try{if(!p.deepEqual(P.version,D.version))return[{command:ln.setStyle,args:[D]}];p.deepEqual(P.center,D.center)||H.push({command:ln.setCenter,args:[D.center]}),p.deepEqual(P.zoom,D.zoom)||H.push({command:ln.setZoom,args:[D.zoom]}),p.deepEqual(P.bearing,D.bearing)||H.push({command:ln.setBearing,args:[D.bearing]}),p.deepEqual(P.pitch,D.pitch)||H.push({command:ln.setPitch,args:[D.pitch]}),p.deepEqual(P.sprite,D.sprite)||H.push({command:ln.setSprite,args:[D.sprite]}),p.deepEqual(P.glyphs,D.glyphs)||H.push({command:ln.setGlyphs,args:[D.glyphs]}),p.deepEqual(P.transition,D.transition)||H.push({command:ln.setTransition,args:[D.transition]}),p.deepEqual(P.light,D.light)||H.push({command:ln.setLight,args:[D.light]});var ae={},be=[];(function(Pe,We,Ve,nt){var ze;for(ze in We=We||{},Pe=Pe||{})Pe.hasOwnProperty(ze)&&(We.hasOwnProperty(ze)||bn(ze,Ve,nt));for(ze in We)We.hasOwnProperty(ze)&&(Pe.hasOwnProperty(ze)?p.deepEqual(Pe[ze],We[ze])||(Pe[ze].type==="geojson"&&We[ze].type==="geojson"&&Yi(Pe,We,ze)?Ve.push({command:ln.setGeoJSONSourceData,args:[ze,We[ze].data]}):Li(ze,We,Ve,nt)):Ai(ze,We,Ve))})(P.sources,D.sources,be,ae);var we=[];P.layers&&P.layers.forEach(function(Pe){ae[Pe.source]?H.push({command:ln.removeLayer,args:[Pe.id]}):we.push(Pe)}),H=H.concat(be),function(Pe,We,Ve){We=We||[];var nt,ze,ot,bt,Zt,hr,ur,gr=(Pe=Pe||[]).map(Ki),Nr=We.map(Ki),an=Pe.reduce(Ni,{}),Hr=We.reduce(Ni,{}),In=gr.slice(),ni=Object.create(null);for(nt=0,ze=0;nt<gr.length;nt++)Hr.hasOwnProperty(ot=gr[nt])?ze++:(Ve.push({command:ln.removeLayer,args:[ot]}),In.splice(In.indexOf(ot,ze),1));for(nt=0,ze=0;nt<Nr.length;nt++)In[In.length-1-nt]!==(ot=Nr[Nr.length-1-nt])&&(an.hasOwnProperty(ot)?(Ve.push({command:ln.removeLayer,args:[ot]}),In.splice(In.lastIndexOf(ot,In.length-ze),1)):ze++,Ve.push({command:ln.addLayer,args:[Hr[ot],hr=In[In.length-nt]]}),In.splice(In.length-nt,0,ot),ni[ot]=!0);for(nt=0;nt<Nr.length;nt++)if(bt=an[ot=Nr[nt]],Zt=Hr[ot],!ni[ot]&&!p.deepEqual(bt,Zt))if(p.deepEqual(bt.source,Zt.source)&&p.deepEqual(bt["source-layer"],Zt["source-layer"])&&p.deepEqual(bt.type,Zt.type)){for(ur in si(bt.layout,Zt.layout,Ve,ot,null,ln.setLayoutProperty),si(bt.paint,Zt.paint,Ve,ot,null,ln.setPaintProperty),p.deepEqual(bt.filter,Zt.filter)||Ve.push({command:ln.setFilter,args:[ot,Zt.filter]}),p.deepEqual(bt.minzoom,Zt.minzoom)&&p.deepEqual(bt.maxzoom,Zt.maxzoom)||Ve.push({command:ln.setLayerZoomRange,args:[ot,Zt.minzoom,Zt.maxzoom]}),bt)bt.hasOwnProperty(ur)&&ur!=="layout"&&ur!=="paint"&&ur!=="filter"&&ur!=="metadata"&&ur!=="minzoom"&&ur!=="maxzoom"&&(ur.indexOf("paint.")===0?si(bt[ur],Zt[ur],Ve,ot,ur.slice(6),ln.setPaintProperty):p.deepEqual(bt[ur],Zt[ur])||Ve.push({command:ln.setLayerProperty,args:[ot,ur,Zt[ur]]}));for(ur in Zt)Zt.hasOwnProperty(ur)&&!bt.hasOwnProperty(ur)&&ur!=="layout"&&ur!=="paint"&&ur!=="filter"&&ur!=="metadata"&&ur!=="minzoom"&&ur!=="maxzoom"&&(ur.indexOf("paint.")===0?si(bt[ur],Zt[ur],Ve,ot,ur.slice(6),ln.setPaintProperty):p.deepEqual(bt[ur],Zt[ur])||Ve.push({command:ln.setLayerProperty,args:[ot,ur,Zt[ur]]}))}else Ve.push({command:ln.removeLayer,args:[ot]}),hr=In[In.lastIndexOf(ot)+1],Ve.push({command:ln.addLayer,args:[Zt,hr]})}(we,D.layers,H)}catch(Pe){console.warn("Unable to compute style diff:",Pe),H=[{command:ln.setStyle,args:[D]}]}return H}(this.serialize(),a).filter(function(P){return!(P.command in Cs)});if(g.length===0)return!1;var b=g.filter(function(P){return!(P.command in Ei)});if(b.length>0)throw new Error("Unimplemented: "+b.map(function(P){return P.command}).join(", ")+".");return g.forEach(function(P){P.command!=="setTransition"&&h[P.command].apply(h,P.args)}),this.stylesheet=a,!0},u.prototype.addImage=function(a,h){if(this.getImage(a))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(a,h),this._afterImageUpdated(a)},u.prototype.updateImage=function(a,h){this.imageManager.updateImage(a,h)},u.prototype.getImage=function(a){return this.imageManager.getImage(a)},u.prototype.removeImage=function(a){if(!this.getImage(a))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(a),this._afterImageUpdated(a)},u.prototype._afterImageUpdated=function(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(a,h,g){var b=this;if(g===void 0&&(g={}),this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+a,h,null,g))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var P=this.sourceCaches[a]=new Ce(a,h,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:b.loaded(),source:P.serialize(),sourceId:a}}),P.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===a)return this.fire(new p.ErrorEvent(new Error('Source "'+a+'" cannot be removed while layer "'+h+'" is using it.')));var g=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],g.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),g.setEventedParent(null),g.clearTiles(),g.onRemove&&g.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(a,h){this._checkLoaded(),this.sourceCaches[a].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()},u.prototype.addLayer=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var b=a.id;if(this.getLayer(b))this.fire(new p.ErrorEvent(new Error('Layer with id "'+b+'" already exists on this map')));else{var P;if(a.type==="custom"){if(_o(this,p.validateCustomStyleLayer(a)))return;P=p.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(b,a.source),a=p.clone$1(a),a=p.extend(a,{source:b})),this._validate(p.validateStyle.layer,"layers."+b,a,{arrayIndex:-1},g))return;P=p.createStyleLayer(a),this._validateLayer(P),P.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[P.id]=P.serialize()}var D=h?this._order.indexOf(h):this._order.length;if(h&&D===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(D,0,b),this._layerOrderChanged=!0,this._layers[b]=P,this._removedLayers[b]&&P.source&&P.type!=="custom"){var H=this._removedLayers[b];delete this._removedLayers[b],H.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},u.prototype.moveLayer=function(a,h){if(this._checkLoaded(),this._changed=!0,this._layers[a]){if(a!==h){var g=this._order.indexOf(a);this._order.splice(g,1);var b=h?this._order.indexOf(h):this._order.length;h&&b===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(b,0,a),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(a){this._checkLoaded();var h=this._layers[a];if(h){h.setEventedParent(null);var g=this._order.indexOf(a);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(a){return this._layers[a]},u.prototype.hasLayer=function(a){return a in this._layers},u.prototype.setLayerZoomRange=function(a,h,g){this._checkLoaded();var b=this.getLayer(a);b?b.minzoom===h&&b.maxzoom===g||(h!=null&&(b.minzoom=h),g!=null&&(b.maxzoom=g),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var b=this.getLayer(a);if(b){if(!p.deepEqual(b.filter,h))return h==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(p.validateStyle.filter,"layers."+b.id+".filter",h,null,g)||(b.filter=p.clone$1(h),this._updateLayer(b)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(a){return p.clone$1(this.getLayer(a).filter)},u.prototype.setLayoutProperty=function(a,h,g,b){b===void 0&&(b={}),this._checkLoaded();var P=this.getLayer(a);P?p.deepEqual(P.getLayoutProperty(h),g)||(P.setLayoutProperty(h,g,b),this._updateLayer(P)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(a,h){var g=this.getLayer(a);if(g)return g.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(a,h,g,b){b===void 0&&(b={}),this._checkLoaded();var P=this.getLayer(a);P?p.deepEqual(P.getPaintProperty(h),g)||(P.setPaintProperty(h,g,b)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(a,h){return this.getLayer(a).getPaintProperty(h)},u.prototype.setFeatureState=function(a,h){this._checkLoaded();var g=a.source,b=a.sourceLayer,P=this.sourceCaches[g];if(P!==void 0){var D=P.getSource().type;D==="geojson"&&b?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):D!=="vector"||b?(a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(b,a.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(a,h){this._checkLoaded();var g=a.source,b=this.sourceCaches[g];if(b!==void 0){var P=b.getSource().type,D=P==="vector"?a.sourceLayer:void 0;P!=="vector"||D?h&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(D,a.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(a){this._checkLoaded();var h=a.source,g=a.sourceLayer,b=this.sourceCaches[h];if(b!==void 0){if(b.getSource().type!=="vector"||g)return a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),b.getFeatureState(g,a.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(a){return a.serialize()}),layers:this._serializeLayers(this._order)},function(a){return a!==void 0})},u.prototype._updateLayer=function(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(a){for(var h=this,g=function(an){return h._layers[an].type==="fill-extrusion"},b={},P=[],D=this._order.length-1;D>=0;D--){var H=this._order[D];if(g(H)){b[H]=D;for(var ae=0,be=a;ae<be.length;ae+=1){var we=be[ae][H];if(we)for(var Pe=0,We=we;Pe<We.length;Pe+=1)P.push(We[Pe])}}}P.sort(function(an,Hr){return Hr.intersectionZ-an.intersectionZ});for(var Ve=[],nt=this._order.length-1;nt>=0;nt--){var ze=this._order[nt];if(g(ze))for(var ot=P.length-1;ot>=0;ot--){var bt=P[ot].feature;if(b[bt.layer.id]<nt)break;Ve.push(bt),P.pop()}else for(var Zt=0,hr=a;Zt<hr.length;Zt+=1){var ur=hr[Zt][ze];if(ur)for(var gr=0,Nr=ur;gr<Nr.length;gr+=1)Ve.push(Nr[gr].feature)}}return Ve},u.prototype.queryRenderedFeatures=function(a,h,g){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var b={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,D=h.layers;P<D.length;P+=1){var H=D[P],ae=this._layers[H];if(!ae)return this.fire(new p.ErrorEvent(new Error("The layer '"+H+"' does not exist in the map's style and cannot be queried for features."))),[];b[ae.source]=!0}}var be=[];for(var we in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!b[we]||be.push(yn(this.sourceCaches[we],this._layers,this._serializedLayers,a,h,g));return this.placement&&be.push(function(Pe,We,Ve,nt,ze,ot,bt){for(var Zt={},hr=ot.queryRenderedSymbols(nt),ur=[],gr=0,Nr=Object.keys(hr).map(Number);gr<Nr.length;gr+=1)ur.push(bt[Nr[gr]]);ur.sort(Vi);for(var an=function(){var ii=In[Hr],ea=ii.featureIndex.lookupSymbolFeatures(hr[ii.bucketInstanceId],We,ii.bucketIndex,ii.sourceLayerIndex,ze.filter,ze.layers,ze.availableImages,Pe);for(var Bn in ea){var _i=Zt[Bn]=Zt[Bn]||[],te=ea[Bn];te.sort(function(F,ne){var pe=ii.featureSortOrder;if(pe){var ht=pe.indexOf(F.featureIndex);return pe.indexOf(ne.featureIndex)-ht}return ne.featureIndex-F.featureIndex});for(var q=0,R=te;q<R.length;q+=1)_i.push(R[q])}},Hr=0,In=ur;Hr<In.length;Hr+=1)an();var ni=function(ii){Zt[ii].forEach(function(ea){var Bn=ea.feature,_i=Ve[Pe[ii].source].getFeatureState(Bn.layer["source-layer"],Bn.id);Bn.source=Bn.layer.source,Bn.layer["source-layer"]&&(Bn.sourceLayer=Bn.layer["source-layer"]),Bn.state=_i})};for(var hi in Zt)ni(hi);return Zt}(this._layers,this._serializedLayers,this.sourceCaches,a,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(be)},u.prototype.querySourceFeatures=function(a,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var g=this.sourceCaches[a];return g?function(b,P){for(var D=b.getRenderableIds().map(function(We){return b.getTileByID(We)}),H=[],ae={},be=0;be<D.length;be++){var we=D[be],Pe=we.tileID.canonical.key;ae[Pe]||(ae[Pe]=!0,we.querySourceFeatures(H,P))}return H}(g,h):[]},u.prototype.addSourceType=function(a,h,g){return u.getSourceType(a)?g(new Error('A source type called "'+a+'" already exists.')):(u.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},g):g(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(a,h){h===void 0&&(h={}),this._checkLoaded();var g=this.light.getLight(),b=!1;for(var P in a)if(!p.deepEqual(a[P],g[P])){b=!0;break}if(b){var D={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,h),this.light.updateTransitions(D)}},u.prototype._validate=function(a,h,g,b,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&_o(this,a.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:g,styleSpec:p.styleSpec},b)))},u.prototype._remove=function(){for(var a in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[a].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(a){this.sourceCaches[a].clearTiles()},u.prototype._reloadSource=function(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()},u.prototype._updateSources=function(a){for(var h in this.sourceCaches)this.sourceCaches[h].update(a)},u.prototype._generateCollisionBoxes=function(){for(var a in this.sourceCaches)this._reloadSource(a)},u.prototype._updatePlacement=function(a,h,g,b,P){P===void 0&&(P=!1);for(var D=!1,H=!1,ae={},be=0,we=this._order;be<we.length;be+=1){var Pe=this._layers[we[be]];if(Pe.type==="symbol"){if(!ae[Pe.source]){var We=this.sourceCaches[Pe.source];ae[Pe.source]=We.getRenderableIds(!0).map(function(bt){return We.getTileByID(bt)}).sort(function(bt,Zt){return Zt.tileID.overscaledZ-bt.tileID.overscaledZ||(bt.tileID.isLessThan(Zt.tileID)?-1:1)})}var Ve=this.crossTileSymbolIndex.addLayer(Pe,ae[Pe.source],a.center.lng);D=D||Ve}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),a.zoom))&&(this.pauseablePlacement=new Xs(a,this._order,P,h,g,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ae),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),H=!0),D&&this.pauseablePlacement.placement.setStale()),H||D)for(var nt=0,ze=this._order;nt<ze.length;nt+=1){var ot=this._layers[ze[nt]];ot.type==="symbol"&&this.placement.updateLayerOpacities(ot,ae[ot.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()},u.prototype.getImages=function(a,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();var b=this.sourceCaches[h.source];b&&b.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(a,h,g){this.glyphManager.getGlyphs(h.stacks,g)},u.prototype.getResource=function(a,h,g){return p.makeRequest(h,g)},u}(p.Evented);gs.getSourceType=function(n){return kr[n]},gs.setSourceType=function(n,u){kr[n]=u},gs.registerForPluginStateChange=p.registerForPluginStateChange;var Aa=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),Po=Qi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),mu=Qi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),bl=Qi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Zu=Qi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Vl=Qi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),tl=Qi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),yu=Qi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ba=Qi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ju=Qi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),m=Qi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),S=Qi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),j=Qi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=Qi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ue=Qi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ie=Qi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),st=Qi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Lt=Qi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),It=Qi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),wr=Qi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),jr=Qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Qn=Qi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Mi=Qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),fi=Qi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),qn=Qi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),wa=Qi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ka=Qi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Qi(n,u){var a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),g=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=b?b.concat(g):g,D={};return{fragmentSource:n=n.replace(a,function(H,ae,be,we,Pe){return D[Pe]=!0,ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
varying `+be+" "+we+" "+Pe+`;
#else
uniform `+be+" "+we+" u_"+Pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Pe+`
    `+be+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`}),vertexSource:u=u.replace(a,function(H,ae,be,we,Pe){var We=we==="float"?"vec2":"vec4",Ve=Pe.match(/color/)?"color":We;return D[Pe]?ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
uniform lowp float u_`+Pe+`_t;
attribute `+be+" "+We+" a_"+Pe+`;
varying `+be+" "+we+" "+Pe+`;
#else
uniform `+be+" "+we+" u_"+Pe+`;
#endif
`:Ve==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Pe+" = a_"+Pe+`;
#else
    `+be+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Pe+" = unpack_mix_"+Ve+"(a_"+Pe+", u_"+Pe+`_t);
#else
    `+be+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
uniform lowp float u_`+Pe+`_t;
attribute `+be+" "+We+" a_"+Pe+`;
#else
uniform `+be+" "+we+" u_"+Pe+`;
#endif
`:Ve==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+be+" "+we+" "+Pe+" = a_"+Pe+`;
#else
    `+be+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+be+" "+we+" "+Pe+" = unpack_mix_"+Ve+"(a_"+Pe+", u_"+Pe+`_t);
#else
    `+be+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`}),staticAttributes:h,staticUniforms:P}}var cs=Object.freeze({__proto__:null,prelude:Po,background:mu,backgroundPattern:bl,circle:Zu,clippingMask:Vl,heatmap:tl,heatmapTexture:yu,collisionBox:Ba,collisionCircle:ju,debug:m,fill:S,fillOutline:j,fillOutlinePattern:O,fillPattern:ue,fillExtrusion:Ie,fillExtrusionPattern:st,hillshadePrepare:Lt,hillshade:It,line:wr,lineGradient:jr,linePattern:Qn,lineSDF:Mi,raster:fi,symbolIcon:qn,symbolSDF:wa,symbolTextAndIcon:ka}),xo=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Ts(n){for(var u=[],a=0;a<n.length;a++)if(n[a]!==null){var h=n[a].split(" ");u.push(h.pop())}return u}xo.prototype.bind=function(n,u,a,h,g,b,P,D){this.context=n;for(var H=this.boundPaintVertexBuffers.length!==h.length,ae=0;!H&&ae<h.length;ae++)this.boundPaintVertexBuffers[ae]!==h[ae]&&(H=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===a&&!H&&this.boundIndexBuffer===g&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===D?(n.bindVertexArrayOES.set(this.vao),P&&P.bind(),g&&g.dynamicDraw&&g.bind(),D&&D.bind()):this.freshBind(u,a,h,g,b,P,D)},xo.prototype.freshBind=function(n,u,a,h,g,b,P){var D,H=n.numAttributes,ae=this.context,be=ae.gl;if(ae.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ae.extVertexArrayObject.createVertexArrayOES(),ae.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=P;else{D=ae.currentNumAttributes||0;for(var we=H;we<D;we++)be.disableVertexAttribArray(we)}u.enableAttributes(be,n);for(var Pe=0,We=a;Pe<We.length;Pe+=1)We[Pe].enableAttributes(be,n);b&&b.enableAttributes(be,n),P&&P.enableAttributes(be,n),u.bind(),u.setVertexAttribPointers(be,n,g);for(var Ve=0,nt=a;Ve<nt.length;Ve+=1){var ze=nt[Ve];ze.bind(),ze.setVertexAttribPointers(be,n,g)}b&&(b.bind(),b.setVertexAttribPointers(be,n,g)),h&&h.bind(),P&&(P.bind(),P.setVertexAttribPointers(be,n,g)),ae.currentNumAttributes=H},xo.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var au=function(n,u,a,h,g,b){var P=n.gl;this.program=P.createProgram();for(var D=Ts(a.staticAttributes),H=h?h.getBinderAttributes():[],ae=D.concat(H),be=a.staticUniforms?Ts(a.staticUniforms):[],we=h?h.getBinderUniforms():[],Pe=[],We=0,Ve=be.concat(we);We<Ve.length;We+=1){var nt=Ve[We];Pe.indexOf(nt)<0&&Pe.push(nt)}var ze=h?h.defines():[];b&&ze.push("#define OVERDRAW_INSPECTOR;");var ot=ze.concat(Po.fragmentSource,a.fragmentSource).join(`
`),bt=ze.concat(Po.vertexSource,a.vertexSource).join(`
`),Zt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Zt,ot),P.compileShader(Zt),P.attachShader(this.program,Zt);var hr=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(hr,bt),P.compileShader(hr),P.attachShader(this.program,hr),this.attributes={};var ur={};this.numAttributes=ae.length;for(var gr=0;gr<this.numAttributes;gr++)ae[gr]&&(P.bindAttribLocation(this.program,gr,ae[gr]),this.attributes[ae[gr]]=gr);P.linkProgram(this.program),P.deleteShader(hr),P.deleteShader(Zt);for(var Nr=0;Nr<Pe.length;Nr++){var an=Pe[Nr];if(an&&!ur[an]){var Hr=P.getUniformLocation(this.program,an);Hr&&(ur[an]=Hr)}}this.fixedUniforms=g(n,ur),this.binderUniforms=h?h.getUniforms(n,ur):[]}}};function Bs(n,u,a){var h=1/Ui(a,1,u.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,u.transform.tileZoom)/g,P=b*(a.tileID.canonical.x+a.tileID.wrap*g),D=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,n.fromScale,n.toScale],u_fade:n.t,u_pixel_coord_upper:[P>>16,D>>16],u_pixel_coord_lower:[65535&P,65535&D]}}au.prototype.draw=function(n,u,a,h,g,b,P,D,H,ae,be,we,Pe,We,Ve,nt){var ze,ot=n.gl;if(!this.failedToCreate){for(var bt in n.program.set(this.program),n.setDepthMode(a),n.setStencilMode(h),n.setColorMode(g),n.setCullFace(b),this.fixedUniforms)this.fixedUniforms[bt].set(P[bt]);We&&We.setUniforms(n,this.binderUniforms,we,{zoom:Pe});for(var Zt=(ze={},ze[ot.LINES]=2,ze[ot.TRIANGLES]=3,ze[ot.LINE_STRIP]=1,ze)[u],hr=0,ur=be.get();hr<ur.length;hr+=1){var gr=ur[hr],Nr=gr.vaos||(gr.vaos={});(Nr[D]||(Nr[D]=new xo)).bind(n,this,H,We?We.getPaintVertexBuffers():[],ae,gr.vertexOffset,Ve,nt),ot.drawElements(u,gr.primitiveLength*Zt,ot.UNSIGNED_SHORT,gr.primitiveOffset*Zt*2)}}};var rl=function(n,u,a,h){var g=u.style.light,b=g.properties.get("position"),P=[b.x,b.y,b.z],D=p.create$1();g.properties.get("anchor")==="viewport"&&p.fromRotation(D,-u.transform.angle),p.transformMat3(P,P,D);var H=g.properties.get("color");return{u_matrix:n,u_lightpos:P,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+a,u_opacity:h}},Ys=function(n,u,a,h,g,b,P){return p.extend(rl(n,u,a,h),Bs(b,u,P),{u_height_factor:-Math.pow(2,g.overscaledZ)/P.tileSize/8})},Ks=function(n){return{u_matrix:n}},$s=function(n,u,a,h){return p.extend(Ks(n),Bs(a,u,h))},ao=function(n,u){return{u_matrix:n,u_world:u}},wu=function(n,u,a,h,g){return p.extend($s(n,u,a,h),{u_world:g})},nl=function(n,u,a,h){var g,b,P=n.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var D=Ui(a,1,P.zoom);g=!0,b=[D,D]}else g=!1,b=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:n.translatePosMatrix(u.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:b}},fs=function(n,u,a){var h=Ui(a,1,u.zoom),g=Math.pow(2,u.zoom-a.tileID.overscaledZ),b=a.tileID.overscaleFactor();return{u_matrix:n,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*g),u.pixelsToGLUnits[1]/(h*g)],u_overscale_factor:b}},Gl=function(n,u,a){return{u_matrix:n,u_inv_matrix:u,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}},ou=function(n,u,a){return a===void 0&&(a=1),{u_matrix:n,u_color:u,u_overlay:0,u_overlay_scale:a}},Ns=function(n){return{u_matrix:n}},uc=function(n,u,a,h){return{u_matrix:n,u_extrude_scale:Ui(u,1,a),u_intensity:h}},Cu=function(n,u,a){var h=n.transform;return{u_matrix:lc(n,u,a),u_ratio:1/Ui(u,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ta=function(n,u,a,h){return p.extend(Cu(n,u,a),{u_image:0,u_image_height:h})},Au=function(n,u,a,h){var g=n.transform,b=Tu(u,g);return{u_matrix:lc(n,u,a),u_texsize:u.imageAtlasTexture.size,u_ratio:1/Ui(u,1,g.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[b,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Hl=function(n,u,a,h,g){var b=n.lineAtlas,P=Tu(u,n.transform),D=a.layout.get("line-cap")==="round",H=b.getDash(h.from,D),ae=b.getDash(h.to,D),be=H.width*g.fromScale,we=ae.width*g.toScale;return p.extend(Cu(n,u,a),{u_patternscale_a:[P/be,-H.height/2],u_patternscale_b:[P/we,-ae.height/2],u_sdfgamma:b.width/(256*Math.min(be,we)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:ae.y,u_mix:g.t})};function Tu(n,u){return 1/Ui(n,1,u.tileZoom)}function lc(n,u,a){return n.translatePosMatrix(u.tileID.posMatrix,u,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}var cc=function(n,u,a,h,g){return{u_matrix:n,u_tl_parent:u,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(P=g.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Rc(g.paint.get("raster-hue-rotate"))};var b,P};function Rc(n){n*=Math.PI/180;var u=Math.sin(n),a=Math.cos(n);return[(2*a+1)/3,(-Math.sqrt(3)*u-a+1)/3,(Math.sqrt(3)*u-a+1)/3]}var kc,Sl=function(n,u,a,h,g,b,P,D,H,ae){var be=g.transform;return{u_is_size_zoom_constant:+(n==="constant"||n==="source"),u_is_size_feature_constant:+(n==="constant"||n==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:be.cameraToCenterDistance,u_pitch:be.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:be.width/be.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:P,u_coord_matrix:D,u_is_text:+H,u_pitch_with_map:+h,u_texsize:ae,u_texture:0}},gu=function(n,u,a,h,g,b,P,D,H,ae,be){var we=g.transform;return p.extend(Sl(n,u,a,h,g,b,P,D,H,ae),{u_gamma_scale:h?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+be})},il=function(n,u,a,h,g,b,P,D,H,ae){return p.extend(gu(n,u,a,h,g,b,P,D,!0,H,!0),{u_texsize_icon:ae,u_texture_icon:1})},al=function(n,u,a){return{u_matrix:n,u_opacity:u,u_color:a}},Vu=function(n,u,a,h,g,b){return p.extend(function(P,D,H,ae){var be=H.imageManager.getPattern(P.from.toString()),we=H.imageManager.getPattern(P.to.toString()),Pe=H.imageManager.getPixelSize(),We=Pe.width,Ve=Pe.height,nt=Math.pow(2,ae.tileID.overscaledZ),ze=ae.tileSize*Math.pow(2,H.transform.tileZoom)/nt,ot=ze*(ae.tileID.canonical.x+ae.tileID.wrap*nt),bt=ze*ae.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:be.tl,u_pattern_br_a:be.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[We,Ve],u_mix:D.t,u_pattern_size_a:be.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/Ui(ae,1,H.transform.tileZoom),u_pixel_coord_upper:[ot>>16,bt>>16],u_pixel_coord_lower:[65535&ot,65535&bt]}}(h,b,a,g),{u_matrix:n,u_opacity:u})},ol={fillExtrusion:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fillExtrusionPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_height_factor:new p.Uniform1f(n,u.u_height_factor),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fill:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},fillPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},fillOutline:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world)}},fillOutlinePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},circle:function(n,u){return{u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(n,u.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},collisionBox:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(n,u.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_overscale_factor:new p.Uniform1f(n,u.u_overscale_factor)}},collisionCircle:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_inv_matrix:new p.UniformMatrix4f(n,u.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(n,u.u_viewport_size)}},debug:function(n,u){return{u_color:new p.UniformColor(n,u.u_color),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_overlay:new p.Uniform1i(n,u.u_overlay),u_overlay_scale:new p.Uniform1f(n,u.u_overlay_scale)}},clippingMask:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmap:function(n,u){return{u_extrude_scale:new p.Uniform1f(n,u.u_extrude_scale),u_intensity:new p.Uniform1f(n,u.u_intensity),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmapTexture:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_color_ramp:new p.Uniform1i(n,u.u_color_ramp),u_opacity:new p.Uniform1f(n,u.u_opacity)}},hillshade:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_latrange:new p.Uniform2f(n,u.u_latrange),u_light:new p.Uniform2f(n,u.u_light),u_shadow:new p.UniformColor(n,u.u_shadow),u_highlight:new p.UniformColor(n,u.u_highlight),u_accent:new p.UniformColor(n,u.u_accent)}},hillshadePrepare:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_dimension:new p.Uniform2f(n,u.u_dimension),u_zoom:new p.Uniform1f(n,u.u_zoom),u_unpack:new p.Uniform4f(n,u.u_unpack)}},line:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels)}},lineGradient:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_image:new p.Uniform1i(n,u.u_image),u_image_height:new p.Uniform1f(n,u.u_image_height)}},linePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_texsize:new p.Uniform2f(n,u.u_texsize),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_image:new p.Uniform1i(n,u.u_image),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},lineSDF:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(n,u.u_patternscale_a),u_patternscale_b:new p.Uniform2f(n,u.u_patternscale_b),u_sdfgamma:new p.Uniform1f(n,u.u_sdfgamma),u_image:new p.Uniform1i(n,u.u_image),u_tex_y_a:new p.Uniform1f(n,u.u_tex_y_a),u_tex_y_b:new p.Uniform1f(n,u.u_tex_y_b),u_mix:new p.Uniform1f(n,u.u_mix)}},raster:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_tl_parent:new p.Uniform2f(n,u.u_tl_parent),u_scale_parent:new p.Uniform1f(n,u.u_scale_parent),u_buffer_scale:new p.Uniform1f(n,u.u_buffer_scale),u_fade_t:new p.Uniform1f(n,u.u_fade_t),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image0:new p.Uniform1i(n,u.u_image0),u_image1:new p.Uniform1i(n,u.u_image1),u_brightness_low:new p.Uniform1f(n,u.u_brightness_low),u_brightness_high:new p.Uniform1f(n,u.u_brightness_high),u_saturation_factor:new p.Uniform1f(n,u.u_saturation_factor),u_contrast_factor:new p.Uniform1f(n,u.u_contrast_factor),u_spin_weights:new p.Uniform3f(n,u.u_spin_weights)}},symbolIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture)}},symbolSDF:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},symbolTextAndIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texsize_icon:new p.Uniform2f(n,u.u_texsize_icon),u_texture:new p.Uniform1i(n,u.u_texture),u_texture_icon:new p.Uniform1i(n,u.u_texture_icon),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},background:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_color:new p.UniformColor(n,u.u_color)}},backgroundPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image:new p.Uniform1i(n,u.u_image),u_pattern_tl_a:new p.Uniform2f(n,u.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(n,u.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(n,u.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(n,u.u_pattern_br_b),u_texsize:new p.Uniform2f(n,u.u_texsize),u_mix:new p.Uniform1f(n,u.u_mix),u_pattern_size_a:new p.Uniform2f(n,u.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(n,u.u_pattern_size_b),u_scale_a:new p.Uniform1f(n,u.u_scale_a),u_scale_b:new p.Uniform1f(n,u.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(n,u.u_tile_units_to_pixels)}}};function Gu(n,u,a,h,g,b,P){for(var D=n.context,H=D.gl,ae=n.useProgram("collisionBox"),be=[],we=0,Pe=0,We=0;We<h.length;We++){var Ve=h[We],nt=u.getTile(Ve),ze=nt.getBucket(a);if(ze){var ot=Ve.posMatrix;g[0]===0&&g[1]===0||(ot=n.translatePosMatrix(Ve.posMatrix,nt,g,b));var bt=P?ze.textCollisionBox:ze.iconCollisionBox,Zt=ze.collisionCircleArray;if(Zt.length>0){var hr=p.create(),ur=ot;p.mul(hr,ze.placementInvProjMatrix,n.transform.glCoordMatrix),p.mul(hr,hr,ze.placementViewportMatrix),be.push({circleArray:Zt,circleOffset:Pe,transform:ur,invTransform:hr}),Pe=we+=Zt.length/4}bt&&ae.draw(D,H.LINES,z.disabled,oe.disabled,n.colorModeForRenderPass(),Ae.disabled,fs(ot,n.transform,nt),a.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,null,n.transform.zoom,null,null,bt.collisionVertexBuffer)}}if(P&&be.length){var gr=n.useProgram("collisionCircle"),Nr=new p.StructArrayLayout2f1f2i16;Nr.resize(4*we),Nr._trim();for(var an=0,Hr=0,In=be;Hr<In.length;Hr+=1)for(var ni=In[Hr],hi=0;hi<ni.circleArray.length/4;hi++){var ii=4*hi,ea=ni.circleArray[ii+0],Bn=ni.circleArray[ii+1],_i=ni.circleArray[ii+2],te=ni.circleArray[ii+3];Nr.emplace(an++,ea,Bn,_i,te,0),Nr.emplace(an++,ea,Bn,_i,te,1),Nr.emplace(an++,ea,Bn,_i,te,2),Nr.emplace(an++,ea,Bn,_i,te,3)}(!kc||kc.length<2*we)&&(kc=function(wt){var At=2*wt,qt=new p.StructArrayLayout3ui6;qt.resize(At),qt._trim();for(var Pr=0;Pr<At;Pr++){var vn=6*Pr;qt.uint16[vn+0]=4*Pr+0,qt.uint16[vn+1]=4*Pr+1,qt.uint16[vn+2]=4*Pr+2,qt.uint16[vn+3]=4*Pr+2,qt.uint16[vn+4]=4*Pr+3,qt.uint16[vn+5]=4*Pr+0}return qt}(we));for(var q=D.createIndexBuffer(kc,!0),R=D.createVertexBuffer(Nr,p.collisionCircleLayout.members,!0),F=0,ne=be;F<ne.length;F+=1){var pe=ne[F],ht=Gl(pe.transform,pe.invTransform,n.transform);gr.draw(D,H.TRIANGLES,z.disabled,oe.disabled,n.colorModeForRenderPass(),Ae.disabled,ht,a.id,R,q,p.SegmentVector.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,n.transform.zoom,null,null,null)}R.destroy(),q.destroy()}}var zs=p.identity(new Float32Array(16));function fc(n,u,a,h,g,b){var P=p.getAnchorAlignment(n),D=-(P.horizontalAlign-.5)*u,H=-(P.verticalAlign-.5)*a,ae=p.evaluateVariableOffset(n,h);return new p.Point((D/g+ae[0])*b,(H/g+ae[1])*b)}function hc(n,u,a,h,g,b,P,D,H,ae,be){var we=n.text.placedSymbolArray,Pe=n.text.dynamicLayoutVertexArray,We=n.icon.dynamicLayoutVertexArray,Ve={};Pe.clear();for(var nt=0;nt<we.length;nt++){var ze=we.get(nt),ot=ze.hidden||!ze.crossTileID||n.allowVerticalPlacement&&!ze.placedOrientation?null:h[ze.crossTileID];if(ot){var bt=new p.Point(ze.anchorX,ze.anchorY),Zt=ri(bt,a?D:P),hr=Gi(b.cameraToCenterDistance,Zt.signedDistanceFromCamera),ur=g.evaluateSizeForFeature(n.textSizeData,ae,ze)*hr/p.ONE_EM;a&&(ur*=n.tilePixelRatio/H);for(var gr=fc(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale,ur),Nr=a?ri(bt.add(gr),P).point:Zt.point.add(u?gr.rotate(-b.angle):gr),an=n.allowVerticalPlacement&&ze.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,Hr=0;Hr<ze.numGlyphs;Hr++)p.addDynamicAttributes(Pe,Nr,an);be&&ze.associatedIconIndex>=0&&(Ve[ze.associatedIconIndex]={shiftedAnchor:Nr,angle:an})}else Xa(ze.numGlyphs,Pe)}if(be){We.clear();for(var In=n.icon.placedSymbolArray,ni=0;ni<In.length;ni++){var hi=In.get(ni);if(hi.hidden)Xa(hi.numGlyphs,We);else{var ii=Ve[ni];if(ii)for(var ea=0;ea<hi.numGlyphs;ea++)p.addDynamicAttributes(We,ii.shiftedAnchor,ii.angle);else Xa(hi.numGlyphs,We)}}n.icon.dynamicLayoutVertexBuffer.updateData(We)}n.text.dynamicLayoutVertexBuffer.updateData(Pe)}function Dc(n,u,a){return a.iconsInText&&u?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function Hu(n,u,a,h,g,b,P,D,H,ae,be,we){for(var Pe=n.context,We=Pe.gl,Ve=n.transform,nt=D==="map",ze=H==="map",ot=nt&&a.layout.get("symbol-placement")!=="point",bt=nt&&!ze&&!ot,Zt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,hr=!1,ur=n.depthModeForSublayer(0,z.ReadOnly),gr=a.layout.get("text-variable-anchor"),Nr=[],an=0,Hr=h;an<Hr.length;an+=1){var In=Hr[an],ni=u.getTile(In),hi=ni.getBucket(a);if(hi){var ii=g?hi.text:hi.icon;if(ii&&ii.segments.get().length){var ea=ii.programConfigurations.get(a.id),Bn=g||hi.sdfIcons,_i=g?hi.textSizeData:hi.iconSizeData,te=ze||Ve.pitch!==0,q=n.useProgram(Dc(Bn,g,hi),ea),R=p.evaluateSizeForZoom(_i,Ve.zoom),F=void 0,ne=[0,0],pe=void 0,ht=void 0,wt=null,At=void 0;if(g)pe=ni.glyphAtlasTexture,ht=We.LINEAR,F=ni.glyphAtlasTexture.size,hi.iconsInText&&(ne=ni.imageAtlasTexture.size,wt=ni.imageAtlasTexture,At=te||n.options.rotating||n.options.zooming||_i.kind==="composite"||_i.kind==="camera"?We.LINEAR:We.NEAREST);else{var qt=a.layout.get("icon-size").constantOr(0)!==1||hi.iconsNeedLinear;pe=ni.imageAtlasTexture,ht=Bn||n.options.rotating||n.options.zooming||qt||te?We.LINEAR:We.NEAREST,F=ni.imageAtlasTexture.size}var Pr=Ui(ni,1,n.transform.zoom),vn=Sa(In.posMatrix,ze,nt,n.transform,Pr),zn=oi(In.posMatrix,ze,nt,n.transform,Pr),$n=gr&&hi.hasTextData(),xi=a.layout.get("icon-text-fit")!=="none"&&$n&&hi.hasIconData();ot&&Ho(hi,In.posMatrix,n,g,vn,zn,ze,ae);var li=n.translatePosMatrix(In.posMatrix,ni,b,P),Zi=ot||g&&gr||xi?zs:vn,$i=n.translatePosMatrix(zn,ni,b,P,!0),ba=Bn&&a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,oo={program:q,buffers:ii,uniformValues:Bn?hi.iconsInText?il(_i.kind,R,bt,ze,n,li,Zi,$i,F,ne):gu(_i.kind,R,bt,ze,n,li,Zi,$i,g,F,!0):Sl(_i.kind,R,bt,ze,n,li,Zi,$i,g,F),atlasTexture:pe,atlasTextureIcon:wt,atlasInterpolation:ht,atlasInterpolationIcon:At,isSDF:Bn,hasHalo:ba};if(Zt&&hi.canOverlap){hr=!0;for(var Ia=0,ho=ii.segments.get();Ia<ho.length;Ia+=1){var Va=ho[Ia];Nr.push({segments:new p.SegmentVector([Va]),sortKey:Va.sortKey,state:oo})}}else Nr.push({segments:ii.segments,sortKey:0,state:oo})}}}hr&&Nr.sort(function(Eo,Fo){return Eo.sortKey-Fo.sortKey});for(var ta=0,da=Nr;ta<da.length;ta+=1){var Na=da[ta],ha=Na.state;if(Pe.activeTexture.set(We.TEXTURE0),ha.atlasTexture.bind(ha.atlasInterpolation,We.CLAMP_TO_EDGE),ha.atlasTextureIcon&&(Pe.activeTexture.set(We.TEXTURE1),ha.atlasTextureIcon&&ha.atlasTextureIcon.bind(ha.atlasInterpolationIcon,We.CLAMP_TO_EDGE)),ha.isSDF){var Pa=ha.uniformValues;ha.hasHalo&&(Pa.u_is_halo=1,El(ha.buffers,Na.segments,a,n,ha.program,ur,be,we,Pa)),Pa.u_is_halo=0}El(ha.buffers,Na.segments,a,n,ha.program,ur,be,we,ha.uniformValues)}}function El(n,u,a,h,g,b,P,D,H){var ae=h.context;g.draw(ae,ae.gl.TRIANGLES,b,P,D,Ae.disabled,H,a.id,n.layoutVertexBuffer,n.indexBuffer,u,a.paint,h.transform.zoom,n.programConfigurations.get(a.id),n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer)}function Wl(n,u,a,h,g,b,P){var D,H,ae,be,we,Pe=n.context.gl,We=a.paint.get("fill-pattern"),Ve=We&&We.constantOr(1),nt=a.getCrossfadeParameters();P?(H=Ve&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=Pe.LINES):(H=Ve?"fillPattern":"fill",D=Pe.TRIANGLES);for(var ze=0,ot=h;ze<ot.length;ze+=1){var bt=ot[ze],Zt=u.getTile(bt);if(!Ve||Zt.patternsLoaded()){var hr=Zt.getBucket(a);if(hr){var ur=hr.programConfigurations.get(a.id),gr=n.useProgram(H,ur);Ve&&(n.context.activeTexture.set(Pe.TEXTURE0),Zt.imageAtlasTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),ur.updatePaintBuffers(nt));var Nr=We.constantOr(null);if(Nr&&Zt.imageAtlas){var an=Zt.imageAtlas,Hr=an.patternPositions[Nr.to.toString()],In=an.patternPositions[Nr.from.toString()];Hr&&In&&ur.setConstantPatternPositions(Hr,In)}var ni=n.translatePosMatrix(bt.posMatrix,Zt,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(P){be=hr.indexBuffer2,we=hr.segments2;var hi=[Pe.drawingBufferWidth,Pe.drawingBufferHeight];ae=H==="fillOutlinePattern"&&Ve?wu(ni,n,nt,Zt,hi):ao(ni,hi)}else be=hr.indexBuffer,we=hr.segments,ae=Ve?$s(ni,n,nt,Zt):Ks(ni);gr.draw(n.context,D,g,n.stencilModeForClipping(bt),b,Ae.disabled,ae,a.id,hr.layoutVertexBuffer,be,we,a.paint,n.transform.zoom,ur)}}}}function pc(n,u,a,h,g,b,P){for(var D=n.context,H=D.gl,ae=a.paint.get("fill-extrusion-pattern"),be=ae.constantOr(1),we=a.getCrossfadeParameters(),Pe=a.paint.get("fill-extrusion-opacity"),We=0,Ve=h;We<Ve.length;We+=1){var nt=Ve[We],ze=u.getTile(nt),ot=ze.getBucket(a);if(ot){var bt=ot.programConfigurations.get(a.id),Zt=n.useProgram(be?"fillExtrusionPattern":"fillExtrusion",bt);be&&(n.context.activeTexture.set(H.TEXTURE0),ze.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),bt.updatePaintBuffers(we));var hr=ae.constantOr(null);if(hr&&ze.imageAtlas){var ur=ze.imageAtlas,gr=ur.patternPositions[hr.to.toString()],Nr=ur.patternPositions[hr.from.toString()];gr&&Nr&&bt.setConstantPatternPositions(gr,Nr)}var an=n.translatePosMatrix(nt.posMatrix,ze,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Hr=a.paint.get("fill-extrusion-vertical-gradient"),In=be?Ys(an,n,Hr,Pe,nt,we,ze):rl(an,n,Hr,Pe);Zt.draw(D,D.gl.TRIANGLES,g,b,P,Ae.backCCW,In,a.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,a.paint,n.transform.zoom,bt)}}}function Wu(n,u,a,h,g,b){var P=n.context,D=P.gl,H=u.fbo;if(H){var ae=n.useProgram("hillshade");P.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,H.colorAttachment.get());var be=function(we,Pe,We){var Ve=We.paint.get("hillshade-shadow-color"),nt=We.paint.get("hillshade-highlight-color"),ze=We.paint.get("hillshade-accent-color"),ot=We.paint.get("hillshade-illumination-direction")*(Math.PI/180);We.paint.get("hillshade-illumination-anchor")==="viewport"&&(ot-=we.transform.angle);var bt,Zt,hr,ur=!we.options.moving;return{u_matrix:we.transform.calculatePosMatrix(Pe.tileID.toUnwrapped(),ur),u_image:0,u_latrange:(bt=Pe.tileID,Zt=Math.pow(2,bt.canonical.z),hr=bt.canonical.y,[new p.MercatorCoordinate(0,hr/Zt).toLngLat().lat,new p.MercatorCoordinate(0,(hr+1)/Zt).toLngLat().lat]),u_light:[We.paint.get("hillshade-exaggeration"),ot],u_shadow:Ve,u_highlight:nt,u_accent:ze}}(n,u,a);ae.draw(P,D.TRIANGLES,h,g,b,Ae.disabled,be,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}}function wl(n,u,a,h,g,b){var P=n.context,D=P.gl,H=u.dem;if(H&&H.data){var ae=H.dim,be=H.stride,we=H.getPixels();if(P.activeTexture.set(D.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||n.getTileTexture(be),u.demTexture){var Pe=u.demTexture;Pe.update(we,{premultiply:!1}),Pe.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else u.demTexture=new p.Texture(P,we,D.RGBA,{premultiply:!1}),u.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);P.activeTexture.set(D.TEXTURE0);var We=u.fbo;if(!We){var Ve=new p.Texture(P,{width:ae,height:ae,data:null},D.RGBA);Ve.bind(D.LINEAR,D.CLAMP_TO_EDGE),(We=u.fbo=P.createFramebuffer(ae,ae,!0)).colorAttachment.set(Ve.texture)}P.bindFramebuffer.set(We.framebuffer),P.viewport.set([0,0,ae,ae]),n.useProgram("hillshadePrepare").draw(P,D.TRIANGLES,h,g,b,Ae.disabled,function(nt,ze){var ot=ze.stride,bt=p.create();return p.ortho(bt,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(bt,bt,[0,-p.EXTENT,0]),{u_matrix:bt,u_image:1,u_dimension:[ot,ot],u_zoom:nt.overscaledZ,u_unpack:ze.getUnpackVector()}}(u.tileID,H),a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Cl(n,u,a,h,g){var b=h.paint.get("raster-fade-duration");if(b>0){var P=p.browser.now(),D=(P-n.timeAdded)/b,H=u?(P-u.timeAdded)/b:-1,ae=a.getSource(),be=g.coveringZoomLevel({tileSize:ae.tileSize,roundZoom:ae.roundZoom}),we=!u||Math.abs(u.tileID.overscaledZ-be)>Math.abs(n.tileID.overscaledZ-be),Pe=we&&n.refreshedUponExpiration?1:p.clamp(we?D:1-H,0,1);return n.refreshedUponExpiration&&D>=1&&(n.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Pe}:{opacity:Pe,mix:0}}return{opacity:1,mix:0}}var Pu=new p.Color(1,0,0,1),Xl=new p.Color(0,1,0,1),za=new p.Color(0,0,1,1),Mu=new p.Color(1,0,1,1),sl=new p.Color(0,1,1,1);function Yl(n,u,a,h){Xu(n,0,u+a/2,n.transform.width,a,h)}function Kl(n,u,a,h){Xu(n,u-a/2,0,a,n.transform.height,h)}function Xu(n,u,a,h,g,b){var P=n.context,D=P.gl;D.enable(D.SCISSOR_TEST),D.scissor(u*p.browser.devicePixelRatio,a*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,g*p.browser.devicePixelRatio),P.clear({color:b}),D.disable(D.SCISSOR_TEST)}function $c(n,u,a){var h=n.context,g=h.gl,b=a.posMatrix,P=n.useProgram("debug"),D=z.disabled,H=oe.disabled,ae=n.colorModeForRenderPass();h.activeTexture.set(g.TEXTURE0),n.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),P.draw(h,g.LINE_STRIP,D,H,ae,Ae.disabled,ou(b,p.Color.red),"$debug",n.debugBuffer,n.tileBorderIndexBuffer,n.debugSegments);var be=u.getTileByID(a.key).latestRawTileData,we=Math.floor((be&&be.byteLength||0)/1024),Pe=u.getTile(a).tileSize,We=512/Math.min(Pe,512)*(a.overscaledZ/n.transform.zoom)*.5,Ve=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ve+=" => "+a.overscaledZ),function(nt,ze){nt.initDebugOverlayCanvas();var ot=nt.debugOverlayCanvas,bt=nt.context.gl,Zt=nt.debugOverlayCanvas.getContext("2d");Zt.clearRect(0,0,ot.width,ot.height),Zt.shadowColor="white",Zt.shadowBlur=2,Zt.lineWidth=1.5,Zt.strokeStyle="white",Zt.textBaseline="top",Zt.font="bold 36px Open Sans, sans-serif",Zt.fillText(ze,5,5),Zt.strokeText(ze,5,5),nt.debugOverlayTexture.update(ot),nt.debugOverlayTexture.bind(bt.LINEAR,bt.CLAMP_TO_EDGE)}(n,Ve+" "+we+"kb"),P.draw(h,g.TRIANGLES,D,H,ve.alphaBlended,Ae.disabled,ou(b,p.Color.transparent,We),"$debug",n.debugBuffer,n.quadTriangleIndexBuffer,n.debugSegments)}var ul={symbol:function(n,u,a,h,g){if(n.renderPass==="translucent"){var b=oe.disabled,P=n.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(D,H,ae,be,we,Pe,We){for(var Ve=H.transform,nt=we==="map",ze=Pe==="map",ot=0,bt=D;ot<bt.length;ot+=1){var Zt=bt[ot],hr=be.getTile(Zt),ur=hr.getBucket(ae);if(ur&&ur.text&&ur.text.segments.get().length){var gr=p.evaluateSizeForZoom(ur.textSizeData,Ve.zoom),Nr=Ui(hr,1,H.transform.zoom),an=Sa(Zt.posMatrix,ze,nt,H.transform,Nr),Hr=ae.layout.get("icon-text-fit")!=="none"&&ur.hasIconData();if(gr){var In=Math.pow(2,Ve.zoom-hr.tileID.overscaledZ);hc(ur,nt,ze,We,p.symbolSize,Ve,an,Zt.posMatrix,In,gr,Hr)}}}}(h,n,a,u,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g),a.paint.get("icon-opacity").constantOr(1)!==0&&Hu(n,u,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),b,P),a.paint.get("text-opacity").constantOr(1)!==0&&Hu(n,u,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),b,P),u.map.showCollisionBoxes&&(Gu(n,u,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Gu(n,u,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))}},circle:function(n,u,a,h){if(n.renderPass==="translucent"){var g=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),P=a.paint.get("circle-stroke-opacity"),D=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)!==0||b.constantOr(1)!==0&&P.constantOr(1)!==0){for(var H=n.context,ae=H.gl,be=n.depthModeForSublayer(0,z.ReadOnly),we=oe.disabled,Pe=n.colorModeForRenderPass(),We=[],Ve=0;Ve<h.length;Ve++){var nt=h[Ve],ze=u.getTile(nt),ot=ze.getBucket(a);if(ot){var bt=ot.programConfigurations.get(a.id),Zt={programConfiguration:bt,program:n.useProgram("circle",bt),layoutVertexBuffer:ot.layoutVertexBuffer,indexBuffer:ot.indexBuffer,uniformValues:nl(n,nt,ze,a)};if(D)for(var hr=0,ur=ot.segments.get();hr<ur.length;hr+=1){var gr=ur[hr];We.push({segments:new p.SegmentVector([gr]),sortKey:gr.sortKey,state:Zt})}else We.push({segments:ot.segments,sortKey:0,state:Zt})}}D&&We.sort(function(ni,hi){return ni.sortKey-hi.sortKey});for(var Nr=0,an=We;Nr<an.length;Nr+=1){var Hr=an[Nr],In=Hr.state;In.program.draw(H,ae.TRIANGLES,be,we,Pe,Ae.disabled,In.uniformValues,a.id,In.layoutVertexBuffer,In.indexBuffer,Hr.segments,a.paint,n.transform.zoom,In.programConfiguration)}}}},heatmap:function(n,u,a,h){if(a.paint.get("heatmap-opacity")!==0)if(n.renderPass==="offscreen"){var g=n.context,b=g.gl,P=oe.disabled,D=new ve([b.ONE,b.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(We,Ve,nt){var ze=We.gl;We.activeTexture.set(ze.TEXTURE1),We.viewport.set([0,0,Ve.width/4,Ve.height/4]);var ot=nt.heatmapFbo;if(ot)ze.bindTexture(ze.TEXTURE_2D,ot.colorAttachment.get()),We.bindFramebuffer.set(ot.framebuffer);else{var bt=ze.createTexture();ze.bindTexture(ze.TEXTURE_2D,bt),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_S,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_T,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MIN_FILTER,ze.LINEAR),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MAG_FILTER,ze.LINEAR),ot=nt.heatmapFbo=We.createFramebuffer(Ve.width/4,Ve.height/4,!1),function(Zt,hr,ur,gr){var Nr=Zt.gl;Nr.texImage2D(Nr.TEXTURE_2D,0,Nr.RGBA,hr.width/4,hr.height/4,0,Nr.RGBA,Zt.extRenderToTextureHalfFloat?Zt.extTextureHalfFloat.HALF_FLOAT_OES:Nr.UNSIGNED_BYTE,null),gr.colorAttachment.set(ur)}(We,Ve,bt,ot)}})(g,n,a),g.clear({color:p.Color.transparent});for(var H=0;H<h.length;H++){var ae=h[H];if(!u.hasRenderableParent(ae)){var be=u.getTile(ae),we=be.getBucket(a);if(we){var Pe=we.programConfigurations.get(a.id);n.useProgram("heatmap",Pe).draw(g,b.TRIANGLES,z.disabled,P,D,Ae.disabled,uc(ae.posMatrix,be,n.transform.zoom,a.paint.get("heatmap-intensity")),a.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,a.paint,n.transform.zoom,Pe)}}}g.viewport.set([0,0,n.width,n.height])}else n.renderPass==="translucent"&&(n.context.setColorMode(n.colorModeForRenderPass()),function(We,Ve){var nt=We.context,ze=nt.gl,ot=Ve.heatmapFbo;if(ot){nt.activeTexture.set(ze.TEXTURE0),ze.bindTexture(ze.TEXTURE_2D,ot.colorAttachment.get()),nt.activeTexture.set(ze.TEXTURE1);var bt=Ve.colorRampTexture;bt||(bt=Ve.colorRampTexture=new p.Texture(nt,Ve.colorRamp,ze.RGBA)),bt.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),We.useProgram("heatmapTexture").draw(nt,ze.TRIANGLES,z.disabled,oe.disabled,We.colorModeForRenderPass(),Ae.disabled,function(Zt,hr,ur,gr){var Nr=p.create();p.ortho(Nr,0,Zt.width,Zt.height,0,0,1);var an=Zt.context.gl;return{u_matrix:Nr,u_world:[an.drawingBufferWidth,an.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:hr.paint.get("heatmap-opacity")}}(We,Ve),Ve.id,We.viewportBuffer,We.quadTriangleIndexBuffer,We.viewportSegments,Ve.paint,We.transform.zoom)}}(n,a))},line:function(n,u,a,h){if(n.renderPass==="translucent"){var g=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(g.constantOr(1)!==0&&b.constantOr(1)!==0)for(var P=n.depthModeForSublayer(0,z.ReadOnly),D=n.colorModeForRenderPass(),H=a.paint.get("line-dasharray"),ae=a.paint.get("line-pattern"),be=ae.constantOr(1),we=a.paint.get("line-gradient"),Pe=a.getCrossfadeParameters(),We=be?"linePattern":H?"lineSDF":we?"lineGradient":"line",Ve=n.context,nt=Ve.gl,ze=!0,ot=0,bt=h;ot<bt.length;ot+=1){var Zt=bt[ot],hr=u.getTile(Zt);if(!be||hr.patternsLoaded()){var ur=hr.getBucket(a);if(ur){var gr=ur.programConfigurations.get(a.id),Nr=n.context.program.get(),an=n.useProgram(We,gr),Hr=ze||an.program!==Nr,In=ae.constantOr(null);if(In&&hr.imageAtlas){var ni=hr.imageAtlas,hi=ni.patternPositions[In.to.toString()],ii=ni.patternPositions[In.from.toString()];hi&&ii&&gr.setConstantPatternPositions(hi,ii)}var ea=be?Au(n,hr,a,Pe):H?Hl(n,hr,a,H,Pe):we?Ta(n,hr,a,ur.lineClipsArray.length):Cu(n,hr,a);if(be)Ve.activeTexture.set(nt.TEXTURE0),hr.imageAtlasTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),gr.updatePaintBuffers(Pe);else if(H&&(Hr||n.lineAtlas.dirty))Ve.activeTexture.set(nt.TEXTURE0),n.lineAtlas.bind(Ve);else if(we){var Bn=ur.gradients[a.id],_i=Bn.texture;if(a.gradientVersion!==Bn.version){var te=256;if(a.stepInterpolant){var q=u.getSource().maxzoom,R=Zt.canonical.z===q?Math.ceil(1<<n.transform.maxZoom-Zt.canonical.z):1;te=p.clamp(p.nextPowerOfTwo(ur.maxLineLength/p.EXTENT*1024*R),256,Ve.maxTextureSize)}Bn.gradient=p.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:te,image:Bn.gradient||void 0,clips:ur.lineClipsArray}),Bn.texture?Bn.texture.update(Bn.gradient):Bn.texture=new p.Texture(Ve,Bn.gradient,nt.RGBA),Bn.version=a.gradientVersion,_i=Bn.texture}Ve.activeTexture.set(nt.TEXTURE0),_i.bind(a.stepInterpolant?nt.NEAREST:nt.LINEAR,nt.CLAMP_TO_EDGE)}an.draw(Ve,nt.TRIANGLES,P,n.stencilModeForClipping(Zt),D,Ae.disabled,ea,a.id,ur.layoutVertexBuffer,ur.indexBuffer,ur.segments,a.paint,n.transform.zoom,gr,ur.layoutVertexBuffer2),ze=!1}}}}},fill:function(n,u,a,h){var g=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)!==0){var P=n.colorModeForRenderPass(),D=a.paint.get("fill-pattern"),H=n.opaquePassEnabledForLayer()&&!D.constantOr(1)&&g.constantOr(p.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(n.renderPass===H){var ae=n.depthModeForSublayer(1,n.renderPass==="opaque"?z.ReadWrite:z.ReadOnly);Wl(n,u,a,h,ae,P,!1)}if(n.renderPass==="translucent"&&a.paint.get("fill-antialias")){var be=n.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,z.ReadOnly);Wl(n,u,a,h,be,P,!0)}}},"fill-extrusion":function(n,u,a,h){var g=a.paint.get("fill-extrusion-opacity");if(g!==0&&n.renderPass==="translucent"){var b=new z(n.context.gl.LEQUAL,z.ReadWrite,n.depthRangeFor3D);if(g!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))pc(n,u,a,h,b,oe.disabled,ve.disabled),pc(n,u,a,h,b,n.stencilModeFor3D(),n.colorModeForRenderPass());else{var P=n.colorModeForRenderPass();pc(n,u,a,h,b,oe.disabled,P)}}},hillshade:function(n,u,a,h){if(n.renderPass==="offscreen"||n.renderPass==="translucent"){for(var g=n.context,b=n.depthModeForSublayer(0,z.ReadOnly),P=n.colorModeForRenderPass(),D=n.renderPass==="translucent"?n.stencilConfigForOverlap(h):[{},h],H=D[0],ae=0,be=D[1];ae<be.length;ae+=1){var we=be[ae],Pe=u.getTile(we);Pe.needsHillshadePrepare&&n.renderPass==="offscreen"?wl(n,Pe,a,b,oe.disabled,P):n.renderPass==="translucent"&&Wu(n,Pe,a,b,H[we.overscaledZ],P)}g.viewport.set([0,0,n.width,n.height])}},raster:function(n,u,a,h){if(n.renderPass==="translucent"&&a.paint.get("raster-opacity")!==0&&h.length)for(var g=n.context,b=g.gl,P=u.getSource(),D=n.useProgram("raster"),H=n.colorModeForRenderPass(),ae=P instanceof ft?[{},h]:n.stencilConfigForOverlap(h),be=ae[0],we=ae[1],Pe=we[we.length-1].overscaledZ,We=!n.options.moving,Ve=0,nt=we;Ve<nt.length;Ve+=1){var ze=nt[Ve],ot=n.depthModeForSublayer(ze.overscaledZ-Pe,a.paint.get("raster-opacity")===1?z.ReadWrite:z.ReadOnly,b.LESS),bt=u.getTile(ze),Zt=n.transform.calculatePosMatrix(ze.toUnwrapped(),We);bt.registerFadeDuration(a.paint.get("raster-fade-duration"));var hr=u.findLoadedParent(ze,0),ur=Cl(bt,hr,u,a,n.transform),gr=void 0,Nr=void 0,an=a.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;g.activeTexture.set(b.TEXTURE0),bt.texture.bind(an,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(b.TEXTURE1),hr?(hr.texture.bind(an,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),gr=Math.pow(2,hr.tileID.overscaledZ-bt.tileID.overscaledZ),Nr=[bt.tileID.canonical.x*gr%1,bt.tileID.canonical.y*gr%1]):bt.texture.bind(an,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);var Hr=cc(Zt,Nr||[0,0],gr||1,ur,a);P instanceof ft?D.draw(g,b.TRIANGLES,ot,oe.disabled,H,Ae.disabled,Hr,a.id,P.boundsBuffer,n.quadTriangleIndexBuffer,P.boundsSegments):D.draw(g,b.TRIANGLES,ot,be[ze.overscaledZ],H,Ae.disabled,Hr,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}},background:function(n,u,a){var h=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g!==0){var b=n.context,P=b.gl,D=n.transform,H=D.tileSize,ae=a.paint.get("background-pattern");if(!n.isPatternMissing(ae)){var be=!ae&&h.a===1&&g===1&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass===be){var we=oe.disabled,Pe=n.depthModeForSublayer(0,be==="opaque"?z.ReadWrite:z.ReadOnly),We=n.colorModeForRenderPass(),Ve=n.useProgram(ae?"backgroundPattern":"background"),nt=D.coveringTiles({tileSize:H});ae&&(b.activeTexture.set(P.TEXTURE0),n.imageManager.bind(n.context));for(var ze=a.getCrossfadeParameters(),ot=0,bt=nt;ot<bt.length;ot+=1){var Zt=bt[ot],hr=n.transform.calculatePosMatrix(Zt.toUnwrapped()),ur=ae?Vu(hr,g,n,ae,{tileID:Zt,tileSize:H},ze):al(hr,g,h);Ve.draw(b,P.TRIANGLES,Pe,we,We,Ae.disabled,ur,a.id,n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}}}},debug:function(n,u,a){for(var h=0;h<a.length;h++)$c(n,u,a[h])},custom:function(n,u,a){var h=n.context,g=a.implementation;if(n.renderPass==="offscreen"){var b=g.prerender;b&&(n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),b.call(g,h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState())}else if(n.renderPass==="translucent"){n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),h.setStencilMode(oe.disabled);var P=g.renderingMode==="3d"?new z(n.context.gl.LEQUAL,z.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,z.ReadOnly);h.setDepthMode(P),g.render(h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState(),h.bindFramebuffer.set(null)}}},$a=function(n,u){this.context=new se(n),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=Ce.maxUnderzooming+Ce.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yo,this.gpuTimers={}};$a.prototype.resize=function(n,u){if(this.width=n*p.browser.devicePixelRatio,this.height=u*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var a=0,h=this.style._order;a<h.length;a+=1)this.style._layers[h[a]].resize()},$a.prototype.setup=function(){var n=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(u,Aa.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var a=new p.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(p.EXTENT,0),a.emplaceBack(0,p.EXTENT),a.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=n.createVertexBuffer(a,Aa.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(h,_t.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(g,Aa.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var b=new p.StructArrayLayout1ui2;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(b);var P=new p.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(P),this.emptyTexture=new p.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);var D=this.context.gl;this.stencilClearMode=new oe({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)},$a.prototype.clearStencil=function(){var n=this.context,u=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var a=p.create();p.ortho(a,0,this.width,this.height,0,0,1),p.scale(a,a,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,u.TRIANGLES,z.disabled,this.stencilClearMode,ve.disabled,Ae.disabled,Ns(a),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},$a.prototype._renderTileClippingMasks=function(n,u){if(this.currentStencilSource!==n.source&&n.isTileClipped()&&u&&u.length){this.currentStencilSource=n.source;var a=this.context,h=a.gl;this.nextStencilID+u.length>256&&this.clearStencil(),a.setColorMode(ve.disabled),a.setDepthMode(z.disabled);var g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var b=0,P=u;b<P.length;b+=1){var D=P[b],H=this._tileClippingMaskIDs[D.key]=this.nextStencilID++;g.draw(a,h.TRIANGLES,z.disabled,new oe({func:h.ALWAYS,mask:0},H,255,h.KEEP,h.KEEP,h.REPLACE),ve.disabled,Ae.disabled,Ns(D.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},$a.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var n=this.nextStencilID++,u=this.context.gl;return new oe({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)},$a.prototype.stencilModeForClipping=function(n){var u=this.context.gl;return new oe({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)},$a.prototype.stencilConfigForOverlap=function(n){var u,a=this.context.gl,h=n.sort(function(H,ae){return ae.overscaledZ-H.overscaledZ}),g=h[h.length-1].overscaledZ,b=h[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();for(var P={},D=0;D<b;D++)P[D+g]=new oe({func:a.GEQUAL,mask:255},D+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[P,h]}return[(u={},u[g]=oe.disabled,u),h]},$a.prototype.colorModeForRenderPass=function(){var n=this.context.gl;return this._showOverdrawInspector?new ve([n.CONSTANT_COLOR,n.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ve.unblended:ve.alphaBlended},$a.prototype.depthModeForSublayer=function(n,u,a){if(!this.opaquePassEnabledForLayer())return z.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new z(a||this.context.gl.LEQUAL,u,[h,h])},$a.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},$a.prototype.render=function(n,u){var a=this;this.style=n,this.options=u,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,g=this.style.sourceCaches;for(var b in g){var P=g[b];P.used&&P.prepare(this.context)}var D,H,ae={},be={},we={};for(var Pe in g){var We=g[Pe];ae[Pe]=We.getVisibleCoordinates(),be[Pe]=ae[Pe].slice().reverse(),we[Pe]=We.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ve=0;Ve<h.length;Ve++)if(this.style._layers[h[Ve]].is3D()){this.opaquePassCutoff=Ve;break}this.renderPass="offscreen";for(var nt=0,ze=h;nt<ze.length;nt+=1){var ot=this.style._layers[ze[nt]];if(ot.hasOffscreenPass()&&!ot.isHidden(this.transform.zoom)){var bt=be[ot.source];(ot.type==="custom"||bt.length)&&this.renderLayer(this,g[ot.source],ot,bt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Zt=this.style._layers[h[this.currentLayer]],hr=g[Zt.source],ur=ae[Zt.source];this._renderTileClippingMasks(Zt,ur),this.renderLayer(this,hr,Zt,ur)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var gr=this.style._layers[h[this.currentLayer]],Nr=g[gr.source],an=(gr.type==="symbol"?we:be)[gr.source];this._renderTileClippingMasks(gr,ae[gr.source]),this.renderLayer(this,Nr,gr,an)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(Hr){Hr.source&&!Hr.isHidden(a.transform.zoom)&&(Hr.source!==(H&&H.id)&&(H=a.style.sourceCaches[Hr.source]),(!D||D.getSource().maxzoom<H.getSource().maxzoom)&&(D=H))}),D&&ul.debug(this,D,D.getVisibleCoordinates())),this.options.showPadding&&function(Hr){var In=Hr.transform.padding;Yl(Hr,Hr.transform.height-(In.top||0),3,Pu),Yl(Hr,In.bottom||0,3,Xl),Kl(Hr,In.left||0,3,za),Kl(Hr,Hr.transform.width-(In.right||0),3,Mu);var ni=Hr.transform.centerPoint;(function(hi,ii,ea,Bn){Xu(hi,ii-1,ea-10,2,20,Bn),Xu(hi,ii-10,ea-1,20,2,Bn)})(Hr,ni.x,Hr.transform.height-ni.y,sl)}(this),this.context.setDefault()},$a.prototype.renderLayer=function(n,u,a,h){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||h.length)&&(this.id=a.id,this.gpuTimingStart(a),ul[a.type](n,u,a,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},$a.prototype.gpuTimingStart=function(n){if(this.options.gpuTiming){var u=this.context.extTimerQuery,a=this.gpuTimers[n.id];a||(a=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),a.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,a.query)}},$a.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}},$a.prototype.collectGpuTimers=function(){var n=this.gpuTimers;return this.gpuTimers={},n},$a.prototype.queryGpuTimers=function(n){var u={};for(var a in n){var h=n[a],g=this.context.extTimerQuery,b=g.getQueryObjectEXT(h.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(h.query),u[a]=b}return u},$a.prototype.translatePosMatrix=function(n,u,a,h,g){if(!a[0]&&!a[1])return n;var b=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(b){var P=Math.sin(b),D=Math.cos(b);a=[a[0]*D-a[1]*P,a[0]*P+a[1]*D]}var H=[g?a[0]:Ui(u,a[0],this.transform.zoom),g?a[1]:Ui(u,a[1],this.transform.zoom),0],ae=new Float32Array(16);return p.translate(ae,n,H),ae},$a.prototype.saveTileTexture=function(n){var u=this._tileTextures[n.size[0]];u?u.push(n):this._tileTextures[n.size[0]]=[n]},$a.prototype.getTileTexture=function(n){var u=this._tileTextures[n];return u&&u.length>0?u.pop():null},$a.prototype.isPatternMissing=function(n){if(!n)return!1;if(!n.from||!n.to)return!0;var u=this.imageManager.getPattern(n.from.toString()),a=this.imageManager.getPattern(n.to.toString());return!u||!a},$a.prototype.useProgram=function(n,u){this.cache=this.cache||{};var a=""+n+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[a]||(this.cache[a]=new au(this.context,n,cs[n],u,ol[n],this._showOverdrawInspector)),this.cache[a]},$a.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},$a.prototype.setBaseState=function(){var n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)},$a.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},$a.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ll=function(n,u){this.points=n,this.planes=u};ll.fromInvProjectionMatrix=function(n,u,a){var h=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return p.transformMat4([],P,n)}).map(function(P){return p.scale$1([],P,1/P[3]/u*h)}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var D=p.sub([],g[P[0]],g[P[1]]),H=p.sub([],g[P[2]],g[P[1]]),ae=p.normalize([],p.cross([],D,H)),be=-p.dot(ae,g[P[1]]);return ae.concat(be)});return new ll(g,b)};var Yu=function(n,u){this.min=n,this.max=u,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};Yu.prototype.quadrant=function(n){for(var u=[n%2==0,n<2],a=p.clone$2(this.min),h=p.clone$2(this.max),g=0;g<u.length;g++)a[g]=u[g]?this.min[g]:this.center[g],h[g]=u[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Yu(a,h)},Yu.prototype.distanceX=function(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]},Yu.prototype.distanceY=function(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]},Yu.prototype.intersects=function(n){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],a=!0,h=0;h<n.planes.length;h++){for(var g=n.planes[h],b=0,P=0;P<u.length;P++)b+=p.dot$1(g,u[P])>=0;if(b===0)return 0;b!==u.length&&(a=!1)}if(a)return 2;for(var D=0;D<3;D++){for(var H=Number.MAX_VALUE,ae=-Number.MAX_VALUE,be=0;be<n.points.length;be++){var we=n.points[be][D]-this.min[D];H=Math.min(H,we),ae=Math.max(ae,we)}if(ae<0||H>this.max[D]-this.min[D])return 0}return 1};var Js=function(n,u,a,h){if(n===void 0&&(n=0),u===void 0&&(u=0),a===void 0&&(a=0),h===void 0&&(h=0),isNaN(n)||n<0||isNaN(u)||u<0||isNaN(a)||a<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=a,this.right=h};Js.prototype.interpolate=function(n,u,a){return u.top!=null&&n.top!=null&&(this.top=p.number(n.top,u.top,a)),u.bottom!=null&&n.bottom!=null&&(this.bottom=p.number(n.bottom,u.bottom,a)),u.left!=null&&n.left!=null&&(this.left=p.number(n.left,u.left,a)),u.right!=null&&n.right!=null&&(this.right=p.number(n.right,u.right,a)),this},Js.prototype.getCenter=function(n,u){var a=p.clamp((this.left+n-this.right)/2,0,n),h=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(a,h)},Js.prototype.equals=function(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right},Js.prototype.clone=function(){return new Js(this.top,this.bottom,this.left,this.right)},Js.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ia=function(n,u,a,h,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||g,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=a==null?0:a,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Js,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ua={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ia.prototype.clone=function(){var n=new ia(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n},Ua.minZoom.get=function(){return this._minZoom},Ua.minZoom.set=function(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))},Ua.maxZoom.get=function(){return this._maxZoom},Ua.maxZoom.set=function(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))},Ua.minPitch.get=function(){return this._minPitch},Ua.minPitch.set=function(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))},Ua.maxPitch.get=function(){return this._maxPitch},Ua.maxPitch.set=function(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))},Ua.renderWorldCopies.get=function(){return this._renderWorldCopies},Ua.renderWorldCopies.set=function(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n},Ua.worldSize.get=function(){return this.tileSize*this.scale},Ua.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ua.size.get=function(){return new p.Point(this.width,this.height)},Ua.bearing.get=function(){return-this.angle/Math.PI*180},Ua.bearing.set=function(n){var u=-p.wrap(n,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ua.pitch.get=function(){return this._pitch/Math.PI*180},Ua.pitch.set=function(n){var u=p.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Ua.fov.get=function(){return this._fov/Math.PI*180},Ua.fov.set=function(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())},Ua.zoom.get=function(){return this._zoom},Ua.zoom.set=function(n){var u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Ua.center.get=function(){return this._center},Ua.center.set=function(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())},Ua.padding.get=function(){return this._edgeInsets.toJSON()},Ua.padding.set=function(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())},Ua.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ia.prototype.isPaddingEqual=function(n){return this._edgeInsets.equals(n)},ia.prototype.interpolatePadding=function(n,u,a){this._unmodified=!1,this._edgeInsets.interpolate(n,u,a),this._constrain(),this._calcMatrices()},ia.prototype.coveringZoomLevel=function(n){var u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)},ia.prototype.getVisibleUnwrappedCoordinates=function(n){var u=[new p.UnwrappedTileID(0,n)];if(this._renderWorldCopies)for(var a=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),g=this.pointCoordinate(new p.Point(this.width,this.height)),b=this.pointCoordinate(new p.Point(0,this.height)),P=Math.floor(Math.min(a.x,h.x,g.x,b.x)),D=Math.floor(Math.max(a.x,h.x,g.x,b.x)),H=P-1;H<=D+1;H++)H!==0&&u.push(new p.UnwrappedTileID(H,n));return u},ia.prototype.coveringTiles=function(n){var u=this.coveringZoomLevel(n),a=u;if(n.minzoom!==void 0&&u<n.minzoom)return[];n.maxzoom!==void 0&&u>n.maxzoom&&(u=n.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),g=Math.pow(2,u),b=[g*h.x,g*h.y,0],P=ll.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),D=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(D=u);var H=function(Hr){return{aabb:new Yu([Hr*g,0,0],[(Hr+1)*g,g,0]),zoom:0,x:0,y:0,wrap:Hr,fullyVisible:!1}},ae=[],be=[],we=u,Pe=n.reparseOverscaled?a:u;if(this._renderWorldCopies)for(var We=1;We<=3;We++)ae.push(H(-We)),ae.push(H(We));for(ae.push(H(0));ae.length>0;){var Ve=ae.pop(),nt=Ve.x,ze=Ve.y,ot=Ve.fullyVisible;if(!ot){var bt=Ve.aabb.intersects(P);if(bt===0)continue;ot=bt===2}var Zt=Ve.aabb.distanceX(b),hr=Ve.aabb.distanceY(b),ur=Math.max(Math.abs(Zt),Math.abs(hr));if(Ve.zoom===we||ur>3+(1<<we-Ve.zoom)-2&&Ve.zoom>=D)be.push({tileID:new p.OverscaledTileID(Ve.zoom===we?Pe:Ve.zoom,Ve.wrap,Ve.zoom,nt,ze),distanceSq:p.sqrLen([b[0]-.5-nt,b[1]-.5-ze])});else for(var gr=0;gr<4;gr++){var Nr=(nt<<1)+gr%2,an=(ze<<1)+(gr>>1);ae.push({aabb:Ve.aabb.quadrant(gr),zoom:Ve.zoom+1,x:Nr,y:an,wrap:Ve.wrap,fullyVisible:ot})}}return be.sort(function(Hr,In){return Hr.distanceSq-In.distanceSq}).map(function(Hr){return Hr.tileID})},ia.prototype.resize=function(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()},Ua.unmodified.get=function(){return this._unmodified},ia.prototype.zoomScale=function(n){return Math.pow(2,n)},ia.prototype.scaleZoom=function(n){return Math.log(n)/Math.LN2},ia.prototype.project=function(n){var u=p.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(n.lng)*this.worldSize,p.mercatorYfromLat(u)*this.worldSize)},ia.prototype.unproject=function(n){return new p.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()},Ua.point.get=function(){return this.project(this.center)},ia.prototype.setLocationAtPoint=function(n,u){var a=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(n),b=new p.MercatorCoordinate(g.x-(a.x-h.x),g.y-(a.y-h.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())},ia.prototype.locationPoint=function(n){return this.coordinatePoint(this.locationCoordinate(n))},ia.prototype.pointLocation=function(n){return this.coordinateLocation(this.pointCoordinate(n))},ia.prototype.locationCoordinate=function(n){return p.MercatorCoordinate.fromLngLat(n)},ia.prototype.coordinateLocation=function(n){return n.toLngLat()},ia.prototype.pointCoordinate=function(n){var u=[n.x,n.y,0,1],a=[n.x,n.y,1,1];p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(a,a,this.pixelMatrixInverse);var h=u[3],g=a[3],b=u[1]/h,P=a[1]/g,D=u[2]/h,H=a[2]/g,ae=D===H?0:(0-D)/(H-D);return new p.MercatorCoordinate(p.number(u[0]/h,a[0]/g,ae)/this.worldSize,p.number(b,P,ae)/this.worldSize)},ia.prototype.coordinatePoint=function(n){var u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix),new p.Point(u[0]/u[3],u[1]/u[3])},ia.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},ia.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ia.prototype.setMaxBounds=function(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ia.prototype.calculatePosMatrix=function(n,u){u===void 0&&(u=!1);var a=n.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[a])return h[a];var g=n.canonical,b=this.worldSize/this.zoomScale(g.z),P=g.x+Math.pow(2,g.z)*n.wrap,D=p.identity(new Float64Array(16));return p.translate(D,D,[P*b,g.y*b,0]),p.scale(D,D,[b/p.EXTENT,b/p.EXTENT,1]),p.multiply(D,u?this.alignedProjMatrix:this.projMatrix,D),h[a]=new Float32Array(D),h[a]},ia.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ia.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var n,u,a,h,g=-90,b=90,P=-180,D=180,H=this.size,ae=this._unmodified;if(this.latRange){var be=this.latRange;g=p.mercatorYfromLat(be[1])*this.worldSize,n=(b=p.mercatorYfromLat(be[0])*this.worldSize)-g<H.y?H.y/(b-g):0}if(this.lngRange){var we=this.lngRange;P=p.mercatorXfromLng(we[0])*this.worldSize,u=(D=p.mercatorXfromLng(we[1])*this.worldSize)-P<H.x?H.x/(D-P):0}var Pe=this.point,We=Math.max(u||0,n||0);if(We)return this.center=this.unproject(new p.Point(u?(D+P)/2:Pe.x,n?(b+g)/2:Pe.y)),this.zoom+=this.scaleZoom(We),this._unmodified=ae,void(this._constraining=!1);if(this.latRange){var Ve=Pe.y,nt=H.y/2;Ve-nt<g&&(h=g+nt),Ve+nt>b&&(h=b-nt)}if(this.lngRange){var ze=Pe.x,ot=H.x/2;ze-ot<P&&(a=P+ot),ze+ot>D&&(a=D-ot)}a===void 0&&h===void 0||(this.center=this.unproject(new p.Point(a!==void 0?a:Pe.x,h!==void 0?h:Pe.y))),this._unmodified=ae,this._constraining=!1}},ia.prototype._calcMatrices=function(){if(this.height){var n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,a=this._fov*(.5+n.y/this.height),h=Math.sin(a)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-u-a,.01,Math.PI-.01)),g=this.point,b=g.x,P=g.y,D=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),H=this.height/50,ae=new Float64Array(16);p.perspective(ae,this._fov,this.width/this.height,H,D),ae[8]=2*-n.x/this.width,ae[9]=2*n.y/this.height,p.scale(ae,ae,[1,-1,1]),p.translate(ae,ae,[0,0,-this.cameraToCenterDistance]),p.rotateX(ae,ae,this._pitch),p.rotateZ(ae,ae,this.angle),p.translate(ae,ae,[-b,-P,0]),this.mercatorMatrix=p.scale([],ae,[this.worldSize,this.worldSize,this.worldSize]),p.scale(ae,ae,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ae,this.invProjMatrix=p.invert([],this.projMatrix);var be=this.width%2/2,we=this.height%2/2,Pe=Math.cos(this.angle),We=Math.sin(this.angle),Ve=b-Math.round(b)+Pe*be+We*we,nt=P-Math.round(P)+Pe*we+We*be,ze=new Float64Array(ae);if(p.translate(ze,ze,[Ve>.5?Ve-1:Ve,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=ze,ae=p.create(),p.scale(ae,ae,[this.width/2,-this.height/2,1]),p.translate(ae,ae,[1,-1,0]),this.labelPlaneMatrix=ae,ae=p.create(),p.scale(ae,ae,[1,-1,1]),p.translate(ae,ae,[-1,-1,0]),p.scale(ae,ae,[2/this.width,2/this.height,1]),this.glCoordMatrix=ae,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ae=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ae,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ia.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var n=this.pointCoordinate(new p.Point(0,0)),u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},ia.prototype.getCameraPoint=function(){var n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,n))},ia.prototype.getCameraQueryGeometry=function(n){var u=this.getCameraPoint();if(n.length===1)return[n[0],u];for(var a=u.x,h=u.y,g=u.x,b=u.y,P=0,D=n;P<D.length;P+=1){var H=D[P];a=Math.min(a,H.x),h=Math.min(h,H.y),g=Math.max(g,H.x),b=Math.max(b,H.y)}return[new p.Point(a,h),new p.Point(g,h),new p.Point(g,b),new p.Point(a,b),new p.Point(a,h)]},Object.defineProperties(ia.prototype,Ua);var _s=function(n){var u,a,h,g;this._hashName=n&&encodeURIComponent(n),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),a=!1,h=null,g=function(){h=null,a&&(u(),h=setTimeout(g,300),a=!1)},function(){return a=!0,h||g(),h})};_s.prototype.addTo=function(n){return this._map=n,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},_s.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},_s.prototype.getHashString=function(n){var u=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,h=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),b=Math.round(u.lng*g)/g,P=Math.round(u.lat*g)/g,D=this._map.getBearing(),H=this._map.getPitch(),ae="";if(ae+=n?"/"+b+"/"+P+"/"+a:a+"/"+P+"/"+b,(D||H)&&(ae+="/"+Math.round(10*D)/10),H&&(ae+="/"+Math.round(H)),this._hashName){var be=this._hashName,we=!1,Pe=p.window.location.hash.slice(1).split("&").map(function(We){var Ve=We.split("=")[0];return Ve===be?(we=!0,Ve+"="+ae):We}).filter(function(We){return We});return we||Pe.push(be+"="+ae),"#"+Pe.join("&")}return"#"+ae},_s.prototype._getCurrentHash=function(){var n,u=this,a=p.window.location.hash.replace("#","");return this._hashName?(a.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(n=h)}),(n&&n[1]||"").split("/")):a.split("/")},_s.prototype._onHashChange=function(){var n=this._getCurrentHash();if(n.length>=3&&!n.some(function(a){return isNaN(a)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1},_s.prototype._updateHashUnthrottled=function(){var n=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,n)}catch(u){}};var Al={linearity:.3,easing:p.bezier(0,0,.3,1)},Iu=p.extend({deceleration:2500,maxSpeed:1400},Al),Tl=p.extend({deceleration:20,maxSpeed:1400},Al),Jc=p.extend({deceleration:1e3,maxSpeed:360},Al),Qc=p.extend({deceleration:1e3,maxSpeed:90},Al),Pl=function(n){this._map=n,this.clear()};function $l(n,u){(!n.duration||n.duration<u.duration)&&(n.duration=u.duration,n.easing=u.easing)}function Ou(n,u,a){var h=a.maxSpeed,g=a.linearity,b=a.deceleration,P=p.clamp(n*g/(u/1e3),-h,h),D=Math.abs(P)/(b*g);return{easing:a.easing,duration:1e3*D,amount:P*(D/2)}}Pl.prototype.clear=function(){this._inertiaBuffer=[]},Pl.prototype.record=function(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:n})},Pl.prototype._drainInertiaBuffer=function(){for(var n=this._inertiaBuffer,u=p.browser.now();n.length>0&&u-n[0].time>160;)n.shift()},Pl.prototype._onMoveEnd=function(n){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},a=0,h=this._inertiaBuffer;a<h.length;a+=1){var g=h[a].settings;u.zoom+=g.zoomDelta||0,u.bearing+=g.bearingDelta||0,u.pitch+=g.pitchDelta||0,g.panDelta&&u.pan._add(g.panDelta),g.around&&(u.around=g.around),g.pinchAround&&(u.pinchAround=g.pinchAround)}var b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(u.pan.mag()){var D=Ou(u.pan.mag(),b,p.extend({},Iu,n||{}));P.offset=u.pan.mult(D.amount/u.pan.mag()),P.center=this._map.transform.center,$l(P,D)}if(u.zoom){var H=Ou(u.zoom,b,Tl);P.zoom=this._map.transform.zoom+H.amount,$l(P,H)}if(u.bearing){var ae=Ou(u.bearing,b,Jc);P.bearing=this._map.transform.bearing+p.clamp(ae.amount,-179,179),$l(P,ae)}if(u.pitch){var be=Ou(u.pitch,b,Qc);P.pitch=this._map.transform.pitch+be.amount,$l(P,be)}if(P.zoom||P.bearing){var we=u.pinchAround===void 0?u.around:u.pinchAround;P.around=we?this._map.unproject(we):this._map.getCenter()}return this.clear(),p.extend(P,{noMoveStart:!0})}};var ko=function(n){function u(h,g,b,P){P===void 0&&(P={});var D=Q.mousePos(g.getCanvasContainer(),b),H=g.unproject(D);n.call(this,h,p.extend({point:D,lngLat:H,originalEvent:b},P)),this._defaultPrevented=!1,this.target=g}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),Us=function(n){function u(h,g,b){var P=h==="touchend"?b.changedTouches:b.touches,D=Q.touchPos(g.getCanvasContainer(),P),H=D.map(function(we){return g.unproject(we)}),ae=D.reduce(function(we,Pe,We,Ve){return we.add(Pe.div(Ve.length))},new p.Point(0,0)),be=g.unproject(ae);n.call(this,h,{points:D,point:ae,lngLats:H,lngLat:be,originalEvent:b}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),cl=function(n){function u(h,g,b){n.call(this,h,{originalEvent:b}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),bo=function(n,u){this._map=n,this._clickTolerance=u.clickTolerance};bo.prototype.reset=function(){delete this._mousedownPos},bo.prototype.wheel=function(n){return this._firePreventable(new cl(n.type,this._map,n))},bo.prototype.mousedown=function(n,u){return this._mousedownPos=u,this._firePreventable(new ko(n.type,this._map,n))},bo.prototype.mouseup=function(n){this._map.fire(new ko(n.type,this._map,n))},bo.prototype.click=function(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new ko(n.type,this._map,n))},bo.prototype.dblclick=function(n){return this._firePreventable(new ko(n.type,this._map,n))},bo.prototype.mouseover=function(n){this._map.fire(new ko(n.type,this._map,n))},bo.prototype.mouseout=function(n){this._map.fire(new ko(n.type,this._map,n))},bo.prototype.touchstart=function(n){return this._firePreventable(new Us(n.type,this._map,n))},bo.prototype.touchmove=function(n){this._map.fire(new Us(n.type,this._map,n))},bo.prototype.touchend=function(n){this._map.fire(new Us(n.type,this._map,n))},bo.prototype.touchcancel=function(n){this._map.fire(new Us(n.type,this._map,n))},bo.prototype._firePreventable=function(n){if(this._map.fire(n),n.defaultPrevented)return{}},bo.prototype.isEnabled=function(){return!0},bo.prototype.isActive=function(){return!1},bo.prototype.enable=function(){},bo.prototype.disable=function(){};var Dn=function(n){this._map=n};Dn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Dn.prototype.mousemove=function(n){this._map.fire(new ko(n.type,this._map,n))},Dn.prototype.mousedown=function(){this._delayContextMenu=!0},Dn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ko("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Dn.prototype.contextmenu=function(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new ko(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()},Dn.prototype.isEnabled=function(){return!0},Dn.prototype.isActive=function(){return!1},Dn.prototype.enable=function(){},Dn.prototype.disable=function(){};var fo=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1};function Lu(n,u){for(var a={},h=0;h<n.length;h++)a[n[h].identifier]=u[h];return a}fo.prototype.isEnabled=function(){return!!this._enabled},fo.prototype.isActive=function(){return!!this._active},fo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},fo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},fo.prototype.mousedown=function(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(Q.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},fo.prototype.mousemoveWindow=function(n,u){if(this._active){var a=u;if(!(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=a,this._box||(this._box=Q.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));var g=Math.min(h.x,a.x),b=Math.max(h.x,a.x),P=Math.min(h.y,a.y),D=Math.max(h.y,a.y);Q.setTransform(this._box,"translate("+g+"px,"+P+"px)"),this._box.style.width=b-g+"px",this._box.style.height=D-P+"px"}}},fo.prototype.mouseupWindow=function(n,u){var a=this;if(this._active&&n.button===0){var h=this._startPos,g=u;if(this.reset(),Q.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:function(b){return b.fitScreenCoordinates(h,g,a._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",n)}},fo.prototype.keydown=function(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))},fo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Q.remove(this._box),this._box=null),Q.enableDrag(),delete this._startPos,delete this._lastPos},fo.prototype._fireEvent=function(n,u){return this._map.fire(new p.Event(n,{originalEvent:u}))};var fl=function(n){this.reset(),this.numTouches=n.numTouches};fl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},fl.prototype.touchstart=function(n,u,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),a.length===this.numTouches&&(this.centroid=function(h){for(var g=new p.Point(0,0),b=0,P=h;b<P.length;b+=1)g._add(P[b]);return g.div(h.length)}(u),this.touches=Lu(a,u)))},fl.prototype.touchmove=function(n,u,a){if(!this.aborted&&this.centroid){var h=Lu(a,u);for(var g in this.touches){var b=h[g];(!b||b.dist(this.touches[g])>30)&&(this.aborted=!0)}}},fl.prototype.touchend=function(n,u,a){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var Qs=function(n){this.singleTap=new fl(n),this.numTaps=n.numTaps,this.reset()};Qs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Qs.prototype.touchstart=function(n,u,a){this.singleTap.touchstart(n,u,a)},Qs.prototype.touchmove=function(n,u,a){this.singleTap.touchmove(n,u,a)},Qs.prototype.touchend=function(n,u,a){var h=this.singleTap.touchend(n,u,a);if(h){var g=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(h)<30;if(g&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Ps=function(){this._zoomIn=new Qs({numTouches:1,numTaps:2}),this._zoomOut=new Qs({numTouches:2,numTaps:1}),this.reset()};Ps.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ps.prototype.touchstart=function(n,u,a){this._zoomIn.touchstart(n,u,a),this._zoomOut.touchstart(n,u,a)},Ps.prototype.touchmove=function(n,u,a){this._zoomIn.touchmove(n,u,a),this._zoomOut.touchmove(n,u,a)},Ps.prototype.touchend=function(n,u,a){var h=this,g=this._zoomIn.touchend(n,u,a),b=this._zoomOut.touchend(n,u,a);return g?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(g)},{originalEvent:n})}}):b?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(b)},{originalEvent:n})}}):void 0},Ps.prototype.touchcancel=function(){this.reset()},Ps.prototype.enable=function(){this._enabled=!0},Ps.prototype.disable=function(){this._enabled=!1,this.reset()},Ps.prototype.isEnabled=function(){return this._enabled},Ps.prototype.isActive=function(){return this._active};var dc={0:1,2:2},dn=function(n){this.reset(),this._clickTolerance=n.clickTolerance||1};dn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},dn.prototype._correctButton=function(n,u){return!1},dn.prototype._move=function(n,u){return{}},dn.prototype.mousedown=function(n,u){if(!this._lastPoint){var a=Q.mouseButton(n);this._correctButton(n,a)&&(this._lastPoint=u,this._eventButton=a)}},dn.prototype.mousemoveWindow=function(n,u){var a=this._lastPoint;if(a){if(n.preventDefault(),function(h,g){var b=dc[g];return h.buttons===void 0||(h.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(a,u)}},dn.prototype.mouseupWindow=function(n){this._lastPoint&&Q.mouseButton(n)===this._eventButton&&(this._moved&&Q.suppressClick(),this.reset())},dn.prototype.enable=function(){this._enabled=!0},dn.prototype.disable=function(){this._enabled=!1,this.reset()},dn.prototype.isEnabled=function(){return this._enabled},dn.prototype.isActive=function(){return this._active};var Jl=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.mousedown=function(a,h){n.prototype.mousedown.call(this,a,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(a,h){return h===0&&!a.ctrlKey},u.prototype._move=function(a,h){return{around:h,panDelta:h.sub(a)}},u}(dn),Ql=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=.8*(h.x-a.x);if(g)return this._active=!0,{bearingDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(dn),Ru=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=-.5*(h.y-a.y);if(g)return this._active=!0,{pitchDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(dn),ja=function(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()};ja.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},ja.prototype.touchstart=function(n,u,a){return this._calculateTransform(n,u,a)},ja.prototype.touchmove=function(n,u,a){if(this._active&&!(a.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,u,a)},ja.prototype.touchend=function(n,u,a){this._calculateTransform(n,u,a),this._active&&a.length<this._minTouches&&this.reset()},ja.prototype.touchcancel=function(){this.reset()},ja.prototype._calculateTransform=function(n,u,a){a.length>0&&(this._active=!0);var h=Lu(a,u),g=new p.Point(0,0),b=new p.Point(0,0),P=0;for(var D in h){var H=h[D],ae=this._touches[D];ae&&(g._add(H),b._add(H.sub(ae)),P++,h[D]=H)}if(this._touches=h,!(P<this._minTouches)&&b.mag()){var be=b.div(P);if(this._sum._add(be),!(this._sum.mag()<this._clickTolerance))return{around:g.div(P),panDelta:be}}},ja.prototype.enable=function(){this._enabled=!0},ja.prototype.disable=function(){this._enabled=!1,this.reset()},ja.prototype.isEnabled=function(){return this._enabled},ja.prototype.isActive=function(){return this._active};var Ms=function(){this.reset()};function ql(n,u,a){for(var h=0;h<n.length;h++)if(n[h].identifier===a)return u[h]}function _u(n,u){return Math.log(n/u)/Math.LN2}Ms.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ms.prototype._start=function(n){},Ms.prototype._move=function(n,u,a){return{}},Ms.prototype.touchstart=function(n,u,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([u[0],u[1]]))},Ms.prototype.touchmove=function(n,u,a){if(this._firstTwoTouches){n.preventDefault();var h=this._firstTwoTouches,g=h[1],b=ql(a,u,h[0]),P=ql(a,u,g);if(b&&P){var D=this._aroundCenter?null:b.add(P).div(2);return this._move([b,P],D,n)}}},Ms.prototype.touchend=function(n,u,a){if(this._firstTwoTouches){var h=this._firstTwoTouches,g=h[1],b=ql(a,u,h[0]),P=ql(a,u,g);b&&P||(this._active&&Q.suppressClick(),this.reset())}},Ms.prototype.touchcancel=function(){this.reset()},Ms.prototype.enable=function(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"},Ms.prototype.disable=function(){this._enabled=!1,this.reset()},Ms.prototype.isEnabled=function(){return this._enabled},Ms.prototype.isActive=function(){return this._active};var Is=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(a){this._startDistance=this._distance=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(_u(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_u(this._distance,g),pinchAround:h}},u}(Ms);function su(n,u){return 180*n.angleWith(u)/Math.PI}var Fc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:su(this._vector,g),pinchAround:h}},u.prototype._isBelowThreshold=function(a){this._minDiameter=Math.min(this._minDiameter,a.mag());var h=25/(Math.PI*this._minDiameter)*360,g=su(a,this._startVector);return Math.abs(g)<h},u}(Ms);function Ml(n){return Math.abs(n.y)>Math.abs(n.x)}var vc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(a){this._lastPoints=a,Ml(a[0].sub(a[1]))&&(this._valid=!1)},u.prototype._move=function(a,h,g){var b=a[0].sub(this._lastPoints[0]),P=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(b,P,g.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:(b.y+P.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(a,h,g){if(this._valid!==void 0)return this._valid;var b=a.mag()>=2,P=h.mag()>=2;if(b||P){if(!b||!P)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;var D=a.y>0==h.y>0;return Ml(a)&&Ml(h)&&D}},u}(Ms),Bc={panStep:100,bearingStep:15,pitchStep:10},qs=function(){var n=Bc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1};function Os(n){return n*(2-n)}qs.prototype.reset=function(){this._active=!1},qs.prototype.keydown=function(n){var u=this;if(!(n.altKey||n.ctrlKey||n.metaKey)){var a=0,h=0,g=0,b=0,P=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?g=1:(n.preventDefault(),P=-1);break;case 40:n.shiftKey?g=-1:(n.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:function(D){var H=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:Os,zoom:a?Math.round(H)+a*(n.shiftKey?2:1):H,bearing:D.getBearing()+h*u._bearingStep,pitch:D.getPitch()+g*u._pitchStep,offset:[-b*u._panStep,-P*u._panStep],center:D.getCenter()},{originalEvent:n})}}}},qs.prototype.enable=function(){this._enabled=!0},qs.prototype.disable=function(){this._enabled=!1,this.reset()},qs.prototype.isEnabled=function(){return this._enabled},qs.prototype.isActive=function(){return this._active},qs.prototype.disableRotation=function(){this._rotationDisabled=!0},qs.prototype.enableRotation=function(){this._rotationDisabled=!1};var qi=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};qi.prototype.setZoomRate=function(n){this._defaultZoomRate=n},qi.prototype.setWheelZoomRate=function(n){this._wheelZoomRate=n},qi.prototype.isEnabled=function(){return!!this._enabled},qi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},qi.prototype.isZooming=function(){return!!this._zooming},qi.prototype.enable=function(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")},qi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},qi.prototype.wheel=function(n){if(this.isEnabled()){var u=n.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,a=p.browser.now(),h=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}},qi.prototype._onTimeout=function(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},qi.prototype._start=function(n){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=Q.mousePos(this._el,n);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},qi.prototype.renderFrame=function(){var n=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var a=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*a)));this._delta<0&&h!==0&&(h=1/h);var g=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(g*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var b,P=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,D=this._startZoom,H=this._easing,ae=!1;if(this._type==="wheel"&&D&&H){var be=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),we=H(be);b=p.number(D,P,we),be<1?this._frameId||(this._frameId=!0):ae=!0}else b=P,ae=!0;return this._active=!0,ae&&(this._active=!1,this._finishTimeout=setTimeout(function(){n._zooming=!1,n._handler._triggerRenderFrame(),delete n._targetZoom,delete n._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ae,zoomDelta:b-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},qi.prototype._smoothOutEasing=function(n){var u=p.ease;if(this._prevEase){var a=this._prevEase,h=(p.browser.now()-a.start)/a.duration,g=a.easing(h+.01)-a.easing(h),b=.27/Math.sqrt(g*g+1e-4)*.01,P=Math.sqrt(.0729-b*b);u=p.bezier(b,P,.25,1)}return this._prevEase={start:p.browser.now(),duration:n,easing:u},u},qi.prototype.reset=function(){this._active=!1};var xu=function(n,u){this._clickZoom=n,this._tapZoom=u};xu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},xu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},xu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},xu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Zs=function(){this.reset()};Zs.prototype.reset=function(){this._active=!1},Zs.prototype.dblclick=function(n,u){return n.preventDefault(),{cameraAnimation:function(a){a.easeTo({duration:300,zoom:a.getZoom()+(n.shiftKey?-1:1),around:a.unproject(u)},{originalEvent:n})}}},Zs.prototype.enable=function(){this._enabled=!0},Zs.prototype.disable=function(){this._enabled=!1,this.reset()},Zs.prototype.isEnabled=function(){return this._enabled},Zs.prototype.isActive=function(){return this._active};var zo=function(){this._tap=new Qs({numTouches:1,numTaps:1}),this.reset()};zo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},zo.prototype.touchstart=function(n,u,a){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=u[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(n,u,a))},zo.prototype.touchmove=function(n,u,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;var h=u[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,n.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(n,u,a)},zo.prototype.touchend=function(n,u,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(n,u,a)&&(this._tapTime=n.timeStamp)},zo.prototype.touchcancel=function(){this.reset()},zo.prototype.enable=function(){this._enabled=!0},zo.prototype.disable=function(){this._enabled=!1,this.reset()},zo.prototype.isEnabled=function(){return this._enabled},zo.prototype.isActive=function(){return this._active};var hl=function(n,u,a){this._el=n,this._mousePan=u,this._touchPan=a};hl.prototype.enable=function(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var uu=function(n,u,a){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=a};uu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},uu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},uu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},uu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var lu=function(n,u,a,h){this._el=n,this._touchZoom=u,this._touchRotate=a,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};lu.prototype.enable=function(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},lu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},lu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},lu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},lu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},lu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var So=function(n){return n.zoom||n.drag||n.pitch||n.rotate},ku=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u}(p.Event);function ai(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}var Hn=function(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pl(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);var a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,g=this._listeners;h<g.length;h+=1){var b=g[h],P=b[0];Q.addEventListener(P,b[1],P===p.window.document?this.handleWindowEvent:this.handleEvent,b[2])}};Hn.prototype.destroy=function(){for(var n=0,u=this._listeners;n<u.length;n+=1){var a=u[n],h=a[0];Q.removeEventListener(h,a[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,a[2])}},Hn.prototype._addDefaultHandlers=function(n){var u=this._map,a=u.getCanvasContainer();this._add("mapEvent",new bo(u,n));var h=u.boxZoom=new fo(u,n);this._add("boxZoom",h);var g=new Ps,b=new Zs;u.doubleClickZoom=new xu(b,g),this._add("tapZoom",g),this._add("clickZoom",b);var P=new zo;this._add("tapDragZoom",P);var D=u.touchPitch=new vc;this._add("touchPitch",D);var H=new Ql(n),ae=new Ru(n);u.dragRotate=new uu(n,H,ae),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",ae,["mouseRotate"]);var be=new Jl(n),we=new ja(n);u.dragPan=new hl(a,be,we),this._add("mousePan",be),this._add("touchPan",we,["touchZoom","touchRotate"]);var Pe=new Fc,We=new Is;u.touchZoomRotate=new lu(a,We,Pe,P),this._add("touchRotate",Pe,["touchPan","touchZoom"]),this._add("touchZoom",We,["touchPan","touchRotate"]);var Ve=u.scrollZoom=new qi(u,this);this._add("scrollZoom",Ve,["mousePan"]);var nt=u.keyboard=new qs;this._add("keyboard",nt),this._add("blockableMapEvent",new Dn(u));for(var ze=0,ot=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ze<ot.length;ze+=1){var bt=ot[ze];n.interactive&&n[bt]&&u[bt].enable(n[bt])}},Hn.prototype._add=function(n,u,a){this._handlers.push({handlerName:n,handler:u,allowed:a}),this._handlersById[n]=u},Hn.prototype.stop=function(n){if(!this._updatingCamera){for(var u=0,a=this._handlers;u<a.length;u+=1)a[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}},Hn.prototype.isActive=function(){for(var n=0,u=this._handlers;n<u.length;n+=1)if(u[n].handler.isActive())return!0;return!1},Hn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Hn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Hn.prototype.isMoving=function(){return Boolean(So(this._eventsInProgress))||this.isZooming()},Hn.prototype._blockedByActive=function(n,u,a){for(var h in n)if(h!==a&&(!u||u.indexOf(h)<0))return!0;return!1},Hn.prototype.handleWindowEvent=function(n){this.handleEvent(n,n.type+"Window")},Hn.prototype._getMapTouches=function(n){for(var u=[],a=0,h=n;a<h.length;a+=1){var g=h[a];this._el.contains(g.target)&&u.push(g)}return u},Hn.prototype.handleEvent=function(n,u){if(n.type!=="blur"){this._updatingCamera=!0;for(var a=n.type==="renderFrame"?void 0:n,h={needsRenderFrame:!1},g={},b={},P=n.touches?this._getMapTouches(n.touches):void 0,D=P?Q.touchPos(this._el,P):Q.mousePos(this._el,n),H=0,ae=this._handlers;H<ae.length;H+=1){var be=ae[H],we=be.handlerName,Pe=be.handler,We=be.allowed;if(Pe.isEnabled()){var Ve=void 0;this._blockedByActive(b,We,we)?Pe.reset():Pe[u||n.type]&&(Ve=Pe[u||n.type](n,D,P),this.mergeHandlerResult(h,g,Ve,we,a),Ve&&Ve.needsRenderFrame&&this._triggerRenderFrame()),(Ve||Pe.isActive())&&(b[we]=Pe)}}var nt={};for(var ze in this._previousActiveHandlers)b[ze]||(nt[ze]=a);this._previousActiveHandlers=b,(Object.keys(nt).length||ai(h))&&(this._changes.push([h,g,nt]),this._triggerRenderFrame()),(Object.keys(b).length||ai(h))&&this._map._stop(!0),this._updatingCamera=!1;var ot=h.cameraAnimation;ot&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ot(this._map))}else this.stop(!0)},Hn.prototype.mergeHandlerResult=function(n,u,a,h,g){if(a){p.extend(n,a);var b={handlerName:h,originalEvent:a.originalEvent||g};a.zoomDelta!==void 0&&(u.zoom=b),a.panDelta!==void 0&&(u.drag=b),a.pitchDelta!==void 0&&(u.pitch=b),a.bearingDelta!==void 0&&(u.rotate=b)}},Hn.prototype._applyChanges=function(){for(var n={},u={},a={},h=0,g=this._changes;h<g.length;h+=1){var b=g[h],P=b[0],D=b[1],H=b[2];P.panDelta&&(n.panDelta=(n.panDelta||new p.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(n.around=P.around),P.pinchAround!==void 0&&(n.pinchAround=P.pinchAround),P.noInertia&&(n.noInertia=P.noInertia),p.extend(u,D),p.extend(a,H)}this._updateMapTransform(n,u,a),this._changes=[]},Hn.prototype._updateMapTransform=function(n,u,a){var h=this._map,g=h.transform;if(!ai(n))return this._fireEvents(u,a,!0);var b=n.panDelta,P=n.zoomDelta,D=n.bearingDelta,H=n.pitchDelta,ae=n.around,be=n.pinchAround;be!==void 0&&(ae=be),h._stop(!0),ae=ae||h.transform.centerPoint;var we=g.pointLocation(b?ae.sub(b):ae);D&&(g.bearing+=D),H&&(g.pitch+=H),P&&(g.zoom+=P),g.setLocationAtPoint(we,ae),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,a,!0)},Hn.prototype._fireEvents=function(n,u,a){var h=this,g=So(this._eventsInProgress),b=So(n),P={};for(var D in n)this._eventsInProgress[D]||(P[D+"start"]=n[D].originalEvent),this._eventsInProgress[D]=n[D];for(var H in!g&&b&&this._fireEvent("movestart",b.originalEvent),P)this._fireEvent(H,P[H]);for(var ae in b&&this._fireEvent("move",b.originalEvent),n)this._fireEvent(ae,n[ae].originalEvent);var be,we={};for(var Pe in this._eventsInProgress){var We=this._eventsInProgress[Pe],Ve=We.handlerName,nt=We.originalEvent;this._handlersById[Ve].isActive()||(delete this._eventsInProgress[Pe],we[Pe+"end"]=be=u[Ve]||nt)}for(var ze in we)this._fireEvent(ze,we[ze]);var ot=So(this._eventsInProgress);if(a&&(g||b)&&!ot){this._updatingCamera=!0;var bt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Zt=function(hr){return hr!==0&&-h._bearingSnap<hr&&hr<h._bearingSnap};bt?(Zt(bt.bearing||this._map.getBearing())&&(bt.bearing=0),this._map.easeTo(bt,{originalEvent:be})):(this._map.fire(new p.Event("moveend",{originalEvent:be})),Zt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Hn.prototype._fireEvent=function(n,u){this._map.fire(new p.Event(n,u?{originalEvent:u}:{}))},Hn.prototype._requestFrame=function(){var n=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete n._frameId,n.handleEvent(new ku("renderFrame",{timeStamp:u})),n._applyChanges()})},Hn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Il=function(n){function u(a,h){n.call(this),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(a,h){return this.jumpTo({center:a},h)},u.prototype.panBy=function(a,h,g){return a=p.Point.convert(a).mult(-1),this.panTo(this.transform.center,p.extend({offset:a},h),g)},u.prototype.panTo=function(a,h,g){return this.easeTo(p.extend({center:a},h),g)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(a,h){return this.jumpTo({zoom:a},h),this},u.prototype.zoomTo=function(a,h,g){return this.easeTo(p.extend({zoom:a},h),g)},u.prototype.zoomIn=function(a,h){return this.zoomTo(this.getZoom()+1,a,h),this},u.prototype.zoomOut=function(a,h){return this.zoomTo(this.getZoom()-1,a,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(a,h){return this.jumpTo({bearing:a},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(a,h){return this.jumpTo({padding:a},h),this},u.prototype.rotateTo=function(a,h,g){return this.easeTo(p.extend({bearing:a},h),g)},u.prototype.resetNorth=function(a,h){return this.rotateTo(0,p.extend({duration:1e3},a),h),this},u.prototype.resetNorthPitch=function(a,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},a),h),this},u.prototype.snapToNorth=function(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(a,h){return this.jumpTo({pitch:a},h),this},u.prototype.cameraForBounds=function(a,h){a=p.LngLatBounds.convert(a);var g=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),g,h)},u.prototype._cameraForBoxAndBearing=function(a,h,g,b){var P={top:0,bottom:0,right:0,left:0};if(typeof(b=p.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){var D=b.padding;b.padding={top:D,bottom:D,right:D,left:D}}b.padding=p.extend(P,b.padding);var H=this.transform,ae=H.padding,be=H.project(p.LngLat.convert(a)),we=H.project(p.LngLat.convert(h)),Pe=be.rotate(-g*Math.PI/180),We=we.rotate(-g*Math.PI/180),Ve=new p.Point(Math.max(Pe.x,We.x),Math.max(Pe.y,We.y)),nt=new p.Point(Math.min(Pe.x,We.x),Math.min(Pe.y,We.y)),ze=Ve.sub(nt),ot=(H.width-(ae.left+ae.right+b.padding.left+b.padding.right))/ze.x,bt=(H.height-(ae.top+ae.bottom+b.padding.top+b.padding.bottom))/ze.y;if(!(bt<0||ot<0)){var Zt=Math.min(H.scaleZoom(H.scale*Math.min(ot,bt)),b.maxZoom),hr=typeof b.offset.x=="number"?new p.Point(b.offset.x,b.offset.y):p.Point.convert(b.offset),ur=new p.Point((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),gr=hr.add(ur).mult(H.scale/H.zoomScale(Zt));return{center:H.unproject(be.add(we).div(2).sub(gr)),zoom:Zt,bearing:g}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(a,h,g){return this._fitInternal(this.cameraForBounds(a,h),h,g)},u.prototype.fitScreenCoordinates=function(a,h,g,b,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(a)),this.transform.pointLocation(p.Point.convert(h)),g,b),b,P)},u.prototype._fitInternal=function(a,h,g){return a?(delete(h=p.extend(a,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this},u.prototype.jumpTo=function(a,h){this.stop();var g=this.transform,b=!1,P=!1,D=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(b=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=p.LngLat.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(P=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(D=!0,g.pitch=+a.pitch),a.padding==null||g.isPaddingEqual(a.padding)||(g.padding=a.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),b&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),P&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),D&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},u.prototype.easeTo=function(a,h){var g=this;this._stop(!1,a.easeId),((a=p.extend({offset:[0,0],duration:500,easing:p.ease},a)).animate===!1||!a.essential&&p.browser.prefersReducedMotion)&&(a.duration=0);var b=this.transform,P=this.getZoom(),D=this.getBearing(),H=this.getPitch(),ae=this.getPadding(),be="zoom"in a?+a.zoom:P,we="bearing"in a?this._normalizeBearing(a.bearing,D):D,Pe="pitch"in a?+a.pitch:H,We="padding"in a?a.padding:b.padding,Ve=p.Point.convert(a.offset),nt=b.centerPoint.add(Ve),ze=b.pointLocation(nt),ot=p.LngLat.convert(a.center||ze);this._normalizeCenter(ot);var bt,Zt,hr=b.project(ze),ur=b.project(ot).sub(hr),gr=b.zoomScale(be-P);a.around&&(bt=p.LngLat.convert(a.around),Zt=b.locationPoint(bt));var Nr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||be!==P,this._rotating=this._rotating||D!==we,this._pitching=this._pitching||Pe!==H,this._padding=!b.isPaddingEqual(We),this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Nr),this._ease(function(an){if(g._zooming&&(b.zoom=p.number(P,be,an)),g._rotating&&(b.bearing=p.number(D,we,an)),g._pitching&&(b.pitch=p.number(H,Pe,an)),g._padding&&(b.interpolatePadding(ae,We,an),nt=b.centerPoint.add(Ve)),bt)b.setLocationAtPoint(bt,Zt);else{var Hr=b.zoomScale(b.zoom-P),In=be>P?Math.min(2,gr):Math.max(.5,gr),ni=Math.pow(In,1-an),hi=b.unproject(hr.add(ur.mult(an*ni)).mult(Hr));b.setLocationAtPoint(b.renderWorldCopies?hi.wrap():hi,nt)}g._fireMoveEvents(h)},function(an){g._afterEase(h,an)},a),this},u.prototype._prepareEase=function(a,h,g){g===void 0&&(g={}),this._moving=!0,h||g.moving||this.fire(new p.Event("movestart",a)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",a))},u.prototype._fireMoveEvents=function(a){this.fire(new p.Event("move",a)),this._zooming&&this.fire(new p.Event("zoom",a)),this._rotating&&this.fire(new p.Event("rotate",a)),this._pitching&&this.fire(new p.Event("pitch",a))},u.prototype._afterEase=function(a,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var g=this._zooming,b=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",a)),b&&this.fire(new p.Event("rotateend",a)),P&&this.fire(new p.Event("pitchend",a)),this.fire(new p.Event("moveend",a))}},u.prototype.flyTo=function(a,h){var g=this;if(!a.essential&&p.browser.prefersReducedMotion){var b=p.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(b,h)}this.stop(),a=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},a);var P=this.transform,D=this.getZoom(),H=this.getBearing(),ae=this.getPitch(),be=this.getPadding(),we="zoom"in a?p.clamp(+a.zoom,P.minZoom,P.maxZoom):D,Pe="bearing"in a?this._normalizeBearing(a.bearing,H):H,We="pitch"in a?+a.pitch:ae,Ve="padding"in a?a.padding:P.padding,nt=P.zoomScale(we-D),ze=p.Point.convert(a.offset),ot=P.centerPoint.add(ze),bt=P.pointLocation(ot),Zt=p.LngLat.convert(a.center||bt);this._normalizeCenter(Zt);var hr=P.project(bt),ur=P.project(Zt).sub(hr),gr=a.curve,Nr=Math.max(P.width,P.height),an=Nr/nt,Hr=ur.mag();if("minZoom"in a){var In=p.clamp(Math.min(a.minZoom,D,we),P.minZoom,P.maxZoom),ni=Nr/P.zoomScale(In-D);gr=Math.sqrt(ni/Hr*2)}var hi=gr*gr;function ii(ne){var pe=(an*an-Nr*Nr+(ne?-1:1)*hi*hi*Hr*Hr)/(2*(ne?an:Nr)*hi*Hr);return Math.log(Math.sqrt(pe*pe+1)-pe)}function ea(ne){return(Math.exp(ne)-Math.exp(-ne))/2}function Bn(ne){return(Math.exp(ne)+Math.exp(-ne))/2}var _i=ii(0),te=function(ne){return Bn(_i)/Bn(_i+gr*ne)},q=function(ne){return Nr*((Bn(_i)*(ea(pe=_i+gr*ne)/Bn(pe))-ea(_i))/hi)/Hr;var pe},R=(ii(1)-_i)/gr;if(Math.abs(Hr)<1e-6||!isFinite(R)){if(Math.abs(Nr-an)<1e-6)return this.easeTo(a,h);var F=an<Nr?-1:1;R=Math.abs(Math.log(an/Nr))/gr,q=function(){return 0},te=function(ne){return Math.exp(F*gr*ne)}}return a.duration="duration"in a?+a.duration:1e3*R/("screenSpeed"in a?+a.screenSpeed/gr:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=H!==Pe,this._pitching=We!==ae,this._padding=!P.isPaddingEqual(Ve),this._prepareEase(h,!1),this._ease(function(ne){var pe=ne*R,ht=1/te(pe);P.zoom=ne===1?we:D+P.scaleZoom(ht),g._rotating&&(P.bearing=p.number(H,Pe,ne)),g._pitching&&(P.pitch=p.number(ae,We,ne)),g._padding&&(P.interpolatePadding(be,Ve,ne),ot=P.centerPoint.add(ze));var wt=ne===1?Zt:P.unproject(hr.add(ur.mult(q(pe))).mult(ht));P.setLocationAtPoint(P.renderWorldCopies?wt.wrap():wt,ot),g._fireMoveEvents(h)},function(){return g._afterEase(h)},a),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!a){var b=this.handlers;b&&b.stop(!1)}return this},u.prototype._ease=function(a,h,g){g.animate===!1||g.duration===0?(a(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var a=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(a,h){a=p.wrap(a,-180,180);var g=Math.abs(a-h);return Math.abs(a-360-h)<g&&(a-=360),Math.abs(a+360-h)<g&&(a+=360),a},u.prototype._normalizeCenter=function(a){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var g=a.lng-h.center.lng;a.lng+=g>180?-360:g<-180?360:0}},u}(p.Evented),ns=function(n){n===void 0&&(n={}),this.options=n,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ns.prototype.getDefaultPosition=function(){return"bottom-right"},ns.prototype.onAdd=function(n){var u=this.options&&this.options.compact;return this._map=n,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Q.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ns.prototype.onRemove=function(){Q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ns.prototype._setElementTitle=function(n,u){var a=this._map._getUIString("AttributionControl."+u);n.title=a,n.setAttribute("aria-label",a)},ns.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ns.prototype._updateEditLink=function(){var n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(n){var a=u.reduce(function(h,g,b){return g.value&&(h+=g.key+"="+g.value+(b<u.length-1?"&":"")),h},"?");n.href=p.config.FEEDBACK_URL+"/"+a+(this._map._hash?this._map._hash.getHashString(!0):""),n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}},ns.prototype._updateData=function(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ns.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(function(D){return typeof D!="string"?"":D})):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var a=this._map.style.sourceCaches;for(var h in a){var g=a[h];if(g.used){var b=g.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort(function(D,H){return D.length-H.length});var P=(n=n.filter(function(D,H){for(var ae=H+1;ae<n.length;ae++)if(n[ae].indexOf(D)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,n.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ns.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var eu=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};eu.prototype.onAdd=function(n){this._map=n,this._container=Q.create("div","mapboxgl-ctrl");var u=Q.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},eu.prototype.onRemove=function(){Q.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},eu.prototype.getDefaultPosition=function(){return"bottom-left"},eu.prototype._updateLogo=function(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},eu.prototype._logoRequired=function(){if(this._map.style){var n=this._map.style.sourceCaches;for(var u in n)if(n[u].getSource().mapbox_logo)return!0;return!1}},eu.prototype._updateCompact=function(){var n=this._container.children;if(n.length){var u=n[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var Ko=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ko.prototype.add=function(n){var u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u},Ko.prototype.remove=function(n){for(var u=this._currentlyRunning,a=0,h=u?this._queue.concat(u):this._queue;a<h.length;a+=1){var g=h[a];if(g.id===n)return void(g.cancelled=!0)}},Ko.prototype.run=function(n){n===void 0&&(n=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var a=0,h=u;a<h.length;a+=1){var g=h[a];if(!g.cancelled&&(g.callback(n),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ko.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var cu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},mc=p.window.HTMLImageElement,ec=p.window.HTMLElement,Wi=p.window.ImageBitmap,Do={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Nc=function(n){function u(h){var g=this;if((h=p.extend({},Do,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var b=new ia(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(n.call(this,b,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Ko,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},cu,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof ec))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return g._update(!1)}),this.on("moveend",function(){return g._update(!1)}),this.on("zoom",function(){return g._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Hn(this,h),this._hash=h.hash&&new _s(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new ns({customAttribution:h.customAttribution})),this.addControl(new eu,h.logoPosition),this.on("style.load",function(){g.transform.unmodified&&g.jumpTo(g.style.stylesheet)}),this.on("data",function(P){g._update(P.dataType==="style"),g.fire(new p.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){g.fire(new p.Event(P.dataType+"dataloading",P))})}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,g){if(g===void 0&&(g=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var b=h.onAdd(this);this._controls.push(h);var P=this._controlPositions[g];return g.indexOf("bottom")!==-1?P.insertBefore(b,P.firstChild):P.appendChild(b),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var g=this._controls.indexOf(h);return g>-1&&this._controls.splice(g,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var g=this._containerDimensions(),b=g[0],P=g[1];this._resizeCanvas(b,P),this.transform.resize(b,P),this.painter.resize(b,P);var D=!this._moving;return D&&(this.stop(),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h))),this.fire(new p.Event("resize",h)),D&&this.fire(new p.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,g,b){var P,D=this;if(h==="mouseenter"||h==="mouseover"){var H=!1;return{layer:g,listener:b,delegates:{mousemove:function(be){var we=D.getLayer(g)?D.queryRenderedFeatures(be.point,{layers:[g]}):[];we.length?H||(H=!0,b.call(D,new ko(h,D,be.originalEvent,{features:we}))):H=!1},mouseout:function(){H=!1}}}}if(h==="mouseleave"||h==="mouseout"){var ae=!1;return{layer:g,listener:b,delegates:{mousemove:function(be){(D.getLayer(g)?D.queryRenderedFeatures(be.point,{layers:[g]}):[]).length?ae=!0:ae&&(ae=!1,b.call(D,new ko(h,D,be.originalEvent)))},mouseout:function(be){ae&&(ae=!1,b.call(D,new ko(h,D,be.originalEvent)))}}}}return{layer:g,listener:b,delegates:(P={},P[h]=function(be){var we=D.getLayer(g)?D.queryRenderedFeatures(be.point,{layers:[g]}):[];we.length&&(be.features=we,b.call(D,be),delete be.features)},P)}},u.prototype.on=function(h,g,b){if(b===void 0)return n.prototype.on.call(this,h,g);var P=this._createDelegatedListener(h,g,b);for(var D in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(P),P.delegates)this.on(D,P.delegates[D]);return this},u.prototype.once=function(h,g,b){if(b===void 0)return n.prototype.once.call(this,h,g);var P=this._createDelegatedListener(h,g,b);for(var D in P.delegates)this.once(D,P.delegates[D]);return this},u.prototype.off=function(h,g,b){var P=this;return b===void 0?n.prototype.off.call(this,h,g):(this._delegatedListeners&&this._delegatedListeners[h]&&function(D){for(var H=D[h],ae=0;ae<H.length;ae++){var be=H[ae];if(be.layer===g&&be.listener===b){for(var we in be.delegates)P.off(we,be.delegates[we]);return H.splice(ae,1),P}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,g){if(!this.style)return[];var b;if(g!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(g=h,h=void 0),g=g||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")b=[p.Point.convert(h)];else{var P=p.Point.convert(h[0]),D=p.Point.convert(h[1]);b=[P,new p.Point(D.x,P.y),D,new p.Point(P.x,D.y),P]}return this.style.queryRenderedFeatures(b,g,this.transform)},u.prototype.querySourceFeatures=function(h,g){return this.style.querySourceFeatures(h,g)},u.prototype.setStyle=function(h,g){return(g=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(h,g))},u.prototype._getUIString=function(h){var g=this._locale[h];if(g==null)throw new Error("Missing UI string '"+h+"'");return g},u.prototype._updateStyle=function(h,g){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new gs(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,g){var b=this;if(typeof h=="string"){var P=this._requestManager.normalizeStyleURL(h),D=this._requestManager.transformRequest(P,p.ResourceType.Style);p.getJSON(D,function(H,ae){H?b.fire(new p.ErrorEvent(H)):ae&&b._updateDiff(ae,g)})}else typeof h=="object"&&this._updateDiff(h,g)},u.prototype._updateDiff=function(h,g){try{this.style.setState(h)&&this._update(!0)}catch(b){p.warnOnce("Unable to perform style diff: "+(b.message||b.error||b)+".  Rebuilding the style from scratch."),this._updateStyle(h,g)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,g){return this._lazyInitEmptyStyle(),this.style.addSource(h,g),this._update(!0)},u.prototype.isSourceLoaded=function(h){var g=this.style&&this.style.sourceCaches[h];if(g!==void 0)return g.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var g in h){var b=h[g]._tiles;for(var P in b){var D=b[P];if(D.state!=="loaded"&&D.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,g,b){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,g,b)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,g,b){b===void 0&&(b={});var P=b.pixelRatio;P===void 0&&(P=1);var D=b.sdf;D===void 0&&(D=!1);var H=b.stretchX,ae=b.stretchY,be=b.content;if(this._lazyInitEmptyStyle(),g instanceof mc||Wi&&g instanceof Wi){var we=p.browser.getImageData(g);this.style.addImage(h,{data:new p.RGBAImage({width:we.width,height:we.height},we.data),pixelRatio:P,stretchX:H,stretchY:ae,content:be,sdf:D,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Pe=g;this.style.addImage(h,{data:new p.RGBAImage({width:g.width,height:g.height},new Uint8Array(g.data)),pixelRatio:P,stretchX:H,stretchY:ae,content:be,sdf:D,version:0,userImage:Pe}),Pe.onAdd&&Pe.onAdd(this,h)}},u.prototype.updateImage=function(h,g){var b=this.style.getImage(h);if(!b)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=g instanceof mc||Wi&&g instanceof Wi?p.browser.getImageData(g):g,D=P.width,H=P.height,ae=P.data;return D===void 0||H===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):D!==b.data.width||H!==b.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(b.data.replace(ae,!(g instanceof mc||Wi&&g instanceof Wi)),void this.style.updateImage(h,b))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,g){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),g)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,g){return this._lazyInitEmptyStyle(),this.style.addLayer(h,g),this._update(!0)},u.prototype.moveLayer=function(h,g){return this.style.moveLayer(h,g),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,g,b){return this.style.setLayerZoomRange(h,g,b),this._update(!0)},u.prototype.setFilter=function(h,g,b){return b===void 0&&(b={}),this.style.setFilter(h,g,b),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,g,b,P){return P===void 0&&(P={}),this.style.setPaintProperty(h,g,b,P),this._update(!0)},u.prototype.getPaintProperty=function(h,g){return this.style.getPaintProperty(h,g)},u.prototype.setLayoutProperty=function(h,g,b,P){return P===void 0&&(P={}),this.style.setLayoutProperty(h,g,b,P),this._update(!0)},u.prototype.getLayoutProperty=function(h,g){return this.style.getLayoutProperty(h,g)},u.prototype.setLight=function(h,g){return g===void 0&&(g={}),this._lazyInitEmptyStyle(),this.style.setLight(h,g),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,g){return this.style.setFeatureState(h,g),this._update()},u.prototype.removeFeatureState=function(h,g){return this.style.removeFeatureState(h,g),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,g=0;return this._container&&(h=this._container.clientWidth||400,g=this._container.clientHeight||300),[h,g]},u.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Q.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var g=this._canvasContainer=Q.create("div","mapboxgl-canvas-container",h);this._interactive&&g.classList.add("mapboxgl-interactive"),this._canvas=Q.create("canvas","mapboxgl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var b=this._containerDimensions();this._resizeCanvas(b[0],b[1]);var P=this._controlContainer=Q.create("div","mapboxgl-control-container",h),D=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(H){D[H]=Q.create("div","mapboxgl-ctrl-"+H,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,g){var b=p.browser.devicePixelRatio||1;this._canvas.width=b*h,this._canvas.height=b*g,this._canvas.style.width=h+"px",this._canvas.style.height=g+"px"},u.prototype._setupPainter=function(){var h=p.extend({},A.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),g=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);g?(this.painter=new $a(g,this.transform),p.webpSupported.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var g,b=this,P=0,D=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=D.createQueryEXT(),D.beginQueryEXT(D.TIME_ELAPSED_EXT,g),P=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var H=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ae=this.transform.zoom,be=p.browser.now();this.style.zoomHistory.update(ae,be);var we=new p.EvaluationParameters(ae,{now:be,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Pe=we.crossFadingFactor();Pe===1&&Pe===this._crossFadingFactor||(H=!0,this._crossFadingFactor=Pe),this.style.update(we)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||H)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var We=p.browser.now()-P;D.endQueryEXT(D.TIME_ELAPSED_EXT,g),setTimeout(function(){var ze=D.getQueryObjectEXT(g,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(g),b.fire(new p.Event("gpu-timing-frame",{cpuTime:We,gpuTime:ze}))},50)}if(this.listens("gpu-timing-layer")){var Ve=this.painter.collectGpuTimers();setTimeout(function(){var ze=b.painter.queryGpuTimers(Ve);b.fire(new p.Event("gpu-timing-layer",{layerTimes:ze}))},50)}var nt=this._sourcesDirty||this._styleDirty||this._placementDirty;return nt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||nt||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,g=this._controls;h<g.length;h+=1)g[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),xs(this._canvasContainer),xs(this._controlContainer),xs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(g){h._frame=null,h._render(g)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,g){p.setCacheLimits(h,g)},a.version.get=function(){return p.version},Object.defineProperties(u.prototype,a),u}(Il);function xs(n){n.parentNode&&n.parentNode.removeChild(n)}var tc={showCompass:!0,showZoom:!0,visualizePitch:!1},bs=function(n){var u=this;this.options=p.extend({},tc,n),this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(a){return a.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(a){return u._map.zoomIn({},{originalEvent:a})}),Q.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(a){return u._map.zoomOut({},{originalEvent:a})}),Q.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(a){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:a}):u._map.resetNorth({},{originalEvent:a})}),this._compassIcon=Q.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};bs.prototype._updateZoomButtons=function(){var n=this._map.getZoom(),u=n===this._map.getMaxZoom(),a=n===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},bs.prototype._rotateCompassArrow=function(){var n=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=n},bs.prototype.onAdd=function(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hs(this._map,this._compass,this.options.visualizePitch)),this._container},bs.prototype.onRemove=function(){Q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},bs.prototype._createButton=function(n,u){var a=Q.create("button",n,this._container);return a.type="button",a.addEventListener("click",u),a},bs.prototype._setButtonTitle=function(n,u){var a=this._map._getUIString("NavigationControl."+u);n.title=a,n.setAttribute("aria-label",a)};var hs=function(n,u,a){a===void 0&&(a=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new Ql({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,a&&(this.mousePitch=new Ru({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Q.addEventListener(u,"mousedown",this.mousedown),Q.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Q.addEventListener(u,"touchmove",this.touchmove),Q.addEventListener(u,"touchend",this.touchend),Q.addEventListener(u,"touchcancel",this.reset)};function pl(n,u,a){if(n=new p.LngLat(n.lng,n.lat),u){var h=new p.LngLat(n.lng-360,n.lat),g=new p.LngLat(n.lng+360,n.lat),b=a.locationPoint(n).distSqr(u);a.locationPoint(h).distSqr(u)<b?n=h:a.locationPoint(g).distSqr(u)<b&&(n=g)}for(;Math.abs(n.lng-a.center.lng)>180;){var P=a.locationPoint(n);if(P.x>=0&&P.y>=0&&P.x<=a.width&&P.y<=a.height)break;n.lng>a.center.lng?n.lng-=360:n.lng+=360}return n}hs.prototype.down=function(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),Q.disableDrag()},hs.prototype.move=function(n,u){var a=this.map,h=this.mouseRotate.mousemoveWindow(n,u);if(h&&h.bearingDelta&&a.setBearing(a.getBearing()+h.bearingDelta),this.mousePitch){var g=this.mousePitch.mousemoveWindow(n,u);g&&g.pitchDelta&&a.setPitch(a.getPitch()+g.pitchDelta)}},hs.prototype.off=function(){var n=this.element;Q.removeEventListener(n,"mousedown",this.mousedown),Q.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),Q.removeEventListener(n,"touchmove",this.touchmove),Q.removeEventListener(n,"touchend",this.touchend),Q.removeEventListener(n,"touchcancel",this.reset),this.offTemp()},hs.prototype.offTemp=function(){Q.enableDrag(),Q.removeEventListener(p.window,"mousemove",this.mousemove),Q.removeEventListener(p.window,"mouseup",this.mouseup)},hs.prototype.mousedown=function(n){this.down(p.extend({},n,{ctrlKey:!0,preventDefault:function(){return n.preventDefault()}}),Q.mousePos(this.element,n)),Q.addEventListener(p.window,"mousemove",this.mousemove),Q.addEventListener(p.window,"mouseup",this.mouseup)},hs.prototype.mousemove=function(n){this.move(n,Q.mousePos(this.element,n))},hs.prototype.mouseup=function(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()},hs.prototype.touchstart=function(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Q.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return n.preventDefault()}},this._startPos))},hs.prototype.touchmove=function(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Q.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:function(){return n.preventDefault()}},this._lastPos))},hs.prototype.touchend=function(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},hs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var fu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ol(n,u,a){var h=n.classList;for(var g in fu)h.remove("mapboxgl-"+a+"-anchor-"+g);h.add("mapboxgl-"+a+"-anchor-"+u)}var Ku,Ll=function(n){function u(a,h){if(n.call(this),(a instanceof p.window.HTMLElement||h)&&(a=p.extend({element:a},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=p.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q.create("div"),this._element.setAttribute("aria-label","Map marker");var g=Q.createNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","41px"),g.setAttributeNS(null,"width","27px"),g.setAttributeNS(null,"viewBox","0 0 27 41");var b=Q.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");var P=Q.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var D=Q.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");for(var H=0,ae=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];H<ae.length;H+=1){var be=ae[H],we=Q.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",be.rx),we.setAttributeNS(null,"ry",be.ry),D.appendChild(we)}var Pe=Q.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"fill",this._color);var We=Q.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Pe.appendChild(We);var Ve=Q.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"opacity","0.25"),Ve.setAttributeNS(null,"fill","#000000");var nt=Q.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ve.appendChild(nt);var ze=Q.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ze.setAttributeNS(null,"fill","#FFFFFF");var ot=Q.createNS("http://www.w3.org/2000/svg","g");ot.setAttributeNS(null,"transform","translate(8.0, 8.0)");var bt=Q.createNS("http://www.w3.org/2000/svg","circle");bt.setAttributeNS(null,"fill","#000000"),bt.setAttributeNS(null,"opacity","0.25"),bt.setAttributeNS(null,"cx","5.5"),bt.setAttributeNS(null,"cy","5.5"),bt.setAttributeNS(null,"r","5.4999962");var Zt=Q.createNS("http://www.w3.org/2000/svg","circle");Zt.setAttributeNS(null,"fill","#FFFFFF"),Zt.setAttributeNS(null,"cx","5.5"),Zt.setAttributeNS(null,"cy","5.5"),Zt.setAttributeNS(null,"r","5.4999962"),ot.appendChild(bt),ot.appendChild(Zt),P.appendChild(D),P.appendChild(Pe),P.appendChild(Ve),P.appendChild(ze),P.appendChild(ot),g.appendChild(P),g.setAttributeNS(null,"height",41*this._scale+"px"),g.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(g),this._offset=p.Point.convert(a&&a.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(hr){hr.preventDefault()}),this._element.addEventListener("mousedown",function(hr){hr.preventDefault()}),Ol(this._element,this._anchor,"marker"),this._popup=null}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Q.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(a){var h=a.code,g=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()},u.prototype._onMapClick=function(a){var h=a.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this},u.prototype._update=function(a){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=pl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g="rotateX("+this._map.getPitch()+"deg)"),a&&a.type!=="moveend"||(this._pos=this._pos.round()),Q.setTransform(this._element,fu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+g+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(a){return this._offset=p.Point.convert(a),this._update(),this},u.prototype._onMove=function(a){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(a){return this._rotation=a||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(a){return this._rotationAlignment=a||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(p.Evented),zc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Rl=0,dl=!1,yc=function(n){function u(a){n.call(this),this.options=p.extend({},zc,a),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(a){var h;return this._map=a,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,Ku!==void 0?h(Ku):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(g){h(Ku=g.state!=="denied")}):h(Ku=!!p.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Rl=0,dl=!1},u.prototype._isOutOfMapMaxBounds=function(a){var h=this._map.getMaxBounds(),g=a.coords;return h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(a){if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",a)),this._finish()}},u.prototype._updateCamera=function(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude),g=a.coords.accuracy,b=this._map.getBearing(),P=p.extend({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),P,{geolocateSource:!0})},u.prototype._updateMarker=function(a){if(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var a=this._map._container.clientHeight/2,h=this._map.unproject([0,a]),g=this._map.unproject([1,a]),b=h.distanceTo(g),P=Math.ceil(2*this._accuracy/b);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(a){if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&dl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",a)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(a){var h=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=Q.create("button","mapboxgl-ctrl-geolocate",this._container),Q.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",a===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{var b=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ll(this._dotElement),this._circleElement=Q.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ll({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||h._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Rl--,dl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var a;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Rl>1?(a={maximumAge:6e5,timeout:0},dl=!0):(a=this.options.positionOptions,dl=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,a)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(p.Evented),Du={maxWidth:100,unit:"metric"},Fu=function(n){this.options=p.extend({},Du,n),p.bindAll(["_onMove","setUnit"],this)};function gc(n,u,a){var h=a&&a.maxWidth||100,g=n._container.clientHeight/2,b=n.unproject([0,g]),P=n.unproject([h,g]),D=b.distanceTo(P);if(a&&a.unit==="imperial"){var H=3.2808*D;H>5280?Bu(u,h,H/5280,n._getUIString("ScaleControl.Miles")):Bu(u,h,H,n._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Bu(u,h,D/1852,n._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Bu(u,h,D/1e3,n._getUIString("ScaleControl.Kilometers")):Bu(u,h,D,n._getUIString("ScaleControl.Meters"))}function Bu(n,u,a,h){var g,b,P,D=(g=a,(b=Math.pow(10,(""+Math.floor(g)).length-1))*(P=(P=g/b)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(H){var ae=Math.pow(10,Math.ceil(-Math.log(H)/Math.LN10));return Math.round(H*ae)/ae}(P)));n.style.width=u*(D/a)+"px",n.innerHTML=D+"&nbsp;"+h}Fu.prototype.getDefaultPosition=function(){return"bottom-left"},Fu.prototype._onMove=function(){gc(this._map,this._container,this.options)},Fu.prototype.onAdd=function(n){return this._map=n,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Fu.prototype.onRemove=function(){Q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Fu.prototype.setUnit=function(n){this.options.unit=n,gc(this._map,this._container,this.options)};var js=function(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof p.window.HTMLElement?this._container=n.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};js.prototype.onAdd=function(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},js.prototype.onRemove=function(){Q.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},js.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},js.prototype._setupUI=function(){var n=this._fullscreenButton=Q.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Q.create("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden",!0),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},js.prototype._updateTitle=function(){var n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.title=n},js.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},js.prototype._isFullscreen=function(){return this._fullscreen},js.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},js.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var _c={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Nu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),kl=function(n){function u(a){n.call(this),this.options=p.extend(Object.create(_c),a),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(a){return this._map&&this.remove(),this._map=a,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&Q.remove(this._content),this._container&&(Q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(a){return this.setDOMContent(p.window.document.createTextNode(a))},u.prototype.setHTML=function(a){var h,g=p.window.document.createDocumentFragment(),b=p.window.document.createElement("body");for(b.innerHTML=a;h=b.firstChild;)g.appendChild(h);return this.setDOMContent(g)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(a){return this.options.maxWidth=a,this._update(),this},u.prototype.setDOMContent=function(a){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Q.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(a),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(a){this._container&&this._container.classList.add(a)},u.prototype.removeClassName=function(a){this._container&&this._container.classList.remove(a)},u.prototype.setOffset=function(a){return this.options.offset=a,this._update(),this},u.prototype.toggleClassName=function(a){if(this._container)return this._container.classList.toggle(a)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Q.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(a){this._update(a.point)},u.prototype._onMouseMove=function(a){this._update(a.point)},u.prototype._onDrag=function(a){this._update(a.point)},u.prototype._update=function(a){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Q.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Q.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(we){return h._container.classList.add(we)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||a)){var g=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat),b=this.options.anchor,P=function we(Pe){if(Pe){if(typeof Pe=="number"){var We=Math.round(Math.sqrt(.5*Math.pow(Pe,2)));return{center:new p.Point(0,0),top:new p.Point(0,Pe),"top-left":new p.Point(We,We),"top-right":new p.Point(-We,We),bottom:new p.Point(0,-Pe),"bottom-left":new p.Point(We,-We),"bottom-right":new p.Point(-We,-We),left:new p.Point(Pe,0),right:new p.Point(-Pe,0)}}if(Pe instanceof p.Point||Array.isArray(Pe)){var Ve=p.Point.convert(Pe);return{center:Ve,top:Ve,"top-left":Ve,"top-right":Ve,bottom:Ve,"bottom-left":Ve,"bottom-right":Ve,left:Ve,right:Ve}}return{center:p.Point.convert(Pe.center||[0,0]),top:p.Point.convert(Pe.top||[0,0]),"top-left":p.Point.convert(Pe["top-left"]||[0,0]),"top-right":p.Point.convert(Pe["top-right"]||[0,0]),bottom:p.Point.convert(Pe.bottom||[0,0]),"bottom-left":p.Point.convert(Pe["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(Pe["bottom-right"]||[0,0]),left:p.Point.convert(Pe.left||[0,0]),right:p.Point.convert(Pe.right||[0,0])}}return we(new p.Point(0,0))}(this.options.offset);if(!b){var D,H=this._container.offsetWidth,ae=this._container.offsetHeight;D=g.y+P.bottom.y<ae?["top"]:g.y>this._map.transform.height-ae?["bottom"]:[],g.x<H/2?D.push("left"):g.x>this._map.transform.width-H/2&&D.push("right"),b=D.length===0?"bottom":D.join("-")}var be=g.add(P[b]).round();Q.setTransform(this._container,fu[b]+" translate("+be.x+"px,"+be.y+"px)"),Ol(this._container,b,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var a=this._container.querySelector(Nu);a&&a.focus()}},u.prototype._onClose=function(){this.remove()},u}(p.Evented),$u={version:p.version,supported:A,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:Nc,NavigationControl:bs,GeolocateControl:yc,AttributionControl:ns,ScaleControl:Fu,FullscreenControl:js,Popup:kl,Marker:Ll,Style:gs,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){$t().acquire(Jt)},clearPrewarmedResources:function(){var n=Mn;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(Jt),Mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(n){p.config.ACCESS_TOKEN=n},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(n){p.config.API_URL=n},get workerCount(){return Rr.workerCount},set workerCount(n){Rr.workerCount=n},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){p.config.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage:function(n){p.clearTileCache(n)},workerUrl:""};return $u}),le})},28660:function(Or,U,E){var le=E(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var C;(function(p){(function(A){var Q=typeof E.g=="object"?E.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Y=W(p);typeof Q.Reflect=="undefined"?Q.Reflect=p:Y=W(Q.Reflect,Y),A(Y);function W(L,N){return function(Be,Ye){typeof L[Be]!="function"&&Object.defineProperty(L,Be,{configurable:!0,writable:!0,value:Ye}),N&&N(Be,Ye)}}})(function(A){var Q=Object.prototype.hasOwnProperty,Y=typeof Symbol=="function",W=Y&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",L=Y&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",N=typeof Object.create=="function",Be={__proto__:[]}instanceof Array,Ye=!N&&!Be,Je={create:N?function(){return Lr(Object.create(null))}:Be?function(){return Lr({__proto__:null})}:function(){return Lr({})},has:Ye?function(rt,gt){return Q.call(rt,gt)}:function(rt,gt){return gt in rt},get:Ye?function(rt,gt){return Q.call(rt,gt)?rt[gt]:void 0}:function(rt,gt){return rt[gt]}},et=Object.getPrototypeOf(Function),Yt=typeof le=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Gt=!Yt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ie(),tr=!Yt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:sr(),zt=!Yt&&typeof WeakMap=="function"?WeakMap:Br(),Pt=new zt;function xt(rt,gt,pt,dr){if(yn(pt)){if(!w(rt))throw new TypeError;if(!Ee(gt))throw new TypeError;return or(rt,gt)}else{if(!w(rt))throw new TypeError;if(!de(gt))throw new TypeError;if(!de(dr)&&!yn(dr)&&!Vi(dr))throw new TypeError;return Vi(dr)&&(dr=void 0),pt=er(pt),zr(rt,gt,pt,dr)}}A("decorate",xt);function yr(rt,gt){function pt(dr,Vr){if(!de(dr))throw new TypeError;if(!yn(Vr)&&!je(Vr))throw new TypeError;Nt(rt,gt,dr,Vr)}return pt}A("metadata",yr);function ee(rt,gt,pt,dr){if(!de(pt))throw new TypeError;return yn(dr)||(dr=er(dr)),Nt(rt,gt,pt,dr)}A("defineMetadata",ee);function vr(rt,gt,pt){if(!de(gt))throw new TypeError;return yn(pt)||(pt=er(pt)),Re(rt,gt,pt)}A("hasMetadata",vr);function Ct(rt,gt,pt){if(!de(gt))throw new TypeError;return yn(pt)||(pt=er(pt)),ye(rt,gt,pt)}A("hasOwnMetadata",Ct);function Ke(rt,gt,pt){if(!de(gt))throw new TypeError;return yn(pt)||(pt=er(pt)),_t(rt,gt,pt)}A("getMetadata",Ke);function Rt(rt,gt,pt){if(!de(gt))throw new TypeError;return yn(pt)||(pt=er(pt)),ft(rt,gt,pt)}A("getOwnMetadata",Rt);function Xe(rt,gt){if(!de(rt))throw new TypeError;return yn(gt)||(gt=er(gt)),Ft(rt,gt)}A("getMetadataKeys",Xe);function Ut(rt,gt){if(!de(rt))throw new TypeError;return yn(gt)||(gt=er(gt)),kr(rt,gt)}A("getOwnMetadataKeys",Ut);function _r(rt,gt,pt){if(!de(gt))throw new TypeError;yn(pt)||(pt=er(pt));var dr=he(gt,pt,!1);if(yn(dr)||!dr.delete(rt))return!1;if(dr.size>0)return!0;var Vr=Pt.get(gt);return Vr.delete(pt),Vr.size>0||Pt.delete(gt),!0}A("deleteMetadata",_r);function or(rt,gt){for(var pt=rt.length-1;pt>=0;--pt){var dr=rt[pt],Vr=dr(gt);if(!yn(Vr)&&!Vi(Vr)){if(!Ee(Vr))throw new TypeError;gt=Vr}}return gt}function zr(rt,gt,pt,dr){for(var Vr=rt.length-1;Vr>=0;--Vr){var Ur=rt[Vr],nn=Ur(gt,pt,dr);if(!yn(nn)&&!Vi(nn)){if(!de(nn))throw new TypeError;dr=nn}}return dr}function he(rt,gt,pt){var dr=Pt.get(rt);if(yn(dr)){if(!pt)return;dr=new Gt,Pt.set(rt,dr)}var Vr=dr.get(gt);if(yn(Vr)){if(!pt)return;Vr=new Gt,dr.set(gt,Vr)}return Vr}function Re(rt,gt,pt){var dr=ye(rt,gt,pt);if(dr)return!0;var Vr=Qt(gt);return Vi(Vr)?!1:Re(rt,Vr,pt)}function ye(rt,gt,pt){var dr=he(gt,pt,!1);return yn(dr)?!1:Le(dr.has(rt))}function _t(rt,gt,pt){var dr=ye(rt,gt,pt);if(dr)return ft(rt,gt,pt);var Vr=Qt(gt);if(!Vi(Vr))return _t(rt,Vr,pt)}function ft(rt,gt,pt){var dr=he(gt,pt,!1);if(!yn(dr))return dr.get(rt)}function Nt(rt,gt,pt,dr){var Vr=he(pt,dr,!0);Vr.set(rt,gt)}function Ft(rt,gt){var pt=kr(rt,gt),dr=Qt(rt);if(dr===null)return pt;var Vr=Ft(dr,gt);if(Vr.length<=0)return pt;if(pt.length<=0)return Vr;for(var Ur=new tr,nn=[],Jr=0,Cr=pt;Jr<Cr.length;Jr++){var kn=Cr[Jr],Zn=Ur.has(kn);Zn||(Ur.add(kn),nn.push(kn))}for(var Si=0,zi=Vr;Si<zi.length;Si++){var kn=zi[Si],Zn=Ur.has(kn);Zn||(Ur.add(kn),nn.push(kn))}return nn}function kr(rt,gt){var pt=[],dr=he(rt,gt,!1);if(yn(dr))return pt;for(var Vr=dr.keys(),Ur=yt(Vr),nn=0;;){var Jr=jt(Ur);if(!Jr)return pt.length=nn,pt;var Cr=St(Jr);try{pt[nn]=Cr}catch(kn){try{Et(Ur)}finally{throw kn}}nn++}}function cn(rt){if(rt===null)return 1;switch(typeof rt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return rt===null?1:6;default:return 6}}function yn(rt){return rt===void 0}function Vi(rt){return rt===null}function ir(rt){return typeof rt=="symbol"}function de(rt){return typeof rt=="object"?rt!==null:typeof rt=="function"}function Te(rt,gt){switch(cn(rt)){case 0:return rt;case 1:return rt;case 2:return rt;case 3:return rt;case 4:return rt;case 5:return rt}var pt=gt===3?"string":gt===5?"number":"default",dr=Qe(rt,W);if(dr!==void 0){var Vr=dr.call(rt,pt);if(de(Vr))throw new TypeError;return Vr}return Ue(rt,pt==="default"?"number":pt)}function Ue(rt,gt){if(gt==="string"){var pt=rt.toString;if(Z(pt)){var dr=pt.call(rt);if(!de(dr))return dr}var Vr=rt.valueOf;if(Z(Vr)){var dr=Vr.call(rt);if(!de(dr))return dr}}else{var Vr=rt.valueOf;if(Z(Vr)){var dr=Vr.call(rt);if(!de(dr))return dr}var Ur=rt.toString;if(Z(Ur)){var dr=Ur.call(rt);if(!de(dr))return dr}}throw new TypeError}function Le(rt){return!!rt}function kt(rt){return""+rt}function er(rt){var gt=Te(rt,3);return ir(gt)?gt:kt(gt)}function w(rt){return Array.isArray?Array.isArray(rt):rt instanceof Object?rt instanceof Array:Object.prototype.toString.call(rt)==="[object Array]"}function Z(rt){return typeof rt=="function"}function Ee(rt){return typeof rt=="function"}function je(rt){switch(cn(rt)){case 3:return!0;case 4:return!0;default:return!1}}function Qe(rt,gt){var pt=rt[gt];if(pt!=null){if(!Z(pt))throw new TypeError;return pt}}function yt(rt){var gt=Qe(rt,L);if(!Z(gt))throw new TypeError;var pt=gt.call(rt);if(!de(pt))throw new TypeError;return pt}function St(rt){return rt.value}function jt(rt){var gt=rt.next();return gt.done?!1:gt}function Et(rt){var gt=rt.return;gt&&gt.call(rt)}function Qt(rt){var gt=Object.getPrototypeOf(rt);if(typeof rt!="function"||rt===et||gt!==et)return gt;var pt=rt.prototype,dr=pt&&Object.getPrototypeOf(pt);if(dr==null||dr===Object.prototype)return gt;var Vr=dr.constructor;return typeof Vr!="function"||Vr===rt?gt:Vr}function ie(){var rt={},gt=[],pt=function(){function nn(Jr,Cr,kn){this._index=0,this._keys=Jr,this._values=Cr,this._selector=kn}return nn.prototype["@@iterator"]=function(){return this},nn.prototype[L]=function(){return this},nn.prototype.next=function(){var Jr=this._index;if(Jr>=0&&Jr<this._keys.length){var Cr=this._selector(this._keys[Jr],this._values[Jr]);return Jr+1>=this._keys.length?(this._index=-1,this._keys=gt,this._values=gt):this._index++,{value:Cr,done:!1}}return{value:void 0,done:!0}},nn.prototype.throw=function(Jr){throw this._index>=0&&(this._index=-1,this._keys=gt,this._values=gt),Jr},nn.prototype.return=function(Jr){return this._index>=0&&(this._index=-1,this._keys=gt,this._values=gt),{value:Jr,done:!0}},nn}();return function(){function nn(){this._keys=[],this._values=[],this._cacheKey=rt,this._cacheIndex=-2}return Object.defineProperty(nn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),nn.prototype.has=function(Jr){return this._find(Jr,!1)>=0},nn.prototype.get=function(Jr){var Cr=this._find(Jr,!1);return Cr>=0?this._values[Cr]:void 0},nn.prototype.set=function(Jr,Cr){var kn=this._find(Jr,!0);return this._values[kn]=Cr,this},nn.prototype.delete=function(Jr){var Cr=this._find(Jr,!1);if(Cr>=0){for(var kn=this._keys.length,Zn=Cr+1;Zn<kn;Zn++)this._keys[Zn-1]=this._keys[Zn],this._values[Zn-1]=this._values[Zn];return this._keys.length--,this._values.length--,Jr===this._cacheKey&&(this._cacheKey=rt,this._cacheIndex=-2),!0}return!1},nn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=rt,this._cacheIndex=-2},nn.prototype.keys=function(){return new pt(this._keys,this._values,dr)},nn.prototype.values=function(){return new pt(this._keys,this._values,Vr)},nn.prototype.entries=function(){return new pt(this._keys,this._values,Ur)},nn.prototype["@@iterator"]=function(){return this.entries()},nn.prototype[L]=function(){return this.entries()},nn.prototype._find=function(Jr,Cr){return this._cacheKey!==Jr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Jr)),this._cacheIndex<0&&Cr&&(this._cacheIndex=this._keys.length,this._keys.push(Jr),this._values.push(void 0)),this._cacheIndex},nn}();function dr(nn,Jr){return nn}function Vr(nn,Jr){return Jr}function Ur(nn,Jr){return[nn,Jr]}}function sr(){return function(){function rt(){this._map=new Gt}return Object.defineProperty(rt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),rt.prototype.has=function(gt){return this._map.has(gt)},rt.prototype.add=function(gt){return this._map.set(gt,gt),this},rt.prototype.delete=function(gt){return this._map.delete(gt)},rt.prototype.clear=function(){this._map.clear()},rt.prototype.keys=function(){return this._map.keys()},rt.prototype.values=function(){return this._map.values()},rt.prototype.entries=function(){return this._map.entries()},rt.prototype["@@iterator"]=function(){return this.keys()},rt.prototype[L]=function(){return this.keys()},rt}()}function Br(){var rt=16,gt=Je.create(),pt=dr();return function(){function Cr(){this._key=dr()}return Cr.prototype.has=function(kn){var Zn=Vr(kn,!1);return Zn!==void 0?Je.has(Zn,this._key):!1},Cr.prototype.get=function(kn){var Zn=Vr(kn,!1);return Zn!==void 0?Je.get(Zn,this._key):void 0},Cr.prototype.set=function(kn,Zn){var Si=Vr(kn,!0);return Si[this._key]=Zn,this},Cr.prototype.delete=function(kn){var Zn=Vr(kn,!1);return Zn!==void 0?delete Zn[this._key]:!1},Cr.prototype.clear=function(){this._key=dr()},Cr}();function dr(){var Cr;do Cr="@@WeakMap@@"+Jr();while(Je.has(gt,Cr));return gt[Cr]=!0,Cr}function Vr(Cr,kn){if(!Q.call(Cr,pt)){if(!kn)return;Object.defineProperty(Cr,pt,{value:Je.create()})}return Cr[pt]}function Ur(Cr,kn){for(var Zn=0;Zn<kn;++Zn)Cr[Zn]=Math.random()*255|0;return Cr}function nn(Cr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Cr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Cr)):Ur(new Uint8Array(Cr),Cr):Ur(new Array(Cr),Cr)}function Jr(){var Cr=nn(rt);Cr[6]=Cr[6]&79|64,Cr[8]=Cr[8]&191|128;for(var kn="",Zn=0;Zn<rt;++Zn){var Si=Cr[Zn];(Zn===4||Zn===6||Zn===8)&&(kn+="-"),Si<16&&(kn+="0"),kn+=Si.toString(16).toLowerCase()}return kn}}function Lr(rt){return rt.__=void 0,delete rt.__,rt}})})(C||(C={}))},69848:function(Or){(function(U,E){Or.exports=E()})(this,function(){"use strict";function U(Ct,Ke,Rt,Xe,Ut,_r){if(!(Ut-Xe<=Rt)){var or=Xe+Ut>>1;E(Ct,Ke,or,Xe,Ut,_r%2),U(Ct,Ke,Rt,Xe,or-1,_r+1),U(Ct,Ke,Rt,or+1,Ut,_r+1)}}function E(Ct,Ke,Rt,Xe,Ut,_r){for(;Ut>Xe;){if(Ut-Xe>600){var or=Ut-Xe+1,zr=Rt-Xe+1,he=Math.log(or),Re=.5*Math.exp(2*he/3),ye=.5*Math.sqrt(he*Re*(or-Re)/or)*(zr-or/2<0?-1:1),_t=Math.max(Xe,Math.floor(Rt-zr*Re/or+ye)),ft=Math.min(Ut,Math.floor(Rt+(or-zr)*Re/or+ye));E(Ct,Ke,Rt,_t,ft,_r)}var Nt=Ke[2*Rt+_r],Ft=Xe,kr=Ut;for(le(Ct,Ke,Xe,Rt),Ke[2*Ut+_r]>Nt&&le(Ct,Ke,Xe,Ut);Ft<kr;){for(le(Ct,Ke,Ft,kr),Ft++,kr--;Ke[2*Ft+_r]<Nt;)Ft++;for(;Ke[2*kr+_r]>Nt;)kr--}Ke[2*Xe+_r]===Nt?le(Ct,Ke,Xe,kr):(kr++,le(Ct,Ke,kr,Ut)),kr<=Rt&&(Xe=kr+1),Rt<=kr&&(Ut=kr-1)}}function le(Ct,Ke,Rt,Xe){C(Ct,Rt,Xe),C(Ke,2*Rt,2*Xe),C(Ke,2*Rt+1,2*Xe+1)}function C(Ct,Ke,Rt){var Xe=Ct[Ke];Ct[Ke]=Ct[Rt],Ct[Rt]=Xe}function p(Ct,Ke,Rt,Xe,Ut,_r,or){for(var zr=[0,Ct.length-1,0],he=[],Re,ye;zr.length;){var _t=zr.pop(),ft=zr.pop(),Nt=zr.pop();if(ft-Nt<=or){for(var Ft=Nt;Ft<=ft;Ft++)Re=Ke[2*Ft],ye=Ke[2*Ft+1],Re>=Rt&&Re<=Ut&&ye>=Xe&&ye<=_r&&he.push(Ct[Ft]);continue}var kr=Math.floor((Nt+ft)/2);Re=Ke[2*kr],ye=Ke[2*kr+1],Re>=Rt&&Re<=Ut&&ye>=Xe&&ye<=_r&&he.push(Ct[kr]);var cn=(_t+1)%2;(_t===0?Rt<=Re:Xe<=ye)&&(zr.push(Nt),zr.push(kr-1),zr.push(cn)),(_t===0?Ut>=Re:_r>=ye)&&(zr.push(kr+1),zr.push(ft),zr.push(cn))}return he}function A(Ct,Ke,Rt,Xe,Ut,_r){for(var or=[0,Ct.length-1,0],zr=[],he=Ut*Ut;or.length;){var Re=or.pop(),ye=or.pop(),_t=or.pop();if(ye-_t<=_r){for(var ft=_t;ft<=ye;ft++)Q(Ke[2*ft],Ke[2*ft+1],Rt,Xe)<=he&&zr.push(Ct[ft]);continue}var Nt=Math.floor((_t+ye)/2),Ft=Ke[2*Nt],kr=Ke[2*Nt+1];Q(Ft,kr,Rt,Xe)<=he&&zr.push(Ct[Nt]);var cn=(Re+1)%2;(Re===0?Rt-Ut<=Ft:Xe-Ut<=kr)&&(or.push(_t),or.push(Nt-1),or.push(cn)),(Re===0?Rt+Ut>=Ft:Xe+Ut>=kr)&&(or.push(Nt+1),or.push(ye),or.push(cn))}return zr}function Q(Ct,Ke,Rt,Xe){var Ut=Ct-Rt,_r=Ke-Xe;return Ut*Ut+_r*_r}var Y=function(Ct){return Ct[0]},W=function(Ct){return Ct[1]},L=function(Ke,Rt,Xe,Ut,_r){Rt===void 0&&(Rt=Y),Xe===void 0&&(Xe=W),Ut===void 0&&(Ut=64),_r===void 0&&(_r=Float64Array),this.nodeSize=Ut,this.points=Ke;for(var or=Ke.length<65536?Uint16Array:Uint32Array,zr=this.ids=new or(Ke.length),he=this.coords=new _r(Ke.length*2),Re=0;Re<Ke.length;Re++)zr[Re]=Re,he[2*Re]=Rt(Ke[Re]),he[2*Re+1]=Xe(Ke[Re]);U(zr,he,Ut,0,zr.length-1,0)};L.prototype.range=function(Ke,Rt,Xe,Ut){return p(this.ids,this.coords,Ke,Rt,Xe,Ut,this.nodeSize)},L.prototype.within=function(Ke,Rt,Xe){return A(this.ids,this.coords,Ke,Rt,Xe,this.nodeSize)};var N={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Ct){return Ct}},Be=Math.fround||function(Ct){return function(Ke){return Ct[0]=+Ke,Ct[0]}}(new Float32Array(1)),Ye=function(Ke){this.options=yr(Object.create(N),Ke),this.trees=new Array(this.options.maxZoom+1)};Ye.prototype.load=function(Ke){var Rt=this.options,Xe=Rt.log,Ut=Rt.minZoom,_r=Rt.maxZoom,or=Rt.nodeSize;Xe&&console.time("total time");var zr="prepare "+Ke.length+" points";Xe&&console.time(zr),this.points=Ke;for(var he=[],Re=0;Re<Ke.length;Re++)!Ke[Re].geometry||he.push(et(Ke[Re],Re));this.trees[_r+1]=new L(he,ee,vr,or,Float32Array),Xe&&console.timeEnd(zr);for(var ye=_r;ye>=Ut;ye--){var _t=+Date.now();he=this._cluster(he,ye),this.trees[ye]=new L(he,ee,vr,or,Float32Array),Xe&&console.log("z%d: %d clusters in %dms",ye,he.length,+Date.now()-_t)}return Xe&&console.timeEnd("total time"),this},Ye.prototype.getClusters=function(Ke,Rt){var Xe=((Ke[0]+180)%360+360)%360-180,Ut=Math.max(-90,Math.min(90,Ke[1])),_r=Ke[2]===180?180:((Ke[2]+180)%360+360)%360-180,or=Math.max(-90,Math.min(90,Ke[3]));if(Ke[2]-Ke[0]>=360)Xe=-180,_r=180;else if(Xe>_r){var zr=this.getClusters([Xe,Ut,180,or],Rt),he=this.getClusters([-180,Ut,_r,or],Rt);return zr.concat(he)}for(var Re=this.trees[this._limitZoom(Rt)],ye=Re.range(tr(Xe),zt(or),tr(_r),zt(Ut)),_t=[],ft=0,Nt=ye;ft<Nt.length;ft+=1){var Ft=Nt[ft],kr=Re.points[Ft];_t.push(kr.numPoints?Yt(kr):this.points[kr.index])}return _t},Ye.prototype.getChildren=function(Ke){var Rt=this._getOriginId(Ke),Xe=this._getOriginZoom(Ke),Ut="No cluster with the specified id.",_r=this.trees[Xe];if(!_r)throw new Error(Ut);var or=_r.points[Rt];if(!or)throw new Error(Ut);for(var zr=this.options.radius/(this.options.extent*Math.pow(2,Xe-1)),he=_r.within(or.x,or.y,zr),Re=[],ye=0,_t=he;ye<_t.length;ye+=1){var ft=_t[ye],Nt=_r.points[ft];Nt.parentId===Ke&&Re.push(Nt.numPoints?Yt(Nt):this.points[Nt.index])}if(Re.length===0)throw new Error(Ut);return Re},Ye.prototype.getLeaves=function(Ke,Rt,Xe){Rt=Rt||10,Xe=Xe||0;var Ut=[];return this._appendLeaves(Ut,Ke,Rt,Xe,0),Ut},Ye.prototype.getTile=function(Ke,Rt,Xe){var Ut=this.trees[this._limitZoom(Ke)],_r=Math.pow(2,Ke),or=this.options,zr=or.extent,he=or.radius,Re=he/zr,ye=(Xe-Re)/_r,_t=(Xe+1+Re)/_r,ft={features:[]};return this._addTileFeatures(Ut.range((Rt-Re)/_r,ye,(Rt+1+Re)/_r,_t),Ut.points,Rt,Xe,_r,ft),Rt===0&&this._addTileFeatures(Ut.range(1-Re/_r,ye,1,_t),Ut.points,_r,Xe,_r,ft),Rt===_r-1&&this._addTileFeatures(Ut.range(0,ye,Re/_r,_t),Ut.points,-1,Xe,_r,ft),ft.features.length?ft:null},Ye.prototype.getClusterExpansionZoom=function(Ke){for(var Rt=this._getOriginZoom(Ke)-1;Rt<=this.options.maxZoom;){var Xe=this.getChildren(Ke);if(Rt++,Xe.length!==1)break;Ke=Xe[0].properties.cluster_id}return Rt},Ye.prototype._appendLeaves=function(Ke,Rt,Xe,Ut,_r){for(var or=this.getChildren(Rt),zr=0,he=or;zr<he.length;zr+=1){var Re=he[zr],ye=Re.properties;if(ye&&ye.cluster?_r+ye.point_count<=Ut?_r+=ye.point_count:_r=this._appendLeaves(Ke,ye.cluster_id,Xe,Ut,_r):_r<Ut?_r++:Ke.push(Re),Ke.length===Xe)break}return _r},Ye.prototype._addTileFeatures=function(Ke,Rt,Xe,Ut,_r,or){for(var zr=0,he=Ke;zr<he.length;zr+=1){var Re=he[zr],ye=Rt[Re],_t=ye.numPoints,ft=void 0,Nt=void 0,Ft=void 0;if(_t)ft=Gt(ye),Nt=ye.x,Ft=ye.y;else{var kr=this.points[ye.index];ft=kr.properties,Nt=tr(kr.geometry.coordinates[0]),Ft=zt(kr.geometry.coordinates[1])}var cn={type:1,geometry:[[Math.round(this.options.extent*(Nt*_r-Xe)),Math.round(this.options.extent*(Ft*_r-Ut))]],tags:ft},yn=void 0;_t?yn=ye.id:this.options.generateId?yn=ye.index:this.points[ye.index].id&&(yn=this.points[ye.index].id),yn!==void 0&&(cn.id=yn),or.features.push(cn)}},Ye.prototype._limitZoom=function(Ke){return Math.max(this.options.minZoom,Math.min(+Ke,this.options.maxZoom+1))},Ye.prototype._cluster=function(Ke,Rt){for(var Xe=[],Ut=this.options,_r=Ut.radius,or=Ut.extent,zr=Ut.reduce,he=Ut.minPoints,Re=_r/(or*Math.pow(2,Rt)),ye=0;ye<Ke.length;ye++){var _t=Ke[ye];if(!(_t.zoom<=Rt)){_t.zoom=Rt;for(var ft=this.trees[Rt+1],Nt=ft.within(_t.x,_t.y,Re),Ft=_t.numPoints||1,kr=Ft,cn=0,yn=Nt;cn<yn.length;cn+=1){var Vi=yn[cn],ir=ft.points[Vi];ir.zoom>Rt&&(kr+=ir.numPoints||1)}if(kr>=he){for(var de=_t.x*Ft,Te=_t.y*Ft,Ue=zr&&Ft>1?this._map(_t,!0):null,Le=(ye<<5)+(Rt+1)+this.points.length,kt=0,er=Nt;kt<er.length;kt+=1){var w=er[kt],Z=ft.points[w];if(!(Z.zoom<=Rt)){Z.zoom=Rt;var Ee=Z.numPoints||1;de+=Z.x*Ee,Te+=Z.y*Ee,Z.parentId=Le,zr&&(Ue||(Ue=this._map(_t,!0)),zr(Ue,this._map(Z)))}}_t.parentId=Le,Xe.push(Je(de/kr,Te/kr,Le,kr,Ue))}else if(Xe.push(_t),kr>1)for(var je=0,Qe=Nt;je<Qe.length;je+=1){var yt=Qe[je],St=ft.points[yt];St.zoom<=Rt||(St.zoom=Rt,Xe.push(St))}}}return Xe},Ye.prototype._getOriginId=function(Ke){return Ke-this.points.length>>5},Ye.prototype._getOriginZoom=function(Ke){return(Ke-this.points.length)%32},Ye.prototype._map=function(Ke,Rt){if(Ke.numPoints)return Rt?yr({},Ke.properties):Ke.properties;var Xe=this.points[Ke.index].properties,Ut=this.options.map(Xe);return Rt&&Ut===Xe?yr({},Ut):Ut};function Je(Ct,Ke,Rt,Xe,Ut){return{x:Be(Ct),y:Be(Ke),zoom:Infinity,id:Rt,parentId:-1,numPoints:Xe,properties:Ut}}function et(Ct,Ke){var Rt=Ct.geometry.coordinates,Xe=Rt[0],Ut=Rt[1];return{x:Be(tr(Xe)),y:Be(zt(Ut)),zoom:Infinity,index:Ke,parentId:-1}}function Yt(Ct){return{type:"Feature",id:Ct.id,properties:Gt(Ct),geometry:{type:"Point",coordinates:[Pt(Ct.x),xt(Ct.y)]}}}function Gt(Ct){var Ke=Ct.numPoints,Rt=Ke>=1e4?Math.round(Ke/1e3)+"k":Ke>=1e3?Math.round(Ke/100)/10+"k":Ke;return yr(yr({},Ct.properties),{cluster:!0,cluster_id:Ct.id,point_count:Ke,point_count_abbreviated:Rt})}function tr(Ct){return Ct/360+.5}function zt(Ct){var Ke=Math.sin(Ct*Math.PI/180),Rt=.5-.25*Math.log((1+Ke)/(1-Ke))/Math.PI;return Rt<0?0:Rt>1?1:Rt}function Pt(Ct){return(Ct-.5)*360}function xt(Ct){var Ke=(180-Ct*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ke))/Math.PI-90}function yr(Ct,Ke){for(var Rt in Ke)Ct[Rt]=Ke[Rt];return Ct}function ee(Ct){return Ct.x}function vr(Ct){return Ct.y}return Ye})},75752:function(Or){Or.exports.RADIUS=6378137,Or.exports.FLATTENING=1/298.257223563,Or.exports.POLAR_RADIUS=63567523142e-4}}]);
